"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[17130],{326745:(e,t,n)=>{n.d(t,{u:()=>useAppRoute});var o=n(728234);function useAppRoute(){return(0,o.lq)()}},440905:(e,t,n)=>{n.d(t,{IM:()=>useLidoClaim,Ow:()=>useLidoWithdraw,cx:()=>useLidoStake});var o=n(324586),r=n(586330),i=n(514041),a=n(310955),c=n(927799),s=n(161024);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function useLidoStake({networkId:e,accountId:t}){var n,{navigationToSendConfirm:o}=(0,c.E)({accountId:t,networkId:e});return(0,i.useCallback)((n=(0,r.A)((function*({amount:n,stakingInfo:r,onSuccess:i,onFail:c}){var s=yield a.A.serviceAccount.getAccount({accountId:t,networkId:e}),u=yield a.A.serviceStaking.buildLidoEthStakingTransaction({amount:n,networkId:e});yield o({encodedTx:_objectSpread(_objectSpread({},u),{},{from:s.address}),stakingInfo:r,onSuccess:i,onFail:c})})),function(e){return n.apply(this,arguments)}),[o,t,e])}function useLidoWithdraw({networkId:e,accountId:t}){var n,{navigationToSendConfirm:o}=(0,c.E)({accountId:t,networkId:e});return(0,i.useCallback)((n=(0,r.A)((function*({amount:n,stakingInfo:r,onSuccess:i,onFail:c}){var u=yield a.A.serviceAccount.getAccount({accountId:t,networkId:e}),{message:l,deadline:d}=yield a.A.serviceStaking.buildLidoEthPermitMessage({accountId:t,networkId:e,amount:n}),p=yield a.A.serviceDApp.openSignMessageModal({accountId:t,networkId:e,request:{origin:"https://www.onekey.so",scope:"ethereum"},unsignedMessage:{type:s.$.TYPED_DATA_V4,message:l}}),m=yield a.A.serviceStaking.buildLidoEthWithdrawalTransaction({amount:n,signature:p,networkId:e,accountId:t,deadline:d});yield o({encodedTx:_objectSpread(_objectSpread({},m),{},{from:u.address}),stakingInfo:r,onSuccess:i,onFail:c})})),function(e){return n.apply(this,arguments)}),[t,e,o])}function useLidoClaim({networkId:e,accountId:t}){var n,{navigationToSendConfirm:o}=(0,c.E)({accountId:t,networkId:e});return(0,i.useCallback)((n=(0,r.A)((function*({requestIds:n,stakingInfo:r,onSuccess:i,onFail:c}){var s=yield a.A.serviceAccount.getAccount({accountId:t,networkId:e}),u=yield a.A.serviceStaking.buildLidoEthClaimTransaction({requestIds:n,networkId:e});yield o({encodedTx:_objectSpread(_objectSpread({},u),{},{from:s.address}),stakingInfo:r,onSuccess:i,onFail:c})})),function(e){return n.apply(this,arguments)}),[o,t,e])}},117130:(e,t,n)=>{n.r(t),n.d(t,{default:()=>pages_EthLidoStake});var o=n(586330),r=n(514041),i=n(241440),a=n(490343),c=n(498356),s=n(326745),u=n(88803),l=n(791088),d=n(391944),p=n(734809),m=n(827843),f=n(831085),LidoStake=function({price:e,balance:t,apr:n=4,minAmount:c="0",tokenImageUri:s,tokenSymbol:k,stTokenSymbol:b,onConfirm:y}){var[S,g]=(0,r.useState)(!1),[h,x]=(0,r.useState)(""),[{currencyInfo:{symbol:I}}]=(0,p.useSettingsPersistAtom)(),j=(0,r.useCallback)((function(e){new i.A(e).isNaN()?""===e&&x(""):x(e)}),[]),w=(0,r.useCallback)((0,o.A)((function*(){g(!0);try{yield y?.(h)}finally{g(!1)}})),[y,h]),A=(0,r.useMemo)((function(){var t=new i.A(h);if(!t.isNaN())return t.multipliedBy(e).toFixed()}),[h,e]),v=(0,r.useMemo)((function(){return new i.A(h).gte(t)}),[h,t]),T=(0,r.useMemo)((function(){var e=new i.A(c),t=new i.A(h);return!(!e.isGreaterThan(0)||!t.isGreaterThan(0))&&t.isLessThan(e)}),[c,h]),P=(0,r.useMemo)((function(){return(0,i.A)(h).isNaN()||v||T}),[h,v,T]),O=(0,r.useMemo)((function(){var t=(0,i.A)(h);if(!h||t.isNaN())return null;var o=(0,i.A)(h).multipliedBy(n).dividedBy(100);return(0,f.jsx)(a.XStack,{space:"$1",children:(0,f.jsxs)(a.SizableText,{children:[(0,f.jsx)(a.NumberSizeableText,{formatter:"balance",formatterOptions:{tokenSymbol:k},children:o.toFixed()}),"(",(0,f.jsx)(a.NumberSizeableText,{formatter:"value",formatterOptions:{currency:I},children:o.multipliedBy(e).toFixed()}),")"]})})}),[h,n,e,I,k]);return(0,f.jsxs)(a.YStack,{children:[(0,f.jsxs)(a.Stack,{mx:"$2",px:"$3",space:"$5",children:[(0,f.jsx)(u.J,{hasError:v||T,value:h,onChange:j,tokenSelectorTriggerProps:{selectedTokenImageUri:s,selectedTokenSymbol:k.toUpperCase()},balanceProps:{value:t},inputProps:{placeholder:"0"},valueProps:{value:A,currency:A?I:void 0}}),(0,f.jsxs)(a.YStack,{space:"$1",children:[T?(0,f.jsx)(a.Alert,{icon:"InfoCircleOutline",type:"critical",title:`The minimum amount for this staking is ${c} ${k}.`}):null,v?(0,f.jsx)(a.Alert,{icon:"InfoCircleOutline",type:"critical",title:"Insufficient balance."}):null]})]}),(0,f.jsx)(a.Stack,{children:(0,f.jsxs)(a.YStack,{children:[O?(0,f.jsx)(l.c,{title:"Est. annual rewards",titleProps:{color:"$textSubdued"},children:O}):null,h?(0,f.jsx)(l.c,{title:"Est. receive",titleProps:{color:"$textSubdued"},children:(0,f.jsx)(a.NumberSizeableText,{formatter:"balance",formatterOptions:{tokenSymbol:b},children:h})}):null,(0,f.jsx)(l.c,{title:"APR",titleProps:{color:"$textSubdued"},children:(0,f.jsx)(l.c.Text,{primary:`${n}%`,primaryTextProps:{color:"$textSuccess"}})}),(0,f.jsx)(l.c,{title:"Protocol",titleProps:{color:"$textSubdued"},children:(0,f.jsxs)(a.XStack,{space:"$2",alignItems:"center",children:[(0,f.jsx)(d.o,{size:"sm",tokenImageUri:m.a3}),(0,f.jsx)(a.SizableText,{size:"$bodyMdMedium",children:"Lido"})]})}),(0,f.jsx)(l.c,{title:"Stake Release Period",titleProps:{color:"$textSubdued"},children:(0,f.jsx)(l.c.Text,{primary:"< 4 Days"})})]})}),(0,f.jsx)(a.Page.Footer,{onConfirmText:"Stake",confirmButtonProps:{onPress:w,loading:S,disabled:P}})]})},k=n(440905);const pages_EthLidoStake=function(){var e,t=(0,s.u)(),{accountId:n,networkId:u,balance:l,price:d,token:p,apr:m,stToken:b}=t.params,y=(0,k.cx)({accountId:n,networkId:u}),S=(0,c.A)(),g=(0,r.useCallback)((e=(0,o.A)((function*(e){var t=(0,i.A)(e).shiftedBy(p.decimals).toFixed(0);yield y({amount:t,stakingInfo:{protocol:"lido",send:{token:p,amount:e},receive:{token:b,amount:e},tags:["lido-eth"]},onSuccess:function(){return S.pop()}})})),function(t){return e.apply(this,arguments)}),[y,S,p,b]);return(0,f.jsxs)(a.Page,{children:[(0,f.jsx)(a.Page.Header,{title:"Stake ETH"}),(0,f.jsx)(a.Page.Body,{children:(0,f.jsx)(LidoStake,{apr:m,price:d,balance:l,minAmount:(0,i.A)(1).shiftedBy(-p.decimals).toFixed(),tokenImageUri:p.logoURI,tokenSymbol:p.symbol,stTokenSymbol:b.symbol,onConfirm:g})})]})}},827843:(e,t,n)=>{n.d(t,{$e:()=>a,Cp:()=>r,LN:()=>i,a3:()=>o});var o="https://uni.onekey-asset.com/static/logo/Lido.png",r="https://uni.onekey-asset.com/static/chain/eth.png",i="https://uni.onekey-asset.com/static/chain/polygon.png",a="https://lido.fi/"}}]);