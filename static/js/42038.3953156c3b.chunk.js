"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[42038,52596],{508343:(e,r,n)=>{n.d(r,{G:()=>DeviceAvatar});var t=n(593827),o=n(831085);function DeviceAvatar({deviceType:e,size:r}){return(0,o.jsx)(t.L,{img:e||"unknown",wallet:void 0,size:r})}},593827:(e,r,n)=>{n.d(r,{L:()=>WalletAvatar});var t=n(503668),o=n.n(t),i=n(490343),a=n(491180),s=n(258988),l=n(831085);function WalletAvatarBase({size:e,img:r,wallet:n}){var t,o,d=r||n?.avatarInfo?.img;return d?a.A.isHwHiddenWallet({wallet:n})?(0,l.jsx)(i.Icon,{size:"$10",name:"LockSolid",color:"$iconSubdued"}):(0,l.jsxs)(i.Image,{size:e,children:[(0,l.jsx)(i.Image.Source,{source:null!=(t=s.UO[d])?t:s.UO.bear}),(0,l.jsx)(i.Image.Fallback,{delayMs:300,justifyContent:"center",alignItems:"center",children:(0,l.jsx)(i.SizableText,{children:null!=(o=n?.avatarInfo?.emoji)?o:""})})]}):null}function WalletAvatar({size:e="$10",status:r,badge:n,img:t,wallet:a}){return(0,l.jsxs)(i.Stack,{w:e,h:e,justifyContent:"center",alignItems:"center",children:[(0,l.jsx)(WalletAvatarBase,{size:e,img:t,wallet:a}),"connected"===r?(0,l.jsx)(i.Stack,{position:"absolute",bottom:-2,right:-2,bg:"$bgSidebar",p:"$0.5",borderRadius:"$full",zIndex:"$1",children:(0,l.jsx)(i.Stack,{borderRadius:"$full",w:"$2.5",h:"$2.5",bg:"$bgSuccessStrong"})}):null,o()(n)?null:(0,l.jsx)(i.Stack,{position:"absolute",bottom:-3,right:0,bg:"$bgSubdued",w:"$3.5",h:"$3.5",alignItems:"center",justifyContent:"center",borderRadius:"$full",zIndex:"$1",children:(0,l.jsx)(i.SizableText,{size:"$bodySmMedium",textAlign:"center",children:n})})]})}},394764:(e,r,n)=>{n.d(r,{Z:()=>usePrevious});var t=n(514041);function usePrevious(e){var r=(0,t.useRef)();return(0,t.useEffect)((function(){r.current=e}),[e]),r.current}},57597:(e,r,n)=>{n.r(r),n.d(r,{FirmwareUpdateGalleryDemo:()=>FirmwareUpdateGalleryDemo,default:()=>stories_FirmwareUpdateGallery});var t=n(586330),o=n(490343),i=n(310955),a=n(325809),s=n(162616),l=n(973066),d=n(139499),c=n(88569),u=n(411252),p=n(711426),h=n(853748),m=n(99202),f=n(296437),g=n(349521),w=n(613838),x={features:{vendor:"trezor.io",major_version:2,minor_version:99,patch_version:99,bootloader_mode:null,device_id:"851D737A09073D51A26A8EEB",pin_protection:!0,passphrase_protection:null,language:"zh_hk",label:"OneKey Touch",initialized:!0,revision:"fccbac81cef7877e6e3b761677ff0d83808380ad",bootloader_hash:null,imported:null,unlocked:!1,_passphrase_cached:null,firmware_present:null,needs_backup:null,flags:null,model:"T",fw_major:null,fw_minor:null,fw_patch:null,fw_vendor:null,unfinished_backup:null,no_backup:null,recovery_mode:null,capabilities:[1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17],sd_card_present:!0,sd_protection:null,wipe_code_protection:null,session_id:"47d8463911f0354f4dc1fa45d403984c43a921926f04bd7f6581c52e6973bd2d",passphrase_always_on_device:null,auto_lock_delay_ms:null,display_rotation:null,experimental_features:null,offset:null,ble_name:"Touch 3F3B",ble_ver:"2.1.0",ble_enable:!0,se_enable:null,se_ver:null,backup_only:null,onekey_version:"4.9.0",onekey_serial:null,bootloader_version:"2.4.9",serial_no:"TC01WBD202207290844270000046",spi_flash:null,initstates:null,NFT_voucher:null,cpu_info:null,pre_firmware:null,coin_switch:null,build_id:"746f7563682e342e392e302d537461626c652d303431302d66636362616338",boardloader_version:"1.0.0",busy:!1,onekey_device_type:"TOUCH",onekey_se_type:"SE608A",onekey_board_version:"1.0.0",onekey_board_hash:null,onekey_boot_version:"2.4.9",onekey_boot_hash:null,onekey_se01_version:null,onekey_se01_hash:null,onekey_se01_build_id:null,onekey_firmware_version:"4.9.0",onekey_firmware_hash:null,onekey_firmware_build_id:null,onekey_serial_no:"TC01WBD202207290844270000046",onekey_boot_build_id:null,onekey_ble_name:"Touch 3F3B",onekey_ble_version:"2.1.0",onekey_ble_build_id:null,onekey_ble_hash:null,onekey_se02_version:null,onekey_se03_version:null,onekey_se04_version:null},deviceType:"touch",deviceName:"OneKey Touch",deviceUUID:"TC01WBD202207290844270000046",hasUpgrade:!0,isBootloaderMode:!1,updateInfos:{firmware:{hasUpgrade:!0,hasUpgradeForce:!1,fromVersion:"4.9.0",toVersion:"4.9.1",releasePayload:{status:"outdated",changelog:[{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing.\r\n- Ability to view firmware version in device information.\r\n- New precision display under the Celestia network.\r\n\r\n### 🐞 Bug Fixes\r\n- Fixed a freeze when viewing transfer data on the Astar network.\r\n- Fixed missing text on the signature information page on the Lightning network.\r\n- Fixed an issue where re-entering the app after an abnormal exit during recovery phrase verification did not trigger PIN verification and the lock screen was ineffective.\r\n\r\n### 💎 Improvements\r\n- Optimized packet handling logic for signing data on the Sui network.\r\n- Enhanced the display of original text in OP_RETURN during signing transactions on the BTC network.\r\n- Improved the display of detailed signature information on the Polkadot network.\r\n"}],release:{required:!1,version:[4,9,1],bootloaderResource:"https://web.onekey-asset.com/hardware/touch/bootloader/v2.4.9/bootloader.2.4.9-Stable-0807-3e033eb.signed.bin",bootloaderVersion:[2,4,8],fullResource:"https://web.onekey-asset.com/hardware/touch/resource/res-4.9.0.zip",fullResourceRange:["3.5.0","4.0.0"],resource:"https://web.onekey-asset.com/hardware/touch/resource/resource-4.0.0-4.9.0.zip",url:"https://web.onekey-asset.com/hardware/touch/firmware/v4.9.0/touch.4.9.0-Stable-0410-fccbac8.signed.bin",fingerprint:"",changelog:{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing.\r\n- Ability to view firmware version in device information.\r\n- New precision display under the Celestia network.\r\n\r\n### 🐞 Bug Fixes\r\n- Fixed a freeze when viewing transfer data on the Astar network.\r\n- Fixed missing text on the signature information page on the Lightning network.\r\n- Fixed an issue where re-entering the app after an abnormal exit during recovery phrase verification did not trigger PIN verification and the lock screen was ineffective.\r\n\r\n### 💎 Improvements\r\n- Optimized packet handling logic for signing data on the Sui network.\r\n- Enhanced the display of original text in OP_RETURN during signing transactions on the BTC network.\r\n- Improved the display of detailed signature information on the Polkadot network.\r\n"}},bootloaderMode:!1,features:{vendor:"trezor.io",major_version:2,minor_version:99,patch_version:99,bootloader_mode:null,device_id:"851D737A09073D51A26A8EEB",pin_protection:!0,passphrase_protection:null,language:"zh_hk",label:"OneKey Touch",initialized:!0,revision:"fccbac81cef7877e6e3b761677ff0d83808380ad",bootloader_hash:null,imported:null,unlocked:!1,_passphrase_cached:null,firmware_present:null,needs_backup:null,flags:null,model:"T",fw_major:null,fw_minor:null,fw_patch:null,fw_vendor:null,unfinished_backup:null,no_backup:null,recovery_mode:null,capabilities:[1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17],sd_card_present:!0,sd_protection:null,wipe_code_protection:null,session_id:"47d8463911f0354f4dc1fa45d403984c43a921926f04bd7f6581c52e6973bd2d",passphrase_always_on_device:null,auto_lock_delay_ms:null,display_rotation:null,experimental_features:null,offset:null,ble_name:"Touch 3F3B",ble_ver:"2.1.0",ble_enable:!0,se_enable:null,se_ver:null,backup_only:null,onekey_version:"4.9.0",onekey_serial:null,bootloader_version:"2.4.9",serial_no:"TC01WBD202207290844270000046",spi_flash:null,initstates:null,NFT_voucher:null,cpu_info:null,pre_firmware:null,coin_switch:null,build_id:"746f7563682e342e392e302d537461626c652d303431302d66636362616338",boardloader_version:"1.0.0",busy:!1,onekey_device_type:"TOUCH",onekey_se_type:"SE608A",onekey_board_version:"1.0.0",onekey_board_hash:null,onekey_boot_version:"2.4.9",onekey_boot_hash:null,onekey_se01_version:null,onekey_se01_hash:null,onekey_se01_build_id:null,onekey_firmware_version:"4.9.0",onekey_firmware_hash:null,onekey_firmware_build_id:null,onekey_serial_no:"TC01WBD202207290844270000046",onekey_boot_build_id:null,onekey_ble_name:"Touch 3F3B",onekey_ble_version:"2.1.0",onekey_ble_build_id:null,onekey_ble_hash:null,onekey_se02_version:null,onekey_se03_version:null,onekey_se04_version:null}},changelog:{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing."},firmwareType:"firmware"},ble:{hasUpgrade:!0,hasUpgradeForce:!1,fromVersion:"2.1.0",toVersion:"2.1.1",releasePayload:{status:"outdated",changelog:[{"zh-CN":"### 🐞 问题修复\r\n- 充电电量显示问题\r\n- 关闭蓝牙后，能够正确关机\r\n","en-US":"### 🐞 Bug Fixes\r\n- Fixed charging power display problem\r\n- After turning off bluetooth, it can shut down properly\r\n"}],release:{required:!1,version:[2,1,1],webUpdate:"https://common.onekey-asset.com/hw/touch/2.1.0/touch_ble_signed-2022-1102_2.1.0.bin",fingerprint:"",changelog:{"zh-CN":"### 🐞 问题修复\r\n- 充电电量显示问题\r\n- 关闭蓝牙后，能够正确关机\r\n","en-US":"### 🐞 Bug Fixes\r\n- Fixed charging power display problem\r\n- After turning off bluetooth, it can shut down properly\r\n"}},bootloaderMode:!1,features:{vendor:"trezor.io",major_version:2,minor_version:99,patch_version:99,bootloader_mode:null,device_id:"851D737A09073D51A26A8EEB",pin_protection:!0,passphrase_protection:null,language:"zh_hk",label:"OneKey Touch",initialized:!0,revision:"fccbac81cef7877e6e3b761677ff0d83808380ad",bootloader_hash:null,imported:null,unlocked:!1,_passphrase_cached:null,firmware_present:null,needs_backup:null,flags:null,model:"T",fw_major:null,fw_minor:null,fw_patch:null,fw_vendor:null,unfinished_backup:null,no_backup:null,recovery_mode:null,capabilities:[1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17],sd_card_present:!0,sd_protection:null,wipe_code_protection:null,session_id:"47d8463911f0354f4dc1fa45d403984c43a921926f04bd7f6581c52e6973bd2d",passphrase_always_on_device:null,auto_lock_delay_ms:null,display_rotation:null,experimental_features:null,offset:null,ble_name:"Touch 3F3B",ble_ver:"2.1.0",ble_enable:!0,se_enable:null,se_ver:null,backup_only:null,onekey_version:"4.9.0",onekey_serial:null,bootloader_version:"2.4.9",serial_no:"TC01WBD202207290844270000046",spi_flash:null,initstates:null,NFT_voucher:null,cpu_info:null,pre_firmware:null,coin_switch:null,build_id:"746f7563682e342e392e302d537461626c652d303431302d66636362616338",boardloader_version:"1.0.0",busy:!1,onekey_device_type:"TOUCH",onekey_se_type:"SE608A",onekey_board_version:"1.0.0",onekey_board_hash:null,onekey_boot_version:"2.4.9",onekey_boot_hash:null,onekey_se01_version:null,onekey_se01_hash:null,onekey_se01_build_id:null,onekey_firmware_version:"4.9.0",onekey_firmware_hash:null,onekey_firmware_build_id:null,onekey_serial_no:"TC01WBD202207290844270000046",onekey_boot_build_id:null,onekey_ble_name:"Touch 3F3B",onekey_ble_version:"2.1.0",onekey_ble_build_id:null,onekey_ble_hash:null,onekey_se02_version:null,onekey_se03_version:null,onekey_se04_version:null}},changelog:{"zh-CN":"### 🐞 问题修复\r\n- 充电电量显示问题\r\n- 关闭蓝牙后，能够正确关机\r\n","en-US":"### 🐞 Bug Fixes\r\n- Fixed charging power display problem\r\n- After turning off bluetooth, it can shut down properly\r\n"},firmwareType:"ble"},bootloader:{hasUpgrade:!0,hasUpgradeForce:!1,fromVersion:"2.4.9",toVersion:"2.4.8",releasePayload:{status:"valid",changelog:[{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing.\r\n- Ability to view firmware version in device information.\r\n- New precision display under the Celestia network.\r\n\r\n### 🐞 Bug Fixes\r\n- Fixed a freeze when viewing transfer data on the Astar network.\r\n- Fixed missing text on the signature information page on the Lightning network.\r\n- Fixed an issue where re-entering the app after an abnormal exit during recovery phrase verification did not trigger PIN verification and the lock screen was ineffective.\r\n\r\n### 💎 Improvements\r\n- Optimized packet handling logic for signing data on the Sui network.\r\n- Enhanced the display of original text in OP_RETURN during signing transactions on the BTC network.\r\n- Improved the display of detailed signature information on the Polkadot network.\r\n"}],release:{required:!1,version:[4,9,1],bootloaderResource:"https://web.onekey-asset.com/hardware/touch/bootloader/v2.4.9/bootloader.2.4.9-Stable-0807-3e033eb.signed.bin",bootloaderVersion:[2,4,8],fullResource:"https://web.onekey-asset.com/hardware/touch/resource/res-4.9.0.zip",fullResourceRange:["3.5.0","4.0.0"],resource:"https://web.onekey-asset.com/hardware/touch/resource/resource-4.0.0-4.9.0.zip",url:"https://web.onekey-asset.com/hardware/touch/firmware/v4.9.0/touch.4.9.0-Stable-0410-fccbac8.signed.bin",fingerprint:"",changelog:{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing.\r\n- Ability to view firmware version in device information.\r\n- New precision display under the Celestia network.\r\n\r\n### 🐞 Bug Fixes\r\n- Fixed a freeze when viewing transfer data on the Astar network.\r\n- Fixed missing text on the signature information page on the Lightning network.\r\n- Fixed an issue where re-entering the app after an abnormal exit during recovery phrase verification did not trigger PIN verification and the lock screen was ineffective.\r\n\r\n### 💎 Improvements\r\n- Optimized packet handling logic for signing data on the Sui network.\r\n- Enhanced the display of original text in OP_RETURN during signing transactions on the BTC network.\r\n- Improved the display of detailed signature information on the Polkadot network.\r\n"}},bootloaderMode:!1,shouldUpdate:!1},changelog:{"zh-CN":"### 🐞 问题修复\r\n- xxxxx","en-US":"### 🐞 Bug Fixes\r\n- xxxx\r\n"},firmwareType:"bootloader"},bridge:{shouldUpdate:!1,status:"valid",releaseVersion:"2.2.0"}}},b=n(734809),v=n(507140),y=n(714191),S=n(100645),_=n(654004),j=n(831085);function ForceOpenHomeDeviceUpdateFirmwareModal(){var{activeAccount:e}=(0,s.LH)({num:0}),r=e.device?.connectId,n=(0,w.B)();return(0,j.jsx)(o.Button,{onPress:(0,t.A)((function*(){n.openChangeLogModal({connectId:r})})),children:"NormalModeUpdate"})}function ResetDetectTimeCheck(){var{activeAccount:e}=(0,s.LH)({num:0}),r=e.device?.connectId;return(0,j.jsx)(o.Button,{onPress:function(){r&&i.A.serviceFirmwareUpdate.resetShouldDetectTimeCheck({connectId:r})},children:"ResetDetectTimeCheck"})}function BootloaderModeUpdateButton(){var[e]=(0,b.useFirmwareUpdateRetryAtom)(),r=(0,w.B)();return(0,j.jsx)(o.Button,{onPress:function(){r.showBootloaderMode({connectId:void 0}),console.log({retryInfo:e})},children:"BootloaderModeUpdate"})}function ClearUpdateInfoDetectCacheButton(){var[,e]=(0,b.useFirmwareUpdatesDetectStatusAtom)();return(0,j.jsx)(o.Button,{onPress:function(){e(void 0)},children:"ClearUpdateInfoDetectCache"})}function FirmwareUpdateGalleryDemo(){return(0,j.jsx)(a.b8,{config:{sceneName:y.Zs.home},enabledNum:[0],children:(0,j.jsx)(o.Stack,{space:"$2",children:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(ForceOpenHomeDeviceUpdateFirmwareModal,{}),(0,j.jsx)(BootloaderModeUpdateButton,{}),(0,j.jsx)(ClearUpdateInfoDetectCacheButton,{}),(0,j.jsx)(ResetDetectTimeCheck,{})]})})})}function FirmwareUpdateErrorDemo({error:e,onRetry:r,result:n}){var{onRetryHandler:t,content:o,detail:i,retryText:a}=(0,h.RH)({error:e,onRetry:r,result:n,lastFirmwareTipMessage:void 0});return(0,j.jsxs)(j.Fragment,{children:[o,i]})}function FirmwareUpdateGalleryStaticUI(){var e=(0,w.B)();return(0,j.jsxs)(o.Stack,{mt:"$8",children:[(0,j.jsxs)(o.Stack,{my:"$8",children:[(0,j.jsx)(o.SizableText,{size:"$heading5xl",children:"* 首页更新提示"}),(0,j.jsx)(g.F,{message:"Firmware 3.6.0 is available"}),(0,j.jsx)(o.Button,{onPress:function(){e.showBootloaderMode({connectId:void 0})},children:"Bootloader 模式更新提示"}),(0,j.jsx)(o.Button,{onPress:function(){e.showForceUpdate({connectId:void 0})},children:"强更提示"})]}),(0,j.jsxs)(o.Stack,{my:"$8",children:[(0,j.jsx)(o.SizableText,{size:"$heading5xl",children:"* 更新检测中"}),(0,j.jsx)(d.k,{connectId:void 0})]}),(0,j.jsxs)(o.Stack,{my:"$8",children:[(0,j.jsx)(o.SizableText,{size:"$heading5xl",children:"* 更新日志（有更新）"}),(0,j.jsx)(l.z,{result:x})]}),(0,j.jsxs)(o.Stack,{my:"$8",children:[(0,j.jsx)(o.SizableText,{size:"$heading5xl",children:"* 已经是最新固件（无更新）"}),(0,j.jsx)(u.p,{})]}),(0,j.jsxs)(o.Stack,{my:"$8",children:[(0,j.jsx)(o.SizableText,{size:"$heading5xl",children:"* 升级前检查项"}),(0,j.jsx)(p.J,{result:x})]}),(0,j.jsxs)(o.Stack,{my:"$8",children:[(0,j.jsx)(o.SizableText,{size:"$heading5xl",children:"* 升级错误"}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 通用错误（直接修改 Error 类型的 defaultMessage）"}),(0,j.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.CJ}),(0,j.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.kG}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 需要手动进入 boot 模式"}),(0,j.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.e9}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 手动进入 boot 模式(mini)"}),(0,j.jsx)(h._V,{deviceType:"mini"}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 手动进入 boot 模式(classic)"}),(0,j.jsx)(h._V,{deviceType:"classic"}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 需要安装或检查 bridge 状态"}),(0,j.jsx)(o.SizableText,{children:"TODO"}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 需要手动升级 bridge"}),(0,j.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.J6}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 需要在网页端升级"}),(0,j.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.Kb}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 需要手动升级全量资源"}),(0,j.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.Rw})]}),(0,j.jsxs)(o.Stack,{my:"$8",children:[(0,j.jsx)(o.SizableText,{size:"$heading5xl",children:"* 安装进度"}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 安装提醒"}),(0,j.jsx)(f.Y,{}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 安装中"}),(0,j.jsx)(m.w,{currentStep:void 0,totalStep:void 0,title:"Preparing...",progress:12,desc:"Checking device...",fromVersion:"",toVersion:""}),(0,j.jsx)(m.w,{currentStep:1,totalStep:1,title:"Preparing...(Only One Step, no step text bar is displayed)",progress:12,desc:"Checking device...",fromVersion:"",toVersion:""}),(0,j.jsx)(m.w,{currentStep:1,totalStep:3,title:"Updating firmware...",progress:20,desc:"Downloading...",fromVersion:"1.0.0",toVersion:"1.0.1"}),(0,j.jsx)(m.w,{currentStep:2,totalStep:3,title:"Updating bluetooth...",progress:50,desc:"Transferring...",fromVersion:"1.0.0",toVersion:"1.0.1"}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 安装出错重试(和前面的 Error 组件共享 UI)"}),(0,j.jsx)(c.V,{result:x,tipMessage:S.rn.FirmwareEraseSuccess,retryInfo:{id:0,error:new v.e9}}),(0,j.jsx)(o.SizableText,{size:"$heading2xl",children:"** 安装完成"}),(0,j.jsx)(c.V,{result:x,isDone:!0,tipMessage:S.rn.AutoRebootToBootloader,retryInfo:void 0})]})]})}const stories_FirmwareUpdateGallery=function(){return(0,j.jsx)(_.P,{description:"--",suggestions:["--"],boundaryConditions:["--"],elements:[{title:"--",element:(0,j.jsxs)(o.Stack,{space:"$1",children:[(0,j.jsx)(FirmwareUpdateGalleryDemo,{}),(0,j.jsx)(FirmwareUpdateGalleryStaticUI,{})]})}]})}},654004:(e,r,n)=>{n.d(r,{P:()=>Layout});var t=n(586330),o=n(728234),i=n(490343),a=n(795871),s=n(310955),l=n(498356),d=n(730223),c=n(831085),FormattedText=function({text:e}){return"string"==typeof e?(0,c.jsx)(i.Stack,{children:(0,c.jsxs)(i.SizableText,{children:[e,"。 "]})}):Array.isArray(e)&&0===e.length?null:(0,c.jsx)(i.Stack,{children:(0,c.jsx)(i.Stack,{space:"$1",children:e.map((function(r,n){return(0,c.jsx)(i.Stack,{children:(0,c.jsxs)(i.SizableText,{children:[n+1,". ",r,n===e.length-1?"。":"；"]})},n.toString())}))})})};function Layout({description:e="",suggestions:r=[],boundaryConditions:n=[],elements:u=[],scrollEnabled:p=!0,contentInsetAdjustmentBehavior:h="never",skipLoading:m=!1,children:f}){var g=(0,a.U6)(),w=(0,l.A)();return(0,c.jsx)(i.Page,{skipLoading:m,children:(0,c.jsx)(i.ScrollView,{maxWidth:"100%",scrollEnabled:p,flex:1,marginBottom:g,paddingHorizontal:"$5",contentContainerStyle:{paddingTop:20,paddingBottom:280},keyboardDismissMode:"on-drag",contentInsetAdjustmentBehavior:h,children:(0,c.jsxs)(i.Stack,{marginHorizontal:"auto",maxWidth:"100%",width:576,space:"$6",children:[(0,c.jsxs)(i.XStack,{children:[(0,c.jsx)(i.IconButton,{icon:"HomeLineOutline",onPress:function(){w.dispatch(o.y9.replace(d.WP.Main,{screen:d.V4.Developer,params:{screen:d.f$.TabDeveloper}}))}}),(0,c.jsx)(i.Button,{ml:"$4",onPress:(0,t.A)((function*(){yield s.A.serviceSetting.setTheme("light")})),children:"Light Theme"}),(0,c.jsx)(i.Button,{ml:"$4",variant:"primary",onPress:(0,t.A)((function*(){yield s.A.serviceSetting.setTheme("dark")})),children:"Dark Theme"})]}),e?(0,c.jsxs)(i.Stack,{space:"$2",children:[(0,c.jsx)(i.Stack,{children:(0,c.jsx)(i.SizableText,{size:"$headingXl",children:"使用说明"})}),(0,c.jsx)(i.Stack,{children:(0,c.jsx)(FormattedText,{text:e})})]}):null,r?(0,c.jsxs)(i.Stack,{space:"$2",children:[(0,c.jsx)(i.Stack,{children:(0,c.jsx)(i.SizableText,{size:"$headingXl",children:"使用建议"})}),(0,c.jsx)(FormattedText,{text:r})]}):null,n?.length>0?(0,c.jsxs)(i.Stack,{space:"$2",children:[(0,c.jsx)(i.Stack,{children:(0,c.jsx)(i.SizableText,{size:"$headingXl",children:"注意事项"})}),(0,c.jsx)(FormattedText,{text:n})]}):null,(0,c.jsxs)(i.Stack,{space:"$2",children:[(0,c.jsx)(i.Stack,{children:(0,c.jsx)(i.SizableText,{size:"$headingXl",children:"组件案例"})}),(0,c.jsx)(i.Stack,{children:u?.map((function(e,r){return(0,c.jsxs)(i.Stack,{space:"$2",pb:"$8",mb:"$8",borderBottomWidth:"$px",borderBottomColor:"$borderSubdued",children:[(0,c.jsxs)(i.Stack,{flexDirection:"column",children:[(0,c.jsx)(i.SizableText,{size:"$headingLg",children:e.title}),e.description?(0,c.jsx)(i.Stack,{paddingTop:1,children:(0,c.jsxs)(i.SizableText,{children:[e.description,"。"]})}):null]}),(0,c.jsx)(i.Stack,{children:"function"==typeof e.element?(0,c.jsx)(e.element,{}):e.element})]},`elements-${r}`)}))}),(0,c.jsx)(i.Stack,{children:f?(0,c.jsx)(i.Stack,{space:"$3",children:f}):null})]})]})})})}},973066:(e,r,n)=>{n.d(r,{i:()=>FirmwareChangeLogContentView,z:()=>FirmwareChangeLogView});var t=n(514041),o=n(490343),i=n(734809),a=n(225555),s=n(701088),l=n(443791),d=n(831085);function ChangeLogSection({title:e,icon:r,isDone:n,updateInfo:i}){var[a,s]=(0,t.useState)(n),c=(0,t.useCallback)((function(){s(!a)}),[a]);return(0,d.jsxs)(o.Stack,{children:[(0,d.jsxs)(o.XStack,{space:"$3",py:"$2",ai:"center",onPress:c,children:[(0,d.jsx)(o.Icon,{name:r,size:"$5"}),(0,d.jsxs)(o.Stack,{flex:1,children:[(0,d.jsx)(o.SizableText,{size:"$bodyLgMedium",children:e}),(0,d.jsx)(o.SizableText,{size:"$bodyMd",color:n?"$textSubdued":"$textInfo",children:n?`Updated to the latest version ${i?.toVersion||""}`:`${i?.toVersion||""} is available`})]}),(0,d.jsx)(o.IconButton,{icon:a?"ChevronDownSmallOutline":"ChevronTopSmallOutline",variant:"tertiary"})]}),a?null:(0,d.jsxs)(o.Stack,{bg:"$bgStrong",p:"$5",borderRadius:"$3",children:[(0,d.jsx)(l.Y,{fromVersion:i?.fromVersion||"?.?.?",toVersion:i?.toVersion}),(0,d.jsx)(o.Markdown,{children:i?.changelog?.["en-US"]||"No change log found."})]})]})}function FirmwareChangeLogContentView({result:e,isDone:r}){return(0,d.jsxs)(o.Stack,{mt:"$8",children:[e?.updateInfos?.bootloader?.hasUpgrade?(0,d.jsx)(ChangeLogSection,{title:"Bootloader",icon:"StorageOutline",updateInfo:e?.updateInfos?.bootloader,isDone:r}):null,e?.updateInfos?.ble?.hasUpgrade?(0,d.jsx)(ChangeLogSection,{title:"BlueTooth",icon:"BluetoothOutline",updateInfo:e?.updateInfos?.ble,isDone:r}):null,e?.updateInfos?.firmware?.hasUpgrade?(0,d.jsx)(ChangeLogSection,{title:"Firmware",icon:"LaunchOutline",updateInfo:e?.updateInfos?.firmware,isDone:r}):null]})}function FirmwareChangeLogView({result:e}){var[,r]=(0,i.useFirmwareUpdateStepInfoAtom)();return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(a.nv,{onConfirmText:"Update Now",onConfirm:function(){return r({step:i.EFirmwareUpdateSteps.showCheckList,payload:void 0})}}),(0,d.jsxs)(o.Stack,{children:[(0,d.jsx)(s.N,{result:e}),(0,d.jsx)(FirmwareChangeLogContentView,{result:e})]})]})}},139499:(e,r,n)=>{n.d(r,{k:()=>FirmwareCheckingLoading});var t=n(8904),o=n(490343),i=n(831085),Spacer=function({height:e=16}){return(0,i.jsx)(t.S,{style:{height:e}})};function FirmwareCheckingLoading({connectId:e}){return(0,i.jsxs)(o.Stack,{py:"$8",children:[(0,i.jsx)(o.Skeleton,{radius:"round",height:56,width:56}),(0,i.jsxs)(o.SizableText,{my:"$6",size:"$heading2xl",children:["Checking for updates..."," "]}),(0,i.jsx)(o.Skeleton,{width:250,height:24}),(0,i.jsx)(Spacer,{height:12}),(0,i.jsx)(o.Skeleton,{width:"100%",height:24}),(0,i.jsx)(Spacer,{height:12}),(0,i.jsx)(o.Skeleton,{width:"100%",height:24}),null]})}},88569:(e,r,n)=>{n.d(r,{m:()=>FirmwareInstallingView,V:()=>FirmwareInstallingViewBase});var t=n(514041),o=n(490343),i=n(734809),a=n(613838),s=n(973066),l=n(723337),d=n(225555),c=n(831085);function FirmwareUpdateDone({result:e}){var r=(0,a.B)();return(0,c.jsxs)(o.Stack,{children:[(0,c.jsx)(l.u,{icon:"CheckRadioSolid",tone:"success",title:"All updates complete 👏🏻"}),(0,c.jsx)(s.i,{result:e,isDone:!0}),(0,c.jsx)(d.nv,{onConfirmText:"Got it",onConfirm:function(){r.closeUpdateModal()}})]})}var u=n(853748),p=n(99202),h=n(701088);function FirmwareInstallingViewBase({result:e,isDone:r,tipMessage:n,retryInfo:i,progressBarKey:a}){(0,c.jsx)(h.N,{result:e});var s=(0,t.useMemo)((function(){return r?(0,c.jsx)(FirmwareUpdateDone,{result:e}):i?(0,c.jsx)(u.uH.InstallingErrors,{retryInfo:i,result:e,lastFirmwareTipMessage:n}):(0,c.jsx)(p.D,{lastFirmwareTipMessage:n,isDone:r},a)}),[r,a,e,i,n]);return(0,c.jsx)(o.Stack,{children:s})}function FirmwareInstallingView({result:e,isDone:r}){var[n]=(0,i.useFirmwareUpdateStepInfoAtom)(),[o]=(0,i.useFirmwareUpdateRetryAtom)(),[a]=(0,i.useHardwareUiStateAtom)(),s=(0,t.useRef)(0);n.step===i.EFirmwareUpdateSteps.updateStart&&(s.current=n.payload.startAtTime);var l=a?.payload?.firmwareTipData?.message,[d,u]=(0,t.useState)();return(0,t.useEffect)((function(){l&&u(l)}),[l]),(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(FirmwareInstallingViewBase,{result:e,isDone:r,tipMessage:d,retryInfo:o,progressBarKey:s.current})})}},411252:(e,r,n)=>{n.d(r,{p:()=>FirmwareLatestVersionInstalled});var t=n(490343),o=n(723337),i=n(831085);function FirmwareLatestVersionInstalled(){return(0,i.jsx)(t.Stack,{children:(0,i.jsx)(o.u,{icon:"CheckLargeOutline",tone:"success",title:"You are on the latest version",message:"No further updates are required at this time."})})}},723337:(e,r,n)=>{n.d(r,{u:()=>FirmwareUpdateBaseMessageView});var t=n(514041),o=n(490343),i=n(831085),getColors=function(e){switch(e){case"destructive":return{iconWrapperBg:"$bgCritical",iconColor:"$iconCritical"};case"warning":return{iconWrapperBg:"$bgCaution",iconColor:"$iconCaution"};case"success":return{iconWrapperBg:"$bgSuccess",iconColor:"$iconSuccess"};default:return{iconWrapperBg:"$bgStrong",iconColor:"$icon"}}};function FirmwareUpdateBaseMessageView({icon:e,title:r,tone:n,message:a,linkList:s}){var l=(0,t.useCallback)((function(){return e?.endsWith("Solid")?(0,i.jsx)(o.Icon,{name:e,size:"$14",color:getColors(n).iconColor}):(0,i.jsx)(o.Stack,{alignSelf:"flex-start",p:"$3",borderRadius:"$full",bg:getColors(n).iconWrapperBg,children:(0,i.jsx)(o.Icon,{name:e,size:"$7",color:getColors(n).iconColor})})}),[e,n]);return(0,i.jsxs)(o.Stack,{py:"$6",children:[e?l():null,r?(0,i.jsx)(o.SizableText,{my:"$4",size:"$heading2xl",children:r}):null,a?(0,i.jsx)(o.RichSizeableText,{size:"$bodyLg",color:"$textSubdued",linkList:s,children:a}):null]})}},711426:(e,r,n)=>{n.d(r,{J:()=>FirmwareUpdateCheckList});var t=n(586330),o=n(514041),i=n(490343),a=n(734809),s=n(16853),l=(n(663522),n(310955)),d=n(225555),c=n(831085);function FirmwareUpdateCheckList({result:e}){var[,r]=(0,a.useFirmwareUpdateStepInfoAtom)(),[,n]=(0,a.useFirmwareUpdateWorkflowRunningAtom)(),[u,p]=(0,o.useState)([{label:"I've backed up my recovery phrase.",emoji:"✅",value:!1},{label:"My device is connected via USB cable.",emoji:"📲",value:!1},{label:"The device battery is fully charged.",emoji:"🔋",value:!1},{label:"Only one device is connected.",emoji:"📱",value:!1},{label:"All other OneKey Apps and web upgrade tools are closed.",emoji:"🆗",value:!1}]),h=(0,o.useCallback)((function(e){e.value=!e.value,p([...u])}),[u]),m=(0,o.useMemo)((function(){return u.every((function(e){return e.value}))}),[u]);return(0,c.jsxs)(i.Stack,{children:[(0,c.jsx)(i.SizableText,{size:"$heading2xl",my:"$8",children:"Ready to Upgrade? Let’s Check You're all set 📝"}),(0,c.jsx)(i.Stack,{space:"$3",children:u.map((function(e){return(0,c.jsx)(i.Checkbox,{value:e.value,label:e.value?`${e.label} ${e.emoji}`:e.label,onChange:function(){return h(e)}},e.label)}))}),(0,c.jsx)(d.nv,{confirmButtonProps:{disabled:!m},onConfirm:e?(0,t.A)((function*(){if(e)try{r({step:a.EFirmwareUpdateSteps.updateStart,payload:{startAtTime:Date.now()}}),n(!0),yield l.A.serviceFirmwareUpdate.startUpdateWorkflow({backuped:!0,usbConnected:!0,releaseResult:e}),r({step:a.EFirmwareUpdateSteps.updateDone,payload:void 0})}catch(e){r({step:a.EFirmwareUpdateSteps.error,payload:{error:(0,s.xm)(e)}})}finally{n(!1)}})):void 0,onConfirmText:"Continue"})]})}},853748:(e,r,n)=>{n.d(r,{_V:()=>EnterBootModeGuide,uH:()=>x,RH:()=>useFirmwareUpdateErrors});var t=n(586330),o=n(514041),i=n(813362),a=n(490343),s=n(734809),l=n(726130),d=n(319357),c=n(514527),u=n(117746),p=n(100645),h=n(310955);const m=n.p+"static/media/enter-boot-guide-mini.e82812de54d81a27fd02.png";var f=n(723337),g=n(225555),w=n(831085);function CommonError({message:e,title:r}){return(0,w.jsx)(f.u,{title:r||"Error Occurred",message:e})}function ShouldUpdateBridge({result:e}){return(0,w.jsxs)(a.Stack,{children:[(0,w.jsx)(f.u,{icon:"InfoCircleOutline",title:"New Bridge Version Available for Update",message:"Hardware update requires the latest bridge software. Please visit our online tutorial <a>[Solution for failed firmware upgrade on Touch]</a> for detailed installation instructions.",linkList:[{url:l.F3}]}),(0,w.jsx)(g.nv,{onConfirm:function(){(0,u.Dr)(l.F3)},onConfirmText:"Visit website"})]})}function ShouldUpdateByWeb(){return(0,w.jsxs)(a.Stack,{children:[(0,w.jsx)(f.u,{icon:"InfoCircleOutline",title:"Update in official web tool",message:"Your hardware wallet firmware requires an update. Please visit <a>firmware.onekey.so</a> on your computer to proceed with the upgrade.",linkList:[{url:l.BZ}]}),(0,w.jsx)(g.nv,{onConfirm:function(){(0,u.Dr)(l.BZ)},onConfirmText:"Visit website"})]})}function HowToUpdateFullResource(){return(0,w.jsxs)(a.Stack,{children:[(0,w.jsx)(f.u,{icon:"InfoCircleOutline",title:"Outdated Version Detected",message:"Your current firmware version is too low. Please visit our online tutorial <a>[Solution for failed firmware upgrade on Touch]</a> and follow the step-by-step instructions to complete the update.",linkList:[{url:l.Kj}]}),(0,w.jsx)(g.nv,{onConfirm:function(){(0,u.Dr)(l.Kj)},onConfirmText:"View tutorial"})]})}function EnterBootModeGuide({deviceType:e}){return"mini"===e?(0,w.jsxs)(a.Stack,{mb:"$6",children:[(0,w.jsx)(a.Image,{w:353,h:224,source:m}),(0,w.jsx)(a.SizableText,{size:"$headingMd",children:"Manually Entering BootLoader Mode"}),(0,w.jsx)(a.SizableText,{mt:"$2",color:"$textSubdued",children:"To enter BootLoader mode on your OneKey Mini, press and hold the lock screen button while inserting the data cable into the computer, then click 'Verify Status and Continue'."})]}):(0,w.jsx)(a.Stack,{mb:"$6",children:(0,w.jsx)(a.RichSizeableText,{mt:"$2",linkList:[{url:l.Kj}],children:'Follow the <a>online tutorial</a> to proceed manually, then click "Retry".'})})}function useFirmwareUpdateErrors({error:e,onRetry:r,result:n,lastFirmwareTipMessage:t}){var a="Retry";return(0,o.useMemo)((function(){return(0,c.R4)({error:e,code:i.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot})||(0,c.R4)({error:e,code:i.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure})||e&&t===p.rn.AutoRebootToBootloader?{content:(0,w.jsx)(CommonError,{title:e?.message}),detail:(0,w.jsx)(EnterBootModeGuide,{deviceType:n?.deviceType}),onRetryHandler:r,retryText:"mini"===n?.deviceType?"Verify Status and Continue":a}:(0,c.R4)({error:e,code:[i.HardwareErrorCode.BridgeNetworkError,i.HardwareErrorCode.BridgeTimeoutError,i.HardwareErrorCode.BridgeNotInstalled,d.o.NeedOneKeyBridge]})?{content:(0,w.jsx)(CommonError,{message:e?.message}),onRetryHandler:r,retryText:a}:(0,c.R4)({error:e,code:d.o.NeedOneKeyBridgeUpgrade})?{content:(0,w.jsx)(ShouldUpdateBridge,{result:n}),retryText:a}:(0,c.R4)({error:e,code:d.o.NeedFirmwareUpgradeFromWeb})?{content:(0,w.jsx)(ShouldUpdateByWeb,{}),retryText:a}:(0,c.R4)({error:e,code:i.HardwareErrorCode.UseDesktopToUpdateFirmware})?{content:(0,w.jsx)(HowToUpdateFullResource,{}),retryText:a}:e?{content:(0,w.jsx)(CommonError,{message:e?.message}),onRetryHandler:r,retryText:a}:{content:null,retryText:a}}),[e,t,r,n])}var x={ShouldUpdateBridge,CommonError,EnterBootModeGuide,WorkflowErrors:function WorkflowErrors({onRetry:e,error:r,result:n}){var{onRetryHandler:t,content:o,retryText:i}=useFirmwareUpdateErrors({error:r,onRetry:e,result:n,lastFirmwareTipMessage:void 0});return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(g.nv,{onConfirm:t,onConfirmText:i||"Retry"}),o]})},InstallingErrors:function InstallingErrors({retryInfo:e,result:r,lastFirmwareTipMessage:n}){var[,i]=(0,s.useFirmwareUpdateStepInfoAtom)(),a=(0,o.useCallback)((0,t.A)((function*(){if(!e)return null;console.error("retry error",e?.error),i({step:s.EFirmwareUpdateSteps.updateStart,payload:{startAtTime:Date.now()}}),yield h.A.serviceFirmwareUpdate.retryUpdateTask({id:e?.id,connectId:r?.updatingConnectId,releaseResult:r})})),[r,e,i]),{content:l,detail:d,onRetryHandler:c,retryText:u}=useFirmwareUpdateErrors({onRetry:a,result:r,lastFirmwareTipMessage:n,error:e?.error});return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(g.nv,{onConfirm:c,onConfirmText:u||"Retry"}),l,d]})}}},225555:(e,r,n)=>{n.d(r,{nv:()=>a,oh:()=>FirmwareUpdatePageLayout});var t=n(490343),o=n(498356),i=n(831085);function FirmwareUpdatePageHeader(){return(0,i.jsx)(t.Page.Header,{dismissOnOverlayPress:!1,title:"Hardware Update"})}var a=t.Page.Footer;function FirmwareUpdatePageLayout({children:e}){(0,o.A)();return(0,i.jsxs)(t.Stack,{children:[(0,i.jsx)(FirmwareUpdatePageHeader,{}),(0,i.jsx)(t.Page.Body,{children:(0,i.jsx)(t.Stack,{p:"$5",children:e})})]})}},99202:(e,r,n)=>{n.d(r,{D:()=>FirmwareUpdateProgressBar,w:()=>FirmwareUpdateProgressBarView});var t=n(460986),o=n.n(t),i=n(514041),a=n(490343),s=n(734809),l=n(284908),d=n(100645),c=n(310955),u=n(394764),p=n(443791),h=n(831085),defaultDesc=function(){return"Checking device"},m=10;function FirmwareUpdateProgressBarView({totalStep:e,currentStep:r,title:n,fromVersion:t,toVersion:o,progress:s,desc:l}){var d=(0,i.useMemo)((function(){return e&&r?e<=1?null:(0,h.jsx)(a.SizableText,{size:"$bodyMd",color:"$textSubdued",children:`Step ${r}/${e}`}):(0,h.jsx)(a.Skeleton,{width:120,height:16})}),[r,e]),c=(0,i.useMemo)((function(){return o?(0,h.jsx)(p.Y,{fromVersion:t,toVersion:o}):(0,h.jsx)(a.Skeleton,{width:80,height:16})}),[t,o]);return(0,h.jsxs)(a.Stack,{py:"$6",children:[d,(0,h.jsx)(a.SizableText,{size:"$heading2xl",my:"$3",children:n}),c,(0,h.jsx)(a.Stack,{mt:"$12",mb:"$3",children:(0,h.jsx)(a.Progress,{size:"medium",value:s})}),(0,h.jsx)(a.SizableText,{size:"$bodyLg",color:"$textSubdued",children:l})]})}function FirmwareUpdateProgressBar({lastFirmwareTipMessage:e,isDone:r}){var[n]=(0,s.useFirmwareUpdateStepInfoAtom)(),[t]=(0,s.useHardwareUiStateAtom)(),[p]=(0,s.useHardwareUiStateCompletedAtom)(),[f,g]=(0,i.useState)(1),[w]=(0,s.useFirmwareUpdateRetryAtom)(),x=(0,i.useRef)(f);x.current=f;var b=(0,i.useRef)(m),[v,y]=(0,i.useState)(defaultDesc()),S=(0,i.useMemo)((function(){if(n?.step===s.EFirmwareUpdateSteps.installing)return n.payload.installingTarget?.updateInfo?.firmwareType||void 0}),[n.payload,n?.step]),{totalStep:_,currentStep:j}=(0,i.useMemo)((function(){if(n?.step===s.EFirmwareUpdateSteps.installing){var e=n?.payload?.installingTarget;if(e)return{totalStep:e.totalPhase.length,currentStep:e.totalPhase.findIndex((function(r){return r===e.currentPhase}))+1}}return{totalPhase:null,currentPhase:null}}),[n.payload,n?.step]),k=(0,i.useMemo)((function(){if(n?.step===s.EFirmwareUpdateSteps.installing)return{fromVersion:n.payload.installingTarget?.updateInfo.fromVersion||void 0,toVersion:n.payload.installingTarget?.updateInfo.toVersion||void 0}}),[n.payload,n?.step]),U=t?.payload?.firmwareTipData?.message,F=t?.payload?.firmwareProgress,T=l.A.isConfirmOnDeviceAction(t),C=([d.rn.CheckLatestUiResource,d.rn.DownloadLatestUiResource,d.rn.DownloadLatestUiResourceSuccess,d.rn.UpdateSysResource,d.rn.UpdateSysResourceSuccess].includes(e),(0,u.Z)(S)),z=(0,i.useRef)(F);z.current=F;var $=(0,i.useRef)([]),B=(0,i.useMemo)((function(){var n="Preparing...";return e&&(n="Updating..."),S&&(n=`Updating ${S}...`,"ble"===S&&(n="Updating bluetooth...")),r&&(n="Done"),n}),[S,r,e]),I=(0,i.useCallback)((function(e){var r=[{type:["checking"],progress:function(){return 1},progressMax:function(){return m},desc:function(){return defaultDesc()}},{type:[d.rn.CheckLatestUiResource],progress:function(){return 2},desc:function(){return"CheckLatestUiResource"}},{type:[d.rn.DownloadLatestUiResource],progress:function(){return 3},desc:function(){return"DownloadLatestUiResource"}},{type:[d.rn.DownloadLatestUiResourceSuccess],progress:function(){return 5},desc:function(){return"DownloadLatestUiResourceSuccess"}},{type:[d.rn.UpdateSysResource],progress:function(){return 7},desc:function(){return"UpdateSysResource"}},{type:[d.rn.UpdateSysResourceSuccess],progress:function(){return 9},desc:function(){return"UpdateSysResourceSuccess"}},{type:[d.rn.AutoRebootToBootloader],progress:function(){return 10},desc:function(){return"Reboot to bootloader mode"}},{type:[d.rn.GoToBootloaderSuccess],progress:function(){return 12},desc:function(){return"Reboot success, downloading"}},{type:[d.rn.DownloadFirmware,d.rn.DownloadLatestBootloaderResource],progress:function(){return 14},desc:function(){return"Downloading"}},{type:[d.rn.DownloadFirmwareSuccess,d.rn.DownloadLatestBootloaderResourceSuccess],progress:function(){return 20},desc:function(){return"Download success"}},{type:[d.rn.FirmwareEraseSuccess],progress:function(){return 25},desc:function(){return"Transferring data"}},{type:["installing"],progress:function(){var e,r=30+.7*(null!=(e=z.current)?e:0);return r>=99&&(r=99),r},desc:function(){return 100===z.current?"Data transferred, installing...":"Transferring data"}},{type:["done"],progress:function(){return 100},desc:function(){return"Firmware Update Done!"}}],n=r.findIndex((function(r){return r.type.includes(e)}));if(n>=0){var t,o=r[n],i=o.progress(),a=x.current;g((function(){var r=Math.max(i,a);return console.log("setProgress>>>>",{newProgress:r,itemProgress:i,currentProgress:a,type:e}),x.current=r,r})),y(o.desc());var s=r[n+1],l=null!=(t=o?.progressMax?.())?t:s?.progress();b.current=l||99}}),[]),R=(0,i.useRef)(I);R.current=I,console.log("progressRef.current >>>",x.current,e),(0,i.useEffect)((function(){console.log("firmwareType>>>>",{firmwareType:S,prevFirmwareType:C}),w||S&&C&&S!==C&&(g(1),x.current=1,b.current=99,R.current("checking"))}),[S,C,w]),(0,i.useEffect)((function(){n?.step!==s.EFirmwareUpdateSteps.updateStart&&S||y(defaultDesc())}),[S,n?.step]),(0,i.useEffect)((function(){var e=setInterval((function(){if(!w&&!r&&!T){var e=x.current;g((function(){if(e>=b.current)return b.current;if(e>=99)return 99;var r=Math.min(e+1,b.current,99);return x.current=r,r}))}}),2e3);return function(){clearInterval(e)}}),[S,T,r,w]),(0,i.useEffect)((function(){r&&setTimeout((function(){R.current("done")}),1e3)}),[r]),(0,i.useEffect)((function(){U&&$.current.push(U)}),[U]),(0,i.useEffect)((function(){o()(F)&&R.current("installing")}),[F]),(0,i.useEffect)((function(){p?.action===s.EHardwareUiStateAction.CLOSE_UI_WINDOW&&c.A.serviceHardwareUI.closeHardwareUiStateDialog({skipDeviceCancel:!0,connectId:void 0})}),[p?.action]),(0,i.useEffect)((function(){e&&R.current(e)}),[e]);var[A,D]=(0,i.useState)(!1),E=(0,i.useMemo)((function(){0}),[F,e,f,A]);return(0,h.jsxs)(a.Stack,{children:[(0,h.jsx)(FirmwareUpdateProgressBarView,{totalStep:_,currentStep:j,title:B,progress:f,desc:v,fromVersion:k?.fromVersion,toVersion:k?.toVersion}),E]})}},701088:(e,r,n)=>{n.d(r,{N:()=>FirmwareUpdateWalletProfile});var t=n(490343),o=n(508343),i=n(831085);function FirmwareUpdateWalletProfile({result:e}){return(0,i.jsxs)(t.Stack,{onPress:function(){console.log("ICheckAllFirmwareReleaseResult",e)},children:[(0,i.jsx)(o.G,{size:"$14",deviceType:e?.deviceType||"unknown"}),(0,i.jsx)(t.SizableText,{mt:"$5",size:"$heading2xl",children:"New hardware updates 🎉"})]})}},296437:(e,r,n)=>{n.d(r,{Y:()=>FirmwareUpdateWarningMessage});var t=n(490343),o=(n(663522),n(831085));function FirmwareUpdateWarningMessage(){return(0,o.jsx)(t.Stack,{backgroundColor:"$bgCautionSubdued",m:"$-5",py:"$3",px:"$5",mb:"$6",children:(0,o.jsx)(t.SizableText,{children:"Keep USB connected and app active during the upgrade."})})}},443791:(e,r,n)=>{n.d(r,{Y:()=>FirmwareVersionProgressBar});var t=n(490343),o=n(831085);function FirmwareVersionProgressBar({fromVersion:e="",toVersion:r=""}){return(0,o.jsxs)(t.XStack,{space:"$2.5",alignItems:"center",children:[(0,o.jsx)(t.Badge,{badgeType:"default",badgeSize:"lg",children:e}),(0,o.jsx)(t.Icon,{name:"ArrowRightSolid",size:"$4"}),(0,o.jsx)(t.Badge,{badgeType:"info",badgeSize:"lg",children:r})]})}},349521:(e,r,n)=>{n.d(r,{F:()=>FirmwareUpdateReminderAlert,a:()=>HomeFirmwareUpdateReminder});var t=n(586330),o=n(514041),i=n(490343),a=n(734809),s=n(714191),l=n(310955),d=n(325809),c=n(498356),u=n(911998),p=n(162616),h=n(613838),m=n(318822);function BootloaderModeUpdateReminder(){var e=(0,c.A)(),r=(0,h.B)();return(0,o.useEffect)((function(){var fn=function(e){r.showBootloaderMode({connectId:e.connectId})};return m.iL.on(m.Tu.ShowFirmwareUpdateFromBootloaderMode,fn),function(){m.iL.off(m.Tu.ShowFirmwareUpdateFromBootloaderMode,fn)}}),[r,e]),null}var f=n(728234),g=n(491180),w=n(831085);function HomeFirmwareUpdateDetectCmp(){var{activeAccount:e}=(0,p.LH)({num:0}),r=e.device?.connectId,n=(0,f.jH)(),t=(0,o.useMemo)((function(){return g.A.isHwWallet({walletId:e.wallet?.id})}),[e.wallet?.id]);return(0,o.useEffect)((function(){t&&r&&n&&l.A.serviceFirmwareUpdate.detectActiveAccountFirmwareUpdates({connectId:r})}),[t,r,n]),null}var x=(0,o.memo)((function HomeFirmwareUpdateDetectWithProvider(){return(0,w.jsx)(d.b8,{config:{sceneName:s.Zs.home},enabledNum:[0],children:(0,w.jsx)(HomeFirmwareUpdateDetectCmp,{})})}));function FirmwareUpdateReminderAlert({message:e,onPress:r}){return(0,w.jsxs)(i.XStack,{px:"$5",py:"$2",borderTopWidth:"$px",borderBottomWidth:"$px",bg:"$bgInfoSubdued",borderColor:"$borderInfoSubdued",alignItems:"center",space:"$2",flex:1,children:[(0,w.jsx)(i.Icon,{size:"$4",name:"DownloadOutline",color:"$iconInfo"}),(0,w.jsx)(i.SizableText,{flex:1,size:"$bodyMdMedium",color:"$text",numberOfLines:1,children:e}),(0,w.jsx)(i.Button,{size:"small",onPress:r,children:"View"})]})}function HomeFirmwareUpdateReminderCmp(){var{activeAccount:e}=(0,p.LH)({num:0}),r=e.device?.connectId,n=(0,h.B)(),[s]=(0,a.useFirmwareUpdatesDetectStatusAtom)(),{result:d}=((0,c.A)(),(0,u.yk)((0,t.A)((function*(){if(r){var e=s?.[r],n=e?.connectId===r&&e?.hasUpgrade;yield l.A.serviceFirmwareUpdate.getFirmwareUpdateDetectInfo({connectId:r});return{shouldUpdate:n,detectResult:e}}})),[r,s])),m=(0,o.useMemo)((function(){if(d?.shouldUpdate){var e="New firmware is available";return d?.detectResult?.toVersion?e=`Firmware ${d?.detectResult?.toVersion} is available`:d?.detectResult?.toVersionBle&&(e=`BLE Firmware ${d?.detectResult?.toVersionBle} is available`),(0,w.jsx)(FirmwareUpdateReminderAlert,{message:e,onPress:(0,t.A)((function*(){n.openChangeLogModal({connectId:r})}))})}return null}),[n,r,d]);return(0,w.jsxs)(i.XStack,{children:[(0,w.jsx)(x,{}),(0,w.jsx)(BootloaderModeUpdateReminder,{}),m]})}function HomeFirmwareUpdateReminder(){return(0,w.jsx)(d.b8,{config:{sceneName:s.Zs.home},enabledNum:[0],children:(0,w.jsx)(HomeFirmwareUpdateReminderCmp,{})})}},898915:(e,r,n)=>{n.r(r),n.d(r,{default:()=>u});var t=n(490343),o=n(324586),i=n(586330),a=n(514041),s=n(791088),l=n(57597),d=n(734809),c=n(831085);function ownKeys(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(n),!0).forEach((function(r){(0,o.A)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function FirmwareUpdateSectionFieldItem({name:e,title:r,titleProps:n={color:"$textCritical"},children:t,onValueChange:o,testID:l=""}){var u,[p,h]=(0,d.useFirmwareUpdateDevSettingsPersistAtom)(),m=a.Children.only(t),f=e?p?.[e]:"",g=(0,a.useCallback)((u=(0,i.A)((function*(r){e&&(h((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:r})})),o?.(r))})),function(e){return u.apply(this,arguments)}),[e,o,h]),w=m?(0,a.cloneElement)(m,_objectSpread(_objectSpread({},m.props),{},{value:f,onChange:g})):null;return(0,c.jsx)(s.c,{title:r,titleProps:n,testID:l,children:w})}function FirmwareUpdateDevSettings(){var[e]=(0,d.useFirmwareUpdateDevSettingsPersistAtom)();return(0,c.jsxs)(t.YStack,{children:[(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"lowBatteryLevel",title:"Low Battery",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"shouldUpdateBridge",title:"Should Update Bridge",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"shouldUpdateFullRes",title:"Should Update Full Resouces",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"shouldUpdateFromWeb",title:"Should Update from web",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"allIsUpToDate",title:"All is up to date",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"usePreReleaseConfig",title:"Use pre-release config",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"forceUpdateResEvenSameVersion",title:"Force update res even same version",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(t.SizableText,{children:JSON.stringify(e,null,2)}),(0,c.jsx)(l.FirmwareUpdateGalleryDemo,{})]})}const u=function PageFirmwareUpdateDevSettings(){return(0,c.jsxs)(t.Page,{scrollEnabled:!0,children:[(0,c.jsx)(t.Page.Header,{title:"FirmwareUpdateDevSettings"}),(0,c.jsx)(FirmwareUpdateDevSettings,{})]})}}}]);