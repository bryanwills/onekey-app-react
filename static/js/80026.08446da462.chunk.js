"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[80026],{280026:(e,n,t)=>{t.r(n),t.d(n,{default:()=>$});var r,i,o,c,a,s,u,d,l=t(586330),f=t(514041),h=t(728234),p=t(908867),g=t(17617),v=t(490343),w=t(972800),m=t(324586),y=t(230414),P=t(813362),S=t(56945);!function(e){e.Unknown="unknown",e.Resetting="resetting",e.Unsupported="unsupported",e.Unauthorized="unauthorized",e.On="on",e.Off="off",e.TurningOn="turning_on",e.TurningOff="turning_off"}(r||(r={})),function(e){e[e.Opportunistic=-1]="Opportunistic",e[e.LowPower=0]="LowPower",e[e.Balanced=1]="Balanced",e[e.LowLatency=2]="LowLatency"}(i||(i={})),function(e){e[e.Aggressive=1]="Aggressive",e[e.Sticky=2]="Sticky"}(o||(o={})),function(e){e[e.AllMatches=1]="AllMatches",e[e.FirstMatch=2]="FirstMatch",e[e.MatchLost=4]="MatchLost"}(c||(c={})),function(e){e[e.OneAdvertisement=1]="OneAdvertisement",e[e.FewAdvertisements=2]="FewAdvertisements",e[e.MaxAdvertisements=3]="MaxAdvertisements"}(a||(a={})),function(e){e[e.LE_1M=1]="LE_1M",e[e.LE_2M=2]="LE_2M",e[e.LE_CODED=3]="LE_CODED",e[e.ALL_SUPPORTED=255]="ALL_SUPPORTED"}(s||(s={})),function(e){e[e.balanced=0]="balanced",e[e.high=1]="high",e[e.low=2]="low"}(u||(u={})),function(e){e.BleManagerDidUpdateState="BleManagerDidUpdateState",e.BleManagerStopScan="BleManagerStopScan",e.BleManagerDiscoverPeripheral="BleManagerDiscoverPeripheral",e.BleManagerDidUpdateValueForCharacteristic="BleManagerDidUpdateValueForCharacteristic",e.BleManagerConnectPeripheral="BleManagerConnectPeripheral",e.BleManagerDisconnectPeripheral="BleManagerDisconnectPeripheral",e.BleManagerPeripheralDidBond="BleManagerPeripheralDidBond",e.BleManagerCentralManagerWillRestoreState="BleManagerCentralManagerWillRestoreState",e.BleManagerDidUpdateNotificationStateFor="BleManagerDidUpdateNotificationStateFor"}(d||(d={}));var M=S.A.BleManager;new(function(){function BleManager(){this.isPeripheralConnected=this.isPeripheralConnected.bind(this)}var e=BleManager.prototype;return e.read=function read(e,n,t){return new Promise((function(r,i){M.read(e,n,t,(function(e,n){e?i(e):r(n)}))}))},e.readDescriptor=function readDescriptor(e,n,t,r){return new Promise((function(i,o){M.readDescriptor(e,n,t,r,(function(e,n){e?o(e):i(n)}))}))},e.readRSSI=function readRSSI(e){return new Promise((function(n,t){M.readRSSI(e,(function(e,r){e?t(e):n(r)}))}))},e.refreshCache=function refreshCache(e){return new Promise((function(n,t){M.refreshCache(e,(function(e,r){e?t(e):n(r)}))}))},e.retrieveServices=function retrieveServices(e,n=[]){return new Promise((function(t,r){M.retrieveServices(e,n,(function(e,n){e?r(e):t(n)}))}))},e.write=function write(e,n,t,r,i=20){return new Promise((function(o,c){M.write(e,n,t,r,i,(function(e){e?c(e):o()}))}))},e.writeWithoutResponse=function writeWithoutResponse(e,n,t,r,i=20,o=10){return new Promise((function(c,a){M.writeWithoutResponse(e,n,t,r,i,o,(function(e){e?a(e):c()}))}))},e.connect=function connect(e,n){return new Promise((function(t,r){n||(n={}),M.connect(e,n,(function(e){e?r(e):t()}))}))},e.createBond=function createBond(e,n=null){return new Promise((function(t,r){M.createBond(e,n,(function(e){e?r(e):t()}))}))},e.removeBond=function removeBond(e){return new Promise((function(n,t){M.removeBond(e,(function(e){e?t(e):n()}))}))},e.disconnect=function disconnect(e,n=!0){return new Promise((function(t,r){M.disconnect(e,n,(function(e){e?r(e):t()}))}))},e.startNotification=function startNotification(e,n,t){return new Promise((function(r,i){M.startNotification(e,n,t,(function(e){e?i(e):r()}))}))},e.startNotificationUseBuffer=function startNotificationUseBuffer(e,n,t,r){return new Promise((function(i,o){M.startNotificationUseBuffer(e,n,t,r,(function(e){e?o(e):i()}))}))},e.stopNotification=function stopNotification(e,n,t){return new Promise((function(r,i){M.stopNotification(e,n,t,(function(e){e?i(e):r()}))}))},e.checkState=function checkState(){return new Promise((function(e,n){M.checkState((function(n){e(n)}))}))},e.start=function start(e){return new Promise((function(n,t){null==e&&(e={}),M.start(e,(function(e){e?t(e):n()}))}))},e.scan=function scan(e,n,t,r={}){return new Promise((function(s,u){null==t&&(t=!1),null==r.numberOfMatches&&(r.numberOfMatches=a.MaxAdvertisements),null==r.matchMode&&(r.matchMode=o.Aggressive),null==r.scanMode&&(r.scanMode=i.LowPower),null==r.callbackType&&(r.callbackType=c.AllMatches),null==r.reportDelay&&(r.reportDelay=0),r.exactAdvertisingName&&"string"==typeof r.exactAdvertisingName||delete r.exactAdvertisingName,M.scan(e,n,t,r,(function(e){e?u(e):s()}))}))},e.stopScan=function stopScan(){return new Promise((function(e,n){M.stopScan((function(t){t?n(t):e()}))}))},e.enableBluetooth=function enableBluetooth(){return new Promise((function(e,n){M.enableBluetooth((function(t){t?n(t):e()}))}))},e.getConnectedPeripherals=function getConnectedPeripherals(e=[]){return new Promise((function(n,t){M.getConnectedPeripherals(e,(function(e,r){e?t(e):n(r||[])}))}))},e.getBondedPeripherals=function getBondedPeripherals(){return new Promise((function(e,n){M.getBondedPeripherals((function(t,r){t?n(t):e(r||[])}))}))},e.getDiscoveredPeripherals=function getDiscoveredPeripherals(){return new Promise((function(e,n){M.getDiscoveredPeripherals((function(t,r){t?n(t):e(r||[])}))}))},e.removePeripheral=function removePeripheral(e){return new Promise((function(n,t){M.removePeripheral(e,(function(e){e?t(e):n()}))}))},e.isPeripheralConnected=function isPeripheralConnected(e,n=[]){return this.getConnectedPeripherals(n).then((function(n){return!!n.find((function(n){return n.id===e}))}))},e.requestConnectionPriority=function requestConnectionPriority(e,n){return new Promise((function(t,r){M.requestConnectionPriority(e,n,(function(e,n){e?r(e):t(n)}))}))},e.requestMTU=function requestMTU(e,n){return new Promise((function(t,r){M.requestMTU(e,n,(function(e,n){e?r(e):t(n)}))}))},e.setName=function setName(e){M.setName(e)},e.getMaximumWriteValueLengthForWithoutResponse=function getMaximumWriteValueLengthForWithoutResponse(e){return new Promise((function(n,t){M.getMaximumWriteValueLengthForWithoutResponse(e,(function(e,r){e?t(e):n(r)}))}))},e.getMaximumWriteValueLengthForWithResponse=function getMaximumWriteValueLengthForWithResponse(e){return new Promise((function(n,t){M.getMaximumWriteValueLengthForWithResponse(e,(function(e,r){e?t(e):n(r)}))}))},(0,y.A)(BleManager)}());var b=t(302722),B=t.n(b),C=t(319357),D=t(272615),A=t(849726),O=(t(663522),t(281464)),R=t(100645),E=t(310955);function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}var x=null;var k=function(){function DeviceUtils(){this.connectedDeviceType="classic",this.scanMap={},this.searchIndex=0,this.tryCount=0,this.checkBonded=!1}var e,n,t,r,i,o=DeviceUtils.prototype;return o.getBleManager=(e=(0,l.A)((function*(){return null})),function getBleManager(){return e.apply(this,arguments)}),o.syncDeviceConnectStatus=(n=(0,l.A)((function*(){if(x)yield x.promise;else{x=(0,P.createDeferred)();try{yield E.A.serviceHardware.searchDevices()}finally{x.resolve(),x=null}}})),function syncDeviceConnectStatus(){return n.apply(this,arguments)}),o.checkDeviceBonded=(t=(0,l.A)((function*(e){var n,t=this,r=0,i=(n=(0,l.A)((function*(n=1e3){if(t.checkBonded)return r+=1,(yield t.getBondedDevices()).find((function(n){return(0,O.Q_)(n.id,e)}))?(t.checkBonded=!1,Promise.resolve(!0)):r>5?(t.checkBonded=!1,Promise.resolve(!1)):new Promise((function(e){return setTimeout((function(){return e(i(4500))}),n)}))})),function poll(){return n.apply(this,arguments)});return this.checkBonded=!0,i()})),function checkDeviceBonded(e){return t.apply(this,arguments)}),o.getBondedDevices=(r=(0,l.A)((function*(){var e=yield this.getBleManager();return e?(yield e.getBondedPeripherals()).map((function(e){var{id:n,name:t,advertising:r={}}=e;return function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach((function(n){(0,m.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({id:n,name:t},r)})):[]})),function getBondedDevices(){return r.apply(this,arguments)}),o.stopCheckBonded=function stopCheckBonded(){this.checkBonded=!1},o.delayShowHardwarePopup=function delayShowHardwarePopup({uiRequest:e,payload:n,content:t},r=500){setTimeout((function(){!function showHardwarePopup({uiRequest:e,payload:n,content:t}){console.log("showHardwarePopup")}({uiRequest:e,payload:n,content:t})}),r)},o.checkTouchNeedUpdateResource=(i=(0,l.A)((function*(e,n){var{getDeviceType:t}=yield(0,D.hc)(),r=t(e),{version:i,fullResourceRange:o=["3.5.0","3.5.0"]}=n;if("touch"!==r)return{error:null,needUpdate:!1};var c=function(e){return e?e.onekey_version?e.onekey_version.split("."):[e.major_version,e.minor_version,e.patch_version]:[0,0,0]}(e).join("."),a=i.join("."),[s,u]=o;return B().lt(c,s)&&B().gte(a,u)?{error:"USE_DESKTOP",needUpdate:!0,minVersion:s,limitVersion:u}:{error:null,needUpdate:!1}})),function checkTouchNeedUpdateResource(e,n){return i.apply(this,arguments)}),o.showErrorToast=function showErrorToast(e,n){console.error("deviceUtils.showErrorToast ERROR: ",e);try{var{className:t,key:r,code:i,info:o}=e||{};if(i===P.HardwareErrorCode.DeviceInterruptedFromOutside)return!1;if(i===C.o.NeedOneKeyBridge)return this.delayShowHardwarePopup({uiRequest:R.D3.CUSTOM_NEED_ONEKEY_BRIDGE}),!0;if(t===C.d.OneKeyHardwareError){var{data:c}=e||{},a=A.a.intl.formatMessage({id:r},null!=o?o:{}),{connectId:s,deviceId:u}=c||{};if(s&&i===P.HardwareErrorCode.NewFirmwareForceUpdate)return this.delayShowHardwarePopup({uiRequest:R.D3.CUSTOM_FORCE_UPGRADE_FIRMWARE,payload:{deviceId:u,deviceConnectId:s},content:a}),!0;if(s&&u){if(i===P.HardwareErrorCode.CallMethodNeedUpgradeFirmware||i===P.HardwareErrorCode.DeviceNotSupportPassphrase)return this.delayShowHardwarePopup({uiRequest:R.D3.CUSTOM_NEED_UPGRADE_FIRMWARE,payload:{deviceId:u,deviceConnectId:s},content:a}),!0;if(i===P.HardwareErrorCode.DeviceOpenedPassphrase)return this.delayShowHardwarePopup({uiRequest:R.D3.CUSTOM_NEED_CLOSE_PASSPHRASE,payload:{deviceId:u,deviceConnectId:s},content:a}),!0;if(i===P.HardwareErrorCode.DeviceNotOpenedPassphrase)return this.delayShowHardwarePopup({uiRequest:R.D3.CUSTOM_NEED_OPEN_PASSPHRASE,payload:{deviceId:u,deviceConnectId:s},content:a}),!0}if(a)return v.Toast.error({title:a}),!0}else{var d;if(r&&!["msg__engine__internal_error","onekey_error"].includes(r)?d=A.a.intl.formatMessage({id:r},o):n?d=A.a.intl.formatMessage({id:n},o):r&&"onekey_error"!==r&&(d=A.a.intl.formatMessage({id:r},o)),d)return v.Toast.error({title:d}),!0}}catch(e){console.error(e)}return!1},o.detectIsPublicBetaTouch=function detectIsPublicBetaTouch(e,n){if(!e)return!1;var t=e.slice(0,2),r=e.slice(7,15),i=Number(r);return"TC"===t?.toUpperCase?.()&&!!(i<20221020&&B().gt("3.3.0",null!=n?n:"3.3.0"))},(0,y.A)(DeviceUtils)}();const U=new k;var _=t(181447),j=t(901976),I=t(298254),T=function(e){return e[e.Unverified=0]="Unverified",e[e.Verifying=1]="Verifying",e[e.Verified=2]="Verified",e[e.ForceShow=3]="ForceShow",e}({}),N=t(831085);const $=function ReceiveToken(){var e;(0,j.e)({name:"ReceiveToken9971"});var n=(0,p.A)(),t=(0,h.lq)(),{networkId:r,accountId:i,walletId:o,deriveInfo:c,deriveType:a}=t.params,s=c?.labelKey?n.formatMessage({id:c?.labelKey}):null!=(e=c?.label)?e:"",{account:u,network:d,wallet:m}=(0,I.b)({accountId:i,networkId:r,walletId:o}),[y,P]=(0,f.useState)(T.Unverified),{copyText:S}=(0,v.useClipboard)(),M=m?.type===_.FN,b=!M||y===T.ForceShow||y===T.Verifying||y===T.Verified,B=!M||y===T.ForceShow||y===T.Verified,C=(0,f.useCallback)((0,l.A)((function*(){P(T.Verifying);try{var e=(yield E.A.serviceAccount.getHWAccountAddresses({walletId:o,networkId:r,indexedAccountId:u?.indexedAccountId,deriveType:a,confirmOnDevice:R.hz.EveryItem}))[0].toLowerCase()===u?.address?.toLowerCase();e||v.Toast.error({title:n.formatMessage({id:"msg__address_is_inconsistent_please_check_manually"})}),P(e?T.Verified:T.Unverified)}catch(e){U.showErrorToast(e),P(T.Unverified)}})),[u?.address,u?.indexedAccountId,a,n,r,o]),D=(0,f.useCallback)((function(){return u&&d&&m?(0,N.jsxs)(N.Fragment,{children:[b&&y===T.ForceShow?(0,N.jsx)(v.Alert,{fullBleed:!0,icon:"InfoCircleOutline",type:"critical",title:"Address Unconfirmed. Verify to Ensure Security.",action:{primary:"Verify",onPrimaryPress:function(){return C()}},mb:"$5"}):null,(0,N.jsxs)(v.Stack,{p:"$5",pt:"$0",my:"auto",alignItems:"center",children:[(0,N.jsxs)(v.SizableText,{textAlign:"center",children:["Receive Only on"," ",(0,N.jsx)(v.SizableText,{size:"$bodyLgMedium",children:d.name})]}),(0,N.jsxs)(v.Stack,{my:"$5",p:"$4",borderWidth:g.A.hairlineWidth,borderColor:"$borderSubdued",borderRadius:"$6",overflow:"hidden",borderCurve:"continuous",children:[(0,N.jsx)(v.QRCode,{value:u.address,logo:{uri:d.logoURI},size:240}),B?null:(0,N.jsxs)(v.Stack,{position:"absolute",top:"$0",left:"$0",right:"$0",bottom:"$0",alignItems:"center",justifyContent:"center",children:[(0,N.jsx)(v.BlurView,{contentStyle:{borderRadius:"$6",width:"100%",height:"100%",borderCurve:"continuous"},position:"absolute",intensity:100,top:"$0",left:"$0",right:"$0",bottom:"$0"}),(0,N.jsx)(v.Empty,{icon:"ShieldOutline",description:"Verify address on device to prevent phishing"})]})]}),(0,N.jsxs)(v.XStack,{space:"$2",alignItems:"center",children:[(0,N.jsx)(v.Heading,{size:"$headingMd",children:u.name}),s?(0,N.jsx)(v.Badge,{children:s}):null]}),(0,N.jsxs)(v.Stack,{alignItems:"center",children:[(0,N.jsxs)(v.ConfirmHighlighter,{highlight:y===T.Verifying,my:"$2.5",py:"$1.5",px:"$3",borderWidth:g.A.hairlineWidth,borderColor:"$borderSubdued",borderRadius:"$3",borderCurve:"continuous",children:[(0,N.jsx)(v.SizableText,{textAlign:"center",size:"$bodyLg",style:{wordBreak:"break-all"},children:u.address}),b?null:(0,N.jsx)(v.BlurView,{borderRadius:"$3",contentStyle:{borderRadius:"$3",width:"100%",height:"100%",borderCurve:"continuous"},position:"absolute",intensity:38,top:"$0",left:"$0",right:"$0",bottom:"$0"})]}),M&&y===T.Unverified?(0,N.jsx)(v.Button,{variant:"primary",onPress:C,children:"Verify on Device"}):(0,N.jsx)(v.Button,{icon:"Copy1Outline",onPress:function(){return S(u.address)},children:"Copy Address"})]})]})]}):null}),[u,y,s,S,C,M,b,B,d,m]);return(0,f.useEffect)((function(){}),[u?.indexedAccountId]),(0,N.jsxs)(v.Page,{scrollEnabled:!0,children:[(0,N.jsx)(v.Page.Header,{title:"Receive",headerRight:M?function(){var e=y!==T.ForceShow;return y===T.Verified?null:(0,N.jsx)(v.ActionList,{title:"Options",items:[{icon:e?"EyeOutline":"EyeOffOutline",label:e?"Show Address Anyway":"Hide Unverfied Address",onPress:function(){return P(e?T.ForceShow:T.Unverified)}}],renderTrigger:(0,N.jsx)(w.v$,{icon:"DotHorOutline"})})}:void 0}),(0,N.jsx)(v.Page.Body,{children:D()})]})}}}]);