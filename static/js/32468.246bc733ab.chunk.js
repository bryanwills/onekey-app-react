"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[32468],{49139:(e,t,n)=>{n.d(t,{A:()=>BackupDeviceList});var o=n(324586),i=n(586330),r=n(839850),c=n(514041),a=n(728234),s=n(187753),l=n(490343),u=n(310955),d=n(791088),p=n(498356),y=n(911998),b=n(734809),h=n(730223),f=n(567807),g=n(903469),m=n(831085),S=["ListEmptyComponent"];function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function BackupDeviceList(e){var t,{ListEmptyComponent:n}=e,o=(0,r.A)(e,S),[{isInProgress:k}]=(0,b.useCloudBackupPersistAtom)(),j=(0,p.A)(),v=(0,c.useMemo)((function(){return{iOS:"PhoneOutline",Android:"PhoneOutline",iPadOS:"SuqarePlaceholderOutline"}}),[]),{result:x,run:w}=(0,y.yk)((0,i.A)((function*(){return(yield u.A.serviceCloudBackup.getBackupDeviceList()).map((function(e){return{deviceName:e.deviceInfo.deviceName,osName:e.deviceInfo.osName,detail:`Updated: ${(0,f.Yq)(new Date(e.backupTime))}`,icon:e.deviceInfo.osName in v?v[e.deviceInfo.osName]:"SuqarePlaceholderOutline",isCurrentDevice:e.deviceInfo.deviceName===s.g7&&e.deviceInfo.osName===s.wH}}))})),[v]),$=(null!=(t=x?.length)?t:0)>0,B=(0,a.jH)();return(0,c.useEffect)((function(){k||B&&w()}),[k,B,w]),x?(0,m.jsx)(l.SectionList,_objectSpread({sections:$?[{data:x}]:[],renderSectionHeader:function(){return(0,m.jsx)(l.SectionList.SectionHeader,{mt:"$5",title:"All Devices"})},renderItem:function({item:e}){return(0,m.jsx)(d.c,{onPress:function(){j.pushModal(h.ry.CloudBackupModal,{screen:h.pc.CloudBackupList,params:{deviceInfo:e}})},renderItemText:function(t){return(0,m.jsx)(d.c.Text,_objectSpread(_objectSpread({},t),{},{primary:(0,m.jsxs)(l.XStack,{alignItems:"center",children:[(0,m.jsx)(l.SizableText,{size:"$bodyLgMedium",children:e.deviceName}),e.isCurrentDevice?(0,m.jsx)(l.Stack,{ml:"$1",bg:"$bgInfo",px:"$2",py:"$0.5",borderRadius:"$1",children:(0,m.jsx)(l.SizableText,{size:"$bodySmMedium",color:"$textInfo",children:"Current"})}):null]})}))},subtitle:e.detail,icon:e.icon,iconProps:{bg:"$bgStrong",p:"$5"},renderIcon:(0,m.jsx)(l.Stack,{bg:"$bgStrong",p:"$2",borderRadius:"$3",children:(0,m.jsx)(l.Icon,{name:e.icon,size:"$6",color:"$icon"})}),drillIn:!0})},estimatedItemSize:"$16",ListFooterComponent:!$&&n?null:(0,m.jsx)(l.SizableText,{size:"$bodySm",color:"$textSubdued",px:"$5",pt:"$3",children:"OneKey won't back up your hardware wallets, you should write down your phrase and keep it safe."}),ListEmptyComponent:n},o)):(0,m.jsx)(g.A,{})}},903469:(e,t,n)=>{n.d(t,{A:()=>BackupListLoading});var o=n(490343),i=n(831085);function BackupListLoading(){return(0,i.jsxs)(o.Stack,{flex:1,px:"$5",space:"$2",pt:"$5",children:[(0,i.jsx)(o.Skeleton,{h:"$6",w:"70%"}),(0,i.jsx)(o.Skeleton,{h:"$6",w:"100%"}),(0,i.jsx)(o.Skeleton,{h:"$6",w:"70%"}),(0,i.jsx)(o.Skeleton,{h:"$6",w:"100%"})]})}},836379:(e,t,n)=>{n.d(t,{d:()=>checkBackupEntryStatus});var o=n(586330),i=n(490343),r=n(310955),c=n(451945),a=n(663522),s=n(117746);function checkBackupEntryStatus(){return _checkBackupEntryStatus.apply(this,arguments)}function _checkBackupEntryStatus(){return(_checkBackupEntryStatus=(0,o.A)((function*(){if(!(yield r.A.serviceCloudBackup.getCloudAvailable()))throw i.Dialog.confirm({icon:"InfoCircleOutline",title:`${(0,c.w3)().cloudName} Backup`,description:a.Ay.isNativeIOS?"Please log in to your Apple account and activate the iCloud Drive feature before proceeding.":"To enable this feature, please download Google Drive, log in, and ensure that OneKey has the necessary permissions.",onConfirmText:a.Ay.isNativeIOS?"Go System Settings":"Got it",onConfirm:function(){return a.Ay.isNativeIOS?(0,s.Ow)("default"):void 0}}),new Error("cloud service is not available");try{yield r.A.serviceCloudBackup.loginIfNeeded(!0)}catch(e){throw i.Toast.error({title:`google auth failed ${e}`}),e}}))).apply(this,arguments)}},432468:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Home});var o=n(586330),i=n(514041),r=n(490343),c=n(310955),a=n(791088),s=n(498356),l=n(734809),u=n(451945),d=n(663522),p=n(49139),y=(n(324586),n(584186),n(836379),n(831085));function maybeShowBackupToggleDialog(e){return _maybeShowBackupToggleDialog.apply(this,arguments)}function _maybeShowBackupToggleDialog(){return(_maybeShowBackupToggleDialog=(0,o.A)((function*(e){}))).apply(this,arguments)}function Home(){var[{isEnabled:e,isInProgress:t}]=(0,l.useCloudBackupPersistAtom)(),[n,b]=(0,i.useState)(""),h=(0,s.A)(),f=(0,i.useCallback)((0,o.A)((function*(){yield maybeShowBackupToggleDialog(!0),b("");try{yield c.A.serviceCloudBackup.backupNow()}catch(e){b("Sync failed, please retry.")}})),[]),g=(0,i.useCallback)((function(){return t?(0,y.jsx)(r.Button,{disabled:!0,bg:"transparent",p:"0",loading:!0,children:"Syncing..."}):n?(0,y.jsx)(r.Button,{disabled:!0,bg:"transparent",p:"0",icon:"XCircleSolid",iconColor:"$iconCritical",children:"Sync error"}):(0,y.jsx)(r.Button,{disabled:!0,bg:"transparent",p:"0",icon:"CheckRadioSolid",iconColor:"$iconSuccess",children:"Synced"})}),[t,n]);return(0,y.jsx)(r.Page,{children:(0,y.jsxs)(r.Page.Body,{children:[(0,y.jsx)(p.A,{ListHeaderComponent:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(a.c,{title:`Enable ${(0,u.w3)().cloudName} backup`,children:(0,y.jsx)(r.Stack,{pointerEvents:"box-only",onPress:(0,o.A)((function*(){yield maybeShowBackupToggleDialog(!e),e?d.Ay.isNativeAndroid&&h.pop():yield f()})),children:(0,y.jsx)(r.Switch,{value:e})})}),e?(0,y.jsx)(a.c,{pt:"$3",title:`${(0,u.w3)().cloudName} Status`,children:g()}):null,(0,y.jsx)(r.Divider,{pt:"$6"})]})}),(0,y.jsx)(r.Stack,{m:"$5",children:(0,y.jsx)(r.Button,{mt:"$4",borderRadius:"$3",py:"$3",disabled:t,onPress:f,children:"Backup Now"})})]})})}}}]);