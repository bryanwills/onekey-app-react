"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[43448],{443448:(e,n,t)=>{t.r(n),t.d(n,{ConnectWallet:()=>ConnectWallet,default:()=>k,useConnectWalletRoute:()=>useConnectWalletRoute});var o=t(586330),l=t(514041),r=t(728234),c=t(17617),a=t(490343),i=t(734809),s=t(181447),u=t(318822),d=t(491180),g=t(300940),f=t(714191),m=t(310955),b=t(325809),C=t(498356),h=t(911998),x=t(162616),I=t(831085),S=g.A.getLogoInfo("walletconnect");g.A.getLogoInfo("metamask"),g.A.getLogoInfo("trustwallet"),g.A.getLogoInfo("rainbow"),g.A.getLogoInfo("imtoken"),g.A.getLogoInfo("okx"),g.A.getLogoInfo("tokenpocket"),g.A.getLogoInfo("zerion"),g.A.getLogoInfo("fireblocks"),g.A.getLogoInfo("amber"),g.A.getLogoInfo("cobowallet"),g.A.getLogoInfo("jadewallet");function WalletItemViewSection({title:e,children:n}){return(0,I.jsxs)(a.Stack,{p:"$5",children:[e?(0,I.jsx)(a.Heading,{pb:"$2.5",color:"$textSubdued",size:"$headingSm",children:e}):null,(0,I.jsx)(a.XStack,{flexWrap:"wrap",mx:"$-1",children:n})]})}function WalletItemView({onPress:e,logo:n,name:t,loading:o}){return(0,I.jsx)(a.Stack,{flexBasis:"50%",$gtMd:{flexBasis:"25%"},p:"$1",children:(0,I.jsxs)(a.Stack,{justifyContent:"center",alignItems:"center",bg:"$bgSubdued",borderWidth:c.A.hairlineWidth,borderColor:"$borderSubdued",borderRadius:"$3",borderCurve:"continuous",p:"$4",hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},onPress:e,focusable:!0,focusStyle:{outlineColor:"$focusRing",outlineStyle:"solid",outlineWidth:2,outlineOffset:2},children:[(0,I.jsx)(a.Stack,{w:"$8",h:"$8",borderRadius:"$2",borderWidth:c.A.hairlineWidth,borderColor:"$borderSubdued",borderCurve:"continuous",overflow:"hidden",children:(0,I.jsx)(a.Image,{w:"100%",h:"100%",source:n})}),(0,I.jsxs)(a.XStack,{alignItems:"center",children:[o?(0,I.jsx)(a.Spinner,{size:"small"}):null,(0,I.jsx)(a.SizableText,{userSelect:"none",mt:"$2",size:"$bodyMdMedium",children:t})]})]})})}function ConnectToWalletDialogContent({onRetryPress:e}){var[n]=(0,i.useOnboardingConnectWalletLoadingAtom)();return(0,I.jsxs)(a.Stack,{justifyContent:"center",alignItems:"center",p:"$5",bg:"$bgSubdued",borderRadius:"$3",borderCurve:"continuous",children:[(0,I.jsx)(a.XStack,{children:n?(0,I.jsx)(a.Spinner,{size:"large"}):(0,I.jsx)(a.Icon,{size:"$10",name:"CloudDisconnectedOutline"})}),n?(0,I.jsx)(a.XStack,{mt:"$4",alignItems:"center",children:(0,I.jsx)(a.SizableText,{children:"Confirm on your wallet to proceed"})}):null,n?null:(0,I.jsx)(a.XStack,{mt:"$4",children:(0,I.jsx)(a.Button,{variant:"primary",onPress:e,children:"Retry"})})]})}function WalletItem({logo:e,name:n,connectionInfo:t}){var[r,c]=(0,i.useOnboardingConnectWalletLoadingAtom)(),[g,f]=(0,l.useState)(!1),b=r||g,h=(0,l.useCallback)((function(e){c(e),f(e)}),[c]),S=(0,C.A)(),k=(0,x.z$)(),{selectedAccount:w}=(0,x.wz)({num:0}),p=(0,l.useRef)(null),W=(0,l.useRef)(h);W.current=h;var A=(0,l.useRef)(b);A.current=b;var j=(0,l.useRef)(void 0),$=(0,l.useCallback)((function(){clearTimeout(j.current),j.current=setTimeout((function(){h(!1)}),600)}),[h]),v=(0,l.useCallback)((function(){clearTimeout(j.current),h(!0)}),[h]);(0,l.useEffect)((function(){if(b){var fn=function(e){!1===e.open&&A.current&&$()};return u.iL.on(u.Tu.WalletConnectModalState,fn),function(){u.iL.off(u.Tu.WalletConnectModalState,fn)}}}),[$,b]);var y=(0,l.useCallback)((0,o.A)((function*(){try{v();var e=yield m.A.serviceDappSide.connectExternalWallet({connectionInfo:t});if(!A.current)return void a.Toast.error({title:"User canceled connect wallet"});var n=(yield m.A.serviceAccount.addExternalAccount({connectResult:e})).accounts[0],o=d.A.getAccountCompatibleNetwork({account:n,networkId:n.createAtNetwork||w.networkId});yield k.current.updateSelectedAccountForSingletonAccount({num:0,networkId:o,walletId:s.lS,othersWalletAccountId:n.id}),S.popStack(),yield p.current?.close()}finally{$()}})),[k,t,$,S,w.networkId,v]),L=(0,l.useCallback)((0,o.A)((function*(){console.log("WalletItem onPress"),b||A.current||(yield p.current?.close(),p.current=a.Dialog.show({title:`Connect to ${n||"Wallet"}`,showFooter:!1,dismissOnOverlayPress:!1,onClose(){W.current?.(!1)},renderContent:(0,I.jsx)(ConnectToWalletDialogContent,{onRetryPress:y})}),yield y())})),[y,b,n]);return(0,I.jsx)(WalletItemView,{onPress:L,logo:e,name:n||"unknown",loading:g})}function useConnectWalletRoute(){return{route:(0,r.lq)()}}function ConnectWallet(){var{route:e}=useConnectWalletRoute(),{impl:n,title:t}=e.params||{},{result:o={wallets:{}}}=(0,h.yk)((function(){return m.A.serviceDappSide.listAllWallets({impls:n?[n]:[]})}),[n]);return(0,I.jsxs)(a.Page,{scrollEnabled:!0,children:[(0,I.jsx)(a.Page.Header,{title:"Connect 3rd-party Wallet"}),(0,I.jsx)(a.Page.Body,{children:(0,I.jsxs)(WalletItemViewSection,{title:t,children:[(0,I.jsx)(WalletItem,{name:S.name,logo:S.logo,connectionInfo:{walletConnect:{impl:n,isNewConnection:!0,topic:"",peerMeta:{name:"",icons:[],description:"",url:""}}}}),o?.wallets?.[n||"--"]?.map?.((function(e,n){var{name:t,icon:o,connectionInfo:l}=e;return(0,I.jsx)(WalletItem,{logo:o,name:t||"unknown",connectionInfo:l},n)}))]})})]})}const k=function ConnectWalletPage(){return(0,I.jsx)(b.b8,{config:{sceneName:f.Zs.home},enabledNum:[0],children:(0,I.jsx)(ConnectWallet,{})})}}}]);