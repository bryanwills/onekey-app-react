"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[21732],{278484:(e,n,t)=>{t.d(n,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var o=t(460986),c=t.n(o),r=t(586330),s=t(514041),i=t(17617),u=t(490343),a=t(310955),l=t(325809),d=t(237532),m=t(24284),p=t(911998),A=t(162616),g=t(226952),h=t(584186),f=t(714191),x=t(82506);var S=t(831085);function DAppAccountListInitFromHome({num:e}){var n=(0,A.z$)();return(0,s.useEffect)((function(){(0,r.A)((function*(){yield h.A.wait(600),yield n.current.syncFromScene({from:{sceneName:f.Zs.home,sceneNum:0},num:e})}))()}),[n,e]),null}function DAppAccountListItem({num:e,handleAccountChanged:n,readonly:t,networkReadonly:o,compressionUiMode:c,initFromHome:r,beforeShowTrigger:a}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:n}){var{activeAccount:t}=(0,A.LH)({num:e}),{selectedAccount:o}=(0,A.wz)({num:e}),c=(0,x.d)(t,200),r=(0,x.d)(o,200),i=(0,s.useRef)(t),u=(0,s.useRef)(o);(0,s.useEffect)((function(){i.current=t,u.current=o}),[t,o]),(0,s.useEffect)((function(){n&&(c.isOthersWallet&&c.account?.id===r.othersWalletAccountId||c.indexedAccount?.id===r.indexedAccountId)&&n({activeAccount:i.current,selectedAccount:u.current},e)}),[c,r,n,e])}({num:e,handleAccountChanged:n});var m=r&&!t,p=m?800:500;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(u.XGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:i.A.hairlineWidth,separator:(0,S.jsx)(u.Divider,{vertical:!0}),disabled:t,children:[(0,S.jsx)(u.Group.Item,{children:(0,S.jsx)(l.jY,{num:e,beforeShowTrigger:a,disabled:o||t,loadingDuration:p})}),(0,S.jsx)(u.Group.Item,{children:(0,S.jsx)(d.U,{num:e,compressionUiMode:c,beforeShowTrigger:a,loadingDuration:p})})]}),m?(0,S.jsx)(DAppAccountListInitFromHome,{num:e}):null]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:n,onConnectedAccountInfoChanged:t}){var{serviceDApp:o,serviceNetwork:i}=a.A,{$sourceInfo:d}=(0,m.A)(),{result:A}=(0,p.yk)((0,r.A)((function*(){var e,n;if(!d?.origin||!d.scope)return{accountSelectorNum:null,networkIds:null};var t=(0,g.zg)(d.scope),c=t?(yield i.getNetworkIdsByImpls({impls:t})).networkIds:null,r=yield o.getConnectedAccountsInfo({origin:d.origin,scope:null!=(e=d.scope)?e:"",isWalletConnectRequest:d.isWalletConnectRequest});return Array.isArray(r)&&r.length>0&&"number"==typeof r[0]?.num?{accountSelectorNum:r[0].num,networkIds:c,existConnectedAccount:!0}:{accountSelectorNum:yield o.getAccountSelectorNum({origin:d.origin,scope:null!=(n=d.scope)?n:"",isWalletConnectRequest:d.isWalletConnectRequest}),networkIds:c,existConnectedAccount:!1}})),[d?.origin,d?.scope,d?.isWalletConnectRequest,o,i]);return(0,s.useEffect)((function(){c()(A?.accountSelectorNum)&&t&&t({num:A.accountSelectorNum,existConnectedAccount:A.existConnectedAccount})}),[A?.accountSelectorNum,A?.existConnectedAccount,t]),(0,S.jsxs)(u.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,S.jsx)(u.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),"number"==typeof A?.accountSelectorNum&&Array.isArray(A?.networkIds)?(0,S.jsx)(l.b8,{config:{sceneName:f.Zs.discover,sceneUrl:d?.origin},enabledNum:[A.accountSelectorNum],availableNetworksMap:{[A.accountSelectorNum]:{networkIds:A.networkIds}},children:(0,S.jsx)(DAppAccountListItem,{initFromHome:!A?.existConnectedAccount,num:A?.accountSelectorNum,handleAccountChanged:n,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){return(0,S.jsxs)(u.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,S.jsx)(u.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),(0,S.jsx)(l.b8,{config:{sceneName:f.Zs.home},enabledNum:[0],children:(0,S.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:n,handleAccountChanged:t}){var o=n.map((function(e){return e.accountSelectorNum})),c=n.reduce((function(e,n){var t=n.networkIds.filter(Boolean);return e[n.accountSelectorNum]={networkIds:t,defaultNetworkId:t[0]},e}),{});return(0,S.jsxs)(u.YStack,{space:"$2",children:[(0,S.jsx)(u.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(n)&&n.length?(0,S.jsx)(l.b8,{config:{sceneName:f.Zs.discover,sceneUrl:e},enabledNum:o,availableNetworksMap:c,children:(0,S.jsx)(u.YStack,{space:"$2",children:n.map((function(e){return(0,S.jsx)(u.Stack,{children:(0,S.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:t})},e.accountSelectorNum)}))})}):null]})}},701378:(e,n,t)=>{t.d(n,{_:()=>DAppRequestedPermissionContent,N:()=>DAppSignMessageContent});var o=t(17617),c=t(490343),r=t(831085);function DAppRequestedPermissionContent({requestPermissions:e=["View your balance and activity","Send approval requests"]}){return(0,r.jsxs)(c.YStack,{space:"$2",children:[(0,r.jsx)(c.SizableText,{color:"$text",size:"$headingMd",children:"Requested permissions"}),(0,r.jsx)(c.YStack,{py:"$2.5",px:"$3",space:"$3",minHeight:"$8",bg:"$bg",borderRadius:"$3",borderWidth:o.A.hairlineWidth,borderColor:"$borderSubdued",borderCurve:"continuous",children:e.map((function(e){return(0,r.jsxs)(c.XStack,{space:"$3",children:[(0,r.jsx)(c.Icon,{name:"CheckLargeOutline",color:"$icon",size:"$5"}),(0,r.jsx)(c.SizableText,{color:"$text",size:"$bodyMd",children:e})]},e)}))})]})}function DAppSignMessageContent({content:e}){return(0,r.jsxs)(c.YStack,{justifyContent:"center",children:[(0,r.jsx)(c.SizableText,{color:"$text",size:"$headingMd",mb:"$2",children:"Message"}),(0,r.jsx)(c.TextArea,{value:e,editable:!1,numberOfLines:14})]})}},980342:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(490343),c=t(831085);const r=function DappOpenModalPage({children:e,onClose:n,dappApprove:t}){return(0,c.jsxs)(o.Page,{scrollEnabled:!0,onClose:function(e){e||t.reject(),"function"==typeof n&&n(e)},children:[(0,c.jsx)(o.Page.Header,{headerShown:!1}),e]})}},321732:(e,n,t)=>{t.r(n),t.d(n,{default:()=>f});var o=t(586330),c=t(514041),r=t(908867),s=t(490343),i=t(310955),u=t(796895),a=t(24284),l=t(911998),d=t(278484),m=t(701378),p=t(748032),A=t(905710),g=t(980342),h=t(831085);const f=function SignMessageModal(){var e,n,t,f,x=(0,r.A)(),{$sourceInfo:S,unsignedMessage:b,accountId:I,networkId:j}=(0,a.A)(),C=(0,u.A)({id:null!=(e=S?.id)?e:"",closeWindowAfterResolved:!0}),{result:k}=(0,l.yk)((function(){return i.A.serviceNetwork.getNetwork({networkId:j})}),[j]),v=(0,c.useMemo)((function(){return k?.name?`Allow this site to request your ${k.name} message signature.`:""}),[k]),{showContinueOperate:w,continueOperate:y,setContinueOperate:$,riskLevel:N,urlSecurityInfo:D}=(0,A.q)({origin:null!=(n=S?.origin)?n:""}),M=(0,c.useCallback)((f=(0,o.A)((function*(e){var n=yield i.A.serviceSend.signMessage({unsignedMessage:b,networkId:j,accountId:I});C.resolve({result:n}),yield i.A.serviceSignature.addItemFromSignMessage({networkId:j,accountId:I,message:b.message,sourceInfo:S}),s.Toast.success({title:x.formatMessage({id:"msg__success"})}),e?.()})),function(e){return f.apply(this,arguments)}),[b,C,j,I,S,x]);return(0,h.jsx)(g.A,{dappApprove:C,children:(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(s.Page.Header,{headerShown:!1}),(0,h.jsx)(s.Page.Body,{children:(0,h.jsxs)(p.HJ,{title:"Message Signature Request",subtitle:v,origin:null!=(t=S?.origin)?t:"",urlSecurityInfo:D,children:[(0,h.jsx)(d.ZY,{readonly:!0}),(0,h.jsx)(m.N,{content:b.message})]})}),(0,h.jsx)(s.Page.Footer,{children:(0,h.jsx)(p.OS,{continueOperate:y,setContinueOperate:function(e){$(!!e)},onConfirm:function(e){return M(e)},onCancel:function(){return C.reject()},confirmButtonProps:{disabled:!y},showContinueOperateCheckbox:w,riskLevel:N})})]})})}}}]);