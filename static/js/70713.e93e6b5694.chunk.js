"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[70713],{508343:(e,r,t)=>{t.d(r,{G:()=>DeviceAvatar});var n=t(593827),a=t(831085);function DeviceAvatar({deviceType:e,size:r}){return(0,a.jsx)(n.L,{img:e||"unknown",wallet:void 0,size:r})}},593827:(e,r,t)=>{t.d(r,{L:()=>WalletAvatar});var n=t(503668),a=t.n(n),o=t(490343),i=t(491180),s=t(258988),u=t(831085);function WalletAvatarBase({size:e,img:r,wallet:t}){var n,a,c=r||t?.avatarInfo?.img;return c?i.A.isHwHiddenWallet({wallet:t})?(0,u.jsx)(o.Icon,{size:"$10",name:"LockSolid",color:"$iconSubdued"}):(0,u.jsxs)(o.Image,{size:e,children:[(0,u.jsx)(o.Image.Source,{source:null!=(n=s.UO[c])?n:s.UO.bear}),(0,u.jsx)(o.Image.Fallback,{delayMs:300,justifyContent:"center",alignItems:"center",children:(0,u.jsx)(o.SizableText,{children:null!=(a=t?.avatarInfo?.emoji)?a:""})})]}):null}function WalletAvatar({size:e="$10",status:r,badge:t,img:n,wallet:i}){return(0,u.jsxs)(o.Stack,{w:e,h:e,justifyContent:"center",alignItems:"center",children:[(0,u.jsx)(WalletAvatarBase,{size:e,img:n,wallet:i}),"connected"===r?(0,u.jsx)(o.Stack,{position:"absolute",bottom:-2,right:-2,bg:"$bgSidebar",p:"$0.5",borderRadius:"$full",zIndex:"$1",children:(0,u.jsx)(o.Stack,{borderRadius:"$full",w:"$2.5",h:"$2.5",bg:"$bgSuccessStrong"})}):null,a()(t)?null:(0,u.jsx)(o.Stack,{position:"absolute",bottom:-3,right:0,bg:"$bgSubdued",w:"$3.5",h:"$3.5",alignItems:"center",justifyContent:"center",borderRadius:"$full",zIndex:"$1",children:(0,u.jsx)(o.SizableText,{size:"$bodySmMedium",textAlign:"center",children:t})})]})}},326745:(e,r,t)=>{t.d(r,{u:()=>useAppRoute});var n=t(728234);function useAppRoute(){return(0,n.lq)()}},394764:(e,r,t)=>{t.d(r,{Z:()=>usePrevious});var n=t(514041);function usePrevious(e){var r=(0,n.useRef)();return(0,n.useEffect)((function(){r.current=e}),[e]),r.current}},973066:(e,r,t)=>{t.d(r,{i:()=>FirmwareChangeLogContentView,z:()=>FirmwareChangeLogView});var n=t(514041),a=t(490343),o=t(734809),i=t(225555),s=t(701088),u=t(443791),c=t(831085);function ChangeLogSection({title:e,icon:r,isDone:t,updateInfo:o}){var[i,s]=(0,n.useState)(t),l=(0,n.useCallback)((function(){s(!i)}),[i]);return(0,c.jsxs)(a.Stack,{children:[(0,c.jsxs)(a.XStack,{space:"$3",py:"$2",ai:"center",onPress:l,children:[(0,c.jsx)(a.Icon,{name:r,size:"$5"}),(0,c.jsxs)(a.Stack,{flex:1,children:[(0,c.jsx)(a.SizableText,{size:"$bodyLgMedium",children:e}),(0,c.jsx)(a.SizableText,{size:"$bodyMd",color:t?"$textSubdued":"$textInfo",children:t?`Updated to the latest version ${o?.toVersion||""}`:`${o?.toVersion||""} is available`})]}),(0,c.jsx)(a.IconButton,{icon:i?"ChevronDownSmallOutline":"ChevronTopSmallOutline",variant:"tertiary"})]}),i?null:(0,c.jsxs)(a.Stack,{bg:"$bgStrong",p:"$5",borderRadius:"$3",children:[(0,c.jsx)(u.Y,{fromVersion:o?.fromVersion||"?.?.?",toVersion:o?.toVersion}),(0,c.jsx)(a.Markdown,{children:o?.changelog?.["en-US"]||"No change log found."})]})]})}function FirmwareChangeLogContentView({result:e,isDone:r}){return(0,c.jsxs)(a.Stack,{mt:"$8",children:[e?.updateInfos?.bootloader?.hasUpgrade?(0,c.jsx)(ChangeLogSection,{title:"Bootloader",icon:"StorageOutline",updateInfo:e?.updateInfos?.bootloader,isDone:r}):null,e?.updateInfos?.ble?.hasUpgrade?(0,c.jsx)(ChangeLogSection,{title:"BlueTooth",icon:"BluetoothOutline",updateInfo:e?.updateInfos?.ble,isDone:r}):null,e?.updateInfos?.firmware?.hasUpgrade?(0,c.jsx)(ChangeLogSection,{title:"Firmware",icon:"LaunchOutline",updateInfo:e?.updateInfos?.firmware,isDone:r}):null]})}function FirmwareChangeLogView({result:e}){var[,r]=(0,o.useFirmwareUpdateStepInfoAtom)();return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.nv,{onConfirmText:"Update Now",onConfirm:function(){return r({step:o.EFirmwareUpdateSteps.showCheckList,payload:void 0})}}),(0,c.jsxs)(a.Stack,{children:[(0,c.jsx)(s.N,{result:e}),(0,c.jsx)(FirmwareChangeLogContentView,{result:e})]})]})}},139499:(e,r,t)=>{t.d(r,{k:()=>FirmwareCheckingLoading});var n=t(8904),a=t(490343),o=t(831085),Spacer=function({height:e=16}){return(0,o.jsx)(n.S,{style:{height:e}})};function FirmwareCheckingLoading({connectId:e}){return(0,o.jsxs)(a.Stack,{py:"$8",children:[(0,o.jsx)(a.Skeleton,{radius:"round",height:56,width:56}),(0,o.jsxs)(a.SizableText,{my:"$6",size:"$heading2xl",children:["Checking for updates..."," "]}),(0,o.jsx)(a.Skeleton,{width:250,height:24}),(0,o.jsx)(Spacer,{height:12}),(0,o.jsx)(a.Skeleton,{width:"100%",height:24}),(0,o.jsx)(Spacer,{height:12}),(0,o.jsx)(a.Skeleton,{width:"100%",height:24}),null]})}},88569:(e,r,t)=>{t.d(r,{m:()=>FirmwareInstallingView,V:()=>FirmwareInstallingViewBase});var n=t(514041),a=t(490343),o=t(734809),i=t(613838),s=t(973066),u=t(723337),c=t(225555),l=t(831085);function FirmwareUpdateDone({result:e}){var r=(0,i.B)();return(0,l.jsxs)(a.Stack,{children:[(0,l.jsx)(u.u,{icon:"CheckRadioSolid",tone:"success",title:"All updates complete ðŸ‘ðŸ»"}),(0,l.jsx)(s.i,{result:e,isDone:!0}),(0,l.jsx)(c.nv,{onConfirmText:"Got it",onConfirm:function(){r.closeUpdateModal()}})]})}var d=t(853748),p=t(99202),f=t(701088);function FirmwareInstallingViewBase({result:e,isDone:r,tipMessage:t,retryInfo:o,progressBarKey:i}){(0,l.jsx)(f.N,{result:e});var s=(0,n.useMemo)((function(){return r?(0,l.jsx)(FirmwareUpdateDone,{result:e}):o?(0,l.jsx)(d.uH.InstallingErrors,{retryInfo:o,result:e,lastFirmwareTipMessage:t}):(0,l.jsx)(p.D,{lastFirmwareTipMessage:t,isDone:r},i)}),[r,i,e,o,t]);return(0,l.jsx)(a.Stack,{children:s})}function FirmwareInstallingView({result:e,isDone:r}){var[t]=(0,o.useFirmwareUpdateStepInfoAtom)(),[a]=(0,o.useFirmwareUpdateRetryAtom)(),[i]=(0,o.useHardwareUiStateAtom)(),s=(0,n.useRef)(0);t.step===o.EFirmwareUpdateSteps.updateStart&&(s.current=t.payload.startAtTime);var u=i?.payload?.firmwareTipData?.message,[c,d]=(0,n.useState)();return(0,n.useEffect)((function(){u&&d(u)}),[u]),(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(FirmwareInstallingViewBase,{result:e,isDone:r,tipMessage:c,retryInfo:a,progressBarKey:s.current})})}},411252:(e,r,t)=>{t.d(r,{p:()=>FirmwareLatestVersionInstalled});var n=t(490343),a=t(723337),o=t(831085);function FirmwareLatestVersionInstalled(){return(0,o.jsx)(n.Stack,{children:(0,o.jsx)(a.u,{icon:"CheckLargeOutline",tone:"success",title:"You are on the latest version",message:"No further updates are required at this time."})})}},723337:(e,r,t)=>{t.d(r,{u:()=>FirmwareUpdateBaseMessageView});var n=t(514041),a=t(490343),o=t(831085),getColors=function(e){switch(e){case"destructive":return{iconWrapperBg:"$bgCritical",iconColor:"$iconCritical"};case"warning":return{iconWrapperBg:"$bgCaution",iconColor:"$iconCaution"};case"success":return{iconWrapperBg:"$bgSuccess",iconColor:"$iconSuccess"};default:return{iconWrapperBg:"$bgStrong",iconColor:"$icon"}}};function FirmwareUpdateBaseMessageView({icon:e,title:r,tone:t,message:i,linkList:s}){var u=(0,n.useCallback)((function(){return e?.endsWith("Solid")?(0,o.jsx)(a.Icon,{name:e,size:"$14",color:getColors(t).iconColor}):(0,o.jsx)(a.Stack,{alignSelf:"flex-start",p:"$3",borderRadius:"$full",bg:getColors(t).iconWrapperBg,children:(0,o.jsx)(a.Icon,{name:e,size:"$7",color:getColors(t).iconColor})})}),[e,t]);return(0,o.jsxs)(a.Stack,{py:"$6",children:[e?u():null,r?(0,o.jsx)(a.SizableText,{my:"$4",size:"$heading2xl",children:r}):null,i?(0,o.jsx)(a.RichSizeableText,{size:"$bodyLg",color:"$textSubdued",linkList:s,children:i}):null]})}},711426:(e,r,t)=>{t.d(r,{J:()=>FirmwareUpdateCheckList});var n=t(586330),a=t(514041),o=t(490343),i=t(734809),s=t(16853),u=(t(663522),t(310955)),c=t(225555),l=t(831085);function FirmwareUpdateCheckList({result:e}){var[,r]=(0,i.useFirmwareUpdateStepInfoAtom)(),[,t]=(0,i.useFirmwareUpdateWorkflowRunningAtom)(),[d,p]=(0,a.useState)([{label:"I've backed up my recovery phrase.",emoji:"âœ…",value:!1},{label:"My device is connected via USB cable.",emoji:"ðŸ“²",value:!1},{label:"The device battery is fully charged.",emoji:"ðŸ”‹",value:!1},{label:"Only one device is connected.",emoji:"ðŸ“±",value:!1},{label:"All other OneKey Apps and web upgrade tools are closed.",emoji:"ðŸ†—",value:!1}]),f=(0,a.useCallback)((function(e){e.value=!e.value,p([...d])}),[d]),m=(0,a.useMemo)((function(){return d.every((function(e){return e.value}))}),[d]);return(0,l.jsxs)(o.Stack,{children:[(0,l.jsx)(o.SizableText,{size:"$heading2xl",my:"$8",children:"Ready to Upgrade? Letâ€™s Check You're all set ðŸ“"}),(0,l.jsx)(o.Stack,{space:"$3",children:d.map((function(e){return(0,l.jsx)(o.Checkbox,{value:e.value,label:e.value?`${e.label} ${e.emoji}`:e.label,onChange:function(){return f(e)}},e.label)}))}),(0,l.jsx)(c.nv,{confirmButtonProps:{disabled:!m},onConfirm:e?(0,n.A)((function*(){if(e)try{r({step:i.EFirmwareUpdateSteps.updateStart,payload:{startAtTime:Date.now()}}),t(!0),yield u.A.serviceFirmwareUpdate.startUpdateWorkflow({backuped:!0,usbConnected:!0,releaseResult:e}),r({step:i.EFirmwareUpdateSteps.updateDone,payload:void 0})}catch(e){r({step:i.EFirmwareUpdateSteps.error,payload:{error:(0,s.xm)(e)}})}finally{t(!1)}})):void 0,onConfirmText:"Continue"})]})}},853748:(e,r,t)=>{t.d(r,{_V:()=>EnterBootModeGuide,uH:()=>x,RH:()=>useFirmwareUpdateErrors});var n=t(586330),a=t(514041),o=t(813362),i=t(490343),s=t(734809),u=t(726130),c=t(319357),l=t(514527),d=t(117746),p=t(100645),f=t(310955);const m=t.p+"static/media/enter-boot-guide-mini.e82812de54d81a27fd02.png";var g=t(723337),w=t(225555),h=t(831085);function CommonError({message:e,title:r}){return(0,h.jsx)(g.u,{title:r||"Error Occurred",message:e})}function ShouldUpdateBridge({result:e}){return(0,h.jsxs)(i.Stack,{children:[(0,h.jsx)(g.u,{icon:"InfoCircleOutline",title:"New Bridge Version Available for Update",message:"Hardware update requires the latest bridge software. Please visit our online tutorial <a>[Solution for failed firmware upgrade on Touch]</a> for detailed installation instructions.",linkList:[{url:u.F3}]}),(0,h.jsx)(w.nv,{onConfirm:function(){(0,d.Dr)(u.F3)},onConfirmText:"Visit website"})]})}function ShouldUpdateByWeb(){return(0,h.jsxs)(i.Stack,{children:[(0,h.jsx)(g.u,{icon:"InfoCircleOutline",title:"Update in official web tool",message:"Your hardware wallet firmware requires an update. Please visit <a>firmware.onekey.so</a> on your computer to proceed with the upgrade.",linkList:[{url:u.BZ}]}),(0,h.jsx)(w.nv,{onConfirm:function(){(0,d.Dr)(u.BZ)},onConfirmText:"Visit website"})]})}function HowToUpdateFullResource(){return(0,h.jsxs)(i.Stack,{children:[(0,h.jsx)(g.u,{icon:"InfoCircleOutline",title:"Outdated Version Detected",message:"Your current firmware version is too low. Please visit our online tutorial <a>[Solution for failed firmware upgrade on Touch]</a> and follow the step-by-step instructions to complete the update.",linkList:[{url:u.Kj}]}),(0,h.jsx)(w.nv,{onConfirm:function(){(0,d.Dr)(u.Kj)},onConfirmText:"View tutorial"})]})}function EnterBootModeGuide({deviceType:e}){return"mini"===e?(0,h.jsxs)(i.Stack,{mb:"$6",children:[(0,h.jsx)(i.Image,{w:353,h:224,source:m}),(0,h.jsx)(i.SizableText,{size:"$headingMd",children:"Manually Entering BootLoader Mode"}),(0,h.jsx)(i.SizableText,{mt:"$2",color:"$textSubdued",children:"To enter BootLoader mode on your OneKey Mini, press and hold the lock screen button while inserting the data cable into the computer, then click 'Verify Status and Continue'."})]}):(0,h.jsx)(i.Stack,{mb:"$6",children:(0,h.jsx)(i.RichSizeableText,{mt:"$2",linkList:[{url:u.Kj}],children:'Follow the <a>online tutorial</a> to proceed manually, then click "Retry".'})})}function useFirmwareUpdateErrors({error:e,onRetry:r,result:t,lastFirmwareTipMessage:n}){var i="Retry";return(0,a.useMemo)((function(){return(0,l.R4)({error:e,code:o.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot})||(0,l.R4)({error:e,code:o.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure})||e&&n===p.rn.AutoRebootToBootloader?{content:(0,h.jsx)(CommonError,{title:e?.message}),detail:(0,h.jsx)(EnterBootModeGuide,{deviceType:t?.deviceType}),onRetryHandler:r,retryText:"mini"===t?.deviceType?"Verify Status and Continue":i}:(0,l.R4)({error:e,code:[o.HardwareErrorCode.BridgeNetworkError,o.HardwareErrorCode.BridgeTimeoutError,o.HardwareErrorCode.BridgeNotInstalled,c.o.NeedOneKeyBridge]})?{content:(0,h.jsx)(CommonError,{message:e?.message}),onRetryHandler:r,retryText:i}:(0,l.R4)({error:e,code:c.o.NeedOneKeyBridgeUpgrade})?{content:(0,h.jsx)(ShouldUpdateBridge,{result:t}),retryText:i}:(0,l.R4)({error:e,code:c.o.NeedFirmwareUpgradeFromWeb})?{content:(0,h.jsx)(ShouldUpdateByWeb,{}),retryText:i}:(0,l.R4)({error:e,code:o.HardwareErrorCode.UseDesktopToUpdateFirmware})?{content:(0,h.jsx)(HowToUpdateFullResource,{}),retryText:i}:e?{content:(0,h.jsx)(CommonError,{message:e?.message}),onRetryHandler:r,retryText:i}:{content:null,retryText:i}}),[e,n,r,t])}var x={ShouldUpdateBridge,CommonError,EnterBootModeGuide,WorkflowErrors:function WorkflowErrors({onRetry:e,error:r,result:t}){var{onRetryHandler:n,content:a,retryText:o}=useFirmwareUpdateErrors({error:r,onRetry:e,result:t,lastFirmwareTipMessage:void 0});return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(w.nv,{onConfirm:n,onConfirmText:o||"Retry"}),a]})},InstallingErrors:function InstallingErrors({retryInfo:e,result:r,lastFirmwareTipMessage:t}){var[,o]=(0,s.useFirmwareUpdateStepInfoAtom)(),i=(0,a.useCallback)((0,n.A)((function*(){if(!e)return null;console.error("retry error",e?.error),o({step:s.EFirmwareUpdateSteps.updateStart,payload:{startAtTime:Date.now()}}),yield f.A.serviceFirmwareUpdate.retryUpdateTask({id:e?.id,connectId:r?.updatingConnectId,releaseResult:r})})),[r,e,o]),{content:u,detail:c,onRetryHandler:l,retryText:d}=useFirmwareUpdateErrors({onRetry:i,result:r,lastFirmwareTipMessage:t,error:e?.error});return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(w.nv,{onConfirm:l,onConfirmText:d||"Retry"}),u,c]})}}},225555:(e,r,t)=>{t.d(r,{nv:()=>i,oh:()=>FirmwareUpdatePageLayout});var n=t(490343),a=t(498356),o=t(831085);function FirmwareUpdatePageHeader(){return(0,o.jsx)(n.Page.Header,{dismissOnOverlayPress:!1,title:"Hardware Update"})}var i=n.Page.Footer;function FirmwareUpdatePageLayout({children:e}){(0,a.A)();return(0,o.jsxs)(n.Stack,{children:[(0,o.jsx)(FirmwareUpdatePageHeader,{}),(0,o.jsx)(n.Page.Body,{children:(0,o.jsx)(n.Stack,{p:"$5",children:e})})]})}},99202:(e,r,t)=>{t.d(r,{D:()=>FirmwareUpdateProgressBar,w:()=>FirmwareUpdateProgressBarView});var n=t(460986),a=t.n(n),o=t(514041),i=t(490343),s=t(734809),u=t(284908),c=t(100645),l=t(310955),d=t(394764),p=t(443791),f=t(831085),defaultDesc=function(){return"Checking device"},m=10;function FirmwareUpdateProgressBarView({totalStep:e,currentStep:r,title:t,fromVersion:n,toVersion:a,progress:s,desc:u}){var c=(0,o.useMemo)((function(){return e&&r?e<=1?null:(0,f.jsx)(i.SizableText,{size:"$bodyMd",color:"$textSubdued",children:`Step ${r}/${e}`}):(0,f.jsx)(i.Skeleton,{width:120,height:16})}),[r,e]),l=(0,o.useMemo)((function(){return a?(0,f.jsx)(p.Y,{fromVersion:n,toVersion:a}):(0,f.jsx)(i.Skeleton,{width:80,height:16})}),[n,a]);return(0,f.jsxs)(i.Stack,{py:"$6",children:[c,(0,f.jsx)(i.SizableText,{size:"$heading2xl",my:"$3",children:t}),l,(0,f.jsx)(i.Stack,{mt:"$12",mb:"$3",children:(0,f.jsx)(i.Progress,{size:"medium",value:s})}),(0,f.jsx)(i.SizableText,{size:"$bodyLg",color:"$textSubdued",children:u})]})}function FirmwareUpdateProgressBar({lastFirmwareTipMessage:e,isDone:r}){var[t]=(0,s.useFirmwareUpdateStepInfoAtom)(),[n]=(0,s.useHardwareUiStateAtom)(),[p]=(0,s.useHardwareUiStateCompletedAtom)(),[g,w]=(0,o.useState)(1),[h]=(0,s.useFirmwareUpdateRetryAtom)(),x=(0,o.useRef)(g);x.current=g;var v=(0,o.useRef)(m),[y,S]=(0,o.useState)(defaultDesc()),j=(0,o.useMemo)((function(){if(t?.step===s.EFirmwareUpdateSteps.installing)return t.payload.installingTarget?.updateInfo?.firmwareType||void 0}),[t.payload,t?.step]),{totalStep:b,currentStep:U}=(0,o.useMemo)((function(){if(t?.step===s.EFirmwareUpdateSteps.installing){var e=t?.payload?.installingTarget;if(e)return{totalStep:e.totalPhase.length,currentStep:e.totalPhase.findIndex((function(r){return r===e.currentPhase}))+1}}return{totalPhase:null,currentPhase:null}}),[t.payload,t?.step]),F=(0,o.useMemo)((function(){if(t?.step===s.EFirmwareUpdateSteps.installing)return{fromVersion:t.payload.installingTarget?.updateInfo.fromVersion||void 0,toVersion:t.payload.installingTarget?.updateInfo.toVersion||void 0}}),[t.payload,t?.step]),k=n?.payload?.firmwareTipData?.message,E=n?.payload?.firmwareProgress,C=u.A.isConfirmOnDeviceAction(n),A=([c.rn.CheckLatestUiResource,c.rn.DownloadLatestUiResource,c.rn.DownloadLatestUiResourceSuccess,c.rn.UpdateSysResource,c.rn.UpdateSysResourceSuccess].includes(e),(0,d.Z)(j)),T=(0,o.useRef)(E);T.current=E;var $=(0,o.useRef)([]),R=(0,o.useMemo)((function(){var t="Preparing...";return e&&(t="Updating..."),j&&(t=`Updating ${j}...`,"ble"===j&&(t="Updating bluetooth...")),r&&(t="Done"),t}),[j,r,e]),I=(0,o.useCallback)((function(e){var r=[{type:["checking"],progress:function(){return 1},progressMax:function(){return m},desc:function(){return defaultDesc()}},{type:[c.rn.CheckLatestUiResource],progress:function(){return 2},desc:function(){return"CheckLatestUiResource"}},{type:[c.rn.DownloadLatestUiResource],progress:function(){return 3},desc:function(){return"DownloadLatestUiResource"}},{type:[c.rn.DownloadLatestUiResourceSuccess],progress:function(){return 5},desc:function(){return"DownloadLatestUiResourceSuccess"}},{type:[c.rn.UpdateSysResource],progress:function(){return 7},desc:function(){return"UpdateSysResource"}},{type:[c.rn.UpdateSysResourceSuccess],progress:function(){return 9},desc:function(){return"UpdateSysResourceSuccess"}},{type:[c.rn.AutoRebootToBootloader],progress:function(){return 10},desc:function(){return"Reboot to bootloader mode"}},{type:[c.rn.GoToBootloaderSuccess],progress:function(){return 12},desc:function(){return"Reboot success, downloading"}},{type:[c.rn.DownloadFirmware,c.rn.DownloadLatestBootloaderResource],progress:function(){return 14},desc:function(){return"Downloading"}},{type:[c.rn.DownloadFirmwareSuccess,c.rn.DownloadLatestBootloaderResourceSuccess],progress:function(){return 20},desc:function(){return"Download success"}},{type:[c.rn.FirmwareEraseSuccess],progress:function(){return 25},desc:function(){return"Transferring data"}},{type:["installing"],progress:function(){var e,r=30+.7*(null!=(e=T.current)?e:0);return r>=99&&(r=99),r},desc:function(){return 100===T.current?"Data transferred, installing...":"Transferring data"}},{type:["done"],progress:function(){return 100},desc:function(){return"Firmware Update Done!"}}],t=r.findIndex((function(r){return r.type.includes(e)}));if(t>=0){var n,a=r[t],o=a.progress(),i=x.current;w((function(){var r=Math.max(o,i);return console.log("setProgress>>>>",{newProgress:r,itemProgress:o,currentProgress:i,type:e}),x.current=r,r})),S(a.desc());var s=r[t+1],u=null!=(n=a?.progressMax?.())?n:s?.progress();v.current=u||99}}),[]),L=(0,o.useRef)(I);L.current=I,console.log("progressRef.current >>>",x.current,e),(0,o.useEffect)((function(){console.log("firmwareType>>>>",{firmwareType:j,prevFirmwareType:A}),h||j&&A&&j!==A&&(w(1),x.current=1,v.current=99,L.current("checking"))}),[j,A,h]),(0,o.useEffect)((function(){t?.step!==s.EFirmwareUpdateSteps.updateStart&&j||S(defaultDesc())}),[j,t?.step]),(0,o.useEffect)((function(){var e=setInterval((function(){if(!h&&!r&&!C){var e=x.current;w((function(){if(e>=v.current)return v.current;if(e>=99)return 99;var r=Math.min(e+1,v.current,99);return x.current=r,r}))}}),2e3);return function(){clearInterval(e)}}),[j,C,r,h]),(0,o.useEffect)((function(){r&&setTimeout((function(){L.current("done")}),1e3)}),[r]),(0,o.useEffect)((function(){k&&$.current.push(k)}),[k]),(0,o.useEffect)((function(){a()(E)&&L.current("installing")}),[E]),(0,o.useEffect)((function(){p?.action===s.EHardwareUiStateAction.CLOSE_UI_WINDOW&&l.A.serviceHardwareUI.closeHardwareUiStateDialog({skipDeviceCancel:!0,connectId:void 0})}),[p?.action]),(0,o.useEffect)((function(){e&&L.current(e)}),[e]);var[B,D]=(0,o.useState)(!1),P=(0,o.useMemo)((function(){0}),[E,e,g,B]);return(0,f.jsxs)(i.Stack,{children:[(0,f.jsx)(FirmwareUpdateProgressBarView,{totalStep:b,currentStep:U,title:R,progress:g,desc:y,fromVersion:F?.fromVersion,toVersion:F?.toVersion}),P]})}},701088:(e,r,t)=>{t.d(r,{N:()=>FirmwareUpdateWalletProfile});var n=t(490343),a=t(508343),o=t(831085);function FirmwareUpdateWalletProfile({result:e}){return(0,o.jsxs)(n.Stack,{onPress:function(){console.log("ICheckAllFirmwareReleaseResult",e)},children:[(0,o.jsx)(a.G,{size:"$14",deviceType:e?.deviceType||"unknown"}),(0,o.jsx)(n.SizableText,{mt:"$5",size:"$heading2xl",children:"New hardware updates ðŸŽ‰"})]})}},296437:(e,r,t)=>{t.d(r,{Y:()=>FirmwareUpdateWarningMessage});var n=t(490343),a=(t(663522),t(831085));function FirmwareUpdateWarningMessage(){return(0,a.jsx)(n.Stack,{backgroundColor:"$bgCautionSubdued",m:"$-5",py:"$3",px:"$5",mb:"$6",children:(0,a.jsx)(n.SizableText,{children:"Keep USB connected and app active during the upgrade."})})}},443791:(e,r,t)=>{t.d(r,{Y:()=>FirmwareVersionProgressBar});var n=t(490343),a=t(831085);function FirmwareVersionProgressBar({fromVersion:e="",toVersion:r=""}){return(0,a.jsxs)(n.XStack,{space:"$2.5",alignItems:"center",children:[(0,a.jsx)(n.Badge,{badgeType:"default",badgeSize:"lg",children:e}),(0,a.jsx)(n.Icon,{name:"ArrowRightSolid",size:"$4"}),(0,a.jsx)(n.Badge,{badgeType:"info",badgeSize:"lg",children:r})]})}},469646:(e,r,t)=>{t.r(r),t.d(r,{default:()=>L});var n,a=t(586330),o=t(514041),i=t(490343),s=t(734809),u=t(16853),c=t(310955),l=t(498356),d=t(326745),p=t(911998),f=t(973066),m=t(139499),g=t(88569),w=t(411252),h=t(711426),x=t(853748),v=t(72631),y=t(683180),S=t(34546);!function(e){e.RELEASE="release"}(n||(n={}));var j={};const b={isAvailableAsync:()=>(0,a.A)((function*(){return!!y.A.isDOMAvailable&&"wakeLock"in navigator}))(),activate:e=>(0,a.A)((function*(){if(y.A.isDOMAvailable){var r=yield navigator.wakeLock.request("screen");j[e]=r}}))(),deactivate:e=>(0,a.A)((function*(){if(y.A.isDOMAvailable){if(!j[e])throw new S.A("ERR_KEEP_AWAKE_TAG_INVALID",`The wake lock with tag ${e} has not activated yet`);j[e].release?.(),delete j[e]}}))(),addListenerForTag(e,r){var eventListener=function(){r({state:n.RELEASE})},t=j[e];return t&&("addEventListener"in t?t.addEventListener?.("release",eventListener):t.onrelease=eventListener),{remove:function(){var r=j[e];r&&(r.removeEventListener?r.removeEventListener("release",eventListener):r.onrelease=null)}}}};var U="ExpoKeepAwakeDefaultTag";function useKeepAwake(e=U,r){(0,o.useEffect)((function(){var t=!0;return activateKeepAwakeAsync(e).then((function(){t&&b.addListenerForTag&&r?.listener&&function addListener(e,r){if(!b.addListenerForTag)throw new v.V("ExpoKeepAwake","addListenerForTag");var t="string"==typeof e?e:U,n="function"==typeof e?e:r;return b.addListenerForTag(t,n)}(e,r.listener)})),function(){t=!1,r?.suppressDeactivateWarnings?deactivateKeepAwake(e).catch((function(){})):deactivateKeepAwake(e)}}),[e])}function activateKeepAwakeAsync(){return _activateKeepAwakeAsync.apply(this,arguments)}function _activateKeepAwakeAsync(){return(_activateKeepAwakeAsync=(0,a.A)((function*(e=U){yield b.activate?.(e)}))).apply(this,arguments)}function deactivateKeepAwake(){return _deactivateKeepAwake.apply(this,arguments)}function _deactivateKeepAwake(){return(_deactivateKeepAwake=(0,a.A)((function*(e=U){yield b.deactivate?.(e)}))).apply(this,arguments)}var F=t(124620),k=t(355931),E=t(493360),C=t(663522),A=t(613838),T=!1;function ForceExtensionUpdatingFromExpandTab(){return function useExtensionUpdatingFromExpandTab(){var e=(0,d.u)(),r=(0,A.B)();(0,o.useEffect)((function(){C.Ay.isExtensionUiPopup&&(r.openChangeLogOfExtension(e.params),window.close())}),[r,e.params])}(),null}function FirmwareUpdateExitPrevent(){var e=F.sy.title,r=F.sy.message;return useKeepAwake(),function useModalExitPrevent({title:e,message:r}){var t=(0,l.A)(),n=(0,o.useCallback)((function({data:n}){T||(T=!0,i.Dialog.show({title:e,description:r,onConfirmText:F.sy.confirm,onConfirm:function(){t.dispatch(n.action)},onCancelText:F.sy.cancel,onClose:function(){T=!1}}))}),[r,t,e]);(0,i.usePreventRemove)(!0,n)}({title:e,message:r}),function useAppExitPrevent({message:e,title:r}){(0,o.useEffect)((function(){if(C.Ay.isRuntimeBrowser&&!C.Ay.isExtensionUiPopup){var fn=function(r){return r.preventDefault(),r.returnValue=!0,e};return window.addEventListener("beforeunload",fn),function(){window.removeEventListener("beforeunload",fn)}}}),[e]),(0,o.useEffect)((function(){var t=E.A.addEventListener("hardwareBackPress",(function(){return k.A.alert(r,e,[{text:F.sy.cancel,onPress:function(){},style:"cancel"},{text:F.sy.confirm,onPress:function(){return E.A.exitApp()}}],{cancelable:!1}),!0}));return function(){return t.remove()}}),[e,r])}({title:e,message:r}),null}var $=t(225555),R=t(296437),I=t(831085);const L=function PageFirmwareUpdateChangeLog(){var e=(0,d.u)(),r=e?.params?.connectId,[t,n]=((0,l.A)(),(0,s.useFirmwareUpdateStepInfoAtom)()),{result:v,run:y,isLoading:S}=(0,p.yk)((0,a.A)((function*(){try{var e=yield c.A.serviceFirmwareUpdate.checkAllFirmwareRelease({connectId:r});return e?.hasUpgrade&&n({step:s.EFirmwareUpdateSteps.showChangeLog,payload:void 0}),e}catch(e){n({step:s.EFirmwareUpdateSteps.error,payload:{error:(0,u.xm)(e)}})}})),[r,n],{watchLoading:!0}),j=(0,o.useMemo)((function(){if(S)return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(FirmwareUpdateExitPrevent,{}),(0,I.jsx)(m.k,{connectId:r})]});if(t.step===s.EFirmwareUpdateSteps.error)return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(R.Y,{}),(0,I.jsx)(FirmwareUpdateExitPrevent,{}),(0,I.jsx)(x.uH.WorkflowErrors,{error:t.payload.error,onRetry:y,result:v})]});if(t.step===s.EFirmwareUpdateSteps.showChangeLog)return(0,I.jsx)(f.z,{result:v});if(t.step===s.EFirmwareUpdateSteps.showCheckList)return(0,I.jsx)(h.J,{result:v});if(t.step===s.EFirmwareUpdateSteps.updateStart||t.step===s.EFirmwareUpdateSteps.installing||t.step===s.EFirmwareUpdateSteps.updateDone){var e=t.step===s.EFirmwareUpdateSteps.updateDone;return(0,I.jsxs)(I.Fragment,{children:[e?null:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(R.Y,{}),(0,I.jsx)(FirmwareUpdateExitPrevent,{})]}),(0,I.jsx)(g.m,{result:v,isDone:e})]})}return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(w.p,{})})}),[r,S,v,y,t.payload,t.step]);return(0,I.jsx)(i.Page,{scrollEnabled:!0,onUnmounted:(0,a.A)((function*(){console.log("PageFirmwareUpdateChangeLog unmounted"),yield c.A.serviceFirmwareUpdate.exitUpdateWorkflow()})),children:(0,I.jsxs)($.oh,{children:[(0,I.jsx)(ForceExtensionUpdatingFromExpandTab,{}),j]})})}}}]);