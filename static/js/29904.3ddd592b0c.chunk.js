"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[29904],{326745:(e,t,n)=>{n.d(t,{u:()=>useAppRoute});var o=n(728234);function useAppRoute(){return(0,o.lq)()}},918778:(e,t,n)=>{n.d(t,{Kb:()=>useLidoMaticStake,Yv:()=>useLidoMaticClaim,ws:()=>useLidoMaticWithdraw});var o=n(324586),r=n(586330),c=n(514041),i=n(310955),a=n(927799);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function useLidoMaticStake({accountId:e,networkId:t}){var n,{navigationToSendConfirm:o}=(0,a.E)({accountId:e,networkId:t});return(0,c.useCallback)((n=(0,r.A)((function*({amount:n,stakingInfo:r,onSuccess:c,onFail:a}){var s=yield i.A.serviceAccount.getAccount({accountId:e,networkId:t}),u=yield i.A.serviceStaking.buildLidoMaticStakingTransaction({amount:n,networkId:t});yield o({encodedTx:_objectSpread(_objectSpread({},u),{},{from:s.address}),stakingInfo:r,onSuccess:c,onFail:a})})),function(e){return n.apply(this,arguments)}),[o,e,t])}function useLidoMaticWithdraw({accountId:e,networkId:t}){var n,{navigationToSendConfirm:o}=(0,a.E)({accountId:e,networkId:t});return(0,c.useCallback)((n=(0,r.A)((function*({amount:n,stakingInfo:r,onSuccess:c,onFail:a}){var s=yield i.A.serviceAccount.getAccount({accountId:e,networkId:t}),u=yield i.A.serviceStaking.buildLidoMaticWithdrawalTransaction({amount:n,networkId:t});yield o({encodedTx:_objectSpread(_objectSpread({},u),{},{from:s.address}),stakingInfo:r,onSuccess:c,onFail:a})})),function(e){return n.apply(this,arguments)}),[e,t,o])}function useLidoMaticClaim({accountId:e,networkId:t}){var n,{navigationToSendConfirm:o}=(0,a.E)({accountId:e,networkId:t});return(0,c.useCallback)((n=(0,r.A)((function*({tokenId:n,stakingInfo:r,onSuccess:c,onFail:a}){var s=yield i.A.serviceAccount.getAccount({accountId:e,networkId:t}),u=yield i.A.serviceStaking.buildLidoMaticClaimTransaction({tokenId:n,networkId:t});yield o({encodedTx:_objectSpread(_objectSpread({},u),{},{from:s.address}),stakingInfo:r,onSuccess:c,onFail:a})})),function(e){return n.apply(this,arguments)}),[o,e,t])}},729904:(e,t,n)=>{n.r(t),n.d(t,{default:()=>pages_MaticLidoStake});var o=n(586330),r=n(514041),c=n(241440),i=n(490343),a=n(498356),s=n(326745),u=n(310955),l=n(88803),d=n(791088),p=n(391944),f=n(927799),k=n(734809),m=n(584186);function useTrackTokenAllowance({networkId:e,accountId:t,initialValue:n,tokenAddress:c,spenderAddress:i}){var[a,s]=(0,r.useState)(n),[l,d]=(0,r.useState)(""),[p,f]=(0,r.useState)(),k=function useTxTrack({trackTxId:e,accountId:t,networkId:n,timeout:c=m.A.getTimeDurationMs({minute:60}),interval:i=m.A.getTimeDurationMs({seconds:30})}){var[a,s]=(0,r.useState)(null),l=(0,r.useRef)();return(0,r.useEffect)((function(){if(e){var r,a=Date.now(),d=(r=(0,o.A)((function*(e){var o=yield u.A.serviceHistory.fetchTxDetails({networkId:n,accountId:t,txid:e});o?s(o):Date.now()-a<c?l.current=setTimeout((function(){return d(e)}),i):s(null)})),function checkTxDetails(e){return r.apply(this,arguments)});return l.current=setTimeout((function(){return d(e)}),0),function(){return clearTimeout(l.current)}}}),[e,n,t,c,i]),a}({accountId:t,networkId:e,trackTxId:l});return(0,r.useEffect)((function(){function _fetchAllowance(){return(_fetchAllowance=(0,o.A)((function*(){if(k)try{var n=yield u.A.serviceStaking.fetchTokenAllowance({networkId:e,accountId:t,tokenAddress:c,spenderAddress:i});n&&s(n.allowanceParsed)}finally{f(!1)}else f(!1)}))).apply(this,arguments)}!function fetchAllowance(){return _fetchAllowance.apply(this,arguments)}()}),[k,e,t,i,c]),{allowance:a,trackAllowance:(0,r.useCallback)((function(e){d(e),f(!0)}),[d]),loading:p}}var y=n(827843),A=n(831085),LidoApproveBaseStake=function({price:e,balance:t,token:n,receivingTokenSymbol:a,apr:s=4,minAmount:m="0",rate:b="1",currentAllowance:I="0",onConfirm:w,approveTarget:x}){var{navigationToSendConfirm:S}=(0,f.E)({accountId:x.accountId,networkId:x.networkId}),[h,v]=(0,r.useState)(!1),[g,T]=(0,r.useState)(!1),{allowance:j,loading:P,trackAllowance:C}=useTrackTokenAllowance({accountId:x.accountId,networkId:x.networkId,tokenAddress:x.token.address,spenderAddress:x.spenderAddress,initialValue:I}),[M,O]=(0,r.useState)(""),[{currencyInfo:{symbol:$}}]=(0,k.useSettingsPersistAtom)(),N=(0,r.useCallback)((function(e){new c.A(e).isNaN()?""===e&&O(""):O(e)}),[]),F=(0,r.useMemo)((function(){var t=new c.A(M);if(!t.isNaN())return t.multipliedBy(e).toFixed()}),[M,e]),L=(0,r.useMemo)((function(){return new c.A(M).gte(t)}),[M,t]),D=(0,r.useMemo)((function(){var e=new c.A(m),t=new c.A(M);return!(!e.isGreaterThan(0)||!t.isGreaterThan(0))&&t.isLessThan(e)}),[m,M]),E=(0,r.useMemo)((function(){return(0,c.A)(M).isNaN()||L||D}),[M,L,D]),B=(0,r.useMemo)((function(){var e=(0,c.A)(M),t=new c.A(j);return!e.isNaN()&&t.lt(M)}),[M,j]),_=(0,r.useMemo)((function(){return B?`Approve ${M} ${n.symbol.toUpperCase()}`:"Stake"}),[B,n,M]),z=(0,r.useCallback)((0,o.A)((function*(){T(!0);var e=yield u.A.serviceAccount.getAccount({accountId:x.accountId,networkId:x.networkId});yield S({approveInfo:{owner:e.address,spender:x.spenderAddress,amount:M,tokenInfo:x.token},onSuccess(e){C(e[0].decodedTx.txid),T(!1)},onFail(){T(!1)}})})),[M,x,S,C]),R=(0,r.useCallback)((0,o.A)((function*(){v(!0);try{yield w?.(M)}finally{v(!1)}})),[w,M]),U=(0,r.useMemo)((function(){var t=(0,c.A)(M);if(!M||t.isNaN())return null;var o=(0,c.A)(M).multipliedBy(s).dividedBy(100);return(0,A.jsx)(i.XStack,{space:"$1",children:(0,A.jsxs)(i.SizableText,{children:[(0,A.jsx)(i.NumberSizeableText,{formatter:"value",formatterOptions:{tokenSymbol:n.symbol},children:o.toFixed()}),"(",(0,A.jsx)(i.NumberSizeableText,{formatter:"value",formatterOptions:{currency:$},children:o.multipliedBy(e).toFixed()}),")"]})})}),[M,s,e,$,n.symbol]),K=(0,r.useMemo)((function(){var e=(0,c.A)(M);if(!e.isNaN())return e.multipliedBy(b).toFixed()}),[M,b]);return(0,A.jsxs)(i.YStack,{children:[(0,A.jsxs)(i.Stack,{mx:"$2",px:"$3",space:"$5",children:[(0,A.jsx)(l.J,{hasError:L||D,value:M,onChange:N,tokenSelectorTriggerProps:{selectedTokenImageUri:n.logoURI,selectedTokenSymbol:n.symbol.toUpperCase()},balanceProps:{value:t},inputProps:{placeholder:"0"},valueProps:{value:F,currency:F?$:void 0}}),(0,A.jsxs)(i.YStack,{children:[D?(0,A.jsx)(i.Alert,{icon:"InfoCircleOutline",type:"critical",title:`The minimum amount for this staking is ${m} ${n.symbol}.`}):null,L?(0,A.jsx)(i.Alert,{icon:"InfoCircleOutline",type:"critical",title:"Insufficient balance."}):null]})]}),(0,A.jsx)(i.Stack,{children:(0,A.jsxs)(i.YStack,{children:[U?(0,A.jsx)(d.c,{title:"Est. annual rewards",titleProps:{color:"$textSubdued"},children:U}):null,K?(0,A.jsx)(d.c,{title:"Est. receive",titleProps:{color:"$textSubdued"},children:(0,A.jsx)(i.SizableText,{children:(0,A.jsx)(i.NumberSizeableText,{formatter:"balance",formatterOptions:{tokenSymbol:a},children:K})})}):null,(0,A.jsx)(d.c,{title:"APR",titleProps:{color:"$textSubdued"},children:(0,A.jsx)(d.c.Text,{primary:`${s}%`,primaryTextProps:{color:"$textSuccess"}})}),(0,A.jsx)(d.c,{title:"Protocol",titleProps:{color:"$textSubdued"},children:(0,A.jsxs)(i.XStack,{space:"$2",alignItems:"center",children:[(0,A.jsx)(p.o,{size:"sm",tokenImageUri:y.a3}),(0,A.jsx)(i.SizableText,{size:"$bodyMdMedium",children:"Lido"})]})}),(0,A.jsx)(d.c,{title:"Stake Release Period",titleProps:{color:"$textSubdued"},children:(0,A.jsx)(d.c.Text,{primary:"< 4 Days"})})]})}),(0,A.jsx)(i.Page.Footer,{onConfirmText:_,confirmButtonProps:{onPress:B?z:R,loading:h||P||g,disabled:E}})]})},b=n(918778);const pages_MaticLidoStake=function(){var e,t=(0,s.u)(),{networkId:n,accountId:u,token:l,balance:d,price:p,apr:f,stToken:k,currentAllowance:m,rate:y="1"}=t.params,I=(0,a.A)(),w=(0,b.Kb)({networkId:n,accountId:u}),x=(0,r.useCallback)((e=(0,o.A)((function*(e){var t=(0,c.A)(e).shiftedBy(l.decimals).toFixed(0);yield w({amount:t,stakingInfo:{protocol:"lido",send:{amount:e,token:l},receive:{token:k,amount:(0,c.A)(e).multipliedBy(y).toFixed()},tags:["lido-matic"]},onSuccess:function(){return I.pop()}})})),function(t){return e.apply(this,arguments)}),[w,l,I,y,k]);return(0,A.jsxs)(i.Page,{children:[(0,A.jsx)(i.Page.Header,{title:"Stake Matic"}),(0,A.jsx)(i.Page.Body,{children:(0,A.jsx)(LidoApproveBaseStake,{price:p,balance:d,token:l,receivingTokenSymbol:k.symbol.toUpperCase(),minAmount:(0,c.A)(1).shiftedBy(-l.decimals).toFixed(),onConfirm:x,apr:f,currentAllowance:m,rate:y,approveTarget:{accountId:u,networkId:n,spenderAddress:k.address,token:l}})})]})}},827843:(e,t,n)=>{n.d(t,{$e:()=>i,Cp:()=>r,LN:()=>c,a3:()=>o});var o="https://uni.onekey-asset.com/static/logo/Lido.png",r="https://uni.onekey-asset.com/static/chain/eth.png",c="https://uni.onekey-asset.com/static/chain/polygon.png",i="https://lido.fi/"}}]);