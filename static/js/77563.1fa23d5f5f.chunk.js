"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[77563],{339330:(e,t,r)=>{r.d(t,{G:()=>x});var n=r(324586),i=r(586330),o=r(230414),a=r(929296),s=r(195309),u=r(972715),c=r(241440),d=r(167612),l=r(824116),p=r(750918),f=r(507140),h=r(514527),v=r(272615),y=r(491180),A=r(825145),g=r(606777),b=r(64238),w=r(901048).Buffer;function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var r,n=(0,u.A)(e);if(t){var i=(0,u.A)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,s.A)(this,r)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}var x=function(e){(0,a.A)(KeyringHardware,e);var t=_createSuper(KeyringHardware);function KeyringHardware(...e){var r,n,o;return(r=t.call(this,...e)).coreApi=p.A.btc.hd,r.buildHardwareInput=(n=(0,i.A)((function*(e,t){var{getHDPath:r,getScriptType:n}=yield(0,v.hc)(),i=r(t),o=n(i);return{prev_index:e.vout,prev_hash:e.txid,amount:new c.A(e.value).toFixed(),address_n:i,script_type:o}})),function(e,t){return n.apply(this,arguments)}),r.buildHardwareOutput=(o=(0,i.A)((function*(e){var{isCharge:t,bip44Path:r,opReturn:n}=e.payload||{};if(n&&"string"==typeof n&&n.length>0)return{script_type:"PAYTOOPRETURN",amount:"0",op_return_data:g.A.bytesToHex(w.from(n))};if(t&&r){var{getHDPath:i,getOutputScriptType:o}=yield(0,v.hc)(),a=i(r);return{script_type:o(a),address_n:a,amount:new c.A(e.value).toFixed()}}return{script_type:"PAYTOADDRESS",address:e.address,amount:new c.A(e.value).toFixed()}})),function(e){return o.apply(this,arguments)}),r.buildPrevTx=function(e){var t=d.ZX.fromHex(e);return{hash:t.getId(),version:t.version,inputs:t.ins.map((function(e){return{prev_hash:e.hash.reverse().toString("hex"),prev_index:e.index,script_sig:e.script.toString("hex"),sequence:e.sequence}})),bin_outputs:t.outs.map((function(e){return{amount:e.value,script_pubkey:e.script.toString("hex")}})),lock_time:t.locktime}},r}var r,n,s,u=KeyringHardware.prototype;return u.signTransaction=(r=(0,i.A)((function*(e){var t=this,{unsignedTx:r}=e,{inputs:n,outputs:o}=r.encodedTx,{dbDevice:a,deviceCommonParams:s}=(0,A.wT)(e.deviceParams),u=yield this.getNetwork(),c=this.vault,l=yield this.coreApi.getCoinName({network:u}),p=n.map((function(e){return e.address})),f=yield c._collectUTXOsInfoByApi(),v={};for(var y of f){var{address:g,path:b}=y;p.includes(g)&&(v[g]=b)}var w,x,m=Array.from(new Set(n.map((function(e){return e.txid})))).filter(Boolean),T=yield c.collectTxs(m),I=yield this.getHardwareSDKInstance(),{connectId:P,deviceId:S}=a,_=yield I.btcSignTransaction(P,S,_objectSpread({coin:l.toLowerCase(),inputs:yield Promise.all(n.map((x=(0,i.A)((function*(e){return t.buildHardwareInput(e,v[e.address])})),function(e){return x.apply(this,arguments)}))),outputs:yield Promise.all(o.map((w=(0,i.A)((function*(e){return t.buildHardwareOutput(e)})),function(e){return w.apply(this,arguments)}))),refTxs:Object.values(T).map((function(e){return t.buildPrevTx(e)}))},s));if(_.success){var{serializedTx:R}=_.payload;return{txid:d.ZX.fromHex(R).getId(),rawTx:R,encodedTx:r.encodedTx}}throw(0,h.MP)(_.payload)})),function signTransaction(e){return r.apply(this,arguments)}),u.signMessage=(n=(0,i.A)((function*(){throw new f.MS})),function signMessage(){return n.apply(this,arguments)}),u.prepareAccounts=(s=(0,i.A)((function*(e){var t,r=this,n=yield this.getCoreApiNetworkInfo(),o=(0,l.getBtcForkNetwork)(n.networkChainCode),a=e.deriveInfo?.addressEncoding;return this.basePrepareHdUtxoAccounts(e,{checkIsAccountUsed:l.checkBtcAddressIsUsed,buildAddressesInfo:(t=(0,i.A)((function*({usedIndexes:t}){for(var n,s=yield r.baseGetDeviceAccountPublicKeys({params:e,usedIndexes:t,sdkGetPublicKeysFn:(n=(0,i.A)((function*({connectId:n,deviceId:i,pathPrefix:o,coinName:a,showOnOnekeyFn:s}){var u=yield r.getHardwareSDKInstance();return yield u.btcGetPublicKey(n,i,_objectSpread(_objectSpread({},e.deviceParams.deviceCommonParams),{},{bundle:t.map((function(e,t){return{path:`${o}/${e}'`,coin:a?.toLowerCase(),showOnOneKey:s(t)}}))}))})),function sdkGetPublicKeysFn(e){return n.apply(this,arguments)})}),u=[],c=0;c<s.length;c+=1){var d=s[c],{path:l,xpub:p,xpubSegwit:f}=d,h=y.A.buildUtxoAddressRelPath(),{addresses:v}=yield r.coreApi.getAddressFromXpub({network:o,xpub:p,relativePaths:[h],addressEncoding:a}),{[h]:A}=v,g={address:A,publicKey:"",path:l,relPath:h,xpub:p,xpubSegwit:f,addresses:{[h]:A}};u.push(g)}return u})),function buildAddressesInfo(e){return t.apply(this,arguments)})})})),function prepareAccounts(e){return s.apply(this,arguments)}),(0,o.A)(KeyringHardware)}(b.V)},368390:(e,t,r)=>{r.d(t,{M:()=>d});var n=r(586330),i=r(230414),o=r(929296),a=r(195309),s=r(972715),u=r(824116),c=r(750918);function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var r,n=(0,s.A)(e);if(t){var i=(0,s.A)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.A)(this,r)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}var d=function(e){(0,o.A)(KeyringHd,e);var t=_createSuper(KeyringHd);function KeyringHd(...e){var r;return(r=t.call(this,...e)).coreApi=c.A.btc.hd,r}var a,s,d,l,p=KeyringHd.prototype;return p.getPrivateKeys=(a=(0,n.A)((function*(e){return this.baseGetPrivateKeys(e)})),function getPrivateKeys(e){return a.apply(this,arguments)}),p.prepareAccounts=(s=(0,n.A)((function*(e){return(yield Promise.resolve().then(r.bind(r,824116))).initBitcoinEcc(),this.basePrepareAccountsHdUtxo(e,{checkIsAccountUsed:u.checkBtcAddressIsUsed})})),function prepareAccounts(e){return s.apply(this,arguments)}),p.signTransaction=(d=(0,n.A)((function*(e){return this.baseSignTransactionBtc(e)})),function signTransaction(e){return d.apply(this,arguments)}),p.signMessage=(l=(0,n.A)((function*(e){return this.baseSignMessageBtc(e)})),function signMessage(e){return l.apply(this,arguments)}),(0,i.A)(KeyringHd)}(r(129441).R)},884882:(e,t,r)=>{r.d(t,{e:()=>c});var n=r(586330),i=r(230414),o=r(929296),a=r(195309),s=r(972715),u=r(750918);function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var r,n=(0,s.A)(e);if(t){var i=(0,s.A)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.A)(this,r)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}var c=function(e){(0,o.A)(KeyringImported,e);var t=_createSuper(KeyringImported);function KeyringImported(...e){var r;return(r=t.call(this,...e)).coreApi=u.A.btc.imported,r}var r,a,s,c,d=KeyringImported.prototype;return d.getPrivateKeys=(r=(0,n.A)((function*(e){return this.baseGetPrivateKeys(e)})),function getPrivateKeys(e){return r.apply(this,arguments)}),d.prepareAccounts=(a=(0,n.A)((function*(e){return this.basePrepareAccountsImportedUtxo(e)})),function prepareAccounts(e){return a.apply(this,arguments)}),d.signTransaction=(s=(0,n.A)((function*(e){return this.baseSignTransactionBtc(e)})),function signTransaction(e){return s.apply(this,arguments)}),d.signMessage=(c=(0,n.A)((function*(e){return this.baseSignMessage(e)})),function signMessage(e){return c.apply(this,arguments)}),(0,i.A)(KeyringImported)}(r(275061).V)},304589:(e,t,r)=>{r.d(t,{v:()=>f});var n=r(586330),i=r(230414),o=r(929296),a=r(195309),s=r(972715),u=r(824116),c=r(750918),d=r(507140),l=r(491180),p=r(330189);function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var r,n=(0,s.A)(e);if(t){var i=(0,s.A)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.A)(this,r)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}var f=function(e){(0,o.A)(KeyringQr,e);var t=_createSuper(KeyringQr);function KeyringQr(...e){var r;return(r=t.call(this,...e)).coreApi=c.A.btc.hd,r}var r,a=KeyringQr.prototype;return a.buildAirGapAccountChildPathTemplate=function buildAirGapAccountChildPathTemplate(e){return l.A.buildUtxoAddressRelPath()},a.signTransaction=function signTransaction(e){throw new d.MS},a.signMessage=function signMessage(e){throw new d.MS},a.prepareAccounts=(r=(0,n.A)((function*(e){var t,r=this,i=yield p.A.getWallet({walletId:this.walletId}),o=yield this.getCoreApiNetworkInfo(),a=(0,u.getBtcForkNetwork)(o.networkChainCode),s=e.deriveInfo?.addressEncoding;return this.basePrepareHdUtxoAccounts(e,{buildAddressesInfo:(t=(0,n.A)((function*({usedIndexes:t}){var n=[];for(var o of t){var{fullPath:u,airGapAccount:c,childPathTemplate:p}=yield r.findQrWalletAirGapAccount(e,{index:o,wallet:i});if(!c)throw new d.a2;var f="",h=void 0;if(p){h=l.A.buildPathFromTemplate({template:p,index:o});var v=c?.extendedPublicKey;if(!v)throw new Error("xpub not found");f=v}if(!f)throw new Error("publicKey not found");if(!h)throw new Error("addressRelPath not found");var y=yield r.coreApi.getAddressFromXpub({network:a,xpub:f,relativePaths:[h],addressEncoding:s}),{[h]:A}=y.addresses,g={address:A,publicKey:"",path:c.path,relPath:h,xpub:f,xpubSegwit:y.xpubSegwit,addresses:{[h]:A}};n.push(g),console.log("KeyringQr prepareAccounts",{params:e,wallet:i,fullPath:u,airGapAccount:c,addressInfo:g})}return n})),function buildAddressesInfo(e){return t.apply(this,arguments)})})})),function prepareAccounts(e){return r.apply(this,arguments)}),(0,i.A)(KeyringQr)}(r(832818).W)},887895:(e,t,r)=>{r.d(t,{r:()=>d});var n=r(586330),i=r(230414),o=r(85018),a=r(929296),s=r(195309),u=r(972715),c=r(750918);function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var r,n=(0,u.A)(e);if(t){var i=(0,u.A)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,s.A)(this,r)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}var d=function(e){(0,a.A)(KeyringWatching,e);var t,r=_createSuper(KeyringWatching);function KeyringWatching(...e){var t;return(t=r.call(this,...e)).coreApi=c.A.btc.hd,t}return KeyringWatching.prototype.prepareAccounts=(t=(0,n.A)((function*(e){return(0,o.A)((0,u.A)(KeyringWatching.prototype),"basePrepareUtxoWatchingAccounts",this).call(this,e)})),function prepareAccounts(e){return t.apply(this,arguments)}),(0,i.A)(KeyringWatching)}(r(7440).w)},877563:(e,t,r)=>{r.r(t),r.d(t,{default:()=>B});var n=r(324586),i=r(839850),o=r(503668),a=r.n(o),s=r(603514),u=r.n(s),c=r(586330),d=r(230414),l=r(929296),p=r(195309),f=r(972715),h=r(241440),v=r(824116),y=r(554902),A=r(404727),g=r(180556),b=r(814878),w=r(507140),x=r(825145),m=r(657355),T=r(584186),I=r(369387),P=r(232471),S=r(34344),_=r(339330),R=r(368390),k=r(884882),F=r(304589),O=r(887895),E=["txId","value"];function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var r,n=(0,f.A)(e);if(t){var i=(0,f.A)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,p.A)(this,r)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}var B=function(e){(0,l.A)(VaultBtc,e);var t=_createSuper(VaultBtc);function VaultBtc(...e){var r;return(r=t.call(this,...e)).keyringMap={hd:R.M,qr:F.v,hw:_.G,imported:k.e,watching:O.r,external:O.r},r._getFeeRate=(0,m.E)((0,c.A)((function*(){try{var e=yield r.backgroundApi.serviceGas.estimateFee({networkId:r.networkId,accountAddress:yield r.getAccountAddress()}),{feeUTXO:t}=e;if(!t||u()(t))throw new w.He("Failed to get fee rates.");for(var n=t.map((function(e){var t;return new h.A(null!=(t=e.feeRate)?t:0).toFixed(0)})),i=n.findIndex((function(e){return new h.A(e).lt(0)}));i>=0;){for(var o=i-1,a=i+1;;){if(o>=0&&new h.A(n[o]).gte(0)){n[i]=n[o];break}if(a<n.length&&new h.A(n[a]).gte(0)){n[i]=n[a];break}if(a+=1,(o-=1)<0&&a>=n.length)break}i=n.findIndex((function(e){return new h.A(e).lt(0)}))}return n.sort((function(e,t){return new h.A(e).comparedTo(new h.A(t))}))}catch(e){throw console.error(e),new w.He("Failed to get fee rates.")}})),{promise:!0,max:1,maxAge:3e4}),r._collectUTXOsInfoByApi=(0,m.E)((0,c.A)((function*(){try{var{utxoList:e}=yield r.backgroundApi.serviceAccountProfile.fetchAccountDetails({networkId:r.networkId,accountAddress:yield r.getAccountAddress(),xpub:yield r.getAccountXpub(),withUTXOList:!0});if(!e)throw new w.He("Failed to get UTXO list.");return e}catch(e){throw new w.He("Failed to get UTXO list.")}})),{promise:!0,max:1,maxAge:T.A.getTimeDurationMs({seconds:30})}),r}var r,n,o,s,p,f,S,B,K,C,N,H,j,U,X,M,D,V,G,W,q,Q=VaultBtc.prototype;return Q.buildAccountAddressDetail=(r=(0,c.A)((function*(e){var{account:t,networkId:r}=e,{address:n}=t;return{networkId:r,normalizedAddress:n,displayAddress:n,address:n,baseAddress:n,isValid:!0,allowEmptyAddress:!1}})),function buildAccountAddressDetail(e){return r.apply(this,arguments)}),Q.buildDecodedTx=(n=(0,c.A)((function*(e){var{unsignedTx:t}=e,r=t.encodedTx,{inputs:n,outputs:i,psbtHex:o,inputsToSign:a}=r,s=yield this.getNetwork(),u=yield this.getAccount(),c=yield this.backgroundApi.serviceToken.getToken({networkId:this.networkId,tokenIdOnNetwork:"",accountAddress:u.address});if(!c)throw new w.He("Native token not found");var d,l=n.map((function(e){return{address:e.address,balance:new h.A(e.value).shiftedBy(-s.decimals).toFixed(),balanceValue:e.value,symbol:s.symbol,isMine:!0}})),p=i.filter((function(e){return!e.payload?.isCharge})).map((function(e){return{address:e.address,balance:new h.A(e.value).shiftedBy(-s.decimals).toFixed(),balanceValue:e.value,symbol:s.symbol,isMine:e.address===u.address}})),f=new h.A(0),v=new h.A(0);d=[{type:P.kF.ASSET_TRANSFER,assetTransfer:{from:u.address,to:p[0].address,sends:p.map((function(e){var t;return f=f.plus(e.balance),v=v.plus(e.balanceValue),{from:u.address,to:e.address,isNative:!0,tokenIdOnNetwork:"",name:c.name,icon:null!=(t=c.logoURI)?t:"",amount:e.balance,amountValue:e.balanceValue,symbol:s.symbol}})),receives:[],utxoFrom:l,utxoTo:p}}];var y=new h.A(r.fee).shiftedBy(-1*s.feeMeta.decimals).toFixed();return{txid:"",owner:u.address,signer:u.address,nonce:0,actions:d,status:P.Y1.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,payload:{type:I.mz.Send},encodedTx:r,totalFeeInNative:y,nativeAmount:f.toFixed(),nativeAmountValue:v.toFixed()}})),function buildDecodedTx(e){return n.apply(this,arguments)}),Q.buildEncodedTx=(o=(0,c.A)((function*(e){var{transfersInfo:t,specifiedFeeRate:r}=e;if(!t||u()(t))throw new w.He("transfersInfo is required");return this._buildEncodedTxFromTransfer({transfersInfo:t,specifiedFeeRate:r})})),function buildEncodedTx(e){return o.apply(this,arguments)}),Q.buildUnsignedTx=(s=(0,c.A)((function*(e){var t,r,n=null!=(t=e.encodedTx)?t:yield this.buildEncodedTx(e);if(n)return this._buildUnsignedTxFromEncodedTx({encodedTx:n,transfersInfo:null!=(r=e.transfersInfo)?r:[]});throw new w.He})),function buildUnsignedTx(e){return s.apply(this,arguments)}),Q.updateUnsignedTx=(p=(0,c.A)((function*(e){var{unsignedTx:t,feeInfo:r}=e,n=t.encodedTx,{psbtHex:i,inputsToSign:o}=n;if(r&&(!i||!o)){if(!t.transfersInfo||u()(t.transfersInfo))throw new w.He("transfersInfo is required");n=yield this._attachFeeInfoToEncodedTx({encodedTx:t.encodedTx,transfersInfo:t.transfersInfo,feeInfo:r})}return t.encodedTx=n,Promise.resolve(t)})),function updateUnsignedTx(e){return p.apply(this,arguments)}),Q._attachFeeInfoToEncodedTx=(f=(0,c.A)((function*({encodedTx:e,feeInfo:t,transfersInfo:r}){var n=yield this.getNetwork();if(t.feeUTXO?.feeRate){var i=new h.A(t.feeUTXO.feeRate).shiftedBy(-n.feeMeta.decimals).toFixed();if("string"==typeof i)return this._buildEncodedTxFromTransfer({transfersInfo:r,specifiedFeeRate:i})}return Promise.resolve(e)})),function _attachFeeInfoToEncodedTx(e){return f.apply(this,arguments)}),Q.getBtcForkNetwork=(S=(0,c.A)((function*(){return(0,v.getBtcForkNetwork)(yield this.getNetworkImpl())})),function getBtcForkNetwork(){return S.apply(this,arguments)}),Q.validatePrivateKey=function validatePrivateKey(){return Promise.resolve({isValid:!1})},Q.validateXpub=(B=(0,c.A)((function*(e){return Promise.resolve((0,v.validateBtcXpub)({xpub:e}))})),function validateXpub(e){return B.apply(this,arguments)}),Q.validateXprvt=(K=(0,c.A)((function*(e){return Promise.resolve((0,v.validateBtcXprvt)({xprvt:e}))})),function validateXprvt(e){return K.apply(this,arguments)}),Q.validateAddress=(C=(0,c.A)((function*(e){return(0,v.validateBtcAddress)({address:e,network:yield this.getBtcForkNetwork()})})),function validateAddress(e){return C.apply(this,arguments)}),Q.validateGeneralInput=(N=(0,c.A)((function*(e){var{result:t,inputDecoded:r}=yield this.baseValidateGeneralInput(e),n="";t.xpubResult?.isValid&&(n=r);var i=yield this.getBtcForkNetwork();if(!n&&t.xprvtResult?.isValid&&({xpub:n}=(0,v.getBtcXpubFromXprvt)({network:i,privateKeyRaw:(0,v.convertBtcXprvtToHex)({xprvt:r})})),n){var{supportEncodings:o}=(0,v.getBtcXpubSupportedAddressEncodings)({xpub:n,network:i});if(o&&o.length){var a=yield this.getVaultSettings(),s=Object.values(a.accountDeriveInfo);t.deriveInfoItems=s.filter((function(e){return e.addressEncoding&&o.includes(e.addressEncoding)}))}}return t})),function validateGeneralInput(e){return N.apply(this,arguments)}),Q.parseAddressEncodings=function parseAddressEncodings(e){var t=this;return Promise.all(e.map((function(e){return t.validateAddress(e)}))).then((function(e){return e.map((function(e){return e.encoding}))}))},Q._buildEncodedTxFromTransfer=(H=(0,c.A)((function*(e){var{transfersInfo:t}=e;if(1===t.length&&!t[0].to)throw new Error("buildEncodedTx ERROR: transferInfo.to is missing");return this._buildEncodedTxFromBatchTransfer(e)})),function _buildEncodedTxFromTransfer(e){return H.apply(this,arguments)}),Q._buildEncodedTxFromBatchTransfer=(j=(0,c.A)((function*(e){var{transfersInfo:t}=e,r=t[0],n=yield this.getAccount(),{inputs:o,outputs:s,fee:u,inputsForCoinSelect:c,outputsForCoinSelect:d}=yield this._buildTransferParamsWithCoinSelector(e);if(!o||!s||a()(u))throw new w.c4({message:"Failed to select UTXOs"});return{inputs:o.map((function(e){var{txId:t,value:r}=e,o=(0,i.A)(e,E);return _objectSpread(_objectSpread({address:n.address,path:""},o),{},{txid:t,value:r.toString()})})),outputs:s.map((function({value:e,address:t,script:i}){var o=e?.toString();if(o&&new h.A(o).eq(0)&&!t&&i===r.opReturn)return{address:"",value:o,payload:{opReturn:r.opReturn}};var a=t||n.address;if(!a)throw new Error("buildEncodedTxFromBatchTransfer ERROR: Invalid change address");if(!o||new h.A(o).lte(0))throw new Error("buildEncodedTxFromBatchTransfer ERROR: Invalid value");return{address:a,value:o,payload:t?void 0:{isCharge:!0,bip44Path:(0,g.zf)(n,n.address)}}})),inputsForCoinSelect:c,outputsForCoinSelect:d,fee:u.toString()}})),function _buildEncodedTxFromBatchTransfer(e){return j.apply(this,arguments)}),Q._buildTransferParamsWithCoinSelector=(U=(0,c.A)((function*({transfersInfo:e,specifiedFeeRate:t}){var r=yield this.getNetwork();if(!e.length)throw new Error("buildTransferParamsWithCoinSelector ERROR: transferInfos is required");var n=e.length>1,i=yield this._collectUTXOsInfoByApi(),o=void 0!==t?new h.A(t).shiftedBy(r.feeMeta.decimals).toFixed():(yield this._getFeeRate())[1],a=i.map((function({txid:e,vout:t,value:r,address:n,path:i}){return{txId:e,vout:t,value:parseInt(r),address:n,path:i}})),s=[];if(n)s=e.map((function({to:e,amount:t}){return{address:e,value:parseInt(new h.A(t).shiftedBy(r.decimals).toFixed())}}));else{var u=e[0],{to:c,amount:d}=u,l=i.reduce((function(e,{value:t}){return e.plus(t)}),new h.A("0")).shiftedBy(-r.decimals);if(l.lt(d))throw new w.c4;var p=l.lte(d),f=parseInt(new h.A(d).shiftedBy(r.decimals).toFixed());s=[p?{address:c,isMax:!0}:{address:c,value:f}],u.opReturn&&"string"==typeof u.opReturn&&u.opReturn.length&&s.push({address:"",value:0,script:u.opReturn})}var v=n?void 0:e[0].coinSelectAlgorithm;if(!n&&s.length>2)throw new Error("single transfer should only have one output");var{inputs:y,outputs:A,fee:g}=(0,b.qk)({inputsForCoinSelect:a,outputsForCoinSelect:s,feeRate:o,algorithm:v});return{inputs:y,outputs:A,fee:g,inputsForCoinSelect:a,outputsForCoinSelect:s,feeRate:o}})),function _buildTransferParamsWithCoinSelector(e){return U.apply(this,arguments)}),Q._buildUnsignedTxFromEncodedTx=(X=(0,c.A)((function*({encodedTx:e,transfersInfo:t}){var{inputs:r,outputs:n,inputsForCoinSelect:i}=e,o=79,a=[];for(var s of r){var u=new h.A(s.value);a.push({address:s.address,value:u,utxo:{txid:s.txid,vout:s.vout,value:u}})}var c,d=i?.filter((function(e){return a.some((function(t){return t.utxo?.txid===e.txId&&t.utxo.vout===e.vout}))}));Number(d?.length)>0&&n.length>0&&(o=(0,g.Ac)(null!=d?d:[],null!=(c=n.map((function(e){return{address:e.address,value:parseInt(e.value)}})))?c:[]));var l={txSize:o,encodedTx:e,transfersInfo:t};return Promise.resolve(l)})),function _buildUnsignedTxFromEncodedTx(e){return X.apply(this,arguments)}),Q.collectTxs=(M=(0,c.A)((function*(e){try{var t={},r=yield this.backgroundApi.serviceSend.getRawTransactions({networkId:this.networkId,txids:e});return Object.keys(r).forEach((function(e){return t[e]=r[e].rawTx})),t}catch(e){throw console.error(e),new w.He("Failed to get raw transactions.")}})),function collectTxs(e){return M.apply(this,arguments)}),Q._getRelPathToAddressByApi=(D=(0,c.A)((function*({addresses:e,account:t}){var r=yield this._collectUTXOsInfoByApi(),n={};for(var i of r){var{address:o,path:a}=i;if(e.includes(o)){var s=a.split("/").slice(-2).join("/");n[a]={address:o,relPath:s}}}var u="0/0",c=[t.path,u].join("/");return n[c]||(n[c]={address:t.address,relPath:u}),{relPaths:Object.values(n).map((function(e){return e.relPath})),pathToAddresses:n}})),function _getRelPathToAddressByApi(e){return D.apply(this,arguments)}),Q._collectInfoForSoftwareSign=(V=(0,c.A)((function*(e){var{inputs:t}=e.encodedTx,r=yield this.parseAddressEncodings(t.map((function(e){return e.address}))),n=Array.from(new Set(r.map((function(e,r){if(e===A.EAddressEncodings.P2PKH)return(0,x.wT)(t[r]).txid})).filter((function(e){return!!e}))));return[r,yield this.collectTxs(n)]})),function _collectInfoForSoftwareSign(e){return V.apply(this,arguments)}),Q.prepareBtcSignExtraInfo=(G=(0,c.A)((function*({unsignedTx:e,unsignedMessage:t}){var r=yield this.getAccount(),n=[];if(t&&(n=[r.address]),e){var{inputs:i,inputsToSign:o}=e.encodedTx;n=[].concat(null!=o?o:[],null!=i?i:[]).filter(Boolean).map((function(e){return e.address})).concat(r.address)}var{relPaths:a,pathToAddresses:s}=yield this._getRelPathToAddressByApi({addresses:n,account:r}),u={pathToAddresses:s};if(e){var[c,d]=yield this._collectInfoForSoftwareSign(e);u.inputAddressesEncodings=c,u.nonWitnessPrevTxs=d}return{btcExtraInfo:u,account:_objectSpread(_objectSpread({},r),{},{relPaths:a})}})),function prepareBtcSignExtraInfo(e){return G.apply(this,arguments)}),Q.getPrivateKeyFromImported=function getPrivateKeyFromImported(e){var t=(0,y.mP)({encodedText:e.input}),r=(0,v.convertBtcXprvtToHex)({xprvt:t});return r=(0,y.uX)({text:r}),Promise.resolve({privateKey:r})},Q.getAccountXpub=(W=(0,c.A)((function*(){var e,t=yield this.getAccount();return null!=(e=t.xpubSegwit)?e:t.xpub})),function getAccountXpub(){return W.apply(this,arguments)}),Q.buildEstimateFeeParams=(q=(0,c.A)((function*(){return Promise.resolve(void 0)})),function buildEstimateFeeParams(){return q.apply(this,arguments)}),(0,d.A)(VaultBtc)}(S.S)}}]);