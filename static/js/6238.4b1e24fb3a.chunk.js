(self.webpackChunkweb=self.webpackChunkweb||[]).push([[6238],{438341:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.convertQueryOptionToLumosSearchKey=convertQueryOptionToLumosSearchKey,e.filterByLumosQueryOptions=function filterByLumosQueryOptions(t,e){const r=convertQueryOptionToLumosSearchKey(e);let o=t.filter((t=>filterByLumosSearchKey(t,r)));e.argsLen&&"any"!==e.argsLen&&-1!==e.argsLen&&(o=o.filter((t=>i.bytes.bytify(t.cellOutput.lock.args).length===e.argsLen)));if(e.data&&"any"!==e.data)if(instanceOfDataWithSearchMode(e.data)&&"exact"===e.data.searchMode){const t=e.data;o=o.filter((e=>i.bytes.equal(i.bytes.bytify(e.data),i.bytes.bytify(t.data))))}else if(instanceOfDataWithSearchMode(e.data)&&"prefix"===e.data.searchMode){const t=e.data;o=o.filter((e=>{const r=i.bytes.bytify(t.data),o=i.bytes.bytify(e.data).slice(0,r.length);return i.bytes.equal(r,o)}))}else o=o.filter((t=>{const r=i.bytes.bytify(e.data),o=i.bytes.bytify(t.data).slice(0,r.length);return i.bytes.equal(r,o)}));return o},e.filterByLumosSearchKey=filterByLumosSearchKey,e.instanceOfDataWithSearchMode=instanceOfDataWithSearchMode,e.instanceOfScriptWrapper=instanceOfScriptWrapper,e.unwrapScriptWrapper=e.unwrapDataWrapper=void 0;var o=r(140993),i=r(852966),n=r(739609);function convertQueryOptionToLumosSearchKey(t){let e,r,o;const i=t.lock,n=t.type;if(i&&(e=instanceOfScriptWrapper(i)?i.script:i),n&&"empty"!==n&&(r=instanceOfScriptWrapper(n)?n.script:n),e)o={script:e,scriptType:"lock",scriptSearchMode:instanceOfScriptWrapper(i)&&i.searchMode||"prefix",filter:{}},r&&(o.filter.script=r);else{if(!r)throw new Error("query.lock and query.type can't be both empty");o={script:r,scriptType:"type",scriptSearchMode:instanceOfScriptWrapper(n)&&n.searchMode||"prefix",filter:{}}}const{outputDataLenRange:a,outputCapacityRange:s,scriptLenRange:c}=t;return o.filter.outputDataLenRange=a,o.filter.outputCapacityRange=s,o.filter.scriptLenRange=c,"empty"===n&&(o.filter.scriptLenRange=["0x0","0x1"]),o}function filterByLumosSearchKey(t,e){const r="exact"===e.scriptSearchMode,{cellOutput:a}=t,{scriptType:s,script:c,filter:l}=e;if(r){if("lock"===s){if(!i.bytes.equal(o.blockchain.Script.pack(a.lock),o.blockchain.Script.pack(c)))return!1}else if(!a.type||!i.bytes.equal(o.blockchain.Script.pack(a.type),o.blockchain.Script.pack(c)))return!1}else if("lock"===s){if(!checkScriptWithPrefixMode(a.lock,c))return!1}else if(!checkScriptWithPrefixMode(a.type,c))return!1;if(!l)return!0;if("lock"===s){if(l.script&&!checkScriptWithPrefixMode(a.type,l.script))return!1;if(l.scriptLenRange&&!checkScriptLenRange(a.type,l.scriptLenRange))return!1}else{if(l.script&&!checkScriptWithPrefixMode(a.lock,l.script))return!1;if(l.scriptLenRange&&!checkScriptLenRange(a.lock,l.scriptLenRange))return!1}const{outputCapacityRange:u,outputDataLenRange:p}=l;if(u){const t=n.BI.from(a.capacity),e=n.BI.from(u[0]),r=n.BI.from(u[1]);if(t.lt(e)||t.gte(r))return!1}if(p){const e=n.BI.from(i.bytes.bytify(t.data).length),r=n.BI.from(p[0]),o=n.BI.from(p[1]);if(e.lt(r)||e.gte(o))return!1}return!0}function checkScriptWithPrefixMode(t,e){if(!t)return!1;if(!i.bytes.equal(e.codeHash,t.codeHash))return!1;const r=i.bytes.bytify(e.args),o=i.bytes.bytify(t.args).slice(0,r.length);return!!i.bytes.equal(r,o)&&t.hashType===e.hashType}function checkScriptLenRange(t,e){const r=t?n.BI.from(i.bytes.concat(t.codeHash,t.args).length+1):n.BI.from(0),o=n.BI.from(e[0]),a=n.BI.from(e[1]);return!r.lt(o)&&!r.gte(a)}function instanceOfScriptWrapper(t){return"object"==typeof t&&null!=t&&"script"in t}function instanceOfDataWithSearchMode(t){return"object"==typeof t&&null!=t&&"data"in t}e.unwrapScriptWrapper=t=>instanceOfScriptWrapper(t)?t.script:t;e.unwrapDataWrapper=t=>instanceOfDataWithSearchMode(t)?t.data:t},239397:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CKBCellCollector=void 0;var o=r(140993),i=r(750458),n=r(821824),a=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(r(410288)),s=r(438341);e.CKBCellCollector=class CKBCellCollector{constructor(t,e,r){this.terminableCellFetcher=t,this.otherQueryOptions=r;const o={lock:void 0,type:void 0,argsLen:-1,data:"any",fromBlock:void 0,toBlock:void 0,order:"asc",skip:void 0,outputDataLenRange:void 0,outputCapacityRange:void 0,bufferSize:void 0};this.queries=(Array.isArray(e)?e:[e]).map((t=>({...o,...t}))),this.queries.forEach((t=>{this.validateQueryOption(t)})),this.convertQueryOptionToSearchKey()}validateQueryOption(t){if(!(t.lock||t.type&&"empty"!==t.type))throw new Error("Either lock or type script must be provided!");if(t.lock&&((0,s.instanceOfScriptWrapper)(t.lock)?(0,s.instanceOfScriptWrapper)(t.lock)&&i.validators.ValidateScript(t.lock.script):i.validators.ValidateScript(t.lock)),t.type&&"empty"!==t.type&&("object"!=typeof t.type||(0,s.instanceOfScriptWrapper)(t.type)?"object"==typeof t.type&&(0,s.instanceOfScriptWrapper)(t.type)&&i.validators.ValidateScript(t.type.script):i.validators.ValidateScript(t.type)),t.fromBlock&&o.utils.assertHexadecimal("fromBlock",t.fromBlock),t.toBlock&&o.utils.assertHexadecimal("toBlock",t.toBlock),"asc"!==t.order&&"desc"!==t.order)throw new Error("Order must be either asc or desc!");if(t.outputCapacityRange&&(o.utils.assertHexadecimal("outputCapacityRange[0]",t.outputCapacityRange[0]),o.utils.assertHexadecimal("outputCapacityRange[1]",t.outputCapacityRange[1])),t.outputDataLenRange&&(o.utils.assertHexadecimal("outputDataLenRange[0]",t.outputDataLenRange[0]),o.utils.assertHexadecimal("outputDataLenRange[1]",t.outputDataLenRange[1])),t.scriptLenRange&&(o.utils.assertHexadecimal("scriptLenRange[0]",t.scriptLenRange[0]),o.utils.assertHexadecimal("scriptLenRange[1]",t.scriptLenRange[1])),t.outputDataLenRange&&t.data&&"any"!==t.data){const e=(0,n.getHexStringBytes)((0,s.unwrapDataWrapper)(t.data));if(e<Number(t.outputDataLenRange[0])||e>=Number(t.outputDataLenRange[1]))throw new Error("data length not match outputDataLenRange")}if(t.skip&&"number"!=typeof t.skip)throw new Error("skip must be a number!");if(t.bufferSize&&"number"!=typeof t.bufferSize)throw new Error("bufferSize must be a number!")}convertQueryOptionToSearchKey(){this.queries.forEach((t=>{const e=t.lock;if(e&&(0,s.instanceOfScriptWrapper)(e)&&(i.validators.ValidateScript(e.script),t.lock=e.script),t.type&&"empty"!==t.type&&"object"==typeof t.type&&(0,s.instanceOfScriptWrapper)(t.type)&&(i.validators.ValidateScript(t.type.script),t.type=t.type.script),!t.outputDataLenRange&&t.data&&"any"!==t.data){const e=(0,n.getHexStringBytes)((0,s.unwrapDataWrapper)(t.data));t.outputDataLenRange=["0x"+e.toString(16),"0x"+(e+1).toString(16)]}t.scriptLenRange||"empty"!==t.type||(t.scriptLenRange=["0x0","0x1"])}))}async getLiveCell(t,e){const r={sizeLimit:t.bufferSize,order:t.order,lastCursor:e};return await this.terminableCellFetcher.getCells((0,n.generateSearchKey)(t),void 0,r)}async count(){let t=0;for await(const e of this.collect())t++;return t}async request(t,e){const r=await(0,a.default)(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(200!==r.status)throw new Error(`indexer request failed with HTTP code ${r.status}`);const o=await r.json();if(void 0!==o.error)throw new Error(`indexer request rpc failed with error: ${JSON.stringify(o.error)}`);return o}async getLiveCellWithBlockHash(t,e){if(!this.otherQueryOptions)throw new Error("CKB Rpc URL must provide");const r=await this.getLiveCell(t,e);if(0===r.objects.length)return r;const o=r.objects.map(((t,e)=>({id:e,jsonrpc:"2.0",method:"get_block_hash",params:[t.blockNumber]}))),i=await this.request(this.otherQueryOptions.ckbRpcUrl,o);return r.objects=r.objects.map(((t,e)=>{const r=i.find((t=>t.id===e));return{...t,blockHash:r&&r.result}})),r}async*collect(){const t=new Set;for(const o of this.queries)for await(const i of this.collectBySingleQuery(o)){var e,r;const o=`${null===(e=i.outPoint)||void 0===e?void 0:e.txHash}-${null===(r=i.outPoint)||void 0===r?void 0:r.index}`;t.has(o)||(t.add(o),yield i)}}async*collectBySingleQuery(t){const e=this.otherQueryOptions&&"withBlockHash"in this.otherQueryOptions&&this.otherQueryOptions.withBlockHash;let r;const getCellWithCursor=async()=>{const o=await(e?this.getLiveCellWithBlockHash(t,r):this.getLiveCell(t,r));return r=o.lastCursor,o.objects};let o=await getCellWithCursor();if(o=(0,s.filterByLumosQueryOptions)(o,t),0===o.length)return;let i=getCellWithCursor(),n=0,a=0;for(;;)if(t.skip&&a<t.skip?a++:yield o[n],n++,n===o.length){if(n=0,o=await i,0===o.length)break;i=getCellWithCursor()}}}},12406:(t,e,r)=>{"use strict";Object.defineProperty(e,"We",{enumerable:!0,get:function(){return o.CKBCellCollector}}),Object.defineProperty(e,"HI",{enumerable:!0,get:function(){return i.TerminableCellAdapter}});var o=r(239397),i=r(823737),n=r(891730),a=r(129021)},823737:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TerminableCellAdapter=e.CkbIndexer=void 0;var o=r(140993),i=r(821824),n=r(239397),a=r(450046),s=r(533060),c=r(739609),l=r(129021),u=r(436115),p=r(750458),d=r(438341);function _defineProperty(t,e,r){return(e=function _toPropertyKey(t){var e=function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const DefaultTerminator=()=>({stop:!1,push:!0});function defaultLogger(t,e){console.log(`[${t}] ${e}`)}class CkbIndexer{constructor(t,e){_defineProperty(this,"medianTimeEmitters",[]),_defineProperty(this,"emitters",[]),_defineProperty(this,"isSubscribeRunning",!1),this.ckbIndexerUrl=t,this.ckbRpcUrl=e,this.uri=e||t,this.ckbIndexerUri=t}getCkbRpc(){return new u.CKBRPC(this.uri)}getIndexerRpc(){if(this.uri===this.ckbIndexerUri){const t=this.getCkbRpc();return{...t,getTip:t.getIndexerTip}}return new l.RPC(this.ckbIndexerUri)}async tip(){return await this.getIndexerRpc().getTip()}asyncSleep(t){return new Promise((e=>setTimeout(e,t)))}async waitForSync(t=0){const e=parseInt((await this.getCkbRpc().getTipHeader()).number,16);for(;;){if(parseInt((await this.tip()).blockNumber,16)+t>=e)return;await this.asyncSleep(1e3)}}collector(t,e){return new n.CKBCellCollector(this,t,e)}async getCells(t,e=DefaultTerminator,r={}){return new TerminableCellAdapter(this.getIndexerRpc()).getCells(t,e,r)}async getTransactions(t,e={}){let r=[],o=e.lastCursor;const i=e.sizeLimit||100,n=e.order||"asc";for(;;){const e=await this.getIndexerRpc().getTransactions(t,n,`0x${i.toString(16)}`,o),a=e.objects;if(o=e.lastCursor,r=r.concat(a),a.length<=i)break}return{objects:r,lastCursor:o}}running(){return!0}start(){defaultLogger("warn","deprecated: no need to start the ckb-indexer manually")}startForever(){defaultLogger("warn","deprecated: no need to startForever the ckb-indexer manually")}stop(){defaultLogger("warn","deprecated: no need to stop the ckb-indexer manually")}subscribe(t){if(this.isSubscribeRunning=!0,this.scheduleLoop(),t.lock&&t.type)throw new Error("The notification machanism only supports you subscribing for one script once so far!");null===t.toBlock&&null===t.skip||defaultLogger("warn","The passing fields such as toBlock and skip are ignored in subscribe() method.");const e=new s.IndexerEmitter;if(e.argsLen=t.argsLen,e.outputData=t.data&&(0,d.unwrapDataWrapper)(t.data),t.fromBlock&&o.utils.assertHexadecimal("fromBlock",t.fromBlock),e.fromBlock=t.fromBlock?c.BI.from(t.fromBlock):c.BI.from(0),t.lock)p.validators.ValidateScript(t.lock),e.lock=t.lock;else{if(!t.type||"empty"===t.type)throw new Error("Either lock or type script must be provided!");p.validators.ValidateScript(t.type),e.type=t.type}return this.emitters.push(e),e}loop(){this.isSubscribeRunning&&this.poll().then((t=>{this.scheduleLoop(t)})).catch((t=>{defaultLogger("error",`Error occurs: ${t} ${t.stack}, stopping indexer!`),this.isSubscribeRunning=!1}))}scheduleLoop(t=1){setTimeout((()=>{this.loop()}),t)}async poll(){let t=1;const e=await this.tip(),{blockNumber:r,blockHash:o}=e;if("0x0"===r){const t=await this.getCkbRpc().getBlockByNumber(r);await this.publishAppendBlockEvents(t)}const i=c.BI.from(r).add(1),n=await this.getCkbRpc().getBlockByNumber(`0x${i.toString(16)}`);if(n)if(n.header.parentHash===o)await this.publishAppendBlockEvents(n);else{const t=await this.getCkbRpc().getBlockByNumber(r);await this.publishAppendBlockEvents(t)}else{const e=await this.getCkbRpc().getBlockByNumber(r);await this.publishAppendBlockEvents(e),t=3e3}return t}async publishAppendBlockEvents(t){for(const[e,r]of t.transactions.entries()){const o=t.header.number;if(e>0){const t=r.inputs.map((t=>t.previousOutput.txHash));(await(0,i.requestBatchTransactionWithStatus)(this.uri,t).then((t=>t.map(((t,e)=>{const o=r.inputs[e].previousOutput.index;return{output:t.transaction.outputs[parseInt(o)],outputData:t.transaction.outputsData[parseInt(o)]}}))))).forEach((({output:t,outputData:e})=>{this.filterEvents(t,o,e)}))}for(const[t,e]of r.outputs.entries()){const i=r.outputsData[t];this.filterEvents(e,o,i)}}await this.emitMedianTimeEvents()}filterEvents(t,e,r){for(const o of this.emitters)void 0!==o.lock&&this.checkFilterOptions(o,e,r,o.lock,t.lock)&&o.emit("changed");if(null!==t.type)for(const o of this.emitters)void 0!==o.type&&this.checkFilterOptions(o,e,r,o.type,t.type)&&o.emit("changed")}checkFilterOptions(t,e,r,o,i){const n=!t.fromBlock||c.BI.from(t.fromBlock).lte(e),a="any"===t.outputData||!t.outputData||t.outputData===r,s=!i||o.codeHash===i.codeHash&&o.hashType===i.hashType&&this.checkArgs(t.argsLen,o.args,i.args);return n&&a&&s}checkArgs(t,e,r){return-1===t||!t&&0!==t?e===r:("number"==typeof t&&r.length===2*t+2||"any"===t)&&r.substring(0,e.length)===e}async emitMedianTimeEvents(){if(0===this.medianTimeEmitters.length)return;const t=(await this.getCkbRpc().getBlockchainInfo()).medianTime;for(const e of this.medianTimeEmitters)e.emit("changed",t)}subscribeMedianTime(){this.isSubscribeRunning=!0,this.scheduleLoop();const t=new a.EventEmitter;return this.medianTimeEmitters.push(t),t}}e.CkbIndexer=CkbIndexer,_defineProperty(CkbIndexer,"version","0.4.1");class TerminableCellAdapter{constructor(t){this.getCellsableRpc=t}async getCells(t,e=DefaultTerminator,r={}){const o=[];let i=r.lastCursor;const n=r.sizeLimit||100,a=r.order||"asc";for(;;){const r=await this.getCellsableRpc.getCells(t,a,`0x${n.toString(16)}`,i),s=r.objects;i=r.lastCursor;for(const t of s){const r={cellOutput:t.output,data:t.outputData,outPoint:t.outPoint?t.outPoint:void 0,blockNumber:t.blockNumber},{stop:n,push:a}=e(0,r);if(a&&o.push(r),n)return{objects:o,lastCursor:i}}if(s.length<=n)break}return{objects:o,lastCursor:i}}}e.TerminableCellAdapter=TerminableCellAdapter},823550:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toSearchKey=e.toSearchFilter=e.toScript=e.toGetTransactionsSearchKey=e.toGetCellsSearchKey=void 0;const toScript=t=>({code_hash:t.codeHash,hash_type:t.hashType,args:t.args});e.toScript=toScript;const toSearchFilter=t=>({script:t.script?toScript(t.script):t.script,output_data_len_range:t.outputDataLenRange,output_capacity_range:t.outputCapacityRange,block_range:t.blockRange,script_len_range:t.scriptLenRange});e.toSearchFilter=toSearchFilter;const toSearchKey=t=>({script:toScript(t.script),script_type:t.scriptType,filter:t.filter?toSearchFilter(t.filter):t.filter,script_search_mode:t.scriptSearchMode?t.scriptSearchMode:"prefix"});e.toSearchKey=toSearchKey;e.toGetCellsSearchKey=t=>({...toSearchKey(t),with_data:t.withData});e.toGetTransactionsSearchKey=t=>({...toSearchKey(t),group_by_transaction:t.groupByTransaction})},66087:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toTip=e.toSearchKey=e.toSearchFilter=e.toScript=e.toOutPoint=e.toCellOutPut=void 0;e.toTip=t=>({blockHash:t.block_hash,blockNumber:t.block_number});const toScript=t=>({codeHash:t.code_hash,hashType:t.hash_type,args:t.args});e.toScript=toScript;e.toOutPoint=t=>({txHash:t.tx_hash,index:t.index});e.toCellOutPut=t=>({...t,lock:toScript(t.lock),type:t.type?toScript(t.type):void 0});const toSearchFilter=t=>({script:t.script?toScript(t.script):t.script,outputDataLenRange:t.output_data_len_range,outputCapacityRange:t.output_capacity_range,scriptLenRange:t.script_len_range,blockRange:t.block_range});e.toSearchFilter=toSearchFilter;e.toSearchKey=t=>({script:toScript(t.script),scriptType:t.script_type,filter:t.filter?toSearchFilter(t.filter):t.filter,scriptSearchMode:t.script_search_mode})},129021:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RPC=void 0;var o=r(140993),i=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(r(410288)),n=r(823550);e.RPC=class RPC{constructor(t){this.uri=t}async getTip(){return o.utils.deepCamel(await request(this.uri,"get_tip"))}async getCells(t,e,r,i){const a=[(0,n.toGetCellsSearchKey)(t),e,r,i];return o.utils.deepCamel(await request(this.uri,"get_cells",a))}async getTransactions(t,e,r,i){const a=[(0,n.toGetTransactionsSearchKey)(t),e,r,i];return o.utils.deepCamel(await request(this.uri,"get_transactions",a))}async getIndexerInfo(){return o.utils.deepCamel(await request(this.uri,"get_indexer_info"))}};const request=async(t,e,r)=>{const o=await(0,i.default)(t,{method:"POST",body:JSON.stringify({id:0,jsonrpc:"2.0",method:e,params:r}),headers:{"Content-Type":"application/json"}});if(200!==o.status)throw new Error(`indexer request failed with HTTP code ${o.status}`);const n=await o.json();if(void 0!==n.error)throw new Error(`indexer request rpc failed with error: ${JSON.stringify(n.error)}`);return n.result}},821824:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getHexStringBytes=e.generateSearchKey=void 0,e.requestBatch=requestBatch,e.requestBatchTransactionWithStatus=async function requestBatchTransactionWithStatus(t,e){if(0===e.length)return[];const r=e.map(((t,e)=>({id:e,jsonrpc:"2.0",method:"get_transaction",params:[t]})));return(await requestBatch(t,r)).map((t=>l.ResultFormatter.toTransactionWithStatus(t.result)))};var o=r(140993),i=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(r(410288)),n=r(739609),a=r(823550),s=r(66087),c=r(438341),l=r(436115);e.generateSearchKey=t=>{let e;const r={};let o,i="prefix";if(t.lock){const i=(0,c.unwrapScriptWrapper)(t.lock);if(e=(0,a.toScript)(i),o="lock",t.type&&"string"!=typeof t.type){const e=(0,c.unwrapScriptWrapper)(t.type);r.script=(0,a.toScript)(e)}}else if(t.type&&"string"!=typeof t.type){const r=(0,c.unwrapScriptWrapper)(t.type);e=(0,a.toScript)(r),o="type"}let l=null;if(t.fromBlock&&t.toBlock&&(l=[t.fromBlock,`0x${n.BI.from(t.toBlock).add(1).toString(16)}`]),l&&(r.block_range=l),t.outputDataLenRange&&(r.output_data_len_range=t.outputDataLenRange),t.outputCapacityRange&&(r.output_capacity_range=t.outputCapacityRange),t.scriptLenRange&&(r.script_len_range=t.scriptLenRange),t.scriptSearchMode&&(i=t.scriptSearchMode),!e)throw new Error("Either lock or type script must be provided!");if(!o)throw new Error("script_type must be provided");return(0,s.toSearchKey)({script:e,script_type:o,filter:r,script_search_mode:i})};e.getHexStringBytes=t=>(o.utils.assertHexString("",t),Math.ceil(t.substr(2).length/2));let u=0;async function requestBatch(t,e){if(!e.length)return[];const r=await(0,i.default)(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.map((t=>({id:u++,...t}))))});if(200!==r.status)throw new Error(`Indexer request failed with HTTP code ${r.status}`);const o=await r.json();if(void 0!==o.error)throw new Error(`indexer request rpc failed with error: ${JSON.stringify(o.error)}`);return o}},891730:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CKBIndexerTransactionCollector=void 0;var o=r(140993),i=r(438341),n=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(821824));function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}function _defineProperty(t,e,r){return(e=function _toPropertyKey(t){var e=function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class CKBIndexerTransactionCollector extends o.indexer.TransactionCollector{constructor(t,e,r,o){super(t,e,o),_defineProperty(this,"getTransactionListFromRpc",(async t=>{const e=t.objects.map((t=>t.txHash));return await n.requestBatchTransactionWithStatus(this.CKBRpcUrl,e).then((e=>e.map(((e,r)=>{if(!this.filterOptions.skipMissing&&!e.transaction)throw new Error(`Transaction ${t.objects[r].txHash} is missing!`);return e}))))})),_defineProperty(this,"isLockArgsLenMatched",((t,e)=>!e||("any"===e||(-1===e||n.getHexStringBytes(t)===e)))),_defineProperty(this,"isCellScriptArgsValid",(t=>{if(this.queries.lock){const e=(0,i.instanceOfScriptWrapper)(this.queries.lock)?this.queries.lock.argsLen:this.queries.argsLen;if(!this.isLockArgsLenMatched(t.lock.args,e))return!1}if(this.queries.type&&"empty"!==this.queries.type){var e;const r=(0,i.instanceOfScriptWrapper)(this.queries.type)?this.queries.type.argsLen:this.queries.argsLen;if(!this.isLockArgsLenMatched(null===(e=t.type)||void 0===e?void 0:e.args,r))return!1}return!this.queries.type||"empty"!==this.queries.type||!t.type})),_defineProperty(this,"filterByIoType",((t,e)=>"both"===e?t:"input"===e||"output"===e?t.filter((t=>t.ioType===e||"both"===t.ioType)):t)),_defineProperty(this,"filterByTypeIoTypeAndLockIoType",((t,e)=>{let r=t;return(0,i.instanceOfScriptWrapper)(e.lock)&&e.lock.ioType&&(r=this.filterByIoType(r,e.lock.ioType)),(0,i.instanceOfScriptWrapper)(e.type)&&e.type.ioType&&(r=this.filterByIoType(r,e.type.ioType)),r})),this.indexer=t,this.queries=e,this.CKBRpcUrl=r,this.options=o;this.filterOptions={skipMissing:!1,includeStatus:!0,...this.options}}static asBaseTransactionCollector(t){return class extends o.indexer.TransactionCollector{constructor(e,r,o){return super(e,r,o),new CKBIndexerTransactionCollector(e,r,t,o)}}}async fetchIndexerTransaction(t,e){const r={sizeLimit:t.bufferSize,order:t.order};e&&(r.lastCursor=e);let o={objects:[],lastCursor:""};return(0,i.instanceOfScriptWrapper)(t.lock)&&(0,i.instanceOfScriptWrapper)(t.type)?(o=await this.getTransactionByLockAndTypeIndependent(r),e=o.lastCursor):(o=await this.indexer.getTransactions(n.generateSearchKey(t),r),e=o.lastCursor),o.objects=this.filterByTypeIoTypeAndLockIoType(o.objects,t),o}getResolvedTransactionRequestPayload(t,e){const r=[];return t.forEach(((t,o)=>{const i=e.objects[o];if("input"===i.ioType){const e=t.transaction.inputs[Number(i.ioIndex)].previousOutput;r.push(e.txHash)}})),r}getResolvedCell(t,e,r){if("input"!==r.ioType)return t.transaction.outputs[Number(r.ioIndex)];{const o=t.transaction.inputs[Number(r.ioIndex)].previousOutput,i=e.find((t=>t.transaction.hash===o.txHash));if(!i)throw new Error("Impossible: can NOT find resolved transaction!");return i.transaction.outputs[Number(o.index)]}}filterTransaction(t,e,r){return t.filter(((t,o)=>{const i=this.getResolvedCell(t,e,r.objects[o]);return this.isCellScriptArgsValid(i)})).map((t=>({transaction:t.transaction,txStatus:t.txStatus,cycles:t.cycles,timeAddedToPool:t.timeAddedToPool})))}async getTransactions(t){const e=await this.fetchIndexerTransaction(this.queries,t);if(t=e.lastCursor,0===e.objects.length)return{objects:[],lastCursor:t};const r=await this.getTransactionListFromRpc(e),o=this.getResolvedTransactionRequestPayload(r,e),i=await n.requestBatchTransactionWithStatus(this.CKBRpcUrl,o);return{objects:this.filterTransaction(r,i,e),lastCursor:t}}async getTransactionByLockAndTypeIndependent(t){const e={...t},r={...t};if(t.lastCursor){const[o,i]=t.lastCursor.split("-");r.lastCursor=o,e.lastCursor=i}const o={...this.queries,type:void 0},i=await this.indexer.getTransactions(n.generateSearchKey(o),e),a={...this.queries,lock:void 0},s=await this.indexer.getTransactions(n.generateSearchKey(a),r);return{objects:((t,e)=>{const r=[];return t.forEach((t=>{const o=e.find((e=>e.txHash===t.txHash));if(o){const e="output"===t.ioType?t:o;r.push({...e,ioType:"both"})}})),r})(s.objects,i.objects),lastCursor:i.lastCursor+"-"+s.lastCursor}}async count(){let t;const getTxWithCursor=async()=>{const e=await this.getTransactions(t);return t=e.lastCursor,e.objects};let e=0,r=await getTxWithCursor();if(0===r.length)return 0;let o=getTxWithCursor(),i=0,n=0;for(;;)if(this.queries.skip&&n<this.queries.skip?n++:e+=1,i++,i===r.length){if(i=0,r=await o,0===r.length)break;o=getTxWithCursor()}return e}async getTransactionHashes(){let t;const getTxWithCursor=async()=>{const e=await this.getTransactions(t);return t=e.lastCursor,e.objects},e=[];let r=await getTxWithCursor();if(0===r.length)return[];let o=getTxWithCursor(),i=0,n=0;for(;;)if(this.queries.skip&&n<this.queries.skip?n++:r[i].transaction.hash&&e.push(r[i].transaction.hash),i++,i===r.length){if(i=0,r=await o,0===r.length)break;o=getTxWithCursor()}return e}async*collect(){let t;const getTxWithCursor=async()=>{const e=await this.getTransactions(t);return t=e.lastCursor,e.objects};let e=await getTxWithCursor();if(0===e.length)return;let r=getTxWithCursor(),o=0,i=0;for(;;)if(this.queries.skip&&i<this.queries.skip?i++:this.filterOptions.includeStatus?yield e[o]:yield e[o].transaction,o++,o===e.length){if(o=0,e=await r,0===e.length)break;r=getTxWithCursor()}}}e.CKBIndexerTransactionCollector=CKBIndexerTransactionCollector},533060:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IndexerEmitter=void 0;var o=r(450046);class IndexerEmitter extends o.EventEmitter{}e.IndexerEmitter=IndexerEmitter},518042:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WitnessArgs=e.BytesVec=e.BytesOpt=e.Bytes=e.Byte32Vec=e.Byte32=void 0,e.WitnessArgsOf=WitnessArgsOf,e.createFixedHexBytesCodec=createFixedHexBytesCodec;var o=r(220941),i=r(542069),n=r(640035);function createFixedHexBytesCodec(t){return(0,o.createFixedBytesCodec)({byteLength:t,pack:t=>(0,i.bytify)(t),unpack:t=>(0,i.hexify)(t)})}const a=(0,n.byteVecOf)({pack:i.bytify,unpack:i.hexify});e.Bytes=a;const s=(0,n.option)(a);e.BytesOpt=s;const c=(0,n.vector)(a);e.BytesVec=c;const l=createFixedHexBytesCodec(32);e.Byte32=l;const u=(0,n.vector)(l);function WitnessArgsOf(t){return(0,n.table)({lock:(0,n.option)((0,n.byteVecOf)(t.lock)),input_type:(0,n.option)((0,n.byteVecOf)(t.input_type)),output_type:(0,n.option)((0,n.byteVecOf)(t.output_type))},["lock","input_type","output_type"])}e.Byte32Vec=u;const p=(0,o.createBytesCodec)({pack:i.bytify,unpack:i.hexify}),d=WitnessArgsOf({lock:p,input_type:p,output_type:p});e.WitnessArgs=d},911584:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CellCollector=void 0,e.checkLimit=checkLimit,e.default=void 0,e.injectCapacity=injectCapacity,e.prepareSigningEntries=prepareSigningEntries,e.setupInputCell=setupInputCell,e.setupOutputCell=setupOutputCell,e.withdraw=withdraw;var o=r(140993),i=r(852966),n=r(519808),a=r(893597),s=r(706081),c=r(739609),l=r(446037),u=r(555258),p=r(77922);const{ScriptValue:d}=o.values,{CKBHasher:f,ckbHash:h}=o.utils,g=class CellCollector{constructor(t,e,{config:r,queryOptions:o={}}={}){if(!e)throw new Error("Cell provider is missing!");r=r||(0,n.getConfig)(),this.fromScript=(0,l.parseFromInfo)(t,{config:r}).fromScript,this.config=r,o={...o,lock:this.fromScript,type:o.type||"empty"},this.cellCollector=e.collector(o)}async*collect(){if((0,u.isAcpScript)(this.fromScript,this.config))for await(const t of this.cellCollector.collect())yield t}};async function setupInputCell(t,e,r,{config:a,defaultWitness:s="0x",since:c}={}){a=a||(0,n.getConfig)();const l=e.cellOutput.lock;if(!(0,u.isAcpScript)(l,a))throw new Error("Not anyone-can-pay input!");t=t.update("inputs",(t=>t.push(e))),c&&(t=t.update("inputSinces",(e=>e.set(t.get("inputs").size-1,c)))),t=t.update("witnesses",(t=>t.push(s)));const p={cellOutput:{capacity:e.cellOutput.capacity,lock:e.cellOutput.lock,type:e.cellOutput.type},data:e.data};t=(t=t.update("outputs",(t=>t.push(p)))).update("fixedEntries",(e=>e.push({field:"outputs",index:t.get("outputs").size-1})));const f=a.SCRIPTS.ANYONE_CAN_PAY;if(!f)throw new Error("ANYONE_CAN_PAY script not defined in config!");const h={txHash:f.TX_HASH,index:f.INDEX},g=(t=(0,u.addCellDep)(t,{outPoint:h,depType:f.DEP_TYPE})).get("inputs").findIndex((t=>new d(t.cellOutput.lock,{validate:!1}).equals(new d(l,{validate:!1}))));if(-1!==g){for(;g>=t.get("witnesses").size;)t=t.update("witnesses",(t=>t.push("0x")));let e=t.get("witnesses").get(g);const r={lock:u.SECP_SIGNATURE_PLACEHOLDER};if("0x"!==e){const t=o.blockchain.WitnessArgs.unpack(i.bytes.bytify(e)),n=t.lock;if(n&&r.lock&&!i.bytes.equal(n,r.lock))throw new Error("Lock field in first witness is set aside for signature!");const a=t.inputType;a&&(r.inputType=a);const s=t.outputType;s&&(r.outputType=s)}e=i.bytes.hexify(o.blockchain.WitnessArgs.pack(r)),t=t.update("witnesses",(t=>t.set(g,e)))}return t}function checkLimit(t,e){const r=c.BI.from(e);let o,i;if(t.length>=46&&(o=c.BI.from(10).pow("0x"+t.slice(44,46))),t.length>=44){const e=c.BI.from(10).pow("0x"+t.slice(42,44)),r=c.BI.from(10).pow(8);i=e.mul(r)}if(i&&o){if(r.lt(i))throw new Error(`capacity(${e}) less than toAddress minimal capacity limit(${i}), and amount less then toAddress minimal amount limit(${o})! If you want to transfer sudt, maybe sudt.transfer can help you.`)}else if(i&&r.lt(i))throw new Error(`capacity(${e}) less than toAddress minimal capacity limit(${i})!`)}async function setupOutputCell(t,e,{config:r}={}){r=r||(0,n.getConfig)();const o=e.cellOutput.lock,i=c.BI.from(e.cellOutput.capacity);checkLimit(o.args,i.toString());const s=t.get("cellProvider");if(!s)throw new Error("Cell Provider is missing!");const l=(0,a.generateAddress)(o,{config:r}),p=new g(l,s,{config:r}),d=(await p.collect().next()).value;let f=i;if(d&&(f=i.add(d.cellOutput.capacity),t=(t=t.update("inputs",(t=>t.push(d)))).update("witnesses",(t=>t.push("0x")))),e.cellOutput.capacity="0x"+f.toString(16),t=t.update("outputs",(t=>t.push(e))),d){const e=r.SCRIPTS.ANYONE_CAN_PAY;if(!e)throw new Error("ANYONE_CAN_PAY script not defined in config!");const o={txHash:e.TX_HASH,index:e.INDEX};t=(0,u.addCellDep)(t,{outPoint:o,depType:e.DEP_TYPE})}return t}async function injectCapacity(t,e,r,o,{config:i}={}){if(i=i||(0,n.getConfig)(),r>=e.get("outputs").size)throw new Error("Invalid output index!");let l=c.BI.from(o);if(!i.SCRIPTS.ANYONE_CAN_PAY)throw new Error("Provided config does not have ANYONE_CAN_PAY script setup!");const u=t.fromScript,p=e.get("fixedEntries").filter((({field:t})=>"outputs"===t)).maxBy((({index:t})=>t));let f=p?p.index+1:0;for(;f<e.get("outputs").size&&l.gt(0);f++){const t=e.get("outputs").get(f);if(new d(t.cellOutput.lock,{validate:!1}).equals(new d(u,{validate:!1}))){const e=c.BI.from(t.cellOutput.capacity),r=e.sub((0,a.minimalCellCapacityCompatible)(t)),o=l.gte(r)?r:l;l=l.sub(o),t.cellOutput.capacity="0x"+e.sub(o).toString(16)}}e=e.update("outputs",(t=>t.filter((t=>!c.BI.from(t.cellOutput.capacity).eq(0)))));const getInputKey=t=>`${t.outPoint.txHash}_${t.outPoint.index}`;if(l.gt(0)){const r={cellOutput:{capacity:"0x0",lock:u,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0};let o=c.BI.from(0);const n=c.BI.from((0,a.minimalCellCapacityCompatible)(r));let p=(0,s.Set)();for(const t of e.get("inputs"))p=p.add(getInputKey(t));for await(const a of t.collect()){if(p.has(getInputKey(a)))continue;const t=(e=await setupInputCell(e,a,0,{config:i})).get("outputs").size-1,s=(e=e.update("outputs",(e=>e.remove(t)))).get("fixedEntries").findIndex((e=>"outputs"===e.field&&e.index===t));s>=0&&(e=e.update("fixedEntries",(t=>t.remove(s))));const u=c.BI.from(a.cellOutput.capacity);let d=u;if(d.gt(l)&&(d=l),l=l.sub(d),o=o.add(u.sub(d)),l.eq(0)&&o.gte(n))break;r.cellOutput.capacity="0x"+o.toString(16),e=e.update("outputs",(t=>t.push(r)))}if(l.gt(0)||o<n)throw new Error("Not enough capacity in from address!");r.cellOutput.capacity="0x"+o.toString(16),e=e.update("outputs",(t=>t.push(r)))}return e}function prepareSigningEntries(t,{config:e}={}){const r="ANYONE_CAN_PAY",i=(e=e||(0,n.getConfig)()).SCRIPTS[r];if(!i)throw new Error(`Provided config does not have ${r} script setup!`);let l=(0,s.Set)();const g=(0,a.createTransactionFromSkeleton)(t),y=h(o.blockchain.RawTransaction.pack(g)),m=t.get("inputs"),b=t.get("witnesses");let S=t.get("signingEntries");for(let e=0;e<m.size;e++){const r=m.get(e);if(i.CODE_HASH===r.cellOutput.lock.codeHash&&i.HASH_TYPE===r.cellOutput.lock.hashType&&!l.has(r.cellOutput.lock.args)){l=l.add(r.cellOutput.lock.args);const i=t.get("outputs").filter((t=>new d(t.cellOutput.lock,{validate:!1}).equals(new d(r.cellOutput.lock,{validate:!1})))),n=i.map((t=>c.BI.from(t.cellOutput.capacity))).reduce(((t,e)=>t.add(e)),c.BI.from(0)),a=i.filter((t=>"0x"!==t.data)).map((t=>(0,p.unpackAmount)(t.data))).reduce(((t,e)=>t.add(e)),c.BI.from(0)),s=m.filter((t=>new d(t.cellOutput.lock,{validate:!1}).equals(new d(r.cellOutput.lock,{validate:!1})))),h=s.map((t=>c.BI.from(t.cellOutput.capacity))).reduce(((t,e)=>t.add(e)),c.BI.from(0)),g=s.filter((t=>"0x"!==t.data)).map((t=>c.BI.from((0,p.unpackAmount)(t.data)))).reduce(((t,e)=>t.add(e)),c.BI.from(0));if(h.lte(n)&&g.lte(a))continue;const C=new o.values.ScriptValue(r.cellOutput.lock,{validate:!1}),_=new f;if(_.update(y),e>=b.size)throw new Error(`The first witness in the script group starting at input index ${e} does not exist, maybe some other part has invalidly tampered the transaction?`);(0,u.hashWitness)(_,b.get(e));for(let t=e+1;t<m.size&&t<b.size;t++){const e=m.get(t);C.equals(new o.values.ScriptValue(e.cellOutput.lock,{validate:!1}))&&(0,u.hashWitness)(_,b.get(t))}for(let t=m.size;t<b.size;t++)(0,u.hashWitness)(_,b.get(t));const w={type:"witness_args_lock",index:e,message:_.digestHex()};S=S.push(w)}}return t=t.set("signingEntries",S)}async function withdraw(t,e,r,o,{config:i}={}){if(i=i||(0,n.getConfig)(),!(0,u.isAcpScript)(e.cellOutput.lock,i))throw new Error("fromInput is not a ANYONE_CAN_PAY cell!");const s=c.BI.from(o),l=c.BI.from(e.cellOutput.capacity),p=c.BI.from((0,a.minimalCellCapacityCompatible)(e));if(!(s.gte(0)&&s.lte(l.sub(p))||s.eq(l)))throw new Error(`capacity must be in [0, ${l.sub(p)}] or ${l} !`);const d=(0,a.parseAddress)(r,{config:i}),f={cellOutput:{capacity:"0x"+o.toString(16),lock:d,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0};if((0,u.isAcpScript)(d,i)){checkLimit(d.args,o);const e=t.get("cellProvider");if(!e)throw new Error("Cell Provider is missing!");const n=new g(r,e,{config:i}),a=(await n.collect().next()).value;if(!a)throw new Error("toAddress ANYONE_CAN_PAY input not found!");const c=s.add(a.cellOutput.capacity);f.cellOutput.capacity="0x"+c.toString(16),t=(t=t.update("inputs",(t=>t.push(a)))).update("witnesses",(t=>t.push("0x")))}t=t.update("outputs",(t=>t.push(f)));const h=(t=await setupInputCell(t,e,(0,a.generateAddress)(e.cellOutput.lock,{config:i}),{config:i})).get("outputs").size-1,y=(t=t.update("outputs",(t=>t.remove(h)))).get("fixedEntries").findIndex((t=>"outputs"===t.field&&t.index===h));return y>=0&&(t=t.update("fixedEntries",(t=>t.remove(y)))),s.eq(l)||(t=t.update("outputs",(t=>t.push({cellOutput:{capacity:"0x"+l.sub(o).toString(16),lock:e.cellOutput.lock,type:e.cellOutput.type},data:e.data})))),t}e.CellCollector=g;var y={CellCollector:g,setupInputCell,setupOutputCell,injectCapacity,prepareSigningEntries,withdraw};e.default=y},974247:(t,e,r)=>{"use strict";var o=r(901048).Buffer;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.injectCapacity=injectCapacity,e.payFee=payFee,e.payFeeByFeeRate=payFeeByFeeRate,e.prepareSigningEntries=prepareSigningEntries,e.registerCustomLockScriptInfos=registerCustomLockScriptInfos,e.setupInputCell=setupInputCell,e.transfer=transfer;var i=r(893597),n=_interopRequireDefault(r(342202)),a=r(446037),s=_interopRequireDefault(r(574393)),c=r(519808),l=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(474233)),u=r(140993),p=_interopRequireDefault(r(911584)),d=r(706081),f=r(555258),h=r(739609),g=_interopRequireDefault(r(478988));function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}const{ScriptValue:y}=u.values;function defaultLogger(t,e){console.log(`[${t}] ${e}`)}const m={configHashCode:0,_predefinedInfos:[],_customInfos:[],get infos(){return[...this._predefinedInfos,...this._customInfos]}};function registerCustomLockScriptInfos(t){m._customInfos=t}function generateLockScriptInfos({config:t}={}){t=t||(0,c.getConfig)();const getPredefinedInfos=()=>{var e,r,o,i;const a=null===(e=t)||void 0===e?void 0:e.SCRIPTS.SECP256K1_BLAKE160,c=null===(r=t)||void 0===r?void 0:r.SCRIPTS.SECP256K1_BLAKE160_MULTISIG,l=null===(o=t)||void 0===o?void 0:o.SCRIPTS.ANYONE_CAN_PAY,u=null===(i=t)||void 0===i?void 0:i.SCRIPTS.OMNILOCK,d=[];return a?d.push({codeHash:a.CODE_HASH,hashType:a.HASH_TYPE,lockScriptInfo:s.default}):defaultLogger("warn","SECP256K1_BLAKE160 script info not found in config!"),c?d.push({codeHash:c.CODE_HASH,hashType:c.HASH_TYPE,lockScriptInfo:n.default}):defaultLogger("warn","SECP256K1_BLAKE160_MULTISIG script info not found in config!"),l?d.push({codeHash:l.CODE_HASH,hashType:l.HASH_TYPE,lockScriptInfo:p.default}):defaultLogger("warn","ANYONE_CAN_PAY script info not found in config!"),u?d.push({codeHash:u.CODE_HASH,hashType:u.HASH_TYPE,lockScriptInfo:g.default}):defaultLogger("warn","OMNILOCK script info not found in config!"),d},e=u.utils.hashCode(o.from(JSON.stringify(t)));0===m.infos.length?(m._predefinedInfos=getPredefinedInfos(),m.configHashCode=e):e!==m.configHashCode&&(defaultLogger("warn","`config` changed, regenerate lockScriptInfos!"),m._predefinedInfos=getPredefinedInfos(),m.configHashCode=e)}async function transfer(t,e,r,o,n,a,{config:s,useLocktimeCellsFirst:u=!0,LocktimePoolCellCollector:p=l.CellCollector}={}){var d;s=s||(0,c.getConfig)();const f=h.BI.from(o);if(!r)throw new Error("You must provide a to address!");const g=(0,i.parseAddress)(r,{config:s}),y={cellOutput:{capacity:"0x"+f.toString(16),lock:g,type:void 0},data:"0x"};generateLockScriptInfos({config:s});const b=m.infos.find((t=>t.codeHash===g.codeHash&&t.hashType===g.hashType));return t=b&&null!==(d=b.lockScriptInfo)&&void 0!==d&&d.setupOutputCell?await b.lockScriptInfo.setupOutputCell(t,y,{config:s}):t.update("outputs",(t=>t.push(y))),t=await injectCapacity(t,e,f.toString(),n,a,{config:s,useLocktimeCellsFirst:u,LocktimePoolCellCollector:p})}async function injectCapacity(t,e,r,o,n,{config:s,useLocktimeCellsFirst:u=!0,LocktimePoolCellCollector:p=l.CellCollector,enableDeductCapacity:d=!0}={}){s=s||(0,c.getConfig)();let f=h.BI.from(r);if(0===e.length)throw new Error("No from info provided!");const g={cellOutput:{capacity:"0x0",lock:(0,a.parseFromInfo)(o||e[0],{config:s}).fromScript,type:void 0},data:"0x"},y=h.BI.from((0,i.minimalCellCapacityCompatible)(g));let m=h.BI.from(0);if(u){if(n){const r=await l.default.injectCapacityWithoutChangeCompatible(t,e,f.toString(),n,y.toString(),{config:s,LocktimeCellCollector:p,enableDeductCapacity:d});t=r.txSkeleton,f=h.BI.from(r.capacity),m=h.BI.from(r.changeCapacity)}if(f.gt(0)){const r=await _commonTransferCompatible(t,e,f,y,{config:s,enableDeductCapacity:d});t=r.txSkeleton,f=r.capacity,m=r.changeCapacity}else if(f.eq(0)&&m.gt(0)&&m.lt(y)){const r=await _commonTransferCompatible(t,e,y.sub(m),h.BI.from(0),{config:s,enableDeductCapacity:d});t=r.txSkeleton,f=r.capacity,m=r.changeCapacity}}else{const r=await _commonTransferCompatible(t,e,f,y,{config:s,enableDeductCapacity:d});if(t=r.txSkeleton,f=r.capacity,m=r.changeCapacity,n)if(f.gt(0)){const r=await l.default.injectCapacityWithoutChangeCompatible(t,e,f.toString(),n,y.toString(),{config:s,LocktimeCellCollector:p,enableDeductCapacity:d});t=r.txSkeleton,f=h.BI.from(r.capacity),m=h.BI.from(r.changeCapacity)}else if(f.eq(0)&&m.gt(0)&&m.lt(y)){const r=await l.default.injectCapacityWithoutChangeCompatible(t,e,y.sub(m).toString(),n,0,{config:s,LocktimeCellCollector:p,enableDeductCapacity:d});t=r.txSkeleton,f=h.BI.from(r.capacity),m=h.BI.from(r.changeCapacity)}}if(f.gt(0))throw new Error("Not enough capacity in from infos!");if(m.gt(0)&&m.lt(y))throw new Error("Not enough capacity in from infos for change!");return m.gt(0)&&(g.cellOutput.capacity="0x"+m.toString(16),t=t.update("outputs",(t=>t.push(g)))),t}async function payFee(t,e,r,o,{config:i,useLocktimeCellsFirst:n=!0,enableDeductCapacity:a=!0}={}){return injectCapacity(t,e,r,void 0,o,{config:i,useLocktimeCellsFirst:n,enableDeductCapacity:a})}function prepareSigningEntries(t,{config:e}={}){generateLockScriptInfos({config:e=e||(0,c.getConfig)()});for(const r of m.infos)t=r.lockScriptInfo.prepareSigningEntries(t,{config:e});return t}async function _commonTransferCompatible(t,e,r,o,{config:i,enableDeductCapacity:n=!0}={}){i=i||(0,c.getConfig)();let s=h.BI.from(r);const l=t.get("cellProvider");if(!l)throw new Error("Cell Provider is missing!");const getInputKey=t=>{var e,r;return`${null===(e=t.outPoint)||void 0===e?void 0:e.txHash}_${null===(r=t.outPoint)||void 0===r?void 0:r.index}`};let u=(0,d.Set)();for(const e of t.get("inputs"))u=u.add(getInputKey(e));const p=e.map((t=>(0,a.parseFromInfo)(t,{config:i}).fromScript));for(const e of p)n&&s.gt(0)&&([t,s]=_deductCapacityCompatible(t,e,s));generateLockScriptInfos({config:i});let f=h.BI.from(0);if(s.gt(0))t:for(const r of e){const e=m.infos.map((t=>new t.lockScriptInfo.CellCollector(r,l,{config:i})));for(const n of e)for await(const e of n.collect()){const n=getInputKey(e);if(u.has(n))continue;u=u.add(n);const a=await collectInputCompatible(t,e,r,{config:i,needCapacity:s});t=a.txSkeleton;const c=h.BI.from(a.availableCapacity);let l=c;if(l.gt(s)&&(l=s),s=s.sub(l),f=f.add(c.sub(l)),s.eq(0)&&(f.eq(0)||f.gt(o)))break t}}return{txSkeleton:t,capacity:s,changeCapacity:f}}function _deductCapacityCompatible(t,e,r){let o=h.BI.from(r);const n=t.get("fixedEntries").filter((({field:t})=>"outputs"===t)).maxBy((({index:t})=>t));let a=n?n.index+1:0;for(;a<t.get("outputs").size&&o.gt(0);a++){const n=t.get("outputs").get(a);if(n&&new y(n.cellOutput.lock,{validate:!1}).equals(new y(e,{validate:!1}))){const e=JSON.parse(JSON.stringify(n)),s=h.BI.from(e.cellOutput.capacity),c=s;let l;o.gte(c)?l=c:(l=s.sub((0,i.minimalCellCapacityCompatible)(e)),l.gt(r)&&(l=r)),o=o.sub(l),e.cellOutput.capacity="0x"+s.sub(l).toString(16),t=t.update("outputs",(t=>t.update(a,(()=>e))))}}return[t=t.update("outputs",(t=>t.filter((t=>h.BI.from(t.cellOutput.capacity).toString()!==h.BI.from(0).toString())))),o]}async function collectInputCompatible(t,e,r,{config:o,since:n,defaultWitness:a="0x",needCapacity:s}={}){o=o||(0,c.getConfig)();const l=(t=await setupInputCell(t,e,r,{config:o,since:n,defaultWitness:a})).get("outputs").size-1,u=t.get("outputs").get(l);if(!u)throw new Error("Impossible: can not find last output");const p=h.BI.from(u.cellOutput.capacity),d=t.get("fixedEntries").findIndex((t=>"outputs"===t.field&&t.index===l)),g=e.cellOutput.lock;let y=h.BI.from(0);if(o.SCRIPTS.ANYONE_CAN_PAY&&(0,f.isAcpScript)(g,o)){const e=!!(r&&"object"==typeof r&&"destroyable"in r&&r.destroyable),o=s?h.BI.from(s):p;if(e)y=p,t=t.update("outputs",(t=>t.remove(l))),d>=0&&(t=t.update("fixedEntries",(t=>t.remove(d))));else{const e=h.BI.from((0,i.minimalCellCapacityCompatible)(u)),r=p.sub(e),n=JSON.parse(JSON.stringify(u));let a=e;y=r,o.lt(r)&&(a=p.sub(o),y=o),n.cellOutput.capacity="0x"+a.toString(16),t=t.update("outputs",(t=>t.update(l,(()=>n))))}}else{var m;if(d<0)y=h.BI.from(null===(m=t.get("outputs").get(l))||void 0===m?void 0:m.cellOutput.capacity),t=t.update("outputs",(t=>t.remove(l)))}return{txSkeleton:t,availableCapacity:y}}async function setupInputCell(t,e,r,{config:o,since:i,defaultWitness:n}={}){generateLockScriptInfos({config:o=o||(0,c.getConfig)()});const a=e.cellOutput.lock,s=m.infos.find((t=>t.codeHash===a.codeHash&&t.hashType===a.hashType));if(!s)throw new Error("No LockScriptInfo found for setupInputCell!");return s.lockScriptInfo.setupInputCell(t,e,r,{config:o,since:i,defaultWitness:n})}async function payFeeByFeeRate(t,e,r,o,{config:i,useLocktimeCellsFirst:n=!0,enableDeductCapacity:a=!0}={}){let s=0,c=t,l=getTransactionSize(c);for(;l>s;){s=l;const u=calculateFeeCompatible(s,r);c=await payFee(t,e,u,o,{config:i,useLocktimeCellsFirst:n,enableDeductCapacity:a}),l=getTransactionSize(c)}return c}function calculateFeeCompatible(t,e){const r=h.BI.from(1e3),o=h.BI.from(t).mul(e),i=o.div(r);return i.mul(r).lt(o)?i.add(1):h.BI.from(i)}function getTransactionSize(t){return getTransactionSizeByTx((0,i.createTransactionFromSkeleton)(t))}function getTransactionSizeByTx(t){return u.blockchain.Transaction.pack(t).byteLength+4}var b={transfer,payFee,prepareSigningEntries,injectCapacity,setupInputCell,registerCustomLockScriptInfos,payFeeByFeeRate,__tests__:{_commonTransfer:async function _commonTransfer(t,e,r,o,{config:i,enableDeductCapacity:n=!0}={}){const a=await _commonTransferCompatible(t,e,r,o,{config:i,enableDeductCapacity:n});return{txSkeleton:a.txSkeleton,capacity:BigInt(a.capacity.toString()),changeCapacity:BigInt(a.changeCapacity.toString())}},resetLockScriptInfos:function resetLockScriptInfos(){m.configHashCode=0,m._predefinedInfos=[],m._customInfos=[]},getLockScriptInfos:function getLockScriptInfos(){return m},generateLockScriptInfos,getTransactionSizeByTx,getTransactionSize,calculateFee:function calculateFee(t,e){const r=calculateFeeCompatible(t,e);return BigInt(r.toString())},calculateFeeCompatible}};e.default=b},855292:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CellCollector=void 0,e.calculateDaoEarliestSince=calculateDaoEarliestSince,e.calculateDaoEarliestSinceCompatible=calculateDaoEarliestSinceCompatible,e.calculateMaximumWithdraw=calculateMaximumWithdraw,e.calculateMaximumWithdrawCompatible=calculateMaximumWithdrawCompatible,e.default=void 0,e.deposit=deposit,e.extractDaoDataCompatible=extractDaoDataCompatible,e.listDaoCells=listDaoCells,e.unlock=unlock;var o=r(893597),i=r(140993),n=r(852966),a=r(519808),s=_interopRequireDefault(r(574393)),c=_interopRequireDefault(r(342202)),l=r(446037),u=r(555258),p=r(739609),d=r(436115),f=_interopRequireDefault(r(974247));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}const{parseSince:h}=i.since,g="0x0000000000000000",y=p.BI.from(180);class CellCollector{constructor(t,e,r,{config:o}={}){if(!e)throw new Error("Cell Provider is missing!");o=o||(0,a.getConfig)();const i=(0,l.parseFromInfo)(t,{config:o}).fromScript,n=(0,u.generateDaoScript)(o),s="deposit"===r?g:"any";this.cellType=r,this.cellCollector=e.collector({lock:i,type:n,data:s})}async*collect(){for await(const t of this.cellCollector.collect())"withdraw"===this.cellType&&t.data===g||(yield t)}}async function*listDaoCells(t,e,r,{config:o}={}){const i=new CellCollector(e,t,r,{config:o});for await(const t of i.collect())yield t}async function deposit(t,e,r,i,{config:d,enableNonSystemScript:y=!1}={}){const m=(d=d||(0,a.getConfig)()).SCRIPTS.DAO;if(!m)throw new Error("Provided config does not have DAO script setup!");if(function _checkFromInfoSince(t,e){let r;if("string"==typeof t){const i=(0,o.parseAddress)(t,{config:e}).args;58===i.length&&(r=n.number.Uint64LE.unpack("0x"+i.slice(42)).toHexString())}else"R"in t&&(r=t.since);if(null!=r){const{relative:t,type:e}=h(r);if(t||"epochNumber"!==e)throw new Error("Can't deposit a dao cell with multisig locktime which not using absolute-epoch-number format!")}}(e,d),t=_addDaoCellDep(t,d),!r)throw new Error("You must provide a to address!");const b=(0,o.parseAddress)(r,{config:d}),S={codeHash:m.CODE_HASH,hashType:m.HASH_TYPE,args:"0x"},C=(t=t.update("outputs",(t=>t.push({cellOutput:{capacity:"0x"+p.BI.from(i).toString(16),lock:b,type:S},data:g,outPoint:void 0,blockHash:void 0})))).get("outputs").size-1;if(t=t.update("fixedEntries",(t=>t.push({field:"outputs",index:C}))),"string"==typeof e){const r=(0,o.parseAddress)(e,{config:d});(0,u.isSecp256k1Blake160Script)(r,d)?t=await s.default.injectCapacity(t,C,e,{config:d}):(0,u.isSecp256k1Blake160MultisigScript)(r,d)?t=await c.default.injectCapacity(t,C,e,{config:d}):y&&(t=await f.default.injectCapacity(t,[e],i,(0,o.encodeToAddress)((0,l.parseFromInfo)(e).fromScript,{config:d}),void 0,{config:d}))}else e&&((0,l.isMultisigFromInfo)(e)?t=await c.default.injectCapacity(t,C,e,{config:d}):y&&(t=await f.default.injectCapacity(t,[e],i,(0,o.encodeToAddress)((0,l.parseFromInfo)(e).fromScript,{config:d}),void 0,{config:d})));return t}function parseEpochCompatible(t){const e=p.BI.from(t);return{length:e.shr(40).and(4095),index:e.shr(24).and(4095),number:e.and(16777215)}}function epochSinceCompatible({length:t,index:e,number:r}){const o=p.BI.from(t),i=p.BI.from(e),n=p.BI.from(r);return p.BI.from(32).shl(56).add(o.shl(40)).add(i.shl(24)).add(n)}async function unlock(t,e,r,l,f,{config:h,RpcClient:m=d.RPC}={}){if(_checkDaoScript(h=h||(0,a.getConfig)()),t=_addDaoCellDep(t,h),!h.SCRIPTS.DAO)throw new Error("Provided config does not have DAO script setup!");const b=t.get("cellProvider");if(!b)throw new Error("Cell provider is missing!");const S=new m(b.uri),C=e.cellOutput.type,_=h.SCRIPTS.DAO;if(!C||C.codeHash!==_.CODE_HASH||C.hashType!==_.HASH_TYPE||e.data!==g)throw new Error("depositInput is not a DAO deposit cell.");const w=r.cellOutput.type;if(!w||w.codeHash!==_.CODE_HASH||w.hashType!==_.HASH_TYPE||r.data===g)throw new Error("withdrawInput is not a DAO withdraw cell.");const k=await S.getHeader(e.blockHash),v=parseEpochCompatible(k.epoch),x=await S.getHeader(r.blockHash),E=parseEpochCompatible(x.epoch),P=E.index.mul(v.length),O=v.index.mul(E.length);let I=E.number.sub(v.number);P.gt(O)&&(I=I.add(1));const T=I.add(y).sub(1).div(y).mul(y),B=epochSinceCompatible({number:p.BI.from(v.number.add(T)),index:p.BI.from(v.index),length:p.BI.from(v.length)}),A="0x"+calculateMaximumWithdrawCompatible(r,k.dao,x.dao).toString(16),H=(0,o.parseAddress)(l,{config:h});t=t.update("outputs",(t=>t.push({cellOutput:{capacity:A,lock:H,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0})));const D="0x"+B.toString(16);for(;t.get("witnesses").size<t.get("inputs").size-1;)t=t.update("witnesses",(t=>t.push("0x")));const R=(t=t.update("headerDeps",(t=>t.push(e.blockHash,r.blockHash)))).get("headerDeps").size-2,F={inputType:n.bytes.hexify(n.number.Uint64LE.pack(R))},M=n.bytes.hexify(i.blockchain.WitnessArgs.pack(F)),L=r.cellOutput.lock;(0,u.isSecp256k1Blake160Script)(L,h)?t=await s.default.setupInputCell(t,r,void 0,{config:h,since:D,defaultWitness:M}):(0,u.isSecp256k1Blake160MultisigScript)(L,h)&&(t=await c.default.setupInputCell(t,r,f||(0,o.generateAddress)(L,{config:h}),{config:h,since:D,defaultWitness:M}));const N=t.get("outputs").size-1;return t=(t=t.update("outputs",(t=>t.remove(N)))).update("fixedEntries",(e=>e.push({field:"inputs",index:t.get("inputs").size-1},{field:"outputs",index:t.get("outputs").size-1},{field:"witnesses",index:t.get("witnesses").size-1},{field:"headerDeps",index:t.get("headerDeps").size-2})))}function calculateDaoEarliestSince(t,e){const r=calculateDaoEarliestSinceCompatible(t,e);return BigInt(r.toString())}function calculateDaoEarliestSinceCompatible(t,e){const r=parseEpochCompatible(t),o=parseEpochCompatible(e),i=o.index.mul(r.length),n=r.index.mul(o.length);let a=o.number.sub(r.number);i.gt(n)&&(a=a.add(1));const s=a.add(y).sub(1).div(y).mul(y);return epochSinceCompatible({number:p.BI.from(r.number.add(s)),index:p.BI.from(r.index),length:p.BI.from(r.length)})}function _checkDaoScript(t){if(!t.SCRIPTS.DAO)throw new Error("Provided config does not have DAO script setup!")}function _addDaoCellDep(t,e){const r=e.SCRIPTS.DAO;return(0,u.addCellDep)(t,{outPoint:{txHash:r.TX_HASH,index:r.INDEX},depType:r.DEP_TYPE})}function extractDaoDataCompatible(t){if(!/^(0x)?([0-9a-fA-F]){64}$/.test(t))throw new Error("Invalid dao format!");const e=t.startsWith("0x")?t.slice(2):t;return["c","ar","s","u"].map(((t,r)=>({[t]:n.number.Uint64LE.unpack("0x"+e.slice(16*r,16*(r+1)))}))).reduce(((t,e)=>({...t,...e})),{})}function calculateMaximumWithdraw(t,e,r){return calculateMaximumWithdrawCompatible(t,e,r).toBigInt()}function calculateMaximumWithdrawCompatible(t,e,r){const i=p.BI.from(extractDaoDataCompatible(e).ar),n=p.BI.from(extractDaoDataCompatible(r).ar),a=p.BI.from((0,o.minimalCellCapacityCompatible)(t));return p.BI.from(t.cellOutput.capacity).sub(a).mul(n).div(i).add(a)}e.CellCollector=CellCollector;var m={deposit,withdraw:async function withdraw(t,e,r,{config:i,enableNonSystemScript:l=!1}={}){if(_checkDaoScript(i=i||(0,a.getConfig)()),(t=_addDaoCellDep(t,i)).get("inputs").size!==t.get("outputs").size)throw new Error("Input size must equals to output size in txSkeleton!");if(!i.SCRIPTS.DAO)throw new Error("Provided config does not have DAO script setup!");if(!t.get("cellProvider"))throw new Error("Cell provider is missing!");const p=e.cellOutput.type,d=i.SCRIPTS.DAO;if(!p||p.codeHash!==d.CODE_HASH||p.hashType!==d.HASH_TYPE||e.data!==g)throw new Error("fromInput is not a DAO deposit cell.");const h=e.cellOutput.lock;(0,u.isSecp256k1Blake160Script)(h,i)?t=await s.default.setupInputCell(t,e,void 0,{config:i}):(0,u.isSecp256k1Blake160MultisigScript)(h,i)?t=await c.default.setupInputCell(t,e,r||(0,o.generateAddress)(h,{config:i}),{config:i}):l&&(t=await f.default.setupInputCell(t,e,r||(0,o.encodeToAddress)(h,{config:i}),{config:i}));const y=t.get("outputs").size-1,m=t.get("outputs").get(y),b=JSON.parse(JSON.stringify(m));if(!e.blockNumber)throw new Error("fromInput has no blockNumber!");return b.data=n.bytes.hexify(n.number.Uint64.pack(e.blockNumber)),t=(t=(t=t.update("outputs",(t=>t.update(y,(()=>b))))).update("headerDeps",(t=>t.push(e.blockHash)))).update("fixedEntries",(e=>e.push({field:"inputs",index:t.get("inputs").size-1},{field:"outputs",index:t.get("outputs").size-1})))},unlock,calculateMaximumWithdraw,calculateMaximumWithdrawCompatible,calculateDaoEarliestSince,calculateDaoEarliestSinceCompatible,CellCollector,listDaoCells};e.default=m},789877:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compareScriptBinaryWithOnChainData=compareScriptBinaryWithOnChainData,e.default=void 0,e.generateDeployWithDataTx=generateDeployWithDataTx,e.generateDeployWithTypeIdTx=generateDeployWithTypeIdTx,e.generateUpgradeTypeIdDataTx=generateUpgradeTypeIdDataTx;var o=r(140993),i=r(852966),n=r(519808),a=r(893597),s=r(706081),c=r(446037),l=r(739609);const{ScriptValue:u}=o.values;function bytesToHex(t){let e="0x";for(let r=0;r<t.length;r++)e+=t[r].toString(16).padStart(2,"0");return e}function updateOutputs(t,e){const r=(0,a.minimalCellCapacityCompatible)(e);return e.cellOutput.capacity=`0x${r.toString(16)}`,t=t.update("outputs",(t=>t.push(e)))}function updateCellDeps(t,e){t=t.update("cellDeps",(t=>t.clear()));const r=(e=e||(0,n.getConfig)()).SCRIPTS.SECP256K1_BLAKE160,o=e.SCRIPTS.SECP256K1_BLAKE160_MULTISIG;if(!r||!o)throw new Error("Provided config does not have SECP256K1_BLAKE160 or SECP256K1_BLAKE160_MULTISIG script setup!");return t=t.update("cellDeps",(t=>t.push({outPoint:{txHash:r.TX_HASH,index:r.INDEX},depType:r.DEP_TYPE},{outPoint:{txHash:o.TX_HASH,index:o.INDEX},depType:o.DEP_TYPE})))}async function completeTx(t,e,r,p){const d=t.get("inputs").map((t=>l.BI.from(t.cellOutput.capacity))).reduce(((t,e)=>t.add(e)),l.BI.from(0)),f=t.get("outputs").map((t=>l.BI.from(t.cellOutput.capacity))).reduce(((t,e)=>t.add(e)),l.BI.from(0)).sub(d);return t=await async function injectCapacity(t,e,r,{config:p,feeRate:d}){p=p||(0,n.getConfig)();const f=d||1e3;let h=l.BI.from(r);const{fromScript:g,multisigScript:y}=(0,c.parseFromInfo)(e,{config:p});h=h.add(l.BI.from(10).pow(8));let m=l.BI.from(10).pow(8);const b={cellOutput:{capacity:"0x0",lock:g,type:void 0},data:"0x"},S=l.BI.from((0,a.minimalCellCapacityCompatible)(b)).add(l.BI.from(10).pow(8));h.lt(0)&&(m=m.sub(h),h=l.BI.from(0));if(h.gt(0)||m.lt(S)){const e=t.get("cellProvider");if(!e)throw new Error("Cell provider is missing!");const r=e.collector({lock:g,type:"empty",data:"0x"});let o=(0,s.Set)();for(const e of t.get("inputs"))o=o.add(`${e.outPoint.txHash}_${e.outPoint.index}`);for await(const e of r.collect()){if(o.has(`${e.outPoint.txHash}_${e.outPoint.index}`))continue;t=(t=t.update("inputs",(t=>t.push(e)))).update("witnesses",(t=>t.push("0x")));const r=l.BI.from(e.cellOutput.capacity);let i=r;if(i.gt(h)&&(i=h),h=h.sub(i),m=m.add(r).sub(i),h.eq(0)&&(m.eq(0)||m.gte(S)))break}}m.gt(0)&&(b.cellOutput.capacity="0x"+m.toString(16),t=t.update("outputs",(t=>t.push(b))));if(h.gt(0)||m.lt(S))throw new Error("Not enough capacity in from address!");const C=t.get("inputs").findIndex((t=>new u(t.cellOutput.lock,{validate:!1}).equals(new u(g,{validate:!1}))));if(-1!==C){for(;C>=t.get("witnesses").size;)t=t.update("witnesses",(t=>t.push("0x")));let r,n=t.get("witnesses").get(C);const a="0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";if(r="string"!=typeof e?{lock:"0x"+y.slice(2)+a.slice(2).repeat(e.M)}:{lock:a},"0x"!==n){const t=o.blockchain.WitnessArgs.unpack(i.bytes.bytify(n)),e=t.lock;if(e&&r.lock&&!i.bytes.equal(e,r.lock))throw new Error("Lock field in first witness is set aside for signature!");const a=t.inputType;a&&(r.inputType=a);const s=t.outputType;s&&(r.outputType=s)}n=i.bytes.hexify(o.blockchain.WitnessArgs.pack(r)),t=t.update("witnesses",(t=>t.set(C,n)))}const _=calculateTxFee(t,f);m=m.sub(_),t=t.update("outputs",(t=>t.pop())),m.gt(0)&&(b.cellOutput.capacity="0x"+m.toString(16),t=t.update("outputs",(t=>t.push(b))));return t}(t,e,l.BI.from(f),{config:r,feeRate:p}),t}function getTransactionSize(t){return function getTransactionSizeByTx(t){const e=o.blockchain.Transaction.pack(t);return e.byteLength+4}((0,a.createTransactionFromSkeleton)(t))}function calculateTxFee(t,e){const r=getTransactionSize(t);return l.BI.from(function calculateFee(t,e){const r=l.BI.from(1e3),o=l.BI.from(t).mul(e),i=o.div(r);return i.mul(r).lt(o)?i.add(1):l.BI.from(i)}(r,e))}function calculateTxHash(t){const e=(0,a.createTransactionFromSkeleton)(t);return o.utils.ckbHash(o.blockchain.RawTransaction.pack(e))}function getScriptConfig(t,e){const r=t.outputs.get(e);if(null==r)throw new Error("Invalid txSkeleton or outputIndex");return void 0!==r.cellOutput.type?function getScriptConfigByTypeHash(t,e){const r=t.outputs.get(e).cellOutput.type;return{CODE_HASH:o.utils.computeScriptHash(r),HASH_TYPE:"type",TX_HASH:calculateTxHash(t),INDEX:"0x0",DEP_TYPE:"code"}}(t,e):function getScriptConfigByDataHash(t,e){const r=t.outputs.get(e).data;return{CODE_HASH:o.utils.ckbHash(i.bytes.bytify(r)),HASH_TYPE:"data2",TX_HASH:calculateTxHash(t),INDEX:"0x0",DEP_TYPE:"code"}}(t,e)}function verifyFromInfo(t,{config:e}={}){if(e=e||(0,n.getConfig)(),"string"==typeof t){if("SECP256K1_BLAKE160"!==n.helpers.nameOfScript((0,a.parseAddress)(t,{config:e}),e.SCRIPTS))throw new Error("only SECP256K1_BLAKE160 or SECP256K1_MULTISIG is supported")}else if(!function isMultisigFromInfo(t){return"object"==typeof t&&"M"in t&&"R"in t&&Array.isArray(t.publicKeyHashes)}(t))throw new Error("only SECP256K1_BLAKE160 or SECP256K1_MULTISIG is supported")}async function generateDeployWithDataTx(t){verifyFromInfo(t.fromInfo,{config:t.config});let e=(0,a.TransactionSkeleton)({cellProvider:t.cellProvider});const{fromScript:r}=(0,c.parseFromInfo)(t.fromInfo,{config:t.config});e=updateOutputs(e,{cellOutput:{capacity:"0x0",lock:r},data:bytesToHex(t.scriptBinary)}),e=updateCellDeps(e,t.config),e=await completeTx(e,t.fromInfo,t.config,t.feeRate);return{txSkeleton:e,scriptConfig:getScriptConfig(e,0)}}async function generateDeployWithTypeIdTx(t){verifyFromInfo(t.fromInfo,{config:t.config});let e=(0,a.TransactionSkeleton)({cellProvider:t.cellProvider});const{fromScript:r}=(0,c.parseFromInfo)(t.fromInfo,{config:t.config}),[i]=await async function findCellsByLock(t,e){const r=e.collector({lock:t,type:"empty",data:"0x"}),o=[];for await(const t of r.collect())o.push(t);return o}(r,t.cellProvider);if(!i)throw new Error("fromAddress has no live ckb");const n=o.utils.generateTypeIdScript({previousOutput:i.outPoint,since:"0x0"},"0x0");e=updateOutputs(e,{cellOutput:{capacity:"0x0",lock:r,type:n},data:bytesToHex(t.scriptBinary)}),e=updateCellDeps(e,t.config),e=await completeTx(e,t.fromInfo,t.config,t.feeRate);return{txSkeleton:e,scriptConfig:getScriptConfig(e,0),typeId:n}}async function generateUpgradeTypeIdDataTx(t){verifyFromInfo(t.fromInfo,{config:t.config});let e=(0,a.TransactionSkeleton)({cellProvider:t.cellProvider});const{fromScript:r}=(0,c.parseFromInfo)(t.fromInfo,{config:t.config}),o=t.cellProvider.collector({type:t.typeId}),i=[];for await(const t of o.collect())i.push(t);if(1!==i.length)throw new Error("the typeid maybe wrong");const n=i[0];e=e.update("inputs",(t=>t.push(n)));e=updateOutputs(e,{cellOutput:{capacity:"0x0",lock:r,type:t.typeId},data:bytesToHex(t.scriptBinary)}),e=updateCellDeps(e,t.config),e=await completeTx(e,t.fromInfo,t.config,t.feeRate);return{txSkeleton:e,scriptConfig:getScriptConfig(e,0)}}async function compareScriptBinaryWithOnChainData(t,e,r){const n=function calculateCodeHashByBin(t){const e=t.valueOf();return(new o.utils.CKBHasher).update(e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)).digestHex()}(t),a=await async function getDataHash(t,e){const r=t.txHash,n=parseInt(t.index,10),a=await e.getTransaction(r);if(!a)throw new Error(`TxHash(${r}) is not found`);const s=a.transaction.outputsData[n];if(!s)throw new Error("cannot find output data");return(new o.utils.CKBHasher).update(i.bytes.bytify(s)).digestHex()}(e,r);return n===a}var p={generateDeployWithDataTx,generateDeployWithTypeIdTx,generateUpgradeTypeIdDataTx,compareScriptBinaryWithOnChainData,__tests__:{calculateTxFee}};e.default=p},446037:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isMultisigFromInfo=function isMultisigFromInfo(t){if(!t||"object"!=typeof t)return!1;const e=t;return"number"==typeof(null==e?void 0:e.R)&&"number"==typeof(null==e?void 0:e.M)&&Array.isArray(null==e?void 0:e.publicKeyHashes)},e.multisigArgs=multisigArgs,e.parseFromInfo=function parseFromInfo(t,{config:e}={}){let r,o,a,s;if(e=e||(0,n.getConfig)(),"string"==typeof t)r=(0,i.parseAddress)(t,{config:e});else if("R"in t){const i=e.SCRIPTS.SECP256K1_BLAKE160_MULTISIG;if(!i)throw new Error("Provided config does not have SECP256K1_BLAKE16_MULTISIG script setup!");o=serializeMultisigScript(t);const n=multisigArgs(o,t.since);r={codeHash:i.CODE_HASH,hashType:i.HASH_TYPE,args:n}}else if("address"in t){const o=e.SCRIPTS.ANYONE_CAN_PAY;if(!o)throw new Error("Provided config does not have ANYONE_CAN_PAY script setup!");const n=t.address;if(r=(0,i.parseAddress)(n,{config:e}),a=t.destroyable,r.codeHash!==o.CODE_HASH||r.hashType!==o.HASH_TYPE)throw new Error("fromInfo.address is not ANYONE_CAN_PAY address!")}else{if(!("script"in t))throw new Error("Invalid fromInfo format!");r=t.script,s=t.customData}return{fromScript:r,multisigScript:o,destroyable:a,customData:s}},e.serializeMultisigScript=serializeMultisigScript;var o=r(140993),i=r(893597),n=r(519808),a=r(852966);const{CKBHasher:s}=o.utils;function serializeMultisigScript({R:t,M:e,publicKeyHashes:r}){if(t<0||t>255)throw new Error("`R` should be less than 256!");if(e<0||e>255)throw new Error("`M` should be less than 256!");return"0x00"+("00"+t.toString(16)).slice(-2)+("00"+e.toString(16)).slice(-2)+("00"+r.length.toString(16)).slice(-2)+r.map((t=>t.slice(2))).join("")}function multisigArgs(t,e){let r="0x";return null!=e&&(r=a.bytes.hexify(a.number.Uint64LE.pack(e))),(new s).update(t).digestHex().slice(0,42)+r.slice(2)}},555258:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SECP_SIGNATURE_PLACEHOLDER=e.OMNILOCK_SIGNATURE_PLACEHOLDER=void 0,e.addCellDep=addCellDep,e.default=void 0,e.ensureScript=ensureScript,e.generateDaoScript=generateDaoScript,e.hashWitness=hashWitness,e.isAcpAddress=isAcpAddress,e.isAcpScript=isAcpScript,e.isDaoScript=isDaoScript,e.isOmnilockAddress=function isOmnilockAddress(t,e){return isOmnilockScript((0,n.parseAddress)(t,{config:e}),e)},e.isOmnilockScript=isOmnilockScript,e.isSecp256k1Blake160Address=isSecp256k1Blake160Address,e.isSecp256k1Blake160MultisigAddress=isSecp256k1Blake160MultisigAddress,e.isSecp256k1Blake160MultisigScript=isSecp256k1Blake160MultisigScript,e.isSecp256k1Blake160Script=isSecp256k1Blake160Script,e.isSudtScript=isSudtScript,e.prepareSigningEntries=prepareSigningEntries;var o=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(478988)),i=r(706081),n=r(893597),a=r(852966),s=r(140993),c=r(739609);function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}const{CKBHasher:l,ckbHash:u}=s.utils;function addCellDep(t,e){return t.get("cellDeps").find((t=>t.depType===e.depType&&new s.values.OutPointValue(t.outPoint,{validate:!1}).equals(new s.values.OutPointValue(e.outPoint,{validate:!1}))))||(t=t.update("cellDeps",(t=>t.push({outPoint:e.outPoint,depType:e.depType})))),t}function generateDaoScript(t){const e=t.SCRIPTS.DAO;return{codeHash:e.CODE_HASH,hashType:e.HASH_TYPE,args:"0x"}}function isSecp256k1Blake160Script(t,e){const r=e.SCRIPTS.SECP256K1_BLAKE160;return t.codeHash===r.CODE_HASH&&t.hashType===r.HASH_TYPE}function isSecp256k1Blake160Address(t,e){return isSecp256k1Blake160Script((0,n.parseAddress)(t,{config:e}),e)}function isOmnilockScript(t,e){const r=e.SCRIPTS.OMNILOCK;return t.codeHash===r.CODE_HASH&&t.hashType===r.HASH_TYPE}function isSecp256k1Blake160MultisigScript(t,e){const r=e.SCRIPTS.SECP256K1_BLAKE160_MULTISIG;return t.codeHash===r.CODE_HASH&&t.hashType===r.HASH_TYPE}function isSecp256k1Blake160MultisigAddress(t,e){return isSecp256k1Blake160MultisigScript((0,n.parseAddress)(t,{config:e}),e)}function isDaoScript(t,e){const r=e.SCRIPTS.DAO;return!!t&&t.codeHash===r.CODE_HASH&&t.hashType===r.HASH_TYPE}function isSudtScript(t,e){const r=e.SCRIPTS.SUDT;if(!r)throw new Error("SUDT script not defined in config!");return!!t&&t.codeHash===r.CODE_HASH&&t.hashType===r.HASH_TYPE}function isAcpScript(t,e){const r=e.SCRIPTS.ANYONE_CAN_PAY;if(!r)throw new Error("ANYONE_CAN_PAY script not defined in config!");return!!t&&t.codeHash===r.CODE_HASH&&t.hashType===r.HASH_TYPE}function isAcpAddress(t,e){return isAcpScript((0,n.parseAddress)(t,{config:e}),e)}function hashWitness(t,e){const r=new ArrayBuffer(8),o=new DataView(r),i=c.BI.from(a.bytes.bytify(e).length).toString(16);i.length<=8&&(o.setUint32(0,Number("0x"+i),!0),o.setUint32(4,Number("0x00000000"),!0)),i.length>8&&i.length<=16&&(o.setUint32(0,Number("0x"+i.slice(-8)),!0),o.setUint32(4,Number("0x"+i.slice(0,-8)),!0)),t.update(r),t.update(e)}function prepareSigningEntries(t,e,r){const o=e.SCRIPTS[r];if(!o)throw new Error(`Provided config does not have ${r} script setup!`);let a=(0,i.Set)();const c=(0,n.createTransactionFromSkeleton)(t),p=u(s.blockchain.RawTransaction.pack(c)),d=t.get("inputs"),f=t.get("witnesses");let h=t.get("signingEntries");for(let t=0;t<d.size;t++){const e=d.get(t);if(o.CODE_HASH===e.cellOutput.lock.codeHash&&o.HASH_TYPE===e.cellOutput.lock.hashType&&!a.has(e.cellOutput.lock.args)){a=a.add(e.cellOutput.lock.args);const r=new s.values.ScriptValue(e.cellOutput.lock,{validate:!1}),o=new l;if(o.update(p),t>=f.size)throw new Error(`The first witness in the script group starting at input index ${t} does not exist, maybe some other part has invalidly tampered the transaction?`);hashWitness(o,f.get(t));for(let e=t+1;e<d.size&&e<f.size;e++){const t=d.get(e);r.equals(new s.values.ScriptValue(t.cellOutput.lock,{validate:!1}))&&hashWitness(o,f.get(e))}for(let t=d.size;t<f.size;t++)hashWitness(o,f.get(t));const i={type:"witness_args_lock",index:t,message:o.digestHex()};h=h.push(i)}}return t=t.set("signingEntries",h)}function ensureScript(t,e,r){const o=e.SCRIPTS[r];if(!o)throw new Error(`Provided config does not have ${r} script setup!`);if(o.CODE_HASH!==t.codeHash||o.HASH_TYPE!==t.hashType)throw new Error(`Provided script is not ${r} script!`)}const p="0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";e.SECP_SIGNATURE_PLACEHOLDER=p;const d=`0x${"00".repeat(o.OmnilockWitnessLock.pack({signature:p}).byteLength)}`;e.OMNILOCK_SIGNATURE_PLACEHOLDER=d;var f={addCellDep,generateDaoScript,isSecp256k1Blake160Script,isSecp256k1Blake160MultisigScript,isDaoScript,isSudtScript,prepareSigningEntries,isSecp256k1Blake160Address,isSecp256k1Blake160MultisigAddress,ensureScript,isAcpScript,isAcpAddress};e.default=f},297516:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"anyoneCanPay",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"common",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"createP2PKHMessageGroup",{enumerable:!0,get:function(){return p.createP2PKHMessageGroup}}),Object.defineProperty(e,"dao",{enumerable:!0,get:function(){return a.default}}),e.default=void 0,Object.defineProperty(e,"deploy",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"locktimePool",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"omnilock",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(e,"parseFromInfo",{enumerable:!0,get:function(){return n.parseFromInfo}}),Object.defineProperty(e,"secp256k1Blake160",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"secp256k1Blake160Multisig",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"sudt",{enumerable:!0,get:function(){return l.default}});var o=_interopRequireDefault(r(574393)),i=_interopRequireDefault(r(342202)),n=r(446037),a=_interopRequireDefault(r(855292)),s=_interopRequireDefault(r(474233)),c=_interopRequireDefault(r(974247)),l=_interopRequireDefault(r(77922)),u=_interopRequireDefault(r(911584)),p=r(878765),d=_interopRequireDefault(r(789877)),f=_interopRequireDefault(r(478988));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var h={secp256k1Blake160:o.default,secp256k1Blake160Multisig:i.default,dao:a.default,locktimePool:s.default,common:c.default,sudt:l.default,anyoneCanPay:u.default};e.default=h},474233:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.CellCollector=void 0,e.injectCapacity=injectCapacity,e.payFee=payFee,e.prepareSigningEntries=prepareSigningEntries,e.setupInputCell=setupInputCell,e.transfer=transfer,e.transferCompatible=transferCompatible;var o=r(893597),i=r(852966),n=r(446037),a=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(r(574393)),s=r(855292),c=r(140993),l=r(555258),u=r(706081),p=r(519808),d=r(297516),f=r(591363),h=r(739609),g=r(436115);const{ScriptValue:y}=c.values,{parseEpoch:m,maximumAbsoluteEpochSince:b,generateAbsoluteEpochSince:S,validateSince:C}=c.since,_=class CellCollector{constructor(t,e,{config:r,queryOptions:o={},tipHeader:i,NodeRPC:a=g.RPC}={}){if(!e)throw new Error("Cell provider is missing!");r=r||(0,p.getConfig)();const s=(0,n.parseFromInfo)(t,{config:r}),c=s.fromScript;this.multisigScript=s.multisigScript,this.fromScript=c,this.config=r,this.tipHeader=i,i&&(this.tipSinceValidationInfo={blockNumber:i.number,epoch:i.epoch,median_timestamp:""}),this.rpc=new a(e.uri),o={...o,lock:this.fromScript};let d=(0,u.List)([]);if((0,l.isSecp256k1Blake160MultisigScript)(c,r)){const t={codeHash:c.codeHash,hashType:c.hashType,args:c.args.slice(0,42)};d=d.push(e.collector({lock:t,argsLen:o.argsLen||28,type:o.type||"empty",data:o.data||"0x"})),o.type||o.data&&"any"!==o.data||(d=d.push(e.collector({lock:t,type:(0,l.generateDaoScript)(r),data:"any"})),d=d.push(e.collector({lock:t,argsLen:28,type:(0,l.generateDaoScript)(r),data:"any"})))}else(0,l.isSecp256k1Blake160Script)(c,r)&&(o.type||o.data&&"any"!==o.data||(d=d.push(e.collector({lock:c,type:(0,l.generateDaoScript)(r),data:"any"}))));this.cellCollectors=d}async*collect(){for(const t of this.cellCollectors)for await(const e of t.collect()){const t=e.cellOutput.lock;let r,o,i,n,a;if(58===t.args.length){const o=await this.rpc.getHeader(e.blockHash);r="0x"+_parseMultisigArgsSinceCompatible(t.args).toString(16),a={epoch:o.epoch,blockNumber:o.number,median_timestamp:""}}if((0,l.isDaoScript)(e.cellOutput.type,this.config)){if("0x0000000000000000"===e.data)continue;const t=await this.rpc.getTransaction(e.outPoint.txHash);n=t.txStatus.blockHash;const a=t.transaction.inputs[+e.outPoint.index].previousOutput;i=(await this.rpc.getTransaction(a.txHash)).txStatus.blockHash;const c=await this.rpc.getHeader(i),l=await this.rpc.getHeader(n);let u="0x"+(0,s.calculateDaoEarliestSinceCompatible)(c.epoch,l.epoch).toString(16);o=(0,s.calculateMaximumWithdrawCompatible)(e,c.dao,l.dao);const p=m(l.epoch),d={number:p.number+4,length:p.length,index:p.index};if(u=b(u,S(d)),r){const t=(0,f.parseSinceCompatible)(r);if(!1!==t.relative||"epochNumber"!==t.type)continue;try{r=b(u,r)}catch{r=u}}else r=u}if("blockTimestamp"===(0,f.parseSinceCompatible)(r).type||this.tipHeader&&!C(r,this.tipSinceValidationInfo,a))continue;const c={...e,since:r,depositBlockHash:i,withdrawBlockHash:n,sinceValidationInfo:a};c.cellOutput.capacity="0x"+(o||h.BI.from(e.cellOutput.capacity)).toString(16),yield c}}};async function transfer(t,e,r,o,i,{config:n,requireToAddress:a=!0,assertAmountEnough:s=!0,LocktimeCellCollector:c=_}={}){const l=await transferCompatible(t,e,r,o,i,{config:n,requireToAddress:a,assertAmountEnough:s,LocktimeCellCollector:c});let u,p;return l instanceof Array?(u=l[0],p=BigInt(l[1].toString()),[u,p]):(u=l,u)}async function transferCompatible(t,e,r,o,i,{config:n,requireToAddress:a=!0,assertAmountEnough:s=!0,LocktimeCellCollector:c=_}={}){let l=h.BI.from(o);for(const[o,u]of e.entries()){const e=await _transferCompatible(t,u,0===o?r:void 0,l,i,{config:n,requireToAddress:0===o&&a,assertAmountEnough:!1,LocktimeCellCollector:c});if(t=e[0],l=e[1],l.eq(0))return s?t:[t,h.BI.from(l)]}if(s)throw new Error("Not enough capacity in from addresses!");return[t,h.BI.from(l)]}async function _transferCompatible(t,e,r,a,s,{config:d,requireToAddress:f=!0,assertAmountEnough:g=!0,LocktimeCellCollector:m=_,changeAddress:b}){d=d||(0,p.getConfig)();const{fromScript:S}=(0,n.parseFromInfo)(e,{config:d});if(!(0,l.isSecp256k1Blake160MultisigScript)(S,d)&&!(0,l.isSecp256k1Blake160Script)(S,d))throw new Error("fromInfo not supported!");if(f&&!r)throw new Error("You must provide a to address!");let C=h.BI.from(a||0);if(r){const e=(0,o.parseAddress)(r,{config:d});t=t.update("outputs",(t=>t.push({cellOutput:{capacity:"0x"+C.toString(16),lock:e,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0})))}const w=t.get("fixedEntries").filter((({field:t})=>"outputs"===t)).maxBy((({index:t})=>t));let k=w?w.index+1:0;for(;k<t.get("outputs").size&&C.gt(0);++k){const e=t.get("outputs").get(k);if(new y(e.cellOutput.lock,{validate:!1}).equals(new y(S,{validate:!1}))){const r=h.BI.from(e.cellOutput.capacity);let i;C.gte(r)?i=r:(i=r.sub((0,o.minimalCellCapacityCompatible)(e)),i.gt(C)&&(i=C)),C=C.sub(i);const n=JSON.parse(JSON.stringify(e));n.cellOutput.capacity="0x"+r.sub(i).toString(16),t=t.update("outputs",(t=>t.update(k,(()=>n))))}}if(t=t.update("outputs",(t=>t.filter((t=>!h.BI.from(t.cellOutput.capacity).eq(0))))),C.gt(0)){const r=t.get("cellProvider");if(!r)throw new Error("cell provider is missing!");const n={cellOutput:{capacity:"0x0",lock:b?(0,o.parseAddress)(b,{config:d}):S,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0};let a=h.BI.from(0),p=(0,u.Set)();for(const e of t.get("inputs"))p=p.add(`${e.outPoint.txHash}_${e.outPoint.index}`);const f=new m(e,r,{config:d,tipHeader:s});for await(const r of f.collect()){const s=r;if(p.has(`${s.outPoint.txHash}_${s.outPoint.index}`))continue;let u;if((0,l.isSecp256k1Blake160MultisigScript)(S,d)){const t=s.cellOutput.lock.args;u=58===t.length?h.BI.from(_parseMultisigArgsSinceCompatible(t)):void 0}let f="0x";if((0,l.isDaoScript)(s.cellOutput.type,d)){const e=d.SCRIPTS.DAO,r=(t=(t=(0,l.addCellDep)(t,{depType:e.DEP_TYPE,outPoint:{txHash:e.TX_HASH,index:e.INDEX}})).update("headerDeps",(t=>t.push(s.depositBlockHash,s.withdrawBlockHash)))).get("headerDeps").size-2,o={inputType:i.bytes.hexify(i.number.Uint64.pack(r))};f=i.bytes.hexify(c.blockchain.WitnessArgs.pack(o))}t=await collectInput(t,s,(0,l.isSecp256k1Blake160MultisigScript)(S,d)?Object.assign({},e,{since:u}):e,{config:d,defaultWitness:f,since:s.since});const g=h.BI.from(s.cellOutput.capacity);let y=g;if(y.gt(C)&&(y=C),C=C.sub(y),a=a.add(g).sub(y),(0,l.isDaoScript)(s.cellOutput.type,d)&&(t=t.update("fixedEntries",(e=>e.push({field:"inputs",index:t.get("inputs").size-1},{field:"witnesses",index:t.get("witnesses").size-1},{field:"headerDeps",index:t.get("headerDeps").size-2})))),C.eq(0)&&(a.eq(0)||a.gt((0,o.minimalCellCapacityCompatible)(n))))break}a.gt(0)&&(n.cellOutput.capacity="0x"+a.toString(16),t=t.update("outputs",(t=>t.push(n))))}if(!g)return[t,C];if(C.gt(0))throw new Error("Not enough capacity in from address!");return t}async function injectCapacityWithoutChangeCompatible(t,e,r,a,s,{config:d,LocktimeCellCollector:f=_,enableDeductCapacity:g=!0}){d=d||(0,p.getConfig)();let m=h.BI.from(r);const b=h.BI.from(s);if(g)for(const r of e){const e=(0,n.parseFromInfo)(r,{config:d}).fromScript;if(!(0,l.isSecp256k1Blake160MultisigScript)(e,d)&&!(0,l.isSecp256k1Blake160Script)(e,d))continue;const i=t.get("fixedEntries").filter((({field:t})=>"outputs"===t)).maxBy((({index:t})=>t));let a=i?i.index+1:0;for(;a<t.get("outputs").size&&m.gt(0);++a){const r=t.get("outputs").get(a);if(new y(r.cellOutput.lock,{validate:!1}).equals(new y(e,{validate:!1}))){const e=JSON.parse(JSON.stringify(r)),i=h.BI.from(e.cellOutput.capacity);let n;m.gte(i)?n=i:(n=i.sub((0,o.minimalCellCapacityCompatible)(e)),n.gt(m)&&(n=m)),m=m.sub(n),e.cellOutput.capacity="0x"+i.sub(n).toString(16),t=t.update("outputs",(t=>t.update(a,(()=>e))))}}t=t.update("outputs",(t=>t.filter((t=>!h.BI.from(t.cellOutput.capacity).eq(0)))))}let S=h.BI.from(0);if(m.gt(0)){const r=t.get("cellProvider");if(!r)throw new Error("cell provider is missing!");const getInputKey=t=>`${t.outPoint.txHash}_${t.outPoint.index}`;let o=(0,u.Set)();for(const e of t.get("inputs"))o=o.add(getInputKey(e));for(const s of e){const e=(0,n.parseFromInfo)(s,{config:d}).fromScript,u=new f(s,r,{config:d,tipHeader:a});for await(const r of u.collect()){const n=r;if(o.has(getInputKey(n)))continue;let a,u="0x";if((0,l.isDaoScript)(n.cellOutput.type,d)){const e=d.SCRIPTS.DAO,r=(t=(t=(0,l.addCellDep)(t,{depType:e.DEP_TYPE,outPoint:{txHash:e.TX_HASH,index:e.INDEX}})).update("headerDeps",(t=>t.push(n.depositBlockHash,n.withdrawBlockHash)))).get("headerDeps").size-2,o={inputType:i.bytes.hexify(i.number.Uint64.pack(r))};u=i.bytes.hexify(c.blockchain.WitnessArgs.pack(o))}if((0,l.isSecp256k1Blake160MultisigScript)(e,d)){const t=n.cellOutput.lock.args;a=58===t.length?h.BI.from(_parseMultisigArgsSinceCompatible(t)):void 0}t=await collectInput(t,n,Object.assign({},s,{since:a}),{config:d,defaultWitness:u,since:n.since});const p=h.BI.from(n.cellOutput.capacity);let f=p;if(f.gt(m)&&(f=m),m=m.sub(f),S=S.add(p).sub(f),(0,l.isDaoScript)(n.cellOutput.type,d)&&(t=t.update("fixedEntries",(e=>e.push({field:"inputs",index:t.get("inputs").size-1},{field:"witnesses",index:t.get("witnesses").size-1},{field:"headerDeps",index:t.get("headerDeps").size-2})))),m.eq(0)&&(S.eq(0)||S.gt(b)))break}}}return{txSkeleton:t,capacity:h.BI.from(m.toString()),changeCapacity:h.BI.from(S.toString())}}async function payFee(t,e,r,o,{config:i,LocktimeCellCollector:n=_}={}){return transferCompatible(t,e,void 0,r,o,{config:i,requireToAddress:!1,LocktimeCellCollector:n})}function prepareSigningEntries(t,{config:e}={}){return e=e||(0,p.getConfig)(),t=(0,l.prepareSigningEntries)(t,e,"SECP256K1_BLAKE160"),t=(0,l.prepareSigningEntries)(t,e,"SECP256K1_BLAKE160_MULTISIG")}async function injectCapacity(t,e,r,o,{config:i,LocktimeCellCollector:n=_}={}){if(i=i||(0,p.getConfig)(),e>=t.get("outputs").size)throw new Error("Invalid output index!");const a=h.BI.from(t.get("outputs").get(e).cellOutput.capacity);return transferCompatible(t,r,void 0,h.BI.from(a),o,{config:i,requireToAddress:!1,LocktimeCellCollector:n})}async function collectInput(t,e,r,{config:o,since:i,defaultWitness:n="0x"}={}){return o=o||(0,p.getConfig)(),t=(t=await setupInputCell(t,e,r,{config:o,since:i,defaultWitness:n})).update("outputs",(t=>t.remove(t.size-1)))}async function setupInputCell(t,e,r,{config:o,since:i,defaultWitness:n="0x"}={}){o=o||(0,p.getConfig)();const s=e.cellOutput.lock;if((0,l.isSecp256k1Blake160Script)(s,o))return a.default.setupInputCell(t,e,r,{config:o,defaultWitness:n,since:i});if((0,l.isSecp256k1Blake160MultisigScript)(s,o))return d.secp256k1Blake160Multisig.setupInputCell(t,e,r,{config:o,defaultWitness:n,since:i});throw new Error("Not supported input lock!")}function _parseMultisigArgsSinceCompatible(t){if(58!==t.length)throw new Error("Invalid multisig with since args!");return i.number.Uint64LE.unpack("0x"+t.slice(42))}e.CellCollector=_;var w={CellCollector:_,transfer,transferCompatible,payFee,prepareSigningEntries,injectCapacity,setupInputCell,injectCapacityWithoutChange:async function injectCapacityWithoutChange(t,e,r,o,i,{config:n,LocktimeCellCollector:a=_,enableDeductCapacity:s=!0}){const c=await injectCapacityWithoutChangeCompatible(t,e,r,o,i,{config:n,LocktimeCellCollector:a,enableDeductCapacity:s});return{txSkeleton:c.txSkeleton,capacity:c.capacity.toBigInt(),changeCapacity:c.changeCapacity.toBigInt()}},injectCapacityWithoutChangeCompatible};e.default=w},318215:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decodeAddress=function decodeAddress(t){try{if(t.startsWith("bc1q"))return i.bech32.fromWords(i.bech32.decode(t).words.slice(1));if(t.startsWith("1"))return n.default.decode(t).slice(1,21);if(t.startsWith("3"))return n.default.decode(t).slice(1,21)}catch{if(t.startsWith("bc1p"))throw new Error("Taproot address is not supported yet.")}throw new Error(`Unsupported bitcoin address ${t}, only 1...(P2PKH) 3...(P2SH), and bc1...(Bech32) are supported.`)},e.signMessage=async function signMessage(t,e,r){const i=(()=>{if(r)return r;if("undefined"!=typeof window){if("unisat"in window)return window.unisat;if("okxwallet"in window&&"bitcoin"in window.okxwallet)return window.okxwallet.bitcoin}throw new Error("No provider found, make sure you have installed UniSat Wallet")})(),n=await i.requestAccounts(),s=o.bytes.hexify(t).slice(2),c=await i.signMessage(`${a}${s}`,e),l=o.bytes.bytify(function base64ToHex(t){const e=atob(t);let r="";for(let t=0;t<e.length;t++){const o=e.charCodeAt(t).toString(16);r+=2===o.length?o:"0"+o}return"0x"+r}(c)),u=n[0];if(u.startsWith("bc1q"))l[0]=39+(l[0]-27)%4;else if(u.startsWith("3"))l[0]=35+(l[0]-27)%4;else{if(!u.startsWith("1"))throw new Error(`Unsupported bitcoin address ${u}, only 1...(P2PKH) 3...(P2SH), and bc1...(Bech32) are supported.`);l[0]=31+(l[0]-27)%4}return o.bytes.hexify(l)};var o=r(852966),i=r(146586),n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(r(185218));const a="CKB (Bitcoin Layer) transaction: 0x"},478988:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.bitcoin=e.OmnilockWitnessLock=e.CellCollector=void 0,e.createOmnilockScript=createOmnilockScript,e.default=void 0,e.prepareSigningEntries=prepareSigningEntries,e.setupInputCell=setupInputCell;var o=r(852966),i=r(140993),n=r(519808),a=r(555258),s=r(446037),c=r(640035),l=r(518042),u=r(542069),p=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(318215));function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}e.bitcoin=p;const{ScriptValue:d}=i.values;var f=function(t){return t[t.IdentityFlagsCkb=0]="IdentityFlagsCkb",t[t.IdentityFlagsEthereum=1]="IdentityFlagsEthereum",t[t.IdentityFlagsEos=2]="IdentityFlagsEos",t[t.IdentityFlagsTron=3]="IdentityFlagsTron",t[t.IdentityFlagsBitcoin=4]="IdentityFlagsBitcoin",t[t.IdentityFlagsDogecoin=5]="IdentityFlagsDogecoin",t[t.IdentityCkbMultisig=6]="IdentityCkbMultisig",t[t.IdentityFlagsEthereumDisplaying=18]="IdentityFlagsEthereumDisplaying",t[t.IdentityFlagsOwnerLock=252]="IdentityFlagsOwnerLock",t[t.IdentityFlagsExec=253]="IdentityFlagsExec",t[t.IdentityFlagsDl=254]="IdentityFlagsDl",t}(f||{});function createOmnilockScript(t,e){const r=((null==e?void 0:e.config)||(0,n.getConfig)()).SCRIPTS.OMNILOCK;if(!r)throw new Error("OMNILOCK script config not found.");const i=[0],a=(()=>{const e=t.auth.flag;switch(e){case"ETHEREUM":return o.bytes.hexify(o.bytes.concat([f.IdentityFlagsEthereum],t.auth.content,i));case"SECP256K1_BLAKE160":return o.bytes.hexify(o.bytes.concat([f.IdentityFlagsCkb],t.auth.content,i));case"BITCOIN":return o.bytes.hexify(o.bytes.concat([f.IdentityFlagsBitcoin],p.decodeAddress(t.auth.content),i));default:throw new Error(`Not supported flag: ${e}.`)}})();return{codeHash:r.CODE_HASH,hashType:r.HASH_TYPE,args:a}}const h={pack:u.bytify,unpack:u.hexify},g=(0,l.createFixedHexBytesCodec)(21),y=(0,c.byteVecOf)(h),m=(0,c.table)({mask:(0,c.byteOf)(h),proof:y},["mask","proof"]),b=(0,c.vector)(m),S=(0,c.table)({identity:g,proofs:b},["identity","proofs"]),C=(0,c.option)(S),_=(0,c.table)({signature:l.BytesOpt,omni_identity:C,preimage:l.BytesOpt},["signature","omni_identity","preimage"]);e.OmnilockWitnessLock=_;const w=class CellCollector{constructor(t,e,{config:r,queryOptions:o={}}={}){if(!e)throw new Error("Cell provider is missing!");r=r||(0,n.getConfig)(),this.fromScript=(0,s.parseFromInfo)(t,{config:r}).fromScript,this.config=r,o={...o,lock:this.fromScript,type:o.type||"empty"},this.cellCollector=e.collector(o)}async*collect(){if((0,a.isOmnilockScript)(this.fromScript,this.config))for await(const t of this.cellCollector.collect())yield t}};async function setupInputCell(t,e,r,{config:s,defaultWitness:c="0x",since:l}={}){s=s||(0,n.getConfig)();const u=e.cellOutput.lock;if(!(0,a.isOmnilockScript)(u,s))throw new Error("Not OMNILOCK input!");t=t.update("inputs",(t=>t.push(e)));const p={cellOutput:{capacity:e.cellOutput.capacity,lock:e.cellOutput.lock,type:e.cellOutput.type},data:e.data};t=t.update("outputs",(t=>t.push(p))),l&&(t=t.update("inputSinces",(e=>e.set(t.get("inputs").size-1,l)))),t=t.update("witnesses",(t=>t.push(c)));const f=s.SCRIPTS.OMNILOCK,h=s.SCRIPTS.SECP256K1_BLAKE160;if(!f)throw new Error("OMNILOCK script not defined in config!");if(!h)throw new Error("SECP256K1_BLAKE160 script not defined in config!");const g={txHash:f.TX_HASH,index:f.INDEX},y={txHash:h.TX_HASH,index:h.INDEX};t=(0,a.addCellDep)(t,{outPoint:g,depType:f.DEP_TYPE});const m=(t=(0,a.addCellDep)(t,{outPoint:y,depType:h.DEP_TYPE})).get("inputs").findIndex((t=>new d(t.cellOutput.lock,{validate:!1}).equals(new d(u,{validate:!1}))));if(-1!==m){for(;m>=t.get("witnesses").size;)t=t.update("witnesses",(t=>t.push("0x")));let e=t.get("witnesses").get(m);const r={lock:a.OMNILOCK_SIGNATURE_PLACEHOLDER};e=o.bytes.hexify(i.blockchain.WitnessArgs.pack(r)),t=t.update("witnesses",(t=>t.set(m,e)))}return t}function prepareSigningEntries(t,{config:e}={}){return e=e||(0,n.getConfig)(),(0,a.prepareSigningEntries)(t,e,"OMNILOCK")}e.CellCollector=w;var k={prepareSigningEntries,setupInputCell,CellCollector:w,OmnilockWitnessLock:_,createOmnilockScript};e.default=k},878765:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createP2PKHMessageGroup=function createP2PKHMessageGroup(t,e,{hasher:r=defaultCkbHasher}={}){const s=function groupInputs(t,e){const r=new Set;for(const t of e){const e=o.utils.ckbHash(o.blockchain.Script.pack(t));r.add(e)}const i=new Map;for(let e=0;e<t.length;e++){const n=o.utils.ckbHash(o.blockchain.Script.pack(t[e].cellOutput.lock));r.has(n)&&(void 0===i.get(n)&&i.set(n,[]),i.get(n).push(e))}return i}(t.inputs.toArray(),e),c=function calcRawTxHash(t){const e=(0,i.createTransactionFromSkeleton)(t),r={cellDeps:e.cellDeps,headerDeps:e.headerDeps,inputs:e.inputs,outputs:e.outputs,outputsData:e.outputsData,version:e.version};return o.utils.ckbHash(o.blockchain.RawTransaction.pack(r))}(t);if(e.length>1&&!(r instanceof Function))throw new Error("Must provide hasher producer when you have multiple locks to group.");const l=[];for(const e of s.keys()){const o=resolveThunk(r),i=s.get(e),u=i[0],p=t.witnesses.get(u);if(void 0===p)throw new Error("Please fill witnesses with 0 first!");o.update(n.bytes.bytify(c));const d=new ArrayBuffer(8),f=new DataView(d),h=a.BI.from(n.bytes.bytify(p).length).toString(16);h.length<=8&&(f.setUint32(0,Number("0x"+h),!0),f.setUint32(4,Number("0x00000000"),!0)),h.length>8&&h.length<=16&&(f.setUint32(0,Number("0x"+h.slice(-8)),!0),f.setUint32(4,Number("0x"+h.slice(0,-8)),!0)),o.update(new Uint8Array(d)),o.update(n.bytes.bytify(p));for(let e=1;e<i.length;e++){const r=t.witnesses.get(i[e]);o.update(new Uint8Array(d)),o.update(n.bytes.bytify(r))}for(let e=t.inputs.toArray().length;e<t.witnesses.toArray().length;e++){const r=t.witnesses.get(e);o.update(new Uint8Array(d)),o.update(n.bytes.bytify(r))}const g=o.digest(),y={index:u,lock:t.inputs.get(u).cellOutput.lock,message:"0x"+Array.prototype.map.call(g,(t=>("00"+t.toString(16)).slice(-2))).join("")};l.push(y)}return l};var o=r(140993),i=r(893597),n=r(852966),a=r(739609);const defaultCkbHasher=()=>{const t=new o.utils.CKBHasher;return{update:e=>t.update(e.buffer),digest:()=>n.bytes.bytify(t.digestHex())}};function resolveThunk(t){return t instanceof Function?t():t}},574393:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.CellCollector=void 0,e.injectCapacity=injectCapacity,e.payFee=payFee,e.prepareSigningEntries=prepareSigningEntries,e.setupInputCell=setupInputCell,e.transfer=transfer,e.transferCompatible=transferCompatible;var o=r(706081),i=r(893597),n=r(852966),a=r(140993),s=r(519808),c=r(555258),l=r(446037),u=r(739609);const{ScriptValue:p}=a.values,d=class CellCollector{constructor(t,e,{config:r,queryOptions:o={}}={}){if(!e)throw new Error("Cell provider is missing!");r=r||(0,s.getConfig)(),this.fromScript=(0,l.parseFromInfo)(t,{config:r}).fromScript,this.config=r,o={...o,lock:this.fromScript,type:o.type||"empty"},this.cellCollector=e.collector(o)}async*collect(){if((0,c.isSecp256k1Blake160Script)(this.fromScript,this.config))for await(const t of this.cellCollector.collect())yield t}};async function setupInputCell(t,e,r,{config:o,defaultWitness:i="0x",since:l}={}){o=o||(0,s.getConfig)();const u=e.cellOutput.lock;if(!(0,c.isSecp256k1Blake160Script)(u,o))throw new Error("Not SECP256K1_BLAKE160 input!");t=t.update("inputs",(t=>t.push(e)));const d={cellOutput:{capacity:e.cellOutput.capacity,lock:e.cellOutput.lock,type:e.cellOutput.type},data:e.data};t=t.update("outputs",(t=>t.push(d))),l&&(t=t.update("inputSinces",(e=>e.set(t.get("inputs").size-1,l)))),t=t.update("witnesses",(t=>t.push(i)));const f=o.SCRIPTS.SECP256K1_BLAKE160;if(!f)throw new Error("SECP256K1_BLAKE160 script not defined in config!");const h={txHash:f.TX_HASH,index:f.INDEX},g=(t=(0,c.addCellDep)(t,{outPoint:h,depType:f.DEP_TYPE})).get("inputs").findIndex((t=>new p(t.cellOutput.lock,{validate:!1}).equals(new p(u,{validate:!1}))));if(-1!==g){for(;g>=t.get("witnesses").size;)t=t.update("witnesses",(t=>t.push("0x")));let e=t.get("witnesses").get(g);const r={lock:c.SECP_SIGNATURE_PLACEHOLDER};if("0x"!==e){const t=a.blockchain.WitnessArgs.unpack(n.bytes.bytify(e)),o=t.lock;if(o&&r.lock&&!n.bytes.equal(o,r.lock))throw new Error("Lock field in first witness is set aside for signature!");const i=t.inputType;i&&(r.inputType=i);const s=t.outputType;s&&(r.outputType=s)}e=n.bytes.hexify(a.blockchain.WitnessArgs.pack(r)),t=t.update("witnesses",(t=>t.set(g,e)))}return t}async function transfer(t,e,r,o,{config:i,requireToAddress:n=!0,assertAmountEnough:a=!0}={}){const s=await transferCompatible(t,e,r,o,{config:i,requireToAddress:n,assertAmountEnough:a});let c,l;return s instanceof Array?(c=s[0],l=BigInt(s[1].toString()),[c,l]):(c=s,c)}async function transferCompatible(t,e,r,l,{config:d,requireToAddress:f=!0,assertAmountEnough:h=!0}={}){const g=(d=d||(0,s.getConfig)()).SCRIPTS.SECP256K1_BLAKE160;if(!g)throw new Error("Provided config does not have SECP256K1_BLAKE160 script setup!");const y={txHash:g.TX_HASH,index:g.INDEX};t=(0,c.addCellDep)(t,{outPoint:y,depType:g.DEP_TYPE});const m=(0,i.parseAddress)(e,{config:d});if((0,c.ensureScript)(m,d,"SECP256K1_BLAKE160"),f&&!r)throw new Error("You must provide a to address!");let b=u.BI.from(l);if(r){const e=(0,i.parseAddress)(r,{config:d});t=t.update("outputs",(t=>t.push({cellOutput:{capacity:"0x"+b.toString(16),lock:e,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0})))}const S=t.get("fixedEntries").filter((({field:t})=>"outputs"===t)).maxBy((({index:t})=>t));let C=S?S.index+1:0;for(;C<t.get("outputs").size&&b.gt(0);C++){const e=t.get("outputs").get(C);if(new p(e.cellOutput.lock,{validate:!1}).equals(new p(m,{validate:!1}))){const t=u.BI.from(e.cellOutput.capacity);let r;b.gte(t)?r=t:(r=t.sub((0,i.minimalCellCapacityCompatible)(e)),r.gt(b)&&(r=b)),b=b.sub(r),e.cellOutput.capacity="0x"+t.sub(r).toString(16)}}if(t=t.update("outputs",(t=>t.filter((t=>!u.BI.from(t.cellOutput.capacity).eq(0))))),b.gt(0)){const e=t.get("cellProvider");if(!e)throw new Error("Cell provider is missing!");const r=e.collector({lock:m}),n={cellOutput:{capacity:"0x0",lock:m,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0};let a=u.BI.from(0),s=(0,o.Set)();for(const e of t.get("inputs"))s=s.add(`${e.outPoint.txHash}_${e.outPoint.index}`);for await(const e of r.collect()){if(s.has(`${e.outPoint.txHash}_${e.outPoint.index}`))continue;t=(t=t.update("inputs",(t=>t.push(e)))).update("witnesses",(t=>t.push("0x")));const r=u.BI.from(e.cellOutput.capacity);let o=r;if(o.gt(b)&&(o=b),b=b.sub(o),a=a.add(r).sub(o),b.eq(0)&&(a.eq(0)||a.gt((0,i.minimalCellCapacityCompatible)(n))))break}a.gt(0)&&(n.cellOutput.capacity="0x"+a.toString(16),t=t.update("outputs",(t=>t.push(n))))}if(b.gt(0)&&h)throw new Error("Not enough capacity in from address!");const _=t.get("inputs").findIndex((t=>new p(t.cellOutput.lock,{validate:!1}).equals(new p(m,{validate:!1}))));if(-1!==_){for(;_>=t.get("witnesses").size;)t=t.update("witnesses",(t=>t.push("0x")));let e=t.get("witnesses").get(_);const r={lock:c.SECP_SIGNATURE_PLACEHOLDER};if("0x"!==e){const t=a.blockchain.WitnessArgs.unpack(n.bytes.bytify(e)),o=t.lock;if(o&&r.lock&&!n.bytes.equal(o,r.lock))throw new Error("Lock field in first witness is set aside for signature!");const i=t.inputType;i&&(r.inputType=i);const s=t.outputType;s&&(r.outputType=s)}e=n.bytes.hexify(a.blockchain.WitnessArgs.pack(r)),t=t.update("witnesses",(t=>t.set(_,e)))}return h?t:[t,u.BI.from(b)]}async function payFee(t,e,r,{config:o}={}){return o=o||(0,s.getConfig)(),await transferCompatible(t,e,null,r,{config:o,requireToAddress:!1})}async function injectCapacity(t,e,r,{config:o}={}){if(o=o||(0,s.getConfig)(),e>=t.get("outputs").size)throw new Error("Invalid output index!");const i=u.BI.from(t.get("outputs").get(e).cellOutput.capacity);return await transferCompatible(t,r,null,u.BI.from(i),{config:o,requireToAddress:!1})}function prepareSigningEntries(t,{config:e}={}){return e=e||(0,s.getConfig)(),(0,c.prepareSigningEntries)(t,e,"SECP256K1_BLAKE160")}e.CellCollector=d;var f={transfer,transferCompatible,payFee,prepareSigningEntries,injectCapacity,setupInputCell,CellCollector:d};e.default=f},342202:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.CellCollector=void 0,e.injectCapacity=injectCapacity,Object.defineProperty(e,"multisigArgs",{enumerable:!0,get:function(){return l.multisigArgs}}),e.payFee=payFee,e.prepareSigningEntries=prepareSigningEntries,Object.defineProperty(e,"serializeMultisigScript",{enumerable:!0,get:function(){return l.serializeMultisigScript}}),e.setupInputCell=setupInputCell,e.transfer=transfer,e.transferCompatible=transferCompatible;var o=r(893597),i=r(852966),n=r(140993),a=r(519808),s=r(706081),c=r(555258),l=r(446037),u=r(739609);const{ScriptValue:p}=n.values,d=class CellCollector{constructor(t,e,{config:r,queryOptions:o={}}={}){if(!e)throw new Error("Cell provider is missing!");r=r||(0,a.getConfig)();const i=(0,l.parseFromInfo)(t,{config:r});this.fromScript=i.fromScript,this.multisigScript=i.multisigScript,this.config=r,o={...o,lock:this.fromScript,type:o.type||"empty"},this.cellCollector=e.collector(o)}async*collect(){if((0,c.isSecp256k1Blake160MultisigScript)(this.fromScript,this.config))for await(const t of this.cellCollector.collect())yield t}};async function setupInputCell(t,e,r,{config:o,defaultWitness:s="0x",since:u,requireMultisigScript:d=!0}={}){if(o=o||(0,a.getConfig)(),d&&"object"!=typeof r)throw new Error("`fromInfo` must be MultisigScript format!");const f=e.cellOutput.lock;if(r){const t=(0,l.parseFromInfo)(r,{config:o}).fromScript;if(!new p(t,{validate:!1}).equals(new p(f,{validate:!1})))throw new Error("`fromInfo` not match to input lock!")}if(!(0,c.isSecp256k1Blake160MultisigScript)(f,o))throw new Error("Not SECP256K1_BLAKE160_MULTISIG input!");t=t.update("inputs",(t=>t.push(e))),u&&(t=t.update("inputSinces",(e=>e.set(t.get("inputs").size-1,u)))),t=t.update("witnesses",(t=>t.push(s)));const h={cellOutput:{capacity:e.cellOutput.capacity,lock:e.cellOutput.lock,type:e.cellOutput.type},data:e.data};t=t.update("outputs",(t=>t.push(h)));const g=o.SCRIPTS.SECP256K1_BLAKE160_MULTISIG;if(!g)throw new Error("SECP256K1_BLAKE160_MULTISIG script not defined in config!");const y={txHash:g.TX_HASH,index:g.INDEX},m=(t=(0,c.addCellDep)(t,{outPoint:y,depType:g.DEP_TYPE})).get("inputs").findIndex((t=>new p(t.cellOutput.lock,{validate:!1}).equals(new p(f,{validate:!1}))));if(-1!==m){for(;m>=t.get("witnesses").size;)t=t.update("witnesses",(t=>t.push("0x")));if("0x"===t.get("witnesses").get(m)&&"object"!=typeof r)throw new Error("`fromInfo` must be MultisigScript format!");if("object"==typeof r){const e=(0,l.parseFromInfo)(r,{config:o}).multisigScript;let a=t.get("witnesses").get(m);const s={lock:"0x"+e.slice(2)+c.SECP_SIGNATURE_PLACEHOLDER.slice(2).repeat(r.M)};if("0x"!==a){const t=n.blockchain.WitnessArgs.unpack(i.bytes.bytify(a)),e=t.lock;if(e&&s.lock&&!i.bytes.equal(e,s.lock))throw new Error("Lock field in first witness is set aside for signature!");const r=t.inputType;r&&(s.inputType=r);const o=t.outputType;o&&(s.outputType=o)}a=i.bytes.hexify(n.blockchain.WitnessArgs.pack(s)),t=t.update("witnesses",(t=>t.set(m,a)))}}return t}async function transfer(t,e,r,o,{config:i,requireToAddress:n=!0,assertAmountEnough:a=!0}={}){const s=await transferCompatible(t,e,r,o,{config:i,requireToAddress:n,assertAmountEnough:a});let c,l;return s instanceof Array?(c=s[0],l=BigInt(s[1].toString()),[c,l]):(c=s,c)}async function transferCompatible(t,e,r,d,{config:f,requireToAddress:h=!0,assertAmountEnough:g=!0}={}){const y=(f=f||(0,a.getConfig)()).SCRIPTS.SECP256K1_BLAKE160_MULTISIG;if(!y)throw new Error("Provided config does not have SECP256K1_BLAKE16_MULTISIG script setup!");const m={txHash:y.TX_HASH,index:y.INDEX};t=(0,c.addCellDep)(t,{outPoint:m,depType:y.DEP_TYPE});const{fromScript:b,multisigScript:S}=(0,l.parseFromInfo)(e,{config:f});(0,c.ensureScript)(b,f,"SECP256K1_BLAKE160_MULTISIG");const C=!t.get("inputs").find((t=>new p(t.cellOutput.lock,{validate:!1}).equals(new p(b,{validate:!1}))));if(C&&"string"===e)throw new Error("MultisigScript is required for witness!");if(h&&!r)throw new Error("You must provide a to address!");let _=d?u.BI.from(d):u.BI.from(0);if(r){const e=(0,o.parseAddress)(r,{config:f});t=t.update("outputs",(t=>t.push({cellOutput:{capacity:"0x"+_.toString(16),lock:e,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0})))}const w=t.get("fixedEntries").filter((({field:t})=>"outputs"===t)).maxBy((({index:t})=>t));let k=w?w.index+1:0;for(;k<t.get("outputs").size&&_.gt(0);++k){const e=t.get("outputs").get(k);if(new p(e.cellOutput.lock,{validate:!1}).equals(new p(b,{validate:!1}))){const t=u.BI.from(e.cellOutput.capacity);let r;_.gte(t)?r=t:(r=t.sub((0,o.minimalCellCapacityCompatible)(e)),r.gt(_)&&(r=_)),_=_.sub(r),e.cellOutput.capacity="0x"+t.sub(r).toString(16)}}if(t=t.update("outputs",(t=>t.filter((t=>!u.BI.from(t.cellOutput.capacity).eq(0))))),_.gt(0)){const e=t.get("cellProvider");if(!e)throw new Error("cell provider is missing!");const r=e.collector({lock:b}),i={cellOutput:{capacity:"0x0",lock:b,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0};let n=u.BI.from(0),a=(0,s.Set)();for(const e of t.get("inputs"))a=a.add(`${e.outPoint.txHash}_${e.outPoint.index}`);for await(const e of r.collect()){if(a.has(`${e.outPoint.txHash}_${e.outPoint.index}`))continue;t=(t=t.update("inputs",(t=>t.push(e)))).update("witnesses",(t=>t.push("0x")));const r=u.BI.from(e.cellOutput.capacity);let s=r;if(s.gt(_)&&(s=_),_=_.sub(s),n=n.add(r.sub(s)),_.eq(0)&&(n.eq(0)||n.gt((0,o.minimalCellCapacityCompatible)(i))))break}n.gt(0)&&(i.cellOutput.capacity="0x"+n.toString(16),t=t.update("outputs",(t=>t.push(i))))}if(_.gt(0)&&g)throw new Error("Not enough capacity in from address!");const v=t.get("inputs").findIndex((t=>new p(t.cellOutput.lock,{validate:!1}).equals(new p(b,{validate:!1}))));if(-1!==v){for(;u.BI.from(v).gte(t.get("witnesses").size);)t=t.update("witnesses",(t=>t.push("0x")));if(C||"string"!=typeof e){let r=t.get("witnesses").get(v);const o={lock:"0x"+S.slice(2)+c.SECP_SIGNATURE_PLACEHOLDER.slice(2).repeat(e.M)};if("0x"!==r){const t=n.blockchain.WitnessArgs.unpack(i.bytes.bytify(r)),e=t.lock;if(e&&o.lock&&!i.bytes.equal(e,o.lock))throw new Error("Lock field in first witness is set aside for signature!");const a=t.inputType;a&&(o.inputType=a);const s=t.outputType;s&&(o.outputType=s)}r=i.bytes.hexify(n.blockchain.WitnessArgs.pack(o)),t=t.update("witnesses",(t=>t.set(v,r)))}}return g?t:[t,u.BI.from(_)]}async function payFee(t,e,r,{config:o}={}){return transferCompatible(t,e,void 0,r,{config:o=o||(0,a.getConfig)(),requireToAddress:!1})}async function injectCapacity(t,e,r,{config:o}={}){if(o=o||(0,a.getConfig)(),e>=t.get("outputs").size)throw new Error("Invalid output index!");const i=u.BI.from(t.get("outputs").get(e).cellOutput.capacity);return transferCompatible(t,r,void 0,i,{config:o,requireToAddress:!1})}function prepareSigningEntries(t,{config:e}={}){return e=e||(0,a.getConfig)(),(0,c.prepareSigningEntries)(t,e,"SECP256K1_BLAKE160_MULTISIG")}e.CellCollector=d;var f={transfer,transferCompatible,payFee,prepareSigningEntries,serializeMultisigScript:l.serializeMultisigScript,multisigArgs:l.multisigArgs,injectCapacity,setupInputCell,CellCollector:d};e.default=f},77922:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.issueToken=issueToken,e.ownerForSudt=ownerForSudt,e.packAmount=packAmount,e.transfer=transfer,e.unpackAmount=unpackAmount;var o=r(555258),i=r(140993),n=_interopRequireDefault(r(342202)),a=r(446037),s=_interopRequireDefault(r(974247)),c=r(893597),l=r(706081),u=r(519808),p=r(474233),d=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(911584)),f=_interopRequireDefault(r(574393)),h=r(739609),g=r(852966);function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}const{computeScriptHash:y}=i.utils,{ScriptValue:m}=i.values;async function issueToken(t,e,r,i,n,{config:l}={}){const p=(l=l||(0,u.getConfig)()).SCRIPTS.SUDT;if(!p)throw new Error("Provided config does not have SUDT script setup!");t=(0,o.addCellDep)(t,{outPoint:{txHash:p.TX_HASH,index:p.INDEX},depType:p.DEP_TYPE});const d=(0,a.parseFromInfo)(e,{config:l}).fromScript,f={cellOutput:{capacity:"0x0",lock:d,type:{codeHash:p.CODE_HASH,hashType:p.HASH_TYPE,args:y(d)}},data:g.bytes.hexify(g.number.Uint128LE.pack(r)),outPoint:void 0,blockHash:void 0};i||(i=(0,c.minimalCellCapacityCompatible)(f));const m=h.BI.from(i);f.cellOutput.capacity="0x"+m.toString(16);const b=(t=t.update("outputs",(t=>t.push(f)))).get("outputs").size-1;return t=t.update("fixedEntries",(t=>t.push({field:"outputs",index:b}))),t=await s.default.injectCapacity(t,[e],h.BI.from(h.BI.from(f.cellOutput.capacity)),void 0,n,{config:l})}async function transfer(t,e,r,i,y,b,S,C,{config:_,LocktimePoolCellCollector:w=p.CellCollector,splitChangeCell:k=!1}={}){_=_||(0,u.getConfig)();let v=h.BI.from(y),x=S?h.BI.from(S):void 0;const E=_.SCRIPTS.SUDT;if(!E)throw new Error("Provided config does not have SUDT script setup!");if(0===e.length)throw new Error("`fromInfos` can't be empty!");if(!i)throw new Error("You must provide a to address!");const P=(0,c.parseAddress)(i,{config:_}),O=e.map((t=>(0,a.parseFromInfo)(t,{config:_}).fromScript)),I=b?(0,c.parseAddress)(b,{config:_}):O[0];if(v.lte(0))throw new Error("amount must be greater than 0");const T=function _generateSudtScript(t,e){const r=e.SCRIPTS.SUDT;return{codeHash:r.CODE_HASH,hashType:r.HASH_TYPE,args:t}}(r,_),B=t.get("cellProvider");if(!B)throw new Error("Cell provider is missing!");let A=h.BI.from(0),H=h.BI.from(0);if((0,o.isAcpScript)(P,_)){const e=new d.CellCollector(i,B,{config:_,queryOptions:{type:T,data:"any"}}),r=(await e.collect().next()).value;if(!r)throw new Error("toAddress ANYONE_CAN_PAY input not found!");t=(t=t.update("inputs",(t=>t.push(r)))).update("witnesses",(t=>t.push("0x"))),A=h.BI.from(r.cellOutput.capacity),H=unpackAmount(r.data)}const D={cellOutput:{capacity:"0x0",lock:P,type:T},data:g.bytes.hexify(g.number.Uint128LE.pack(v)),outPoint:void 0,blockHash:void 0};(0,o.isAcpScript)(P,_)?(x||(x=h.BI.from(0)),D.cellOutput.capacity="0x"+A.add(x).toString(16),D.data=g.bytes.hexify(g.number.Uint128LE.pack(H.add(v)))):(x||(x=h.BI.from((0,c.minimalCellCapacityCompatible)(D))),D.cellOutput.capacity="0x"+x.toString(16)),t=(t=t.update("outputs",(t=>t.push(D)))).update("fixedEntries",(e=>e.push({field:"outputs",index:t.get("outputs").size-1}))),t=(0,o.addCellDep)(t,{outPoint:{txHash:E.TX_HASH,index:E.INDEX},depType:E.DEP_TYPE});const R={cellOutput:{capacity:"0x0",lock:I,type:T},data:g.bytes.hexify(g.number.Uint128LE.pack(0)),outPoint:void 0,blockHash:void 0},F={cellOutput:{capacity:"0x0",lock:I,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0};let M=h.BI.from(0),L=h.BI.from(0),N=(0,l.Set)();for(const e of t.get("inputs"))N=N.add(`${e.outPoint.txHash}_${e.outPoint.index}`);let j=(0,l.List)();C&&e.forEach(((t,e)=>{const r=new w(t,B,{config:_,tipHeader:C,queryOptions:{type:T,data:"any"}});j=j.push({cellCollector:r,index:e})})),e.forEach(((t,e)=>{const r=new f.default.CellCollector(t,B,{config:_,queryOptions:{type:T,data:"any"}}),o=new n.default.CellCollector(t,B,{config:_,queryOptions:{type:T,data:"any"}}),i=new d.default.CellCollector(t,B,{config:_,queryOptions:{type:T,data:"any"}});j=j.push({cellCollector:r,index:e},{cellCollector:o,index:e},{cellCollector:i,index:e,isAnyoneCanPay:!0,destroyable:(0,a.parseFromInfo)(t,{config:_}).destroyable})})),C&&e.forEach(((t,e)=>{const r=new w(t,B,{config:_,tipHeader:C});j=j.push({cellCollector:r,index:e})})),e.forEach(((t,e)=>{const r=new f.default.CellCollector(t,B,{config:_}),o=new n.default.CellCollector(t,B,{config:_}),i=new d.default.CellCollector(t,B,{config:_});j=j.push({cellCollector:r,index:e},{cellCollector:o,index:e},{cellCollector:i,index:e,isAnyoneCanPay:!0,destroyable:(0,a.parseFromInfo)(t,{config:_}).destroyable})}));for(const{index:r,cellCollector:o,isAnyoneCanPay:i,destroyable:n}of j)for await(const a of o.collect()){const o=`${a.outPoint.txHash}_${a.outPoint.index}`;if(N.has(o))continue;N=N.add(o);const l=e[r],u=(t=await s.default.setupInputCell(t,a,l,{config:_})).get("outputs").size-1,p=(t=t.update("outputs",(t=>t.remove(u)))).get("fixedEntries").findIndex((t=>"outputs"===t.field&&t.index===u));p>=0&&(t=t.update("fixedEntries",(t=>t.remove(p))));const d=h.BI.from(a.cellOutput.capacity),f=a.cellOutput.type?unpackAmount(a.data):h.BI.from(0);let y=i&&!n?d.sub((0,c.minimalCellCapacityCompatible)(a)):d,m=f;y.gt(x)&&(y=h.BI.from(x)),x=x.sub(y);const b=d.sub(y);(!i||i&&n)&&(M=M.add(b)),m.gt(v)&&(m=v),v=v.sub(m);const S=f.sub(m);if((!i||i&&n)&&(L=L.add(S)),i&&!n){const e={cellOutput:{capacity:"0x"+b.toString(16),lock:a.cellOutput.lock,type:a.cellOutput.type},data:a.cellOutput.type?g.bytes.hexify(g.number.Uint128LE.pack(S)):"0x"};t=t.update("outputs",(t=>t.push(e))),a.cellOutput.type&&(t=t.update("fixedEntries",(e=>e.push({field:"outputs",index:t.get("outputs").size-1}))))}if(x.eq(0)&&v.eq(0)&&(M.eq(0)&&L.eq(0)||M.gt((0,c.minimalCellCapacityCompatible)(F))&&L.eq(0))){R.cellOutput.type=void 0,R.data="0x";break}if(x.eq(0)&&v.eq(0)&&M.gt((0,c.minimalCellCapacityCompatible)(F))&&L.gt(0))break}let W=-1;if((0,o.isAcpScript)(R.cellOutput.lock,_)&&-1!==(W=t.get("outputs").findIndex((t=>new m(R.cellOutput.lock,{validate:!1}).equals(new m(t.cellOutput.lock,{validate:!1}))&&(L.eq(0)&&!R.cellOutput.type&&!t.cellOutput.type||L.gte(0)&&!!R.cellOutput.type&&!!t.cellOutput.type&&new m(R.cellOutput.type,{validate:!1}).equals(new m(t.cellOutput.type,{validate:!1}))))))&&-1===t.get("fixedEntries").findIndex((t=>"output"===t.field&&t.index===W))){const e=t.get("outputs").get(W),r=JSON.parse(JSON.stringify(e));r.cellOutput.capacity="0x"+h.BI.from(e.cellOutput.capacity).add(M).toString(16),L.gt(0)&&(r.data=g.bytes.hexify(g.number.Uint128LE.pack(unpackAmount(e.data).add(L))));const o=h.BI.from((0,c.minimalCellCapacityCompatible)(R)),i=h.BI.from((0,c.minimalCellCapacityCompatible)(F));let n=!1;L.gt(0)&&k&&M.gte(o.add(i))&&(r.cellOutput.capacity=e.cellOutput.capacity,F.cellOutput.capacity="0x"+M.toString(16),n=!0),t=t.update("outputs",(t=>t.set(W,r))),n&&(t=t.update("outputs",(t=>t.push(F))))}else if(M.gte((0,c.minimalCellCapacityCompatible)(R))){R.cellOutput.capacity="0x"+M.toString(16),L.gt(0)&&(R.data=g.bytes.hexify(g.number.Uint128LE.pack(L)));const e=h.BI.from((0,c.minimalCellCapacityCompatible)(R)),r=h.BI.from((0,c.minimalCellCapacityCompatible)(F));let o=!1;L.gt(0)&&k&&M.gte(e.add(r))&&(R.cellOutput.capacity="0x"+e.toString(16),F.cellOutput.capacity="0x"+M.sub(e).toString(16),o=!0),t=t.update("outputs",(t=>t.push(R))),L.gt(0)&&(t=t.update("fixedEntries",(e=>e.push({field:"outputs",index:t.get("outputs").size-1})))),o&&(t=t.update("outputs",(t=>t.push(F))))}else if(L.gt(0)&&M.lt((0,c.minimalCellCapacityCompatible)(R)))throw new Error("Not enough capacity for change in from infos!");if(x.gt(0))throw new Error("Not enough capacity in from infos!");if(v.gt(0))throw new Error("Not enough amount in from infos!");return t}function ownerForSudt(t,{config:e}={}){e=e||(0,u.getConfig)();const{fromScript:r}=(0,a.parseFromInfo)(t,{config:e});return y(r)}function unpackAmount(t){return g.number.Uint128LE.unpack(g.bytes.bytify(t).slice(0,16))}function packAmount(t){return g.bytes.hexify(g.number.Uint128LE.pack(t))}var b={issueToken,transfer,ownerForSudt,packAmount,unpackAmount};e.default=b},464509:t=>{"use strict";t.exports=function base(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),r=0;r<e.length;r++)e[r]=255;for(var o=0;o<t.length;o++){var i=t.charAt(o),n=i.charCodeAt(0);if(255!==e[n])throw new TypeError(i+" is ambiguous");e[n]=o}var a=t.length,s=t.charAt(0),c=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function decodeUnsafe(t){if("string"!=typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;for(var r=0,o=0,i=0;t[r]===s;)o++,r++;for(var n=(t.length-r)*c+1>>>0,l=new Uint8Array(n);t[r];){var u=e[t.charCodeAt(r)];if(255===u)return;for(var p=0,d=n-1;(0!==u||p<i)&&-1!==d;d--,p++)u+=a*l[d]>>>0,l[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=p,r++}for(var f=n-i;f!==n&&0===l[f];)f++;for(var h=new Uint8Array(o+(n-f)),g=o;f!==n;)h[g++]=l[f++];return h}return{encode:function encode(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";for(var r=0,o=0,i=0,n=e.length;i!==n&&0===e[i];)i++,r++;for(var c=(n-i)*l+1>>>0,u=new Uint8Array(c);i!==n;){for(var p=e[i],d=0,f=c-1;(0!==p||d<o)&&-1!==f;f--,d++)p+=256*u[f]>>>0,u[f]=p%a>>>0,p=p/a>>>0;if(0!==p)throw new Error("Non-zero carry");o=d,i++}for(var h=c-o;h!==c&&0===u[h];)h++;for(var g=s.repeat(r);h<c;++h)g+=t.charAt(u[h]);return g},decodeUnsafe,decode:function decode(t){var e=decodeUnsafe(t);if(e)return e;throw new Error("Non-base"+a+" character")}}}},185218:(t,e,r)=>{const o=r(464509);t.exports=o("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},426488:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(907823),i=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(593202));function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}var n={getTipBlockNumber:{method:"get_tip_block_number",paramsFormatters:[],resultFormatters:i.toNumber},getTipHeader:{method:"get_tip_header",paramsFormatters:[],resultFormatters:i.toHeader},getCurrentEpoch:{method:"get_current_epoch",paramsFormatters:[],resultFormatters:i.toEpoch},getEpochByNumber:{method:"get_epoch_by_number",paramsFormatters:[o.formatter.toNumber],resultFormatters:i.toEpoch},getBlockHash:{method:"get_block_hash",paramsFormatters:[o.formatter.toNumber]},getBlock:{method:"get_block",paramsFormatters:[o.formatter.toHash],resultFormatters:i.toBlock},getBlockByNumber:{method:"get_block_by_number",paramsFormatters:[o.formatter.toNumber],resultFormatters:i.toBlock},getHeader:{method:"get_header",paramsFormatters:[o.formatter.toHash],resultFormatters:i.toHeader},getHeaderByNumber:{method:"get_header_by_number",paramsFormatters:[o.formatter.toNumber],resultFormatters:i.toHeader},getLiveCell:{method:"get_live_cell",paramsFormatters:[o.formatter.toOutPoint],resultFormatters:i.toLiveCellWithStatus},getTransaction:{method:"get_transaction",paramsFormatters:[o.formatter.toHash],resultFormatters:i.toTransactionWithStatus},getCellbaseOutputCapacityDetails:{method:"get_cellbase_output_capacity_details",paramsFormatters:[o.formatter.toHash],resultFormatters:i.toCellbaseOutputCapacityDetails},getBlockEconomicState:{method:"get_block_economic_state",paramsFormatters:[o.formatter.toHash],resultFormatters:i.toBlockEconomicState},getTransactionProof:{method:"get_transaction_proof",paramsFormatters:[o.formatter.toArray(o.formatter.toHash),o.formatter.toOptional(o.formatter.toHash)],resultFormatters:i.toTransactionProof},verifyTransactionProof:{method:"verify_transaction_proof",paramsFormatters:[o.formatter.toTransactionProof]},getConsensus:{method:"get_consensus",paramsFormatters:[],resultFormatters:i.toConsensus}};e.default=n},821323:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(907823),i={dryRunTransaction:{method:"dry_run_transaction",paramsFormatters:[o.formatter.toRawTransaction]},calculateDaoMaximumWithdraw:{method:"calculate_dao_maximum_withdraw",paramsFormatters:[o.formatter.toOutPoint,o.formatter.toHash]}};e.default=i},167837:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.rpcProperties=e.Base=void 0;var o=_interopRequireDefault(r(426488)),i=_interopRequireDefault(r(821323)),n=_interopRequireDefault(r(309154)),a=_interopRequireDefault(r(600027)),s=_interopRequireDefault(r(829862)),c=_interopRequireDefault(r(511766));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classPrivateFieldInitSpec(t,e,r){!function _checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,r)}function _classPrivateFieldGet(t,e){var r=function _classExtractFieldDescriptor(t,e,r){if(!e.has(t))throw new TypeError("attempted to "+r+" private field on non-instance");return e.get(t)}(t,e,"get");return function _classApplyDescriptorGet(t,e){if(e.get)return e.get.call(t);return e.value}(t,r)}const l={...o.default,...i.default,...c.default,...n.default,...a.default,...s.default};e.rpcProperties=l;var u=new WeakMap;e.Base=class Base{constructor(){_classPrivateFieldInitSpec(this,u,{writable:!0,value:l})}get rpcProperties(){return _classPrivateFieldGet(this,u)}}},511766:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(907823),i=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(593202));function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}var n={getIndexerTip:{method:"get_indexer_tip",paramsFormatters:[],resultFormatters:i.toTip},getCells:{method:"get_cells",paramsFormatters:[o.formatter.toGetCellsSearchKey,o.formatter.toOrder,o.formatter.toNumber,o.formatter.toOptional(o.formatter.toHash)],resultFormatters:i.toGetCellsResult},getTransactions:{method:"get_transactions",paramsFormatters:[o.formatter.toGetTransactionsSearchKey,o.formatter.toOrder,o.formatter.toNumber,o.formatter.toOptional(o.formatter.toHash)],resultFormatters:i.toGetTransactionsResult},getCellsCapacity:{method:"get_cells_capacity",paramsFormatters:[o.formatter.toSearchKey],resultFormatters:i.toCellsCapacity},getBlockFilter:{method:"get_block_filter",paramsFormatters:[o.formatter.toHash],resultFormatters:i.toNullable(i.toBlockFilter)},getTransactionAndWitnessProof:{method:"get_transaction_and_witness_proof",paramsFormatters:[o.formatter.toArray(o.formatter.toHash),o.formatter.toOptional(o.formatter.toHash)],resultFormatters:i.toTransactionAndWitnessProof},verifyTransactionAndWitnessProof:{method:"verify_transaction_and_witness_proof",paramsFormatters:[o.formatter.toTransactionAndWitnessProof],resultFormatters:i.toArray(i.toHash)},getForkBlock:{method:"get_fork_block",paramsFormatters:[o.formatter.toHash,o.formatter.toOptional(o.formatter.toNumber)],resultFormatters:i.toNullable(i.toForkBlockResult)},getBlockMedianTime:{method:"get_block_median_time",paramsFormatters:[o.formatter.toHash],resultFormatters:i.toNullable(i.toNumber)},estimateCycles:{method:"estimate_cycles",paramsFormatters:[o.formatter.toRawTransaction],resultFormatters:i.toEstimateCycles},getFeeRateStatistics:{method:"get_fee_rate_statistics",paramsFormatters:[o.formatter.toOptional(o.formatter.toNumber)],resultFormatters:i.toNullable(i.toFeeRateStatistics)},getFeeRateStatics:{method:"get_fee_rate_statics",paramsFormatters:[o.formatter.toOptional(o.formatter.toNumber)],resultFormatters:i.toNullable(i.toFeeRateStatistics)}};e.default=n},309154:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(907823),i=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(593202));function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}var n={localNodeInfo:{method:"local_node_info",paramsFormatters:[],resultFormatters:i.toLocalNodeInfo},getPeers:{method:"get_peers",paramsFormatters:[],resultFormatters:i.toPeers},getBannedAddresses:{method:"get_banned_addresses",paramsFormatters:[],resultFormatters:i.toBannedAddresses},clearBannedAddresses:{method:"clear_banned_addresses",paramsFormatters:[]},setBan:{method:"set_ban",paramsFormatters:[]},syncState:{method:"sync_state",paramsFormatters:[],resultFormatters:i.toSyncState},setNetworkActive:{method:"set_network_active",paramsFormatters:[o.formatter.toBoolean]},addNode:{method:"add_node",paramsFormatters:[]},removeNode:{method:"remove_node",paramsFormatters:[]},pingPeers:{method:"ping_peers",paramsFormatters:[]}};e.default=n},600027:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(907823),i=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(593202));function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}var n={sendTransaction:{method:"send_transaction",paramsFormatters:[o.formatter.toRawTransaction,o.formatter.toOutputsValidator],resultFormatters:i.toHash},txPoolInfo:{method:"tx_pool_info",paramsFormatters:[],resultFormatters:i.toTxPoolInfo},clearTxPool:{method:"clear_tx_pool",paramsFormatters:[]},getRawTxPool:{method:"get_raw_tx_pool",paramsFormatters:[],resultFormatters:i.toRawTxPool}};e.default=n},829862:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(593202));function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}var i={getBlockchainInfo:{method:"get_blockchain_info",paramsFormatters:[],resultFormatters:o.toBlockchainInfo},getDeploymentsInfo:{method:"get_deployments_info",paramsFormatters:[],resultFormatters:o.toDeploymentsInfo}};e.default=i},50725:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.ErrorCode=void 0;let r=function(t){return t[t.ParameterInvalid=101]="ParameterInvalid",t[t.IdNotMatch=201]="IdNotMatch",t[t.MethodNotFound=202]="MethodNotFound",t[t.PayloadMessage=203]="PayloadMessage",t[t.ResponseMessage=204]="ResponseMessage",t}({});e.ErrorCode=r;var o=r;e.default=o},377478:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.PayloadInBatchException=e.MethodInBatchNotFoundException=e.IdNotMatchedInBatchException=void 0;var o=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(r(50725)),i=r(323729);function _defineProperty(t,e,r){return(e=function _toPropertyKey(t){var e=function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const n="Batch Request";class MethodInBatchNotFoundException extends Error{constructor(t){super(`[${n}]: Method ${t} is not found`),_defineProperty(this,"code",o.default.MethodNotFound)}}e.MethodInBatchNotFoundException=MethodInBatchNotFoundException;class PayloadInBatchException extends Error{constructor(t,e){super(`[${n} ${t}]: ${e}`),_defineProperty(this,"code",o.default.PayloadMessage),this.index=t}}e.PayloadInBatchException=PayloadInBatchException;class IdNotMatchedInBatchException extends i.IdNotMatchException{constructor(t,e,r){super(e,r),this.message=`[${n} ${t}]: ${this.message}`,this.index=t}}e.IdNotMatchedInBatchException=IdNotMatchedInBatchException;var a={MethodInBatchNotFoundException,PayloadInBatchException,IdNotMatchedInBatchException};e.default=a},803380:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.StringHashTypeException=e.PageSizeTooSmallException=e.PageSizeTooLargeException=e.OutputsValidatorTypeException=e.HexStringWithout0xException=e.BigintOrHexStringTypeException=void 0;var o=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(r(50725));function _defineProperty(t,e,r){return(e=function _toPropertyKey(t){var e=function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class PageSizeTooLargeException extends RangeError{constructor(t,e){super(`Expect page size to be at most ${e}, but ${t} received`),_defineProperty(this,"code",o.default.ParameterInvalid)}}e.PageSizeTooLargeException=PageSizeTooLargeException;class PageSizeTooSmallException extends RangeError{constructor(t,e){super(`Expect page size to be at least ${e}, but ${t} received`),_defineProperty(this,"code",o.default.ParameterInvalid)}}e.PageSizeTooSmallException=PageSizeTooSmallException;class OutputsValidatorTypeException extends TypeError{constructor(){super("Expect outputs validator to be 'default' or 'passthrough'"),_defineProperty(this,"code",o.default.ParameterInvalid)}}e.OutputsValidatorTypeException=OutputsValidatorTypeException;class BigintOrHexStringTypeException extends TypeError{constructor(t){super(`Expect number to be bigint or hex string, but ${t} received`),_defineProperty(this,"code",o.default.ParameterInvalid)}}e.BigintOrHexStringTypeException=BigintOrHexStringTypeException;class StringHashTypeException extends TypeError{constructor(t){super(`Expect hash to be string, but ${t} received`),_defineProperty(this,"code",o.default.ParameterInvalid)}}e.StringHashTypeException=StringHashTypeException;class HexStringWithout0xException extends Error{constructor(t){super(`Hex string ${t} should start with 0x`),_defineProperty(this,"code",o.default.ParameterInvalid)}}e.HexStringWithout0xException=HexStringWithout0xException;var i={PageSizeTooLargeException,PageSizeTooSmallException,OutputsValidatorTypeException,BigintOrHexStringTypeException,StringHashTypeException,HexStringWithout0xException};e.default=i},409314:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r(803380);Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e&&e[t]===o[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}}))}));var i=r(323729);Object.keys(i).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e&&e[t]===i[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}}))}));var n=r(377478);Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e&&e[t]===n[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}}))}))},323729:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.ResponseException=e.IdNotMatchException=void 0;var o=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(r(50725));function _defineProperty(t,e,r){return(e=function _toPropertyKey(t){var e=function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class IdNotMatchException extends Error{constructor(t,e){super(`Expect json rpc id to be ${t}, but ${e} received`),_defineProperty(this,"code",o.default.IdNotMatch)}}e.IdNotMatchException=IdNotMatchException;class ResponseException extends Error{constructor(...t){super(...t),_defineProperty(this,"code",o.default.ResponseMessage)}}e.ResponseException=ResponseException;var i={IdNotMatchException,ResponseException};e.default=i},436115:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ResultFormatter=e.RPC=e.ParamsFormatter=e.CKBRPC=void 0;var o=r(167837),i=r(686466),n=r(907823),a=function _interopRequireWildcard(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=_getRequireWildcardCache(e);if(r&&r.has(t))return r.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=t[n]}o.default=t,r&&r.set(t,o);return o}(r(593202)),s=r(409314),c=_interopRequireDefault(r(410288)),l=_interopRequireDefault(r(167083));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _getRequireWildcardCache(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(t){return t?r:e})(t)}function _defineProperty(t,e,r){return(e=function _toPropertyKey(t){var e=function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _classPrivateFieldInitSpec(t,e,r){!function _checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,r)}function _classPrivateFieldSet(t,e,r){return function _classApplyDescriptorSet(t,e,r){if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}(t,_classExtractFieldDescriptor(t,e,"set"),r),r}function _classPrivateFieldGet(t,e){return function _classApplyDescriptorGet(t,e){if(e.get)return e.get.call(t);return e.value}(t,_classExtractFieldDescriptor(t,e,"get"))}function _classExtractFieldDescriptor(t,e,r){if(!e.has(t))throw new TypeError("attempted to "+r+" private field on non-instance");return e.get(t)}const u=n.formatter;e.ParamsFormatter=u;const p=a;e.ResultFormatter=p;var d=new WeakMap,f=new WeakMap,h=new WeakMap,g=new WeakMap;class CKBRPC extends o.Base{get node(){return _classPrivateFieldGet(this,f)}get paramsFormatter(){return _classPrivateFieldGet(this,h)}get resultFormatter(){return _classPrivateFieldGet(this,g)}constructor(t,e={}){super(),_classPrivateFieldInitSpec(this,d,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,f,{writable:!0,value:{url:""}}),_classPrivateFieldInitSpec(this,h,{writable:!0,value:n.formatter}),_classPrivateFieldInitSpec(this,g,{writable:!0,value:a}),_defineProperty(this,"addMethod",((t,e)=>{const r=new i.Method(this.node,t,e);Object.defineProperty(this,t.name,{value:r.call,enumerable:!0})})),_defineProperty(this,"createBatchRequest",((t=[])=>{const e=this,r=new Proxy([],{set(...t){const r=Object.keys(e);if("length"!==t[1]){var o;const e=null==t||null===(o=t[2])||void 0===o?void 0:o[0];if(-1===r.indexOf(e))throw new s.MethodInBatchNotFoundException(e)}return Reflect.set(...t)}});return Object.defineProperties(r,{add:{value(...t){return this.push(t),this}},remove:{value(t){return this.splice(t,1),this}},exec:{async value(){const t=r.map((([t,...r],o)=>{try{return new i.Method(e.node,{...e.rpcProperties[t],name:t}).getPayload(...r)}catch(t){throw new s.PayloadInBatchException(o,t.message)}})),o=new l.default,n=o.signal,a=setTimeout((()=>o.abort()),_classPrivateFieldGet(e,d).timeout),c=await _classPrivateFieldGet(e,d).fetch(_classPrivateFieldGet(e,f).url,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t),signal:n}).then((t=>t.json()));return clearTimeout(a),c.map(((o,i)=>{var n,a,c;return o.id!==t[i].id?new s.IdNotMatchedInBatchException(i,t[i].id,o.id):null!==(n=null===(a=(c=e.rpcProperties[r[i][0]]).resultFormatters)||void 0===a?void 0:a.call(c,o.result))&&void 0!==n?n:o.result}))}}}),t.forEach((t=>r.push(t))),r})),this.setNode({url:t});const{timeout:r=3e4,fetch:o=c.default}=e;_classPrivateFieldSet(this,d,{timeout:r,fetch:o}),Object.defineProperties(this,{addMethod:{value:this.addMethod,enumerable:!1,writable:!1,configurable:!1},setNode:{value:this.setNode,enumerable:!1,writable:!1,configurable:!1}}),Object.keys(this.rpcProperties).forEach((t=>{this.addMethod({name:t,...this.rpcProperties[t]},_classPrivateFieldGet(this,d))}))}setNode(t){return Object.assign(this.node,t),this.node}}e.RPC=e.CKBRPC=CKBRPC},686466:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Method=void 0;var o=r(409314),i=_interopRequireDefault(r(167083)),n=_interopRequireDefault(r(410288));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,e,r){return(e=function _toPropertyKey(t){var e=function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _classPrivateFieldInitSpec(t,e,r){!function _checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,r)}function _classPrivateFieldSet(t,e,r){return function _classApplyDescriptorSet(t,e,r){if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}(t,_classExtractFieldDescriptor(t,e,"set"),r),r}function _classPrivateFieldGet(t,e){return function _classApplyDescriptorGet(t,e){if(e.get)return e.get.call(t);return e.value}(t,_classExtractFieldDescriptor(t,e,"get"))}function _classExtractFieldDescriptor(t,e,r){if(!e.has(t))throw new TypeError("attempted to "+r+" private field on non-instance");return e.get(t)}var a=new WeakMap,s=new WeakMap,c=new WeakMap,l=new WeakMap;e.Method=class Method{get name(){return _classPrivateFieldGet(this,a)}constructor(t,e,r={}){_classPrivateFieldInitSpec(this,a,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,s,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,c,{writable:!0,value:{name:"",method:"",paramsFormatters:[],resultFormatters:void 0}}),_classPrivateFieldInitSpec(this,l,{writable:!0,value:void 0}),_defineProperty(this,"call",(async(...t)=>{const e=this.getPayload(...t),r=new i.default,n=r.signal,a=setTimeout((()=>r.abort()),_classPrivateFieldGet(this,s).timeout),u=await _classPrivateFieldGet(this,s).fetch(_classPrivateFieldGet(this,l).url,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e),signal:n}).then((t=>t.json())).then((t=>{var r,i,n;if(t.id!==e.id)throw new o.IdNotMatchException(e.id,t.id);if(t.error)throw new o.ResponseException(JSON.stringify(t.error));return null!==(r=null===(i=(n=_classPrivateFieldGet(this,c)).resultFormatters)||void 0===i?void 0:i.call(n,t.result))&&void 0!==r?r:t.result}));return clearTimeout(a),u})),_defineProperty(this,"getPayload",((...t)=>{const e=t.map(((t,e)=>_classPrivateFieldGet(this,c).paramsFormatters[e]&&_classPrivateFieldGet(this,c).paramsFormatters[e](t)||t));return{id:Math.round(1e4*Math.random()),method:_classPrivateFieldGet(this,c).method,params:e,jsonrpc:"2.0"}})),_classPrivateFieldSet(this,l,t),_classPrivateFieldSet(this,c,e),_classPrivateFieldSet(this,a,e.name);const{timeout:u=3e4,fetch:p=n.default}=r;_classPrivateFieldSet(this,s,{timeout:u,fetch:p}),Object.defineProperty(this.call,"name",{value:e.name,configurable:!1,writable:!1})}}},907823:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.formatter=void 0;var o=r(409314),i=r(739609);const n={toOptional:t=>e=>t&&null!=e?t(e):e,toArray:t=>e=>"function"==typeof t&&Array.isArray(e)?e.map(t):e,toHash:t=>{if("string"!=typeof t)throw new o.StringHashTypeException(t);return t.startsWith("0x")?t:`0x${t}`},toNumber:t=>{if("bigint"==typeof t)return`0x${t.toString(16)}`;if("string"!=typeof t)throw new o.BigintOrHexStringTypeException(t);if(!t.startsWith("0x"))throw new o.HexStringWithout0xException(t);return t},toScript:t=>{const{codeHash:e,hashType:r,...o}=t;return{code_hash:n.toHash(e),hash_type:r,...o}},toOutPoint:t=>{const{txHash:e,index:r,...o}=t;return{tx_hash:n.toHash(e),index:n.toNumber(r),...o}},toInput:t=>{if(!t)return t;const{previousOutput:e,since:r,...o}=t;return{previous_output:n.toOutPoint(e),since:n.toNumber(r),...o}},toOutput:t=>{if(!t)return t;const{capacity:e,lock:r,type:o,...i}=t;return{capacity:n.toNumber(e),lock:n.toScript(r),type:o?n.toScript(o):o,...i}},toDepType:t=>"depGroup"===t?"dep_group":t,toOrder:t=>t,toCellDep:t=>{if(!t)return t;const{outPoint:e,depType:r="code",...o}=t;return{out_point:n.toOutPoint(e),dep_type:n.toDepType(r),...o}},toRawTransaction:t=>{if(!t)return t;const{version:e,cellDeps:r=[],inputs:o=[],outputs:i=[],outputsData:a=[],headerDeps:s=[],...c}=t,l=o.map((t=>n.toInput(t))),u=i.map((t=>n.toOutput(t))),p=r.map((t=>n.toCellDep(t)));return{version:n.toNumber(e),cell_deps:p,inputs:l,outputs:u,outputs_data:a,header_deps:s,...c}},toPageNumber:(t="0x1")=>n.toNumber(t),toPageSize:(t="0x32")=>{const e=i.BI.from(t);if(i.BI.from(e).gt(50))throw new o.PageSizeTooLargeException(t,50);if(i.BI.from(e).lt(0))throw new o.PageSizeTooSmallException(t,0);return n.toNumber(`0x${e.toString(16)}`)},toReverseOrder:(t=!1)=>!!t,toOutputsValidator:t=>{if(!t)return;if(["default","passthrough"].indexOf(t)>-1)return t;throw new o.OutputsValidatorTypeException},toBoolean:t=>!!t,toTransactionProof:t=>{if(!t)return t;const{blockHash:e,witnessesRoot:r,...o}=t;return{block_hash:e,witnesses_root:r,...o}},toTransactionAndWitnessProof:t=>({block_hash:t.blockHash,witnesses_proof:t.witnessesProof,transactions_proof:t.transactionsProof}),toSearchFilter:t=>t?{script:t.script?n.toScript(t.script):t.script,output_data_len_range:t.outputDataLenRange,output_capacity_range:t.outputCapacityRange,block_range:t.blockRange,script_len_range:t.scriptLenRange}:t,toSearchKey:t=>t?{script:n.toScript(t.script),script_type:t.scriptType,filter:t.filter?n.toSearchFilter(t.filter):t.filter,script_search_mode:t.scriptSearchMode?t.scriptSearchMode:"prefix"}:t,toGetCellsSearchKey:t=>t?{...n.toSearchKey(t),with_data:t.withData}:t,toGetTransactionsSearchKey:t=>t?{...n.toSearchKey(t),group_by_transaction:t.groupByTransaction}:t};e.formatter=n},593202:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toBannedAddresses=e.toBannedAddress=e.toArray=e.toAlertMessage=void 0,e.toBlock=function toBlock(t){if(!t)return t;if("string"==typeof t)return t;if("block"in t&&"cycles"in t)return{cycles:t.cycles,block:toBlock(t.block)};const{header:e,uncles:r=[],transactions:o=[],...i}=t;return{header:toHeader(e),uncles:r.map(toUncleBlock),transactions:o.map(toTransaction),...i}},e.toHash=e.toGetTransactionsResult=e.toGetCellsResult=e.toForkBlockResult=e.toFeeRateStatistics=e.toFeeRate=e.toEstimateCycles=e.toEpoch=e.toDeploymentsInfo=e.toDeploymentInfo=e.toDeployment=e.toDeployState=e.toDepType=e.toConsensus=e.toCellsIncludingOutPoint=e.toCellsCapacity=e.toCells=e.toCellbaseOutputCapacityDetails=e.toCellIncludingOutPoint=e.toCellDep=e.toCell=e.toCapacityByLockHash=e.toBlockchainInfo=e.toBlockFilter=e.toBlockEconomicState=void 0,e.toHeader=toHeader,e.toTip=e.toSyncState=e.toScript=e.toRemoteNodeInfo=e.toRawTxPool=e.toPeers=e.toOutput=e.toOutPoint=e.toNumber=e.toNullable=e.toLockHashIndexStates=e.toLockHashIndexState=e.toLocalNodeInfo=e.toLiveCellsByLockHash=e.toLiveCellWithStatus=e.toLiveCell=e.toInput=void 0,e.toTransaction=toTransaction,e.toUncleBlock=e.toTxPoolInfo=e.toTransactionsByLockHash=e.toTransactionWithStatus=e.toTransactionProof=e.toTransactionPoint=e.toTransactionAndWitnessProof=void 0;e.toArray=t=>e=>"function"==typeof t&&Array.isArray(e)?e.map(t):e;e.toNullable=t=>e=>t&&null!==e?t(e):e;e.toNumber=t=>t.toString();function toHeader(t){if("string"==typeof t)return t;if(!t)return t;const{compact_target:e,transactions_root:r,proposals_hash:o,extra_hash:i,parent_hash:n,...a}=t;return{compactTarget:e,parentHash:n,transactionsRoot:r,proposalsHash:o,extraHash:i,...a}}e.toHash=t=>t;const toScript=t=>{if(!t)return t;const{code_hash:e,hash_type:r,...o}=t;return{codeHash:e,hashType:r,...o}};e.toScript=toScript;const toInput=t=>{if(!t)return t;const{previous_output:e,...r}=t;return{previousOutput:e?toOutPoint(e):e,...r}};e.toInput=toInput;const toOutput=t=>{if(!t)return t;const{lock:e,type:r,...o}=t;return{lock:toScript(e),type:r?toScript(r):r,...o}};e.toOutput=toOutput;const toOutPoint=t=>{const{tx_hash:e,...r}=t;return{txHash:e,...r}};e.toOutPoint=toOutPoint;const toDepType=t=>"dep_group"===t?"depGroup":t;e.toDepType=toDepType;const toCellDep=t=>{if(!t)return t;const{out_point:e,dep_type:r="code",...o}=t;return{outPoint:toOutPoint(e),depType:toDepType(r),...o}};function toTransaction(t){if(!t||"object"!=typeof t)return t;const{cell_deps:e=[],inputs:r=[],outputs:o=[],outputs_data:i=[],header_deps:n=[],...a}=t;return{cellDeps:e.map(toCellDep),inputs:r.map(toInput),outputs:o.map(toOutput),outputsData:i,headerDeps:n,...a}}e.toCellDep=toCellDep;const toUncleBlock=t=>{if(!t)return t;const{header:e,...r}=t;return{header:toHeader(e),...r}};e.toUncleBlock=toUncleBlock;e.toTip=t=>({blockHash:t.block_hash,blockNumber:t.block_number});const toAlertMessage=t=>{if(!t)return t;const{notice_until:e,...r}=t;return{noticeUntil:e,...r}};e.toAlertMessage=toAlertMessage;e.toBlockchainInfo=t=>{if(!t)return t;const{is_initial_block_download:e,median_time:r,alerts:o,...i}=t;return{isInitialBlockDownload:e,medianTime:r,alerts:o.map(toAlertMessage),...i}};e.toLocalNodeInfo=t=>{if(!t)return t;const{node_id:e,protocols:r,...o}=t;return{nodeId:e,protocols:r.map((({id:t,name:e,support_versions:r})=>({id:t,name:e,supportVersions:r}))),...o}};const toRemoteNodeInfo=t=>{if(!t)return t;const{node_id:e,connected_duration:r,is_outbound:o,last_ping_duration:i,sync_state:n,...a}=t;return{nodeId:e,connectedDuration:r,isOutbound:o,lastPingDuration:i,syncState:{bestKnownHeaderHash:n.best_known_header_hash,bestKnownHeaderNumber:n.best_known_header_number,canFetchCount:n.can_fetch_count,inflightCount:n.inflight_count,lastCommonHeaderHash:n.last_common_header_hash,lastCommonHeaderNumber:n.last_common_header_number,unknownHeaderListSize:n.unknown_header_list_size},...a}};e.toRemoteNodeInfo=toRemoteNodeInfo;e.toTxPoolInfo=t=>{if(!t)return t;const{last_txs_updated_at:e,tip_hash:r,tip_number:o,total_tx_cycles:i,total_tx_size:n,min_fee_rate:a,...s}=t;return{lastTxsUpdatedAt:e,tipHash:r,tipNumber:o,totalTxCycles:i,totalTxSize:n,minFeeRate:a,...s}};e.toPeers=t=>Array.isArray(t)?t.map(toRemoteNodeInfo):[];const toCell=t=>{if(!t)return t;const{lock:e,type:r,...o}=t;return{lock:toScript(e),type:r?toScript(r):void 0,...o}};e.toCell=toCell;const toLiveCell=t=>{if(!t)return t;const{data:e,output:r,...o}=t;return{data:e,output:toOutput(r),...o}};e.toLiveCell=toLiveCell;e.toLiveCellWithStatus=t=>{if(!t)return t;const{cell:e,...r}=t;return{cell:toLiveCell(e),...r}};e.toCells=t=>Array.isArray(t)?t.map(toCell):[];const toCellIncludingOutPoint=t=>{if(!t)return t;const{lock:e,block_hash:r,out_point:o,output_data_len:i,...n}=t;return{blockHash:r,lock:toScript(e),outPoint:toOutPoint(o),outputDataLen:i,...n}};e.toCellIncludingOutPoint=toCellIncludingOutPoint;e.toCellsIncludingOutPoint=t=>Array.isArray(t)?t.map(toCellIncludingOutPoint):[];e.toTransactionWithStatus=t=>{if(!t)return t;const{transaction:e,tx_status:{block_hash:r,status:o},time_added_to_pool:i,...n}=t;return{transaction:toTransaction(e),txStatus:{blockHash:r,status:o,..."reason"in t.tx_status?{reason:t.tx_status.reason}:{}},timeAddedToPool:i,...n}};e.toEpoch=t=>{if(!t)return t;const{start_number:e,compact_target:r,...o}=t;return{compactTarget:r,startNumber:e,...o}};const toTransactionPoint=t=>{if(!t)return t;const{block_number:e,tx_hash:r,...o}=t;return{blockNumber:e,txHash:r,...o}};e.toTransactionPoint=toTransactionPoint;e.toTransactionsByLockHash=t=>t?t.map((t=>({consumedBy:t.consumed_by?toTransactionPoint(t.consumed_by):t.consumed_by,createdBy:toTransactionPoint(t.created_by)}))):t;e.toLiveCellsByLockHash=t=>t?t.map((t=>({cellOutput:toCell(t.cell_output),createdBy:toTransactionPoint(t.created_by),cellbase:t.cellbase,outputDataLen:t.output_data_len}))):t;const toLockHashIndexState=t=>{if(!t)return t;const{block_hash:e,block_number:r,lock_hash:o,...i}=t;return{blockHash:e,blockNumber:r,lockHash:o,...i}};e.toLockHashIndexState=toLockHashIndexState;e.toLockHashIndexStates=t=>t?t.map(toLockHashIndexState):t;const toBannedAddress=t=>{if(!t)return t;const{ban_reason:e,ban_until:r,created_at:o,...i}=t;return{banReason:e,banUntil:r,createdAt:o,...i}};e.toBannedAddress=toBannedAddress;e.toBannedAddresses=t=>t?t.map((t=>toBannedAddress(t))):t;e.toCellbaseOutputCapacityDetails=t=>{if(!t)return t;const{proposal_reward:e,tx_fee:r,...o}=t;return{proposalReward:e,txFee:r,...o}};e.toFeeRate=t=>{if(!t)return t;const{fee_rate:e,...r}=t;return{feeRate:e,...r}};e.toCapacityByLockHash=t=>{if(!t)return t;const{cells_count:e,block_number:r,capacity:o,...i}=t;return{blockNumber:r,capacity:o,cellsCount:e,...i}};e.toBlockEconomicState=t=>{if(!t)return t;const{finalized_at:e,miner_reward:r,txs_fee:o,...i}=t;return{finalizedAt:e,minerReward:r,txsFee:o,...i}};e.toSyncState=t=>t?{bestKnownBlockNumber:t.best_known_block_number,bestKnownBlockTimestamp:t.best_known_block_timestamp,fastTime:t.fast_time,ibd:t.ibd,inflightBlocksCount:t.inflight_blocks_count,lowTime:t.low_time,normalTime:t.normal_time,orphanBlocksCount:t.orphan_blocks_count}:t;e.toTransactionProof=t=>{if(!t)return t;const{block_hash:e,witnesses_root:r,...o}=t;return{blockHash:e,witnessesRoot:r,...o}};const toHardforkFeature=t=>({rfc:t.rfc,epochNumber:t.epoch_number}),toDeployment=t=>({bit:t.bit,start:t.start,timeout:t.timeout,minActivationEpoch:t.min_activation_epoch,period:t.period,threshold:t.threshold});e.toDeployment=toDeployment;const toSoftFork=t=>"rfc0043"in t?{status:t.status,rfc0043:toDeployment(t.rfc0043)}:t;e.toConsensus=t=>{if(!t)return t;const e=t.hardfork_features,r=t.softforks,o=r.light_client&&toSoftFork(r.light_client),i=r.testdummy&&toSoftFork(r.testdummy);return{blockVersion:t.block_version,cellbaseMaturity:t.cellbase_maturity,daoTypeHash:t.dao_type_hash,epochDurationTarget:t.epoch_duration_target,genesisHash:t.genesis_hash,id:t.id,initialPrimaryEpochReward:t.initial_primary_epoch_reward,maxBlockBytes:t.max_block_bytes,maxBlockCycles:t.max_block_cycles,maxBlockProposalsLimit:t.max_block_proposals_limit,maxUnclesNum:t.max_uncles_num,medianTimeBlockCount:t.median_time_block_count,orphanRateTarget:t.orphan_rate_target,permanentDifficultyInDummy:t.permanent_difficulty_in_dummy,primaryEpochRewardHalvingInterval:t.primary_epoch_reward_halving_interval,proposerRewardRatio:t.proposer_reward_ratio,secondaryEpochReward:t.secondary_epoch_reward,secp256k1Blake160MultisigAllTypeHash:t.secp256k1_blake160_multisig_all_type_hash,secp256k1Blake160SighashAllTypeHash:t.secp256k1_blake160_sighash_all_type_hash,txProposalWindow:t.tx_proposal_window,txVersion:t.tx_version,typeIdCodeHash:t.type_id_code_hash,hardforkFeatures:e.map(toHardforkFeature),softforks:{...o&&{lightClient:o},...i&&{testdummy:i}}}};e.toRawTxPool=t=>{if(!t)return t;if((t=>Array.isArray(t.pending))(t))return t;const toTxVerbosity=({ancestors_count:t,ancestors_cycles:e,ancestors_size:r,...o})=>({ancestorsCount:t,ancestorsCycles:e,ancestorsSize:r,...o}),e={},r={};return Object.keys(t.proposed).forEach((r=>{e[r]=toTxVerbosity(t.proposed[r])})),Object.keys(t.pending).forEach((e=>{r[e]=toTxVerbosity(t.pending[e])})),{proposed:e,pending:r}};e.toGetCellsResult=t=>({lastCursor:t.last_cursor,objects:t.objects.map((t=>{return(e=t)?{blockNumber:e.block_number,outPoint:toOutPoint(e.out_point),output:toOutput(e.output),outputData:e.output_data,txIndex:e.tx_index}:e;var e}))});e.toGetTransactionsResult=t=>t?{lastCursor:t.last_cursor,objects:t.objects.map((t=>{return(e=t)?e.cells?{txHash:e.tx_hash,txIndex:e.tx_index,blockNumber:e.block_number,cells:e.cells}:{txHash:e.tx_hash,blockNumber:e.block_number,ioIndex:e.io_index,ioType:e.io_type,txIndex:e.tx_index}:e;var e}))}:t;e.toCellsCapacity=t=>t?{capacity:t.capacity,blockHash:t.block_hash,blockNumber:t.block_number}:t;e.toBlockFilter=t=>({hash:t.hash,data:t.data});e.toTransactionAndWitnessProof=t=>({blockHash:t.block_hash,transactionsProof:t.transactions_proof,witnessesProof:t.witnesses_proof});e.toFeeRateStatistics=t=>({mean:t.mean,median:t.median});e.toForkBlockResult=t=>"string"==typeof t?t:{header:toHeader(t.header),uncles:t.uncles.map(toUncleBlock),transactions:t.transactions.map(toTransaction),proposals:t.proposals,extension:t.extension};e.toEstimateCycles=t=>({cycles:t.cycles});const toDeployState=t=>"locked_in"===t?"lockedIn":t;e.toDeployState=toDeployState;const toDeploymentInfo=t=>({bit:t.bit,start:t.start,timeout:t.timeout,minActivationEpoch:t.min_activation_epoch,period:t.period,threshold:t.threshold,since:t.since,state:toDeployState(t.state)});e.toDeploymentInfo=toDeploymentInfo;e.toDeploymentsInfo=t=>{const{light_client:e,testdummy:r}=t.deployments;return{hash:t.hash,epoch:t.epoch,deployments:{...e?{lightClient:toDeploymentInfo(e)}:{},...r?{testdummy:toDeploymentInfo(r)}:{}}}}},167083:t=>{"use strict";const{AbortController:e,AbortSignal:r}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;t.exports=e,t.exports.AbortSignal=r,t.exports.default=e},90366:t=>{var e=10,r=41,o=107,i=9,n=25,a=10;function inputBytes(t){return r+(t.script?t.script.length:o)}function outputBytes(t){return t.script?a+t.script.length+(t.script.length>=74?2:1):i+(t.script?t.script.length:n)}function dustThreshold(t,e){return 3*inputBytes({})}function transactionBytes(t,r){return e+t.reduce((function(t,e){return t+inputBytes(e)}),0)+r.reduce((function(t,e){return t+outputBytes(e)}),0)}function uintOrNaN(t){return"number"!=typeof t?NaN:isFinite(t)?Math.floor(t)!==t||t<0?NaN:t:NaN}function sumOrNaN(t){return t.reduce((function(t,e){return t+uintOrNaN(e.value)}),0)}var s=outputBytes({});t.exports={dustThreshold,finalize:function finalize(t,e,r){var o=transactionBytes(t,e),i=r*(o+s),n=sumOrNaN(t)-(sumOrNaN(e)+i);n>dustThreshold()&&(e=e.concat({value:n}));var a=sumOrNaN(t)-sumOrNaN(e);return isFinite(a)?{inputs:t,outputs:e,fee:a}:{fee:r*o}},inputBytes,outputBytes,sumOrNaN,sumForgiving:function sumForgiving(t){return t.reduce((function(t,e){return t+(isFinite(e.value)?e.value:0)}),0)},transactionBytes,uintOrNaN}}}]);