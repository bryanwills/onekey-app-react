(self.webpackChunkweb=self.webpackChunkweb||[]).push([[18528],{567967:(e,t,n)=>{"use strict";n.d(t,{Xp:()=>r.Xp,yZ:()=>useBrowserAction,Gd:()=>useBrowserBookmarkAction,cS:()=>useBrowserHistoryAction,AO:()=>useBrowserTabActions,AS:()=>r.AS,Do:()=>r.Do,pJ:()=>r.pJ,nD:()=>r.nD});var r=n(603614),o=n(586330),a=n(324586),i=n(946343),c=n.n(i),s=n(230414),u=n(929296),l=n(195309),d=n(972715),p=n(514041),f=n(490343),b=n(310955),m=n(262873),y=n(714178),A=n(971670),v=n(660015),g=n(849726),w=(n(663522),n(730223),n(657355)),k=n(482407),h=n(796151),D=function(e){return e.Valid="Valid",e.InvalidUrl="InvalidUrl",e.NotSupportProtocol="NotSupportProtocol",e.ValidDeeplink="ValidDeeplink",e.InvalidPunycode="InvalidPunycode",e}({});function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var n,r=(0,d.A)(e);if(t){var o=(0,d.A)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,l.A)(this,n)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}var I={};var S="about:blank",W={id:"home",url:S,title:"OneKey",canGoBack:!1,loading:!1,favicon:""},B=function(e){(0,u.A)(ContextJotaiActionsDiscovery,e);var t=_createSuper(ContextJotaiActionsDiscovery);function ContextJotaiActionsDiscovery(...e){var n,a,i,s,u,l,d,p,y;return(n=t.call(this,...e)).setDisplayHomePage=(0,r.q0)((function(e,t,n){t((0,r.QL)(),n)})),n.buildWebTabs=(0,r.q0)((function(e,t,n){var o=e((0,r.cl)()),{data:a,options:i}=n,s=a;if(!Array.isArray(a))throw new Error("setWebTabsWriteAtom: payload must be an array");s&&s.length||(s=[]);var u=function buildWebTabData(e){var t={},n=[];return e.sort((function(e,t){return e.timestamp&&t.timestamp?e.timestamp-t.timestamp:0})),e.forEach((function(e){n.push(e.id),t[e.id]=e})),{data:e,keys:n,map:t}}(s);c()(u.keys,o.keys)&&!i?.forceUpdate||t((0,r.cl)(),{keys:u.keys,tabs:u.data}),t((0,r.GW)(),(function(){return u.map})),b.A.simpleDb.browserTabs.setRawData({tabs:u.data})})),n.refreshTabs=(0,r.q0)((function(e,t){var{tabs:o}=e((0,r.cl)()),a=[...o];n.buildWebTabs.call(t,{data:a,options:{forceUpdate:!0}})})),n.setCurrentWebTab=(0,r.q0)((function(e,t,o){var a=e((0,r.WL)());if(a!==o){n.pauseDappInteraction.call(t,a);var{tabs:i}=e((0,r.cl)()),c=i.findIndex((function(e){return e.id===o}));i.forEach((function(e){e.isActive=!1})),n.buildWebTabs.call(t,{data:[...i]}),-1!==c?(i[c].isActive=!0,t((0,r.WL)(),o),n.resumeDappInteraction.call(t,o)):t((0,r.WL)(),"")}var s=e((0,r.QL)());o&&s&&n.setDisplayHomePage.call(t,!1),o||s||n.setDisplayHomePage.call(t,!0)})),n.addWebTab=(0,r.q0)((function(e,t,o){var a,i=performance.now(),{tabs:c}=e((0,r.cl)());o.id&&o.id!==W.id||(o.id=(0,k.lk)()),o.timestamp=Date.now(),n.buildWebTabs.call(t,{data:[...c,o]}),n.setCurrentWebTab.call(t,null!=(a=o.id)?a:"");var s=performance.now();console.log(`addBlankWebTab took ${s-i} milliseconds.`)})),n.addBlankWebTab=(0,r.q0)((function(e,t){n.addWebTab.call(t,_objectSpread(_objectSpread({},W),{},{isActive:!0}))})),n.setWebTabData=(0,r.q0)((function(e,t,o){var{tabs:a}=e((0,r.cl)()),i=a,c=i.findIndex((function(e){return e.id===o.id}));if(c>-1){var s=i[c];Object.keys(o).forEach((function(e){var t=e,n=o[t];if(void 0!==n&&n!==s[t]){if("title"===t&&!n)return;s[t]=n,"url"===t&&(s.timestamp=Date.now(),"about:blank"===n&&o.id&&(I[o.id]=s.timestamp))}})),i[c]=s,n.buildWebTabs.call(t,{data:i})}})),n.closeWebTab=(0,r.q0)((function(e,t,o){delete v.O3[o];var{tabs:a}=e((0,r.cl)()),i=e((0,r.WL)()),c=a.findIndex((function(e){return e.id===o}));if(-1!==c){var s=a[c].id===i;if(a.splice(c,1),s){var u=c-1;if(u<0&&a.length>0&&(u=0),u>=0){var l=a[u];l.isActive=!0,n.setCurrentWebTab.call(t,l.id)}}}n.buildWebTabs.call(t,{data:[...a]})})),n.closeAllWebTabs=(0,r.q0)((function(e,t){var{tabs:o}=e((0,r.cl)()),a=e((0,r.WL)()),i=o.filter((function(e){return e.isPinned}));i.every((function(e){return e.id!==a}))&&n.setCurrentWebTab.call(t,null);var _loop=function(e){i.find((function(t){return t.id===e}))||delete v.O3[e]};for(var c of Object.getOwnPropertyNames(v.O3))_loop(c);n.buildWebTabs.call(t,{data:i})})),n.setPinnedTab=(0,r.q0)((function(e,t,r){n.setWebTabData.call(t,{id:r.id,isPinned:r.pinned,timestamp:Date.now()}),n.refreshTabs.call(t)})),n.syncBookmark=(0,r.q0)((function(e,t,o){var a=e((0,r.GW)());a&&Object.entries(a).forEach((function([,e]){e.url===o.url&&n.setWebTabData.call(t,{id:e.id,isBookmark:o.isBookmark})}))})),n.getBookmarkData=(0,r.q0)((0,o.A)((function*(){var e;return null!=(e=(yield b.A.simpleDb.browserBookmarks.getRawData())?.data)?e:[]}))),n.buildBookmarkData=(0,r.q0)((function(e,t,n){if(!Array.isArray(n))throw new Error("buildBookmarkData: payload must be an array");b.A.simpleDb.browserBookmarks.setRawData({data:n})})),n.addBrowserBookmark=(0,r.q0)((a=(0,o.A)((function*(e,t,r){if(r.url&&r.url!==W.url){var o=[...(yield n.getBookmarkData.call(t)).filter((function(e){return e.url!==r.url})),{url:r.url,title:r.title}];n.buildBookmarkData.call(t,o),n.syncBookmark.call(t,{url:r.url,isBookmark:!0}),b.A.serviceCloudBackup.requestAutoBackup()}})),function(e,t,n){return a.apply(this,arguments)})),n.removeBrowserBookmark=(0,r.q0)((i=(0,o.A)((function*(e,t,r){var o=(yield n.getBookmarkData.call(t)).filter((function(e){return e.url!==r}));n.buildBookmarkData.call(t,o),n.syncBookmark.call(t,{url:r,isBookmark:!1})})),function(e,t,n){return i.apply(this,arguments)})),n.modifyBrowserBookmark=(0,r.q0)((s=(0,o.A)((function*(e,t,r){if(r.url&&r.url!==W.url){var o=(yield n.getBookmarkData.call(t)).map((function(e){return e.url===r.url?_objectSpread(_objectSpread({},e),r):e}));n.buildBookmarkData.call(t,o)}})),function(e,t,n){return s.apply(this,arguments)})),n.getHistoryData=(0,r.q0)((0,o.A)((function*(){var e;return null!=(e=(yield b.A.simpleDb.browserHistory.getRawData())?.data)?e:[]}))),n.buildHistoryData=(0,r.q0)((function(e,t,n){if(!Array.isArray(n))throw new Error("buildHistoryData: payload must be an array");b.A.simpleDb.browserHistory.setRawData({data:n})})),n.addBrowserHistory=(0,r.q0)((u=(0,o.A)((function*(e,t,r){if(r.url&&r.url!==W.url){var o=(yield n.getHistoryData.call(t)).filter((function(e){return e.url!==r.url})),a={id:(0,k.lk)(),url:r.url,title:r.title,createdAt:Date.now()};n.buildHistoryData.call(t,[a,...o])}})),function(e,t,n){return u.apply(this,arguments)})),n.removeBrowserHistory=(0,r.q0)((l=(0,o.A)((function*(e,t,r){var o=(yield n.getHistoryData.call(t)).filter((function(e){return e.id!==r}));n.buildHistoryData.call(t,o)})),function(e,t,n){return l.apply(this,arguments)})),n.removeAllBrowserHistory=(0,r.q0)((d=(0,o.A)((function*(e,t){n.buildHistoryData.call(t,[])})),function(e,t){return d.apply(this,arguments)})),n.getWebTabById=(0,r.q0)((function(e,t,n){var o=e((0,r.GW)());return o?.[n||""]})),n.gotoSite=(0,r.q0)((p=(0,o.A)((function*(e,t,{id:r,url:o,title:a,favicon:i,isNewWindow:c,isInPlace:s,userTriggered:u}){var l=n.getWebTabById.call(t,null!=r?r:"");if(o){var d=h.Ay.validateUrl(o);if(!d)return;if(u&&n.addBrowserHistory.call(t,{url:d,title:null!=a?a:""}),"StandardBrowser"===v.n5)return(0,A.C)(d);var p=l?.id,f=!d.startsWith("http")&&"about:blank"!==d,b="boolean"==typeof c?c:(c||!p||"home"===p||f)&&"MultiTabBrowser"===v.n5,m=yield n.getBookmarkData.call(t),y=m?.some((function(e){return e.url.includes(d)}));return b?n.addWebTab.call(t,{title:a,url:d,favicon:i,isBookmark:y}):n.setWebTabData.call(t,{id:p,url:d,title:a,favicon:i,isBookmark:y}),b||s||(0,v.T0)({url:d,tabId:p}),f&&"MultiTabBrowser"===v.n5&&p&&setTimeout((function(){n.closeWebTab.call(t,p)}),1e3),!0}return!1})),function(e,t,n){return p.apply(this,arguments)})),n.openMatchDApp=(0,r.q0)((y=(0,o.A)((function*(e,t,{dApp:r,webSite:o,isNewWindow:a,tabId:i}){return o?n.gotoSite.call(t,{id:i,url:o.url,title:o.title,favicon:yield b.A.serviceDiscovery.buildWebsiteIconUrl(o.url),isNewWindow:a,userTriggered:!0}):r?n.gotoSite.call(t,{id:i,url:r.url,title:r.name,dAppId:r.dappId,favicon:r.logo||r.originLogo,userTriggered:!0,isNewWindow:a}):void 0})),function(e,t,n){return y.apply(this,arguments)})),n.handleOpenWebSite=(0,r.q0)((function(e,t,{useCurrentWindow:o,tabId:a,navigation:i,webSite:c,dApp:s,shouldPopNavigation:u=!0}){var l=!o;if(!o&&e((0,r.$D)()))return void f.Toast.message({title:g.a.intl.formatMessage({id:"msg__tab_has_reached_the_maximum_limit_of_str"},{0:"20"})});n.setDisplayHomePage.call(t,!1),n.openMatchDApp.call(t,{webSite:c,dApp:s,isNewWindow:l,tabId:a}),u&&i.pop()})),n.onNavigation=(0,r.q0)((function(e,t,{url:o,isNewWindow:a,isInPlace:i,title:c,favicon:s,canGoBack:u,canGoForward:l,loading:d,id:p,handlePhishingUrl:f}){var b=Date.now(),y=n.getWebTabById.call(t,null!=p?p:"");if(y){var A="string"==typeof o&&o!==y.url;if(o){var v=e((0,r.RY)()),{action:g}=h.Ay.parseDappRedirect(o,Array.from(v.keys()));if(g===h.Ay.EDAppOpenActionEnum.DENY)return void f?.(o);if(h.Ay.isValidDeepLink(o))return void(0,m.q)({url:o})}if(A){if(y.timestamp&&b-y.timestamp<500)return;if(I[y.id]&&o!==W.url&&b-I[y.id]<1e3)return;n.gotoSite.call(t,{url:o,title:c,favicon:s,isNewWindow:a,isInPlace:i,id:y.id})}n.setWebTabData.call(t,{id:y.id,title:c,favicon:s,canGoBack:u,canGoForward:l,loading:d})}})),n.addUrlToPhishingCache=(0,r.q0)((function(e,t,n){try{var{origin:o}=new URL(n.url),a=e((0,r.RY)());a.set(o,!0),t((0,r.RY)(),a),window.desktopApi?.setAllowedPhishingUrls(Array.from(a.keys()))}catch{}})),n.updateDappActivityInteraction=(0,r.q0)((function(e,t,n){var o=n.id;o||(o=e((0,r.WL)()));var a=o?v.O3[o]:null;if(a){var i="pause"===n.type;i?v.ay:v.F;a.jsBridge&&(a.jsBridge.globalOnMessageEnabled=!i)}})),n.pauseDappInteraction=(0,r.q0)((function(e,t,r){n.updateDappActivityInteraction.call(t,{id:r,type:"pause"})})),n.resumeDappInteraction=(0,r.q0)((function(e,t,r){n.updateDappActivityInteraction.call(t,{id:r,type:"resume"})})),n.validateWebviewSrc=(0,r.q0)((function(e,t,n){if(!n)return D.InvalidUrl;if(n===S)return D.Valid;var o=e((0,r.RY)()),{action:a}=h.Ay.parseDappRedirect(n,Array.from(o.keys()));return a===h.Ay.EDAppOpenActionEnum.DENY?D.NotSupportProtocol:h.Ay.containsPunycode(n)?D.InvalidPunycode:h.Ay.isValidDeepLink(n)?D.ValidDeeplink:D.Valid})),n}return(0,s.A)(ContextJotaiActionsDiscovery)}(y.x),T=(0,w.j)((function(){return console.log("new ContextJotaiActionsDiscovery()",Date.now()),new B}));function useBrowserTabActions(){var e=T(),t=e.addWebTab.use(),n=e.addBlankWebTab.use(),r=e.buildWebTabs.use(),o=e.refreshTabs.use(),a=e.setWebTabData.use(),i=e.getWebTabById.use(),c=e.closeWebTab.use(),s=e.closeAllWebTabs.use(),u=e.setCurrentWebTab.use(),l=e.setPinnedTab.use(),d=e.setDisplayHomePage.use();return(0,p.useRef)({addWebTab:t,addBlankWebTab:n,buildWebTabs:r,refreshTabs:o,setWebTabData:a,getWebTabById:i,closeWebTab:c,closeAllWebTabs:s,setCurrentWebTab:u,setPinnedTab:l,setDisplayHomePage:d})}function useBrowserBookmarkAction(){var e=T(),t=e.buildBookmarkData.use(),n=e.getBookmarkData.use(),r=e.addBrowserBookmark.use(),o=e.removeBrowserBookmark.use(),a=e.modifyBrowserBookmark.use();return(0,p.useRef)({buildBookmarkData:t,getBookmarkData:n,addBrowserBookmark:r,removeBrowserBookmark:o,modifyBrowserBookmark:a})}function useBrowserHistoryAction(){var e=T(),t=e.buildHistoryData.use(),n=e.getHistoryData.use(),r=e.addBrowserHistory.use(),o=e.removeBrowserHistory.use(),a=e.removeAllBrowserHistory.use();return(0,p.useRef)({buildHistoryData:t,getHistoryData:n,addBrowserHistory:r,removeBrowserHistory:o,removeAllBrowserHistory:a})}function useBrowserAction(){var e=T(),t=e.gotoSite.use(),n=e.openMatchDApp.use(),r=e.handleOpenWebSite.use(),o=e.onNavigation.use(),a=e.addUrlToPhishingCache.use(),i=e.pauseDappInteraction.use(),c=e.resumeDappInteraction.use(),s=e.validateWebviewSrc.use();return(0,p.useRef)({gotoSite:t,openMatchDApp:n,handleOpenWebSite:r,onNavigation:o,addUrlToPhishingCache:a,pauseDappInteraction:i,resumeDappInteraction:c,validateWebviewSrc:s})}},278484:(e,t,n)=>{"use strict";n.d(t,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var r=n(460986),o=n.n(r),a=n(586330),i=n(514041),c=n(17617),s=n(490343),u=n(310955),l=n(325809),d=n(237532),p=n(24284),f=n(911998),b=n(162616),m=n(226952),y=n(584186),A=n(714191),v=n(82506);var g=n(831085);function DAppAccountListInitFromHome({num:e}){var t=(0,b.z$)();return(0,i.useEffect)((function(){(0,a.A)((function*(){yield y.A.wait(600),yield t.current.syncFromScene({from:{sceneName:A.Zs.home,sceneNum:0},num:e})}))()}),[t,e]),null}function DAppAccountListItem({num:e,handleAccountChanged:t,readonly:n,networkReadonly:r,compressionUiMode:o,initFromHome:a,beforeShowTrigger:u}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:t}){var{activeAccount:n}=(0,b.LH)({num:e}),{selectedAccount:r}=(0,b.wz)({num:e}),o=(0,v.d)(n,200),a=(0,v.d)(r,200),c=(0,i.useRef)(n),s=(0,i.useRef)(r);(0,i.useEffect)((function(){c.current=n,s.current=r}),[n,r]),(0,i.useEffect)((function(){t&&(o.isOthersWallet&&o.account?.id===a.othersWalletAccountId||o.indexedAccount?.id===a.indexedAccountId)&&t({activeAccount:c.current,selectedAccount:s.current},e)}),[o,a,t,e])}({num:e,handleAccountChanged:t});var p=a&&!n,f=p?800:500;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(s.XGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:c.A.hairlineWidth,separator:(0,g.jsx)(s.Divider,{vertical:!0}),disabled:n,children:[(0,g.jsx)(s.Group.Item,{children:(0,g.jsx)(l.jY,{num:e,beforeShowTrigger:u,disabled:r||n,loadingDuration:f})}),(0,g.jsx)(s.Group.Item,{children:(0,g.jsx)(d.U,{num:e,compressionUiMode:o,beforeShowTrigger:u,loadingDuration:f})})]}),p?(0,g.jsx)(DAppAccountListInitFromHome,{num:e}):null]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:t,onConnectedAccountInfoChanged:n}){var{serviceDApp:r,serviceNetwork:c}=u.A,{$sourceInfo:d}=(0,p.A)(),{result:b}=(0,f.yk)((0,a.A)((function*(){var e,t;if(!d?.origin||!d.scope)return{accountSelectorNum:null,networkIds:null};var n=(0,m.zg)(d.scope),o=n?(yield c.getNetworkIdsByImpls({impls:n})).networkIds:null,a=yield r.getConnectedAccountsInfo({origin:d.origin,scope:null!=(e=d.scope)?e:"",isWalletConnectRequest:d.isWalletConnectRequest});return Array.isArray(a)&&a.length>0&&"number"==typeof a[0]?.num?{accountSelectorNum:a[0].num,networkIds:o,existConnectedAccount:!0}:{accountSelectorNum:yield r.getAccountSelectorNum({origin:d.origin,scope:null!=(t=d.scope)?t:"",isWalletConnectRequest:d.isWalletConnectRequest}),networkIds:o,existConnectedAccount:!1}})),[d?.origin,d?.scope,d?.isWalletConnectRequest,r,c]);return(0,i.useEffect)((function(){o()(b?.accountSelectorNum)&&n&&n({num:b.accountSelectorNum,existConnectedAccount:b.existConnectedAccount})}),[b?.accountSelectorNum,b?.existConnectedAccount,n]),(0,g.jsxs)(s.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,g.jsx)(s.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),"number"==typeof b?.accountSelectorNum&&Array.isArray(b?.networkIds)?(0,g.jsx)(l.b8,{config:{sceneName:A.Zs.discover,sceneUrl:d?.origin},enabledNum:[b.accountSelectorNum],availableNetworksMap:{[b.accountSelectorNum]:{networkIds:b.networkIds}},children:(0,g.jsx)(DAppAccountListItem,{initFromHome:!b?.existConnectedAccount,num:b?.accountSelectorNum,handleAccountChanged:t,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){return(0,g.jsxs)(s.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,g.jsx)(s.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),(0,g.jsx)(l.b8,{config:{sceneName:A.Zs.home},enabledNum:[0],children:(0,g.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:t,handleAccountChanged:n}){var r=t.map((function(e){return e.accountSelectorNum})),o=t.reduce((function(e,t){var n=t.networkIds.filter(Boolean);return e[t.accountSelectorNum]={networkIds:n,defaultNetworkId:n[0]},e}),{});return(0,g.jsxs)(s.YStack,{space:"$2",children:[(0,g.jsx)(s.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(t)&&t.length?(0,g.jsx)(l.b8,{config:{sceneName:A.Zs.discover,sceneUrl:e},enabledNum:r,availableNetworksMap:o,children:(0,g.jsx)(s.YStack,{space:"$2",children:t.map((function(e){return(0,g.jsx)(s.Stack,{children:(0,g.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:n})},e.accountSelectorNum)}))})}):null]})}},618528:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var r=n(586330),o=n(514041),a=n(490343),i=n(310955),c=n(911998),s=n(233693),u=n(324586),l=n(325809),d=n(714191),p=n(278484),f=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,u.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const b=function ConnectionListItem({item:e,handleDisconnect:t,handleAccountChanged:n}){return(0,f.jsxs)(a.YStack,{space:"$5",p:"$5",children:[(0,f.jsxs)(a.XStack,{alignItems:"center",justifyContent:"space-between",space:"$3",children:[(0,f.jsxs)(a.XStack,{flex:1,alignItems:"center",space:"$3",children:[(0,f.jsxs)(a.Image,{size:"$10",children:[(0,f.jsx)(a.Image.Source,{src:e.imageURL}),(0,f.jsx)(a.Image.Fallback,{children:(0,f.jsx)(a.Icon,{size:"$10",name:"GlobusOutline"})}),(0,f.jsx)(a.Image.Loading,{children:(0,f.jsx)(a.Skeleton,{width:"100%",height:"100%"})})]}),(0,f.jsx)(a.SizableText,{size:"$bodyLgMedium",color:"$text",numberOfLines:3,style:{wordBreak:"break-all"},children:new URL(e.origin).hostname})]}),(0,f.jsx)(a.XStack,{p:"$1.5",m:"-$1.5",borderRadius:"$2",hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},focusable:!0,focusStyle:{outlineWidth:2,outlineColor:"$focusRing",outlineStyle:"solid"},onPress:function(){t(e.origin,e.storageType)},children:(0,f.jsx)(a.Icon,{name:"BrokenLinkOutline",color:"$iconSubdued",size:"$6"})})]}),(0,f.jsx)(l.b8,{config:{sceneName:d.Zs.discover,sceneUrl:e.origin},enabledNum:Object.keys(e.connectionMap).map((function(e){return Number(e)})),availableNetworksMap:e.availableNetworksMap,children:(0,f.jsx)(a.YStack,{space:"$2",children:Object.keys(e.connectionMap).map((function(t){return(0,f.jsx)(p.wI,{num:Number(t),handleAccountChanged:function(r){n({handleAccountChangedParams:r,num:Number(t),origin:e.origin,prevAccountInfo:_objectSpread(_objectSpread({},e.connectionMap[Number(t)]),{},{num:Number(t),storageType:e.storageType})})}},t)}))})})]})};var ItemSeparatorComponent=function(){return(0,f.jsx)(a.Divider,{})};function ConnectionListEmpty(){return(0,f.jsx)(a.Empty,{flex:1,icon:"LinkSolid",title:"No dApps Connected",description:"You haven't connected to any dApps yet. "})}const m=function ConnectionList(){var e,{serviceDApp:t}=i.A,{result:n,run:u}=(0,c.yk)((0,r.A)((function*(){return t.getAllConnectedList()})),[t],{checkIsFocused:!1}),l=(0,o.useCallback)((e=(0,r.A)((function*(e,n){yield t.disconnectWebsite({origin:e,storageType:n}),u()})),function(t,n){return e.apply(this,arguments)}),[u,t]),d=(0,o.useCallback)((function(){return(0,f.jsx)(a.Button,{variant:"tertiary",size:"medium",onPress:(0,r.A)((function*(){yield t.disconnectAllWebsites(),u()})),children:"Remove All"})}),[u,t]),{handleAccountInfoChanged:p}=(0,s.Q)();return(0,f.jsxs)(a.Page,{children:[(0,f.jsx)(a.Page.Header,{title:"dApp connections",headerRight:function(){return d()}}),(0,f.jsx)(a.Page.Body,{children:(0,f.jsx)(a.ListView,{contentContainerStyle:{flex:1},estimatedItemSize:48,scrollEnabled:!0,data:n,ListEmptyComponent:ConnectionListEmpty,keyExtractor:function(e){return e.origin},renderItem:function({item:e}){return(0,f.jsx)(b,{item:e,handleDisconnect:l,handleAccountChanged:function({origin:e,num:t,handleAccountChangedParams:n,prevAccountInfo:r}){p({origin:e,accountSelectorNum:t,prevAccountInfo:r,accountChangedParams:n,storageType:r.storageType,afterUpdate:function(){return u()}})}})},ItemSeparatorComponent})})]})}},233693:(e,t,n)=>{"use strict";n.d(t,{Q:()=>useShouldUpdateConnectedAccount});var r=n(586330),o=n(797331),a=n.n(o),i=n(514041);n(663522),n(730223);var c=n(310955);n(317522),n(660015),n(574319),a()((function(e,t){console.log("webview notify changed events: ",e,t);var n=new URL(e).origin;c.A.serviceDApp.notifyDAppAccountsChanged(n),c.A.serviceDApp.notifyDAppChainChanged(n)}),800);function useShouldUpdateConnectedAccount(){var e,t=(0,i.useCallback)((function(e,t){var n=e.walletId!==t.walletId||e.indexedAccountId!==t.indexedAccountId||e.networkId!==t.networkId||e.accountId!==t.accountId||e.address!==t.address,r=t.accountId&&t.walletId&&t.address&&t.networkId;return e&&n&&r}),[]),n=(0,i.useCallback)((function({activeAccount:e,selectedAccount:t}){var n,r,o,a,i,c;return{walletId:null!=(n=e.wallet?.id)?n:"",indexedAccountId:null!=(r=e.indexedAccount?.id)?r:"",networkId:null!=(o=e.network?.id)?o:"",accountId:null!=(a=e.account?.id)?a:"",address:null!=(i=e.account?.address)?i:"",networkImpl:null!=(c=e.network?.impl)?c:"",deriveType:e.deriveType,focusedWallet:t.focusedWallet,othersWalletAccountId:t.othersWalletAccountId}}),[]),o=(0,i.useCallback)((e=(0,r.A)((function*({origin:e,accountSelectorNum:r,prevAccountInfo:o,accountChangedParams:a,storageType:i,afterUpdate:s}){var u=n(a);if(t(o,u)){var{serviceDApp:l}=c.A;yield c.A.serviceDApp.updateConnectionSession({origin:e,accountSelectorNum:r,updatedAccountInfo:u,storageType:i}),console.log("useShouldUpdateConnectedAccount handleAccountChanged: ",r,o,a),s(),o.accountId!==u.accountId&&l.notifyDAppAccountsChanged(e),o.networkId!==u.networkId&&l.notifyDAppChainChanged(e)}})),function(t){return e.apply(this,arguments)}),[n,t]);return{handleAccountInfoChanged:o}}},574319:(e,t,n)=>{"use strict";n.d(t,{D$:()=>useWebTabDataById,bI:()=>useDisabledAddedNewTab,cf:()=>useActiveTabId,oM:()=>useWebTabs,y:()=>useDisplayHomePageFlag});var r=n(514041),o=n(567967),useWebTabs=function(){var[e]=(0,o.pJ)();return(0,r.useMemo)((function(){return{tabs:e.tabs}}),[e])},useWebTabDataById=function(e){var[t]=(0,o.nD)();return(0,r.useMemo)((function(){return{tab:t[null!=e?e:""]}}),[t,e])},useActiveTabId=function(){var[e]=(0,o.Xp)();return(0,r.useMemo)((function(){return{activeTabId:e}}),[e])},useDisplayHomePageFlag=function(){var[e]=(0,o.Do)();return{displayHomePage:e}},useDisabledAddedNewTab=function(){var[e]=(0,o.AS)();return(0,r.useMemo)((function(){return{disabledAddedNewTab:e}}),[e])}},660015:(e,t,n)=>{"use strict";n.d(t,{F:()=>c,O3:()=>a,T0:()=>crossWebviewLoadUrl,ay:()=>i,n5:()=>o});var r=n(663522),o="StandardBrowser",a={};function getWebviewWrapperRef(e){var t=e?a[e]:null;return null!=t?t:null}function crossWebviewLoadUrl({url:e,tabId:t}){var n=getWebviewWrapperRef(t);console.log("crossWebviewLoadUrl >>>>",e),r.Ay.isRuntimeBrowser?n?.innerRef?.loadURL(e):n?.innerRef?.loadUrl(e)}var i="\n(function(){\n  if (window.WebSocket) {\n    if (!window.$$onekeyWebSocketSend) {\n      window.$$onekeyWebSocketSend = window.WebSocket.prototype.send;\n    }\n    window.WebSocket.prototype.send = () => {};\n  }\n})()\n",c="\n(function(){\n  if (\n    window.WebSocket &&\n    window.$$onekeyWebSocketSend\n  ) {\n    window.WebSocket.prototype.send = window.$$onekeyWebSocketSend;\n  }\n})()\n"},797331:(e,t,n)=>{var r=n(712784),o=n(141580);e.exports=function throttle(e,t,n){var a=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return o(n)&&(a="leading"in n?!!n.leading:a,i="trailing"in n?!!n.trailing:i),r(e,t,{leading:a,maxWait:t,trailing:i})}}}]);