"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[99855],{638731:(e,t,r)=>{r.d(t,{DL:()=>validateEvmAddress,Pm:()=>buildSignedTxFromSignatureEvm,TE:()=>packUnsignedTxForSignEvm,jI:()=>getPublicKeyFromPrivateKey});var n=r(586330),a=r(171277),i=r(705372),o=r(89729),s=r(757808),c=r(241440),d=r(554902),l=r(507140),u=r(825145),x=r(606777),h=r(424754),g=r(403144);function getPublicKeyFromPrivateKey(e){return _getPublicKeyFromPrivateKey.apply(this,arguments)}function _getPublicKeyFromPrivateKey(){return(_getPublicKeyFromPrivateKey=(0,n.A)((function*({privateKeyRaw:e}){if(!h.A.isHexString(e))throw new l.He("Invalid private key.");var t=x.A.toBuffer(e);if(32!==t.length)throw new l.He("Invalid private key.");var r=d.bI.publicFromPrivate(t).toString("hex");return Promise.resolve({publicKey:r})}))).apply(this,arguments)}function packUnsignedTxForSignEvm(e){var t=function packTransaction(e){var t,r={to:e.to||void 0,nonce:(0,g.Si)(new c.A((0,u.wT)(e.nonce))),gasLimit:(0,g.Si)(new c.A((0,u.wT)(null!=(t=e.gasLimit)?t:e.gas))),data:e?.data||"0x",value:e?.value||"0x0",chainId:new c.A((0,u.wT)(e.chainId)).toNumber()};return r.to||(console.error("may be EVM contract deploy, always set value to 0"),r.value="0x0"),e?.maxFeePerGas||e?.maxPriorityFeePerGas?Object.assign(r,{type:s.Eh.eip1559,maxFeePerGas:(0,g.Si)(new c.A((0,u.wT)(e?.maxFeePerGas))),maxPriorityFeePerGas:(0,g.Si)(new c.A((0,u.wT)(e?.maxPriorityFeePerGas)))}):Object.assign(r,{gasPrice:(0,g.Si)(new c.A((0,u.wT)(e.gasPrice)))}),r}(e.encodedTx),r=(0,s.lK)(t);return{digest:(0,o.S)(r),tx:t,serializedTx:r,serializedTxWithout0x:h.A.stripHexPrefix(r)}}function validateEvmAddress(e){var t=!1,r="";try{t=42===(r=(0,a.bv)(e)).length}catch{return Promise.resolve({isValid:!1,normalizedAddress:"",displayAddress:""})}return Promise.resolve({normalizedAddress:r.toLowerCase()||"",displayAddress:r||"",isValid:t})}function buildSignedTxFromSignatureEvm({tx:e,signature:t}){var{r,s:n,v:a}=t,c=(0,i.Pc)({v:Number(a),r,s:n}),d=(0,s.lK)(e,c);return{rawTx:d,txid:(0,o.S)(d)}}},299855:(e,t,r)=>{r.r(t),r.d(t,{default:()=>stories_QRWalletGallery});var n=r(490343),a=r(310955),i=r(325809),o=r(162616),s=r(714191),c=r(654004),d=r(586330),l=r(514041),u=r(613526),x=r(81318),h=r.n(x),g=r(498356),p=r(147882),S=r(772528),A=function(e){return e.standard="account.standard",e.ledger_live="account.ledger_live",e.ledger_legacy="account.ledger_legacy",e}({}),m=function(e){return e.hd="hd",e.pubkey="pubkey",e}({}),y=r(831085),T=r(901048).Buffer;function HdKeyImport(){var[e,t]=(0,l.useState)("UR:CRYPTO-HDKEY/PTAOWKAXHDCLAXLECXLTSNHYJZJPBBFYRYIHKPQZVTNEBBEHJTKTWDMYHLPFHLZTWMDADSNDGMSWESAAHDCXDICEBETLROYKCABAAAFMSWJZEMCHTNPTKNYNVYHPHFETHDSTKORHYTTAGAATHSRHAHTAADEHOEADCSFNAOAEAMTAADDYOTADLNCSDWYKCSFNYKAEYKAOCYSGWSYLBSAXAXATTAADDYOEADLRAEWKLAWKAXAEAYCYDKURZERDASIYGWJTIHGRIHKKBKJOHSIAIAJLKPJTJYDMJKJYHSJTIEHSJPIEHFKIDSWZ"),r=(0,p.A)();(0,g.A)();return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(n.Button,{onPress:(0,d.A)((function*(){var e,n=(e=(0,d.A)((function*(){var e=(yield r.start({handlers:r.PARSE_HANDLER_NAMES.animation,autoHandleResult:!1,qrWalletScene:!0,showProTutorial:!0})).data,t=e.fullData;return console.log({animatedData:e}),t})),function startAnimatedScan(){return e.apply(this,arguments)}),a=yield n();t(a||"")})),children:"Scan"}),(0,y.jsx)(n.TextArea,{value:e,onChangeText:t,placeholder:"qrcode data"}),(0,y.jsx)(n.Button,{onPress:(0,d.A)((function*(){var t=S.HA.createAnimatedURDecoder(),r=e.split("\n").map((function(e){return e.trim()})).filter(Boolean);for(var n of r)t.receivePart?.(n);var a=yield t.promiseResultUR,i=a.cbor.toString("hex"),o=S.HA.decodeUrToDataItem(i);if(console.log(a.type,a.cbor,i,o),"crypto-hdkey"===a.type){console.log("crypto-hdkey cbor",i);var s=S.xr.fromCBOR(T.from(i,"hex")),c=`m/${s.getOrigin()?.getPath()}`,d=s.getOrigin()?.getSourceFingerprint()?.toString("hex"),l=s.getChildren()?.getPath(),x=l||"0/*",g=s.getName(),p=s.getNote(),y=A.standard,f=m.hd;s.getNote()===A.standard?y=A.standard:s.getNote()===A.ledger_legacy&&(y=A.ledger_legacy),s.getNote()===A.ledger_live&&(y=A.ledger_live);var P=s.getBip32Key(),v={chain:"ETH",path:c,publicKey:"",name:"OneKeyPro",chainCode:"1111",extendedPublicKey:P,xfp:d,note:p,extra:{okx:{chainId:1}}};console.log("crypto-hdkey xpub",{airGapAccount:v,dataList:r,hdPath:c,xfp:d,childrenPathWildcardWithDefault:x,childrenPathWildcard:l,name:g,note:p,keyringAccount:y,xpub:P});for(var b=0;b<3;b+=1)if(f===m.hd){var j=h().fromExtendedKey(P),D=x.replace("*",String(b)).replace(/\*/g,"0"),E=`m/${D}`,K=j.derive(E),k=`${c}/${D}`,H=`0x${(0,u.publicToAddress)(K.publicKey,!0).toString("hex")}`;H=(0,u.toChecksumAddress)(H),console.log({addr:H,hdPath:c,childrenPath:D,fullPath:k,childrenPathWildcard:l,childrenPathWildcardWithDefault:x,basePath:"m",derivePath:E})}else{var O=Object.keys({})[b];if(!O)throw new Error("KeystoneError#pubkey_account.no_expected_account");var R=(0,u.toChecksumAddress)(O);console.log(R)}}var I=(0,S.nB)(),w=I.parseHDKey(a),F=I.eth.generateAddressFromXpub({xpub:w.extendedPublicKey||"",derivePath:"m/0/0"});console.log({accountBySdk:w,addressBySdk:F})})),children:"crypto-hdkey (EVM)"})]})}function HdKeyImportMultiAccounts(){return(0,y.jsx)(n.Button,{children:"crypto-multi-accounts (TODO)"})}function QRWalletGalleryImportAccount(){return(0,y.jsxs)(n.Stack,{space:"$2",children:[(0,y.jsx)(HdKeyImport,{}),(0,y.jsx)(HdKeyImportMultiAccounts,{})]})}var f=r(324586),P=r(83219),v=r.n(P),b=r(309276),j=r(653980),D=r(638731),E=r(424754),K=r(482407),k=r(901048).Buffer;function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,f.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var H={to:"0x02bA7fd1b0aCdd0E4F8c6DA7C4bA8Fd7F963bA50",gasLimit:"0x8a10",maxPriorityFeePerGas:"0x128ed",maxFeePerGas:"0x1d1ac",data:"0x",nonce:"0x1",value:"0x12a05f200",chainId:"0x1",type:"0x2"},O=_objectSpread({from:"0x02bA7fd1b0aCdd0E4F8c6DA7C4bA8Fd7F963bA50"},H),R=_objectSpread({},H);function QRWalletGallerySignTx(){var{start:e}=(0,p.A)();return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(n.Button,{onPress:function(){var{digest:e,serializedTx:t,serializedTxWithout0x:r}=(0,D.TE)({encodedTx:O}),a=new(v())({chain:P.Chain.Mainnet,hardfork:P.Hardfork.London}),i=(b.Transaction.fromTxData(R,{common:a}),b.FeeMarketEIP1559Transaction.fromTxData(R,{common:a})),o=k.from(i.getMessageToSign(!1)).toString("hex"),s=b.FeeMarketEIP1559Transaction.fromTxData(R),c=k.from(s.getMessageToSign(!1)).toString("hex"),d={requestId:(0,K.lk)(),signData:r,dataType:S.q1.typedTransaction,path:"m/44'/60'/0'/0/0",xfp:"aaaff70f",chainId:1,origin:"MetaMask"},l=(0,S.nB)(),u=(S.LI.ETH_SIGN_REQUEST,S.RF.EthSignature,S.LI.ETH_SIGNATURE,l.eth.generateSignRequest(d)),x=j.UREncoder.encodeSinglePart(u).toUpperCase();new j.UREncoder(u,200,0).nextPart();console.log({ur:{type:u.type,cbor:u.cbor.toString("hex"),uri:x},unsignedMessage:o,unsignedMessage2:c,serializedTx:t,serializedTxWithout0x:r,digest:e});var h=j.URDecoder.decode(x),g=S.iq.fromCBOR(h.cbor);console.log({qrUri:x,decodedUr:h,decodedSignRequest:g,decodedSignRequestInfo:{xfp:g.getSourceFingerprint().toString("hex"),path:g.getDerivationPath()}}),n.Dialog.show({title:x,renderContent:(0,y.jsx)(n.QRCode,{size:300,value:x,drawType:"line"})})},children:"eth-sign-request (EVM signTx EIP-1559 )"}),(0,y.jsx)(n.Button,{children:"eth-sign-request (EVM signTx legacy TODO)"}),(0,y.jsx)(n.Button,{children:"eth-sign-request (EVM personal_sign TODO)"}),(0,y.jsx)(n.Button,{children:"eth-sign-request (EVM signTypedData_v1 v3 v4 TODO)"}),(0,y.jsx)(n.Input,{}),(0,y.jsx)(n.Button,{onPress:(0,d.A)((function*(){var e=(0,S.nB)(),t=S.HA.createAnimatedURDecoder();t?.receivePart?.("UR:ETH-SIGNATURE/OTADTPDAGDTOFNGRPKSBMNFXJERSCMGLZOSOPMWEFRAOHDFPOLDEOSHEEOGOONVDIHNBUOTDLRGLLRDAFGADSKHYADZMLPCWSEMNKOJZJTDWDPWPKGSGHDVSVLJLCAEMDTSSKGCPRLSFATMSEHKKGYWDDKEOIMCNMNBSJOJLIEAATLWPAEAXIYGWJTIHGRIHKKLGENRKKT");var r=yield t?.promiseResultUR,n=e.eth.parseSignature(r),{signature:a}=n,i=a.slice(0,64),o=a.slice(64,128),s=a.slice(128),c=b.TransactionFactory.fromTxData(_objectSpread(_objectSpread({},H),{},{type:H.type,r:E.A.addHexPrefix(i),s:E.A.addHexPrefix(o),v:E.A.addHexPrefix(s)})),d=E.A.addHexPrefix(c.hash().toString("hex")),l=E.A.addHexPrefix(c.serialize().toString("hex"));console.log({sig:n,ur:r,txid:d,rawTx:l})})),children:"eth-signature (EVM scan sign result)"})]})}function QRWalletGalleryDemo(){var{activeAccount:e}=(0,o.LH)({num:0});return(0,y.jsxs)(n.Stack,{space:"$2",children:[(0,y.jsx)(n.Button,{onPress:function(){a.A.serviceDemo.clearQrWalletAirGapAccountKeys({walletId:e?.wallet?.id||""})},children:"clear wallet airgap account keys"}),(0,y.jsx)(QRWalletGalleryImportAccount,{}),(0,y.jsx)(QRWalletGallerySignTx,{})]})}const stories_QRWalletGallery=function(){return(0,y.jsx)(c.P,{description:"--",suggestions:["--"],boundaryConditions:["--"],elements:[{title:"--",element:(0,y.jsx)(i.b8,{config:{sceneName:s.Zs.home,sceneUrl:""},enabledNum:[0],children:(0,y.jsx)(n.Stack,{space:"$1",children:(0,y.jsx)(QRWalletGalleryDemo,{})})})}]})}},654004:(e,t,r)=>{r.d(t,{P:()=>Layout});var n=r(586330),a=r(728234),i=r(490343),o=r(795871),s=r(310955),c=r(498356),d=r(730223),l=r(831085),FormattedText=function({text:e}){return"string"==typeof e?(0,l.jsx)(i.Stack,{children:(0,l.jsxs)(i.SizableText,{children:[e,"。 "]})}):Array.isArray(e)&&0===e.length?null:(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.Stack,{space:"$1",children:e.map((function(t,r){return(0,l.jsx)(i.Stack,{children:(0,l.jsxs)(i.SizableText,{children:[r+1,". ",t,r===e.length-1?"。":"；"]})},r.toString())}))})})};function Layout({description:e="",suggestions:t=[],boundaryConditions:r=[],elements:u=[],scrollEnabled:x=!0,contentInsetAdjustmentBehavior:h="never",skipLoading:g=!1,children:p}){var S=(0,o.U6)(),A=(0,c.A)();return(0,l.jsx)(i.Page,{skipLoading:g,children:(0,l.jsx)(i.ScrollView,{maxWidth:"100%",scrollEnabled:x,flex:1,marginBottom:S,paddingHorizontal:"$5",contentContainerStyle:{paddingTop:20,paddingBottom:280},keyboardDismissMode:"on-drag",contentInsetAdjustmentBehavior:h,children:(0,l.jsxs)(i.Stack,{marginHorizontal:"auto",maxWidth:"100%",width:576,space:"$6",children:[(0,l.jsxs)(i.XStack,{children:[(0,l.jsx)(i.IconButton,{icon:"HomeLineOutline",onPress:function(){A.dispatch(a.y9.replace(d.WP.Main,{screen:d.V4.Developer,params:{screen:d.f$.TabDeveloper}}))}}),(0,l.jsx)(i.Button,{ml:"$4",onPress:(0,n.A)((function*(){yield s.A.serviceSetting.setTheme("light")})),children:"Light Theme"}),(0,l.jsx)(i.Button,{ml:"$4",variant:"primary",onPress:(0,n.A)((function*(){yield s.A.serviceSetting.setTheme("dark")})),children:"Dark Theme"})]}),e?(0,l.jsxs)(i.Stack,{space:"$2",children:[(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.SizableText,{size:"$headingXl",children:"使用说明"})}),(0,l.jsx)(i.Stack,{children:(0,l.jsx)(FormattedText,{text:e})})]}):null,t?(0,l.jsxs)(i.Stack,{space:"$2",children:[(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.SizableText,{size:"$headingXl",children:"使用建议"})}),(0,l.jsx)(FormattedText,{text:t})]}):null,r?.length>0?(0,l.jsxs)(i.Stack,{space:"$2",children:[(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.SizableText,{size:"$headingXl",children:"注意事项"})}),(0,l.jsx)(FormattedText,{text:r})]}):null,(0,l.jsxs)(i.Stack,{space:"$2",children:[(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.SizableText,{size:"$headingXl",children:"组件案例"})}),(0,l.jsx)(i.Stack,{children:u?.map((function(e,t){return(0,l.jsxs)(i.Stack,{space:"$2",pb:"$8",mb:"$8",borderBottomWidth:"$px",borderBottomColor:"$borderSubdued",children:[(0,l.jsxs)(i.Stack,{flexDirection:"column",children:[(0,l.jsx)(i.SizableText,{size:"$headingLg",children:e.title}),e.description?(0,l.jsx)(i.Stack,{paddingTop:1,children:(0,l.jsxs)(i.SizableText,{children:[e.description,"。"]})}):null]}),(0,l.jsx)(i.Stack,{children:"function"==typeof e.element?(0,l.jsx)(e.element,{}):e.element})]},`elements-${t}`)}))}),(0,l.jsx)(i.Stack,{children:p?(0,l.jsx)(i.Stack,{space:"$3",children:p}):null})]})]})})})}}}]);