(self.webpackChunkweb=self.webpackChunkweb||[]).push([[50200],{567967:(e,t,n)=>{"use strict";n.d(t,{Xp:()=>r.Xp,yZ:()=>useBrowserAction,Gd:()=>useBrowserBookmarkAction,cS:()=>useBrowserHistoryAction,AO:()=>useBrowserTabActions,AS:()=>r.AS,Do:()=>r.Do,pJ:()=>r.pJ,nD:()=>r.nD});var r=n(603614),o=n(586330),a=n(324586),i=n(946343),c=n.n(i),s=n(230414),l=n(929296),u=n(195309),d=n(972715),p=n(514041),f=n(490343),b=n(310955),m=n(262873),A=n(714178),y=n(971670),v=n(660015),g=n(849726),w=(n(663522),n(730223),n(657355)),k=n(482407),h=n(796151),D=function(e){return e.Valid="Valid",e.InvalidUrl="InvalidUrl",e.NotSupportProtocol="NotSupportProtocol",e.ValidDeeplink="ValidDeeplink",e.InvalidPunycode="InvalidPunycode",e}({});function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var n,r=(0,d.A)(e);if(t){var o=(0,d.A)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,u.A)(this,n)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}var I={};var S="about:blank",W={id:"home",url:S,title:"OneKey",canGoBack:!1,loading:!1,favicon:""},B=function(e){(0,l.A)(ContextJotaiActionsDiscovery,e);var t=_createSuper(ContextJotaiActionsDiscovery);function ContextJotaiActionsDiscovery(...e){var n,a,i,s,l,u,d,p,A;return(n=t.call(this,...e)).setDisplayHomePage=(0,r.q0)((function(e,t,n){t((0,r.QL)(),n)})),n.buildWebTabs=(0,r.q0)((function(e,t,n){var o=e((0,r.cl)()),{data:a,options:i}=n,s=a;if(!Array.isArray(a))throw new Error("setWebTabsWriteAtom: payload must be an array");s&&s.length||(s=[]);var l=function buildWebTabData(e){var t={},n=[];return e.sort((function(e,t){return e.timestamp&&t.timestamp?e.timestamp-t.timestamp:0})),e.forEach((function(e){n.push(e.id),t[e.id]=e})),{data:e,keys:n,map:t}}(s);c()(l.keys,o.keys)&&!i?.forceUpdate||t((0,r.cl)(),{keys:l.keys,tabs:l.data}),t((0,r.GW)(),(function(){return l.map})),b.A.simpleDb.browserTabs.setRawData({tabs:l.data})})),n.refreshTabs=(0,r.q0)((function(e,t){var{tabs:o}=e((0,r.cl)()),a=[...o];n.buildWebTabs.call(t,{data:a,options:{forceUpdate:!0}})})),n.setCurrentWebTab=(0,r.q0)((function(e,t,o){var a=e((0,r.WL)());if(a!==o){n.pauseDappInteraction.call(t,a);var{tabs:i}=e((0,r.cl)()),c=i.findIndex((function(e){return e.id===o}));i.forEach((function(e){e.isActive=!1})),n.buildWebTabs.call(t,{data:[...i]}),-1!==c?(i[c].isActive=!0,t((0,r.WL)(),o),n.resumeDappInteraction.call(t,o)):t((0,r.WL)(),"")}var s=e((0,r.QL)());o&&s&&n.setDisplayHomePage.call(t,!1),o||s||n.setDisplayHomePage.call(t,!0)})),n.addWebTab=(0,r.q0)((function(e,t,o){var a,i=performance.now(),{tabs:c}=e((0,r.cl)());o.id&&o.id!==W.id||(o.id=(0,k.lk)()),o.timestamp=Date.now(),n.buildWebTabs.call(t,{data:[...c,o]}),n.setCurrentWebTab.call(t,null!=(a=o.id)?a:"");var s=performance.now();console.log(`addBlankWebTab took ${s-i} milliseconds.`)})),n.addBlankWebTab=(0,r.q0)((function(e,t){n.addWebTab.call(t,_objectSpread(_objectSpread({},W),{},{isActive:!0}))})),n.setWebTabData=(0,r.q0)((function(e,t,o){var{tabs:a}=e((0,r.cl)()),i=a,c=i.findIndex((function(e){return e.id===o.id}));if(c>-1){var s=i[c];Object.keys(o).forEach((function(e){var t=e,n=o[t];if(void 0!==n&&n!==s[t]){if("title"===t&&!n)return;s[t]=n,"url"===t&&(s.timestamp=Date.now(),"about:blank"===n&&o.id&&(I[o.id]=s.timestamp))}})),i[c]=s,n.buildWebTabs.call(t,{data:i})}})),n.closeWebTab=(0,r.q0)((function(e,t,o){delete v.O3[o];var{tabs:a}=e((0,r.cl)()),i=e((0,r.WL)()),c=a.findIndex((function(e){return e.id===o}));if(-1!==c){var s=a[c].id===i;if(a.splice(c,1),s){var l=c-1;if(l<0&&a.length>0&&(l=0),l>=0){var u=a[l];u.isActive=!0,n.setCurrentWebTab.call(t,u.id)}}}n.buildWebTabs.call(t,{data:[...a]})})),n.closeAllWebTabs=(0,r.q0)((function(e,t){var{tabs:o}=e((0,r.cl)()),a=e((0,r.WL)()),i=o.filter((function(e){return e.isPinned}));i.every((function(e){return e.id!==a}))&&n.setCurrentWebTab.call(t,null);var _loop=function(e){i.find((function(t){return t.id===e}))||delete v.O3[e]};for(var c of Object.getOwnPropertyNames(v.O3))_loop(c);n.buildWebTabs.call(t,{data:i})})),n.setPinnedTab=(0,r.q0)((function(e,t,r){n.setWebTabData.call(t,{id:r.id,isPinned:r.pinned,timestamp:Date.now()}),n.refreshTabs.call(t)})),n.syncBookmark=(0,r.q0)((function(e,t,o){var a=e((0,r.GW)());a&&Object.entries(a).forEach((function([,e]){e.url===o.url&&n.setWebTabData.call(t,{id:e.id,isBookmark:o.isBookmark})}))})),n.getBookmarkData=(0,r.q0)((0,o.A)((function*(){var e;return null!=(e=(yield b.A.simpleDb.browserBookmarks.getRawData())?.data)?e:[]}))),n.buildBookmarkData=(0,r.q0)((function(e,t,n){if(!Array.isArray(n))throw new Error("buildBookmarkData: payload must be an array");b.A.simpleDb.browserBookmarks.setRawData({data:n})})),n.addBrowserBookmark=(0,r.q0)((a=(0,o.A)((function*(e,t,r){if(r.url&&r.url!==W.url){var o=[...(yield n.getBookmarkData.call(t)).filter((function(e){return e.url!==r.url})),{url:r.url,title:r.title}];n.buildBookmarkData.call(t,o),n.syncBookmark.call(t,{url:r.url,isBookmark:!0}),b.A.serviceCloudBackup.requestAutoBackup()}})),function(e,t,n){return a.apply(this,arguments)})),n.removeBrowserBookmark=(0,r.q0)((i=(0,o.A)((function*(e,t,r){var o=(yield n.getBookmarkData.call(t)).filter((function(e){return e.url!==r}));n.buildBookmarkData.call(t,o),n.syncBookmark.call(t,{url:r,isBookmark:!1})})),function(e,t,n){return i.apply(this,arguments)})),n.modifyBrowserBookmark=(0,r.q0)((s=(0,o.A)((function*(e,t,r){if(r.url&&r.url!==W.url){var o=(yield n.getBookmarkData.call(t)).map((function(e){return e.url===r.url?_objectSpread(_objectSpread({},e),r):e}));n.buildBookmarkData.call(t,o)}})),function(e,t,n){return s.apply(this,arguments)})),n.getHistoryData=(0,r.q0)((0,o.A)((function*(){var e;return null!=(e=(yield b.A.simpleDb.browserHistory.getRawData())?.data)?e:[]}))),n.buildHistoryData=(0,r.q0)((function(e,t,n){if(!Array.isArray(n))throw new Error("buildHistoryData: payload must be an array");b.A.simpleDb.browserHistory.setRawData({data:n})})),n.addBrowserHistory=(0,r.q0)((l=(0,o.A)((function*(e,t,r){if(r.url&&r.url!==W.url){var o=(yield n.getHistoryData.call(t)).filter((function(e){return e.url!==r.url})),a={id:(0,k.lk)(),url:r.url,title:r.title,createdAt:Date.now()};n.buildHistoryData.call(t,[a,...o])}})),function(e,t,n){return l.apply(this,arguments)})),n.removeBrowserHistory=(0,r.q0)((u=(0,o.A)((function*(e,t,r){var o=(yield n.getHistoryData.call(t)).filter((function(e){return e.id!==r}));n.buildHistoryData.call(t,o)})),function(e,t,n){return u.apply(this,arguments)})),n.removeAllBrowserHistory=(0,r.q0)((d=(0,o.A)((function*(e,t){n.buildHistoryData.call(t,[])})),function(e,t){return d.apply(this,arguments)})),n.getWebTabById=(0,r.q0)((function(e,t,n){var o=e((0,r.GW)());return o?.[n||""]})),n.gotoSite=(0,r.q0)((p=(0,o.A)((function*(e,t,{id:r,url:o,title:a,favicon:i,isNewWindow:c,isInPlace:s,userTriggered:l}){var u=n.getWebTabById.call(t,null!=r?r:"");if(o){var d=h.Ay.validateUrl(o);if(!d)return;if(l&&n.addBrowserHistory.call(t,{url:d,title:null!=a?a:""}),"StandardBrowser"===v.n5)return(0,y.C)(d);var p=u?.id,f=!d.startsWith("http")&&"about:blank"!==d,b="boolean"==typeof c?c:(c||!p||"home"===p||f)&&"MultiTabBrowser"===v.n5,m=yield n.getBookmarkData.call(t),A=m?.some((function(e){return e.url.includes(d)}));return b?n.addWebTab.call(t,{title:a,url:d,favicon:i,isBookmark:A}):n.setWebTabData.call(t,{id:p,url:d,title:a,favicon:i,isBookmark:A}),b||s||(0,v.T0)({url:d,tabId:p}),f&&"MultiTabBrowser"===v.n5&&p&&setTimeout((function(){n.closeWebTab.call(t,p)}),1e3),!0}return!1})),function(e,t,n){return p.apply(this,arguments)})),n.openMatchDApp=(0,r.q0)((A=(0,o.A)((function*(e,t,{dApp:r,webSite:o,isNewWindow:a,tabId:i}){return o?n.gotoSite.call(t,{id:i,url:o.url,title:o.title,favicon:yield b.A.serviceDiscovery.buildWebsiteIconUrl(o.url),isNewWindow:a,userTriggered:!0}):r?n.gotoSite.call(t,{id:i,url:r.url,title:r.name,dAppId:r.dappId,favicon:r.logo||r.originLogo,userTriggered:!0,isNewWindow:a}):void 0})),function(e,t,n){return A.apply(this,arguments)})),n.handleOpenWebSite=(0,r.q0)((function(e,t,{useCurrentWindow:o,tabId:a,navigation:i,webSite:c,dApp:s,shouldPopNavigation:l=!0}){var u=!o;if(!o&&e((0,r.$D)()))return void f.Toast.message({title:g.a.intl.formatMessage({id:"msg__tab_has_reached_the_maximum_limit_of_str"},{0:"20"})});n.setDisplayHomePage.call(t,!1),n.openMatchDApp.call(t,{webSite:c,dApp:s,isNewWindow:u,tabId:a}),l&&i.pop()})),n.onNavigation=(0,r.q0)((function(e,t,{url:o,isNewWindow:a,isInPlace:i,title:c,favicon:s,canGoBack:l,canGoForward:u,loading:d,id:p,handlePhishingUrl:f}){var b=Date.now(),A=n.getWebTabById.call(t,null!=p?p:"");if(A){var y="string"==typeof o&&o!==A.url;if(o){var v=e((0,r.RY)()),{action:g}=h.Ay.parseDappRedirect(o,Array.from(v.keys()));if(g===h.Ay.EDAppOpenActionEnum.DENY)return void f?.(o);if(h.Ay.isValidDeepLink(o))return void(0,m.q)({url:o})}if(y){if(A.timestamp&&b-A.timestamp<500)return;if(I[A.id]&&o!==W.url&&b-I[A.id]<1e3)return;n.gotoSite.call(t,{url:o,title:c,favicon:s,isNewWindow:a,isInPlace:i,id:A.id})}n.setWebTabData.call(t,{id:A.id,title:c,favicon:s,canGoBack:l,canGoForward:u,loading:d})}})),n.addUrlToPhishingCache=(0,r.q0)((function(e,t,n){try{var{origin:o}=new URL(n.url),a=e((0,r.RY)());a.set(o,!0),t((0,r.RY)(),a),window.desktopApi?.setAllowedPhishingUrls(Array.from(a.keys()))}catch{}})),n.updateDappActivityInteraction=(0,r.q0)((function(e,t,n){var o=n.id;o||(o=e((0,r.WL)()));var a=o?v.O3[o]:null;if(a){var i="pause"===n.type;i?v.ay:v.F;a.jsBridge&&(a.jsBridge.globalOnMessageEnabled=!i)}})),n.pauseDappInteraction=(0,r.q0)((function(e,t,r){n.updateDappActivityInteraction.call(t,{id:r,type:"pause"})})),n.resumeDappInteraction=(0,r.q0)((function(e,t,r){n.updateDappActivityInteraction.call(t,{id:r,type:"resume"})})),n.validateWebviewSrc=(0,r.q0)((function(e,t,n){if(!n)return D.InvalidUrl;if(n===S)return D.Valid;var o=e((0,r.RY)()),{action:a}=h.Ay.parseDappRedirect(n,Array.from(o.keys()));return a===h.Ay.EDAppOpenActionEnum.DENY?D.NotSupportProtocol:h.Ay.containsPunycode(n)?D.InvalidPunycode:h.Ay.isValidDeepLink(n)?D.ValidDeeplink:D.Valid})),n}return(0,s.A)(ContextJotaiActionsDiscovery)}(A.x),T=(0,w.j)((function(){return console.log("new ContextJotaiActionsDiscovery()",Date.now()),new B}));function useBrowserTabActions(){var e=T(),t=e.addWebTab.use(),n=e.addBlankWebTab.use(),r=e.buildWebTabs.use(),o=e.refreshTabs.use(),a=e.setWebTabData.use(),i=e.getWebTabById.use(),c=e.closeWebTab.use(),s=e.closeAllWebTabs.use(),l=e.setCurrentWebTab.use(),u=e.setPinnedTab.use(),d=e.setDisplayHomePage.use();return(0,p.useRef)({addWebTab:t,addBlankWebTab:n,buildWebTabs:r,refreshTabs:o,setWebTabData:a,getWebTabById:i,closeWebTab:c,closeAllWebTabs:s,setCurrentWebTab:l,setPinnedTab:u,setDisplayHomePage:d})}function useBrowserBookmarkAction(){var e=T(),t=e.buildBookmarkData.use(),n=e.getBookmarkData.use(),r=e.addBrowserBookmark.use(),o=e.removeBrowserBookmark.use(),a=e.modifyBrowserBookmark.use();return(0,p.useRef)({buildBookmarkData:t,getBookmarkData:n,addBrowserBookmark:r,removeBrowserBookmark:o,modifyBrowserBookmark:a})}function useBrowserHistoryAction(){var e=T(),t=e.buildHistoryData.use(),n=e.getHistoryData.use(),r=e.addBrowserHistory.use(),o=e.removeBrowserHistory.use(),a=e.removeAllBrowserHistory.use();return(0,p.useRef)({buildHistoryData:t,getHistoryData:n,addBrowserHistory:r,removeBrowserHistory:o,removeAllBrowserHistory:a})}function useBrowserAction(){var e=T(),t=e.gotoSite.use(),n=e.openMatchDApp.use(),r=e.handleOpenWebSite.use(),o=e.onNavigation.use(),a=e.addUrlToPhishingCache.use(),i=e.pauseDappInteraction.use(),c=e.resumeDappInteraction.use(),s=e.validateWebviewSrc.use();return(0,p.useRef)({gotoSite:t,openMatchDApp:n,handleOpenWebSite:r,onNavigation:o,addUrlToPhishingCache:a,pauseDappInteraction:i,resumeDappInteraction:c,validateWebviewSrc:s})}},278484:(e,t,n)=>{"use strict";n.d(t,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var r=n(460986),o=n.n(r),a=n(586330),i=n(514041),c=n(17617),s=n(490343),l=n(310955),u=n(325809),d=n(237532),p=n(24284),f=n(911998),b=n(162616),m=n(226952),A=n(584186),y=n(714191),v=n(82506);var g=n(831085);function DAppAccountListInitFromHome({num:e}){var t=(0,b.z$)();return(0,i.useEffect)((function(){(0,a.A)((function*(){yield A.A.wait(600),yield t.current.syncFromScene({from:{sceneName:y.Zs.home,sceneNum:0},num:e})}))()}),[t,e]),null}function DAppAccountListItem({num:e,handleAccountChanged:t,readonly:n,networkReadonly:r,compressionUiMode:o,initFromHome:a,beforeShowTrigger:l}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:t}){var{activeAccount:n}=(0,b.LH)({num:e}),{selectedAccount:r}=(0,b.wz)({num:e}),o=(0,v.d)(n,200),a=(0,v.d)(r,200),c=(0,i.useRef)(n),s=(0,i.useRef)(r);(0,i.useEffect)((function(){c.current=n,s.current=r}),[n,r]),(0,i.useEffect)((function(){t&&(o.isOthersWallet&&o.account?.id===a.othersWalletAccountId||o.indexedAccount?.id===a.indexedAccountId)&&t({activeAccount:c.current,selectedAccount:s.current},e)}),[o,a,t,e])}({num:e,handleAccountChanged:t});var p=a&&!n,f=p?800:500;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(s.XGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:c.A.hairlineWidth,separator:(0,g.jsx)(s.Divider,{vertical:!0}),disabled:n,children:[(0,g.jsx)(s.Group.Item,{children:(0,g.jsx)(u.jY,{num:e,beforeShowTrigger:l,disabled:r||n,loadingDuration:f})}),(0,g.jsx)(s.Group.Item,{children:(0,g.jsx)(d.U,{num:e,compressionUiMode:o,beforeShowTrigger:l,loadingDuration:f})})]}),p?(0,g.jsx)(DAppAccountListInitFromHome,{num:e}):null]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:t,onConnectedAccountInfoChanged:n}){var{serviceDApp:r,serviceNetwork:c}=l.A,{$sourceInfo:d}=(0,p.A)(),{result:b}=(0,f.yk)((0,a.A)((function*(){var e,t;if(!d?.origin||!d.scope)return{accountSelectorNum:null,networkIds:null};var n=(0,m.zg)(d.scope),o=n?(yield c.getNetworkIdsByImpls({impls:n})).networkIds:null,a=yield r.getConnectedAccountsInfo({origin:d.origin,scope:null!=(e=d.scope)?e:"",isWalletConnectRequest:d.isWalletConnectRequest});return Array.isArray(a)&&a.length>0&&"number"==typeof a[0]?.num?{accountSelectorNum:a[0].num,networkIds:o,existConnectedAccount:!0}:{accountSelectorNum:yield r.getAccountSelectorNum({origin:d.origin,scope:null!=(t=d.scope)?t:"",isWalletConnectRequest:d.isWalletConnectRequest}),networkIds:o,existConnectedAccount:!1}})),[d?.origin,d?.scope,d?.isWalletConnectRequest,r,c]);return(0,i.useEffect)((function(){o()(b?.accountSelectorNum)&&n&&n({num:b.accountSelectorNum,existConnectedAccount:b.existConnectedAccount})}),[b?.accountSelectorNum,b?.existConnectedAccount,n]),(0,g.jsxs)(s.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,g.jsx)(s.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),"number"==typeof b?.accountSelectorNum&&Array.isArray(b?.networkIds)?(0,g.jsx)(u.b8,{config:{sceneName:y.Zs.discover,sceneUrl:d?.origin},enabledNum:[b.accountSelectorNum],availableNetworksMap:{[b.accountSelectorNum]:{networkIds:b.networkIds}},children:(0,g.jsx)(DAppAccountListItem,{initFromHome:!b?.existConnectedAccount,num:b?.accountSelectorNum,handleAccountChanged:t,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){return(0,g.jsxs)(s.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,g.jsx)(s.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),(0,g.jsx)(u.b8,{config:{sceneName:y.Zs.home},enabledNum:[0],children:(0,g.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:t,handleAccountChanged:n}){var r=t.map((function(e){return e.accountSelectorNum})),o=t.reduce((function(e,t){var n=t.networkIds.filter(Boolean);return e[t.accountSelectorNum]={networkIds:n,defaultNetworkId:n[0]},e}),{});return(0,g.jsxs)(s.YStack,{space:"$2",children:[(0,g.jsx)(s.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(t)&&t.length?(0,g.jsx)(u.b8,{config:{sceneName:y.Zs.discover,sceneUrl:e},enabledNum:r,availableNetworksMap:o,children:(0,g.jsx)(s.YStack,{space:"$2",children:t.map((function(e){return(0,g.jsx)(s.Stack,{children:(0,g.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:n})},e.accountSelectorNum)}))})}):null]})}},450200:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>v});var r=n(503668),o=n.n(r),a=n(586330),i=n(514041),c=n(728234),s=n(490343),l=n(310955),u=n(325809),d=n(791088),p=n(498356),f=n(730223),b=n(714191),m=n(233693),A=n(278484),y=n(831085);const v=function CurrentConnectionModal(){var e=(0,p.A)(),t=(0,c.lq)(),{faviconUrl:n,origin:r}=t.params,{handleAccountInfoChanged:v}=(0,m.Q)(),[g,w]=(0,i.useState)([]),k=(0,i.useRef)(!1),h=(0,i.useCallback)((0,a.A)((function*(){if(r){var t=yield l.A.serviceDApp.findInjectedAccountByOrigin(r);t?w(t):e.pop()}else w(null)})),[r,e]);(0,c.xK)((function(){k.current&&(h(),k.current=!1)})),(0,i.useEffect)((function(){h()}),[h]);var D=(0,i.useCallback)((function(){k.current=!0,e.pushModal(f.ry.DAppConnectionModal,{screen:f.EB.ConnectionList})}),[e]),I=(0,i.useCallback)((function(){e.pushModal(f.ry.DAppConnectionModal,{screen:f.EB.DefaultWalletSettingsModal})}),[e]),S=(0,i.useCallback)((0,a.A)((function*(){g?.[0].storageType&&(yield l.A.serviceDApp.disconnectWebsite({origin:r,storageType:g?.[0].storageType}),e.pop())})),[r,g,e]);return(0,y.jsxs)(s.Page,{children:[(0,y.jsx)(s.Page.Header,{title:"Connect"}),(0,y.jsxs)(s.Page.Body,{children:[(0,y.jsxs)(s.XStack,{p:"$5",space:"$3",children:[(0,y.jsxs)(s.Image,{size:"$10",borderRadius:"$2",children:[(0,y.jsx)(s.Image.Source,{src:n}),(0,y.jsx)(s.Image.Fallback,{children:(0,y.jsx)(s.Icon,{size:"$10",name:"GlobusOutline"})}),(0,y.jsx)(s.Image.Loading,{children:(0,y.jsx)(s.Skeleton,{width:"100%",height:"100%"})})]}),(0,y.jsxs)(s.YStack,{children:[(0,y.jsx)(s.SizableText,{size:"$bodyLgMedium",children:new URL(r).hostname}),(0,y.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSuccess",children:"Connected"})]})]}),o()(g)||!g.length?null:(0,y.jsx)(u.b8,{config:{sceneName:b.Zs.discover,sceneUrl:r},enabledNum:g.map((function(e){return e.num})),availableNetworksMap:g.reduce((function(e,t){return Array.isArray(t.availableNetworkIds)&&(e[t.num]={networkIds:t.availableNetworkIds}),e}),{}),children:(0,y.jsx)(s.YStack,{space:"$2",px:"$5",children:g.map((function(e){return(0,y.jsx)(A.wI,{num:e.num,compressionUiMode:!0,handleAccountChanged:(t=(0,a.A)((function*(t){yield v({origin:r,accountSelectorNum:e.num,prevAccountInfo:e,accountChangedParams:t,storageType:e.storageType,afterUpdate:h})})),function(e){return t.apply(this,arguments)})},e.num);var t}))})})]}),(0,y.jsxs)(s.Page.Footer,{children:[(0,y.jsx)(s.Divider,{}),(0,y.jsxs)(s.YStack,{bg:"$bgSubdued",py:"$3",space:"$2",children:[(0,y.jsx)(d.c,{onPress:D,children:(0,y.jsx)(s.SizableText,{size:"$bodyMd",children:"Manage dApp Connections"})},"manage-connection"),(0,y.jsx)(d.c,{onPress:I,children:(0,y.jsx)(s.SizableText,{size:"$bodyMd",children:"Default Wallet Settings"})},"default-wallet-settings"),(0,y.jsx)(s.Divider,{mx:"$5"}),(0,y.jsx)(d.c,{onPress:S,children:(0,y.jsx)(s.SizableText,{size:"$bodyMd",children:"Disconnect"})},"disconnection")]})]})]})}},233693:(e,t,n)=>{"use strict";n.d(t,{Q:()=>useShouldUpdateConnectedAccount});var r=n(586330),o=n(797331),a=n.n(o),i=n(514041);n(663522),n(730223);var c=n(310955);n(317522),n(660015),n(574319),a()((function(e,t){console.log("webview notify changed events: ",e,t);var n=new URL(e).origin;c.A.serviceDApp.notifyDAppAccountsChanged(n),c.A.serviceDApp.notifyDAppChainChanged(n)}),800);function useShouldUpdateConnectedAccount(){var e,t=(0,i.useCallback)((function(e,t){var n=e.walletId!==t.walletId||e.indexedAccountId!==t.indexedAccountId||e.networkId!==t.networkId||e.accountId!==t.accountId||e.address!==t.address,r=t.accountId&&t.walletId&&t.address&&t.networkId;return e&&n&&r}),[]),n=(0,i.useCallback)((function({activeAccount:e,selectedAccount:t}){var n,r,o,a,i,c;return{walletId:null!=(n=e.wallet?.id)?n:"",indexedAccountId:null!=(r=e.indexedAccount?.id)?r:"",networkId:null!=(o=e.network?.id)?o:"",accountId:null!=(a=e.account?.id)?a:"",address:null!=(i=e.account?.address)?i:"",networkImpl:null!=(c=e.network?.impl)?c:"",deriveType:e.deriveType,focusedWallet:t.focusedWallet,othersWalletAccountId:t.othersWalletAccountId}}),[]),o=(0,i.useCallback)((e=(0,r.A)((function*({origin:e,accountSelectorNum:r,prevAccountInfo:o,accountChangedParams:a,storageType:i,afterUpdate:s}){var l=n(a);if(t(o,l)){var{serviceDApp:u}=c.A;yield c.A.serviceDApp.updateConnectionSession({origin:e,accountSelectorNum:r,updatedAccountInfo:l,storageType:i}),console.log("useShouldUpdateConnectedAccount handleAccountChanged: ",r,o,a),s(),o.accountId!==l.accountId&&u.notifyDAppAccountsChanged(e),o.networkId!==l.networkId&&u.notifyDAppChainChanged(e)}})),function(t){return e.apply(this,arguments)}),[n,t]);return{handleAccountInfoChanged:o}}},574319:(e,t,n)=>{"use strict";n.d(t,{D$:()=>useWebTabDataById,bI:()=>useDisabledAddedNewTab,cf:()=>useActiveTabId,oM:()=>useWebTabs,y:()=>useDisplayHomePageFlag});var r=n(514041),o=n(567967),useWebTabs=function(){var[e]=(0,o.pJ)();return(0,r.useMemo)((function(){return{tabs:e.tabs}}),[e])},useWebTabDataById=function(e){var[t]=(0,o.nD)();return(0,r.useMemo)((function(){return{tab:t[null!=e?e:""]}}),[t,e])},useActiveTabId=function(){var[e]=(0,o.Xp)();return(0,r.useMemo)((function(){return{activeTabId:e}}),[e])},useDisplayHomePageFlag=function(){var[e]=(0,o.Do)();return{displayHomePage:e}},useDisabledAddedNewTab=function(){var[e]=(0,o.AS)();return(0,r.useMemo)((function(){return{disabledAddedNewTab:e}}),[e])}},660015:(e,t,n)=>{"use strict";n.d(t,{F:()=>c,O3:()=>a,T0:()=>crossWebviewLoadUrl,ay:()=>i,n5:()=>o});var r=n(663522),o="StandardBrowser",a={};function getWebviewWrapperRef(e){var t=e?a[e]:null;return null!=t?t:null}function crossWebviewLoadUrl({url:e,tabId:t}){var n=getWebviewWrapperRef(t);console.log("crossWebviewLoadUrl >>>>",e),r.Ay.isRuntimeBrowser?n?.innerRef?.loadURL(e):n?.innerRef?.loadUrl(e)}var i="\n(function(){\n  if (window.WebSocket) {\n    if (!window.$$onekeyWebSocketSend) {\n      window.$$onekeyWebSocketSend = window.WebSocket.prototype.send;\n    }\n    window.WebSocket.prototype.send = () => {};\n  }\n})()\n",c="\n(function(){\n  if (\n    window.WebSocket &&\n    window.$$onekeyWebSocketSend\n  ) {\n    window.WebSocket.prototype.send = window.$$onekeyWebSocketSend;\n  }\n})()\n"},797331:(e,t,n)=>{var r=n(712784),o=n(141580);e.exports=function throttle(e,t,n){var a=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return o(n)&&(a="leading"in n?!!n.leading:a,i="trailing"in n?!!n.trailing:i),r(e,t,{leading:a,maxWait:t,trailing:i})}}}]);