"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[48244],{593827:(e,t,n)=>{n.d(t,{L:()=>WalletAvatar});var r=n(503668),i=n.n(r),o=n(490343),a=n(491180),s=n(258988),l=n(831085);function WalletAvatarBase({size:e,img:t,wallet:n}){var r,i,c=t||n?.avatarInfo?.img;return c?a.A.isHwHiddenWallet({wallet:n})?(0,l.jsx)(o.Icon,{size:"$10",name:"LockSolid",color:"$iconSubdued"}):(0,l.jsxs)(o.Image,{size:e,children:[(0,l.jsx)(o.Image.Source,{source:null!=(r=s.UO[c])?r:s.UO.bear}),(0,l.jsx)(o.Image.Fallback,{delayMs:300,justifyContent:"center",alignItems:"center",children:(0,l.jsx)(o.SizableText,{children:null!=(i=n?.avatarInfo?.emoji)?i:""})})]}):null}function WalletAvatar({size:e="$10",status:t,badge:n,img:r,wallet:a}){return(0,l.jsxs)(o.Stack,{w:e,h:e,justifyContent:"center",alignItems:"center",children:[(0,l.jsx)(WalletAvatarBase,{size:e,img:r,wallet:a}),"connected"===t?(0,l.jsx)(o.Stack,{position:"absolute",bottom:-2,right:-2,bg:"$bgSidebar",p:"$0.5",borderRadius:"$full",zIndex:"$1",children:(0,l.jsx)(o.Stack,{borderRadius:"$full",w:"$2.5",h:"$2.5",bg:"$bgSuccessStrong"})}):null,i()(n)?null:(0,l.jsx)(o.Stack,{position:"absolute",bottom:-3,right:0,bg:"$bgSubdued",w:"$3.5",h:"$3.5",alignItems:"center",justifyContent:"center",borderRadius:"$full",zIndex:"$1",children:(0,l.jsx)(o.SizableText,{size:"$bodySmMedium",textAlign:"center",children:n})})]})}},903469:(e,t,n)=>{n.d(t,{A:()=>BackupListLoading});var r=n(490343),i=n(831085);function BackupListLoading(){return(0,i.jsxs)(r.Stack,{flex:1,px:"$5",space:"$2",pt:"$5",children:[(0,i.jsx)(r.Skeleton,{h:"$6",w:"70%"}),(0,i.jsx)(r.Skeleton,{h:"$6",w:"100%"}),(0,i.jsx)(r.Skeleton,{h:"$6",w:"70%"}),(0,i.jsx)(r.Skeleton,{h:"$6",w:"100%"})]})}},348244:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Detail});var r=n(324586),i=n(586330),o=n(514041),a=n(728234),s=n(302722),l=n.n(s),c=n(490343),u=n(972800),d=n(310955),p=n(791088),f=n(593827),m=n(498356),g=n(911998),h=n(847164),b=n(730223),v=n(567807),y=n(903469),j=n(451945),k=n(831085);function DeleteBackupDialogFooter({filename:e,callback:t}){var[n,r]=(0,o.useState)(!1);return(0,k.jsx)(c.Dialog.Footer,{confirmButtonProps:{loading:n},tone:"destructive",onConfirmText:"Delete",onConfirm:(0,i.A)((function*(){try{r(!0),yield d.A.serviceCloudBackup.removeBackup(e),t?.(),c.Toast.message({title:"Backup Deleted"})}finally{r(!1)}}))})}var w=n(882115);function RestorePasswordVerify(){var[e,t]=(0,o.useState)(!0);return(0,k.jsx)(c.Dialog.Form,{formProps:{values:{password:""}},children:(0,k.jsx)(c.Dialog.FormField,{name:"password",rules:{required:{value:!0,message:"Please enter the password "},onChange:function(){}},children:(0,k.jsx)(c.Input,{autoFocus:!0,size:"large",placeholder:"Enter your password",flex:1,keyboardType:(0,w.V)(!e),secureTextEntry:e,addOns:[{iconName:e?"EyeOffOutline":"EyeOutline",onPress:function(){t(!e)},testID:"password-eye-"+(e?"off":"on")}]})})})}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Detail(){var e,t,n=(0,m.A)(),r=(0,a.lq)(),{item:{filename:s,backupTime:w}}=r.params,O=(0,v.Yq)(new Date(w)),[x,S]=(0,o.useState)(0),[D,A]=(0,o.useState)(!1),$=(0,o.useCallback)((function(e){var t,n,r;return[Object.values(e.HDWallets).length>0&&{title:"App Wallet",data:Object.values(e.HDWallets).map((function(e){return{title:e.name,detail:`${e.accountUUIDs.length} Accounts`,walletAvatar:e.avatar,infoList:["Recovery phrase","Wallet avatar","Names of wallets and accounts"]}}))},Object.values(e.importedAccounts).length+Object.values(e.watchingAccounts).length>0&&{title:"Other Wallet",data:[Object.values(e.importedAccounts).length>0&&{title:"Private Key",detail:`${Object.keys(e.importedAccounts).length} Accounts`,icon:"PasswordOutline",infoList:["Private key","Account name"]},Object.values(e.watchingAccounts).length>0&&{title:"Watchlist",detail:`${Object.keys(e.watchingAccounts).length} Accounts`,icon:"EyeOutline",infoList:["Address","Account name"]}].filter((function(e){return e}))},Object.keys(e.contacts).length>0&&{title:"Address Book & Labels",data:[Object.keys(e.contacts).length>0&&{title:"Address Book",detail:`${Object.keys(e.contacts).length} Items`,icon:"BookOpenOutline",infoList:["Address","Name","Network type"]}].filter((function(e){return e}))},(null!=(t=e?.discoverBookmarks?.length)?t:0)>0&&{title:"Explore",data:[(null!=(n=e?.discoverBookmarks?.length)?n:0)>0&&{title:"Bookmark",detail:`${null!=(r=e?.discoverBookmarks?.length)?r:0} Items`,icon:"BookmarkOutline",infoList:["URL","Name"]}].filter((function(e){return e}))}].filter((function(e){return e}))}),[]),P=(0,g.yk)((0,i.A)((function*(){var e=yield d.A.serviceCloudBackup.getBackupDiffListWithFilename(s),t=$(e.alreadyOnDevice),n=$(e.notOnDevice);return _objectSpread(_objectSpread({},e),{},{alreadyOnDeviceSectionList:t,notOnDeviceSectionList:n})})),[s,$]).result,B=(0,o.useMemo)((function(){if(!P)return[];var e=0===x?P.notOnDeviceSectionList:P.alreadyOnDeviceSectionList;return null!=e?e:[]}),[x,P]),C=(0,o.useCallback)((function(){var e;D||c.ActionList.show({title:O,sections:[{items:[{label:"Delete",icon:"DeleteOutline",destructive:!0,onPress:(e=(0,i.A)((function*(){yield function showDeleteBackupDialog(e){return new Promise((function(t){c.Dialog.show({title:"Delete this Backup?",icon:"DeleteOutline",description:`This file will be permanently deleted from ${(0,j.w3)().cloudName}. Make sure you have written down the recovery phrases as you won’t be able to restore the wallets otherwise.`,tone:"destructive",renderContent:(0,k.jsx)(DeleteBackupDialogFooter,{filename:e,callback:t})})}))}(s),n.pop()})),function onPress(){return e.apply(this,arguments)})}]}]})}),[O,s,n,D]),I=(0,o.useCallback)((function(){return(0,k.jsx)(u.v$,{icon:"DotVerOutline",onPress:C})}),[C]),L=(0,o.useCallback)((t=(0,i.A)((function*(e){if(P){var{password:t}=yield d.A.servicePassword.promptPasswordVerify();return d.A.serviceCloudBackup.restoreFromPrivateBackup({privateString:P.backupData.privateData,notOnDevice:P.notOnDevice,localPassword:t,remotePassword:null!=e?e:t})}})),function(e){return t.apply(this,arguments)}),[P]),R=(0,o.useCallback)((0,i.A)((function*(){var e;if(l().gt(null!=(e=P?.backupData.appVersion)?e:"",null!="5.0.0"?"5.0.0":"1.0.0"))c.Dialog.show({icon:"InfoCircleOutline",title:"Upgrade Required",description:"Please upgrade your app to import the data from a newer version",onConfirmText:"Upgrade"});else{A(!0);try{var{isOnboardingDone:t}=yield d.A.serviceOnboarding.isOnboardingDone(),r=yield L();if(r===h.d.WRONG_PASSWORD){var i=yield function showRestorePasswordVerifyDialog(){return new Promise((function(e){return c.Dialog.confirm({icon:"PlaceholderOutline",title:"Import Data",description:"Verify the App password at the time of backup to import data.",renderContent:(0,k.jsx)(RestorePasswordVerify,{}),onConfirmText:"Import",onConfirm:function(t){var n,r=t.getForm()?.getValues(),i=null!=(n=r?.password)?n:"";i.length<=0||e(i)}})}))}();r=yield L(yield d.A.servicePassword.encodeSensitiveText({text:i}))}r===h.d.UNKNOWN_ERROR||r===h.d.WRONG_PASSWORD?c.Toast.error({title:r}):(c.Toast.success({title:"Backup Imported"}),t?n.pop():n.navigate(b.WP.Main))}catch(e){var o;c.Toast.error({title:`${null!=(o=e?.message)?o:e}`})}finally{A(!1)}}})),[P,n,L]);return(0,k.jsxs)(c.Page,{children:[(0,k.jsx)(c.Page.Header,{title:O,headerRight:I}),(0,k.jsxs)(c.Page.Body,{children:[(0,k.jsx)(c.Stack,{m:"$5",children:(0,k.jsx)(c.SegmentControl,{value:x,onChange:function(e){S(e)},options:[{label:`Not here(${null!=(e=P?.diffCount)?e:0})`,value:0},{label:"On-device",value:1}]})}),P?(0,k.jsx)(c.SectionList,{sections:B,renderItem:function({item:e}){return(0,k.jsx)(p.c,{title:e.title,renderIcon:e.walletAvatar?(0,k.jsx)(f.L,{wallet:{avatarInfo:e.walletAvatar}}):(0,k.jsx)(c.Stack,{bg:"$bgStrong",p:"$2",borderRadius:"$3",children:(0,k.jsx)(c.Icon,{name:e.icon,size:"$6",color:"$icon"})}),children:(0,k.jsxs)(c.XStack,{space:"$1",onPress:function(){c.ActionList.show({title:"Encrypted Backup Contents",sections:[{items:e.infoList.map((function(e){return{label:`  •\t${e}`}}))}]})},children:[(0,k.jsx)(p.c.Text,{secondary:e.detail,align:"right"}),(0,k.jsx)(c.Icon,{name:"InfoCircleOutline",color:"$iconSubdued",size:"small",bg:"transparent"})]})})},estimatedItemSize:"$16",ListEmptyComponent:(0,k.jsx)(c.Empty,{icon:"SearchOutline",title:"No Data",description:"All the data in this backup is already present on the current device."}),renderSectionHeader:function({section:e}){return(0,k.jsx)(c.SectionList.SectionHeader,{title:e.title})}}):(0,k.jsx)(y.A,{}),(0,k.jsx)(c.Button,{m:"$5",borderRadius:"$3",py:"$3",variant:"primary",loading:D,disabled:!P||P.notOnDeviceSectionList.length<=0,onPress:R,children:"Import"})]})]})}}}]);