"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[7885],{278484:(e,n,t)=>{t.d(n,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var o=t(460986),r=t.n(o),c=t(586330),i=t(514041),u=t(17617),a=t(490343),s=t(310955),l=t(325809),d=t(237532),m=t(24284),f=t(911998),A=t(162616),p=t(226952),h=t(584186),g=t(714191),x=t(82506);var v=t(831085);function DAppAccountListInitFromHome({num:e}){var n=(0,A.z$)();return(0,i.useEffect)((function(){(0,c.A)((function*(){yield h.A.wait(600),yield n.current.syncFromScene({from:{sceneName:g.Zs.home,sceneNum:0},num:e})}))()}),[n,e]),null}function DAppAccountListItem({num:e,handleAccountChanged:n,readonly:t,networkReadonly:o,compressionUiMode:r,initFromHome:c,beforeShowTrigger:s}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:n}){var{activeAccount:t}=(0,A.LH)({num:e}),{selectedAccount:o}=(0,A.wz)({num:e}),r=(0,x.d)(t,200),c=(0,x.d)(o,200),u=(0,i.useRef)(t),a=(0,i.useRef)(o);(0,i.useEffect)((function(){u.current=t,a.current=o}),[t,o]),(0,i.useEffect)((function(){n&&(r.isOthersWallet&&r.account?.id===c.othersWalletAccountId||r.indexedAccount?.id===c.indexedAccountId)&&n({activeAccount:u.current,selectedAccount:a.current},e)}),[r,c,n,e])}({num:e,handleAccountChanged:n});var m=c&&!t,f=m?800:500;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(a.XGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:u.A.hairlineWidth,separator:(0,v.jsx)(a.Divider,{vertical:!0}),disabled:t,children:[(0,v.jsx)(a.Group.Item,{children:(0,v.jsx)(l.jY,{num:e,beforeShowTrigger:s,disabled:o||t,loadingDuration:f})}),(0,v.jsx)(a.Group.Item,{children:(0,v.jsx)(d.U,{num:e,compressionUiMode:r,beforeShowTrigger:s,loadingDuration:f})})]}),m?(0,v.jsx)(DAppAccountListInitFromHome,{num:e}):null]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:n,onConnectedAccountInfoChanged:t}){var{serviceDApp:o,serviceNetwork:u}=s.A,{$sourceInfo:d}=(0,m.A)(),{result:A}=(0,f.yk)((0,c.A)((function*(){var e,n;if(!d?.origin||!d.scope)return{accountSelectorNum:null,networkIds:null};var t=(0,p.zg)(d.scope),r=t?(yield u.getNetworkIdsByImpls({impls:t})).networkIds:null,c=yield o.getConnectedAccountsInfo({origin:d.origin,scope:null!=(e=d.scope)?e:"",isWalletConnectRequest:d.isWalletConnectRequest});return Array.isArray(c)&&c.length>0&&"number"==typeof c[0]?.num?{accountSelectorNum:c[0].num,networkIds:r,existConnectedAccount:!0}:{accountSelectorNum:yield o.getAccountSelectorNum({origin:d.origin,scope:null!=(n=d.scope)?n:"",isWalletConnectRequest:d.isWalletConnectRequest}),networkIds:r,existConnectedAccount:!1}})),[d?.origin,d?.scope,d?.isWalletConnectRequest,o,u]);return(0,i.useEffect)((function(){r()(A?.accountSelectorNum)&&t&&t({num:A.accountSelectorNum,existConnectedAccount:A.existConnectedAccount})}),[A?.accountSelectorNum,A?.existConnectedAccount,t]),(0,v.jsxs)(a.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,v.jsx)(a.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),"number"==typeof A?.accountSelectorNum&&Array.isArray(A?.networkIds)?(0,v.jsx)(l.b8,{config:{sceneName:g.Zs.discover,sceneUrl:d?.origin},enabledNum:[A.accountSelectorNum],availableNetworksMap:{[A.accountSelectorNum]:{networkIds:A.networkIds}},children:(0,v.jsx)(DAppAccountListItem,{initFromHome:!A?.existConnectedAccount,num:A?.accountSelectorNum,handleAccountChanged:n,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){return(0,v.jsxs)(a.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,v.jsx)(a.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),(0,v.jsx)(l.b8,{config:{sceneName:g.Zs.home},enabledNum:[0],children:(0,v.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:n,handleAccountChanged:t}){var o=n.map((function(e){return e.accountSelectorNum})),r=n.reduce((function(e,n){var t=n.networkIds.filter(Boolean);return e[n.accountSelectorNum]={networkIds:t,defaultNetworkId:t[0]},e}),{});return(0,v.jsxs)(a.YStack,{space:"$2",children:[(0,v.jsx)(a.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(n)&&n.length?(0,v.jsx)(l.b8,{config:{sceneName:g.Zs.discover,sceneUrl:e},enabledNum:o,availableNetworksMap:r,children:(0,v.jsx)(a.YStack,{space:"$2",children:n.map((function(e){return(0,v.jsx)(a.Stack,{children:(0,v.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:t})},e.accountSelectorNum)}))})}):null]})}},980342:(e,n,t)=>{t.d(n,{A:()=>c});var o=t(490343),r=t(831085);const c=function DappOpenModalPage({children:e,onClose:n,dappApprove:t}){return(0,r.jsxs)(o.Page,{scrollEnabled:!0,onClose:function(e){e||t.reject(),"function"==typeof n&&n(e)},children:[(0,r.jsx)(o.Page.Header,{headerShown:!1}),e]})}},646433:(e,n,t)=>{t.d(n,{A:()=>l});var o=t(514041),r=t(241440),c=t(908867),i=t(490343),u=t(310955),a=t(911998),s=t(831085);const l=function LNMakeInvoiceForm(e){var{networkId:n,useFormReturn:t,amount:l,minimumAmount:d,maximumAmount:m,descriptionLabelId:f,memo:A,amountReadOnly:p}=e,h=(0,c.A)(),{result:g}=(0,a.yk)((function(){return u.A.serviceLightning.getInvoiceConfig({networkId:n})}),[n]),x=new r.A(null!=d?d:0).toNumber(),v=new r.A(null!=m?m:0).toNumber(),b=(0,o.useMemo)((function(){var e;return v&&v>0&&v>x&&v<Number(g?.maxReceiveAmount)&&(e=v),{min:{value:x,message:h.formatMessage({id:"form__field_too_small"},{0:x})},max:e?{value:e,message:h.formatMessage({id:"form__field_too_large"},{0:e})}:void 0,pattern:{value:/^[0-9]*$/,message:h.formatMessage({id:"form__field_only_integer"})},validate:function(e){if(!(x<=0)||e){var n=new r.A(e);return n.isInteger()?g?.maxReceiveAmount&&n.isGreaterThan(g?.maxReceiveAmount)?h.formatMessage({id:"msg_receipt_amount_should_be_less_than_int_sats"},{0:g?.maxReceiveAmount}):void 0:h.formatMessage({id:"form__field_only_integer"})}}}}),[x,v,g,h]),w=(0,o.useMemo)((function(){if(!(Number(l)>0||x>0&&x===v))return x>0&&v>0?h.formatMessage({id:"form__between_int_and_int_sats"},{min:x,max:v<x?g?.maxReceiveAmount:Math.min(v,Number(g?.maxReceiveAmount))}):void 0}),[l,x,v,g,h]);return(0,s.jsxs)(i.Form,{form:t,children:[(0,s.jsx)(i.Form.Field,{label:h.formatMessage({id:"content__amount"}),name:"amount",rules:b,labelAddon:w,children:(0,s.jsx)(i.Input,{readOnly:p,placeholder:h.formatMessage({id:"form__enter_amount"}),flex:1,addOns:[{label:h.formatMessage({id:"form__sats__units"})}]})}),(0,s.jsx)(i.Form.Field,{label:h.formatMessage({id:null!=f?f:"form__description"}),name:"description",rules:{maxLength:{value:40,message:h.formatMessage({id:"msg_description_can_be_up_to_int_characters"},{0:"40"})}},defaultValue:"",children:(0,s.jsx)(i.TextArea,{editable:!A})})]})}},307885:(e,n,t)=>{t.r(n),t.d(n,{default:()=>v});var o=t(586330),r=t(514041),c=t(728234),i=t(241440),u=t(908867),a=t(490343),s=t(310955),l=t(796895),d=t(24284),m=t(980342),f=t(507140),A=t(278484),p=t(748032),h=t(905710),g=t(646433),x=t(831085);const v=function LnurlWithdrawModal(){var e,n,t,v,b=(0,u.A)(),w=(0,c.lq)().params,{isSendFlow:_}=w,I=(0,d.A)(),{$sourceInfo:S}=I,{accountId:j,networkId:k,lnurlDetails:y}=_?w:I,C=(0,r.useMemo)((function(){if(y?.url)return new URL(y.url).origin}),[y?.url]),N=(0,l.A)({id:null!=(e=S?.id)?e:"",closeWindowAfterResolved:!0}),[M,L]=(0,r.useState)(!1),{showContinueOperate:R,continueOperate:D,setContinueOperate:F,riskLevel:$,urlSecurityInfo:W}=(0,h.q)({origin:null!=C?C:""}),O=Math.floor(Number(null!=(n=y?.minWithdrawable)?n:0)/1e3),T=Math.floor(Number(null!=(t=y?.maxWithdrawable)?t:0)/1e3),H=(0,a.useForm)({defaultValues:{amount:O>0&&O===T?`${O}`:"",description:y.defaultDescription}}),q=(0,r.useCallback)((v=(0,o.A)((function*(e){if(y&&!M){L(!0);var{serviceLightning:n}=s.A,t=H.getValues(),o=new i.A(t.amount).times(1e3).toNumber();try{var r=yield n.createInvoice({networkId:k,accountId:j,amount:new i.A(o).toString(),description:y.defaultDescription}),{callback:c,k1:u}=y;yield n.fetchLnurlWithdrawRequestResult({callback:c,k1:u,pr:r.payment_request}),_||N.resolve(),a.Toast.success({title:"Withdrawer success"}),e?.()}catch(e){var l=e?.message;throw _||setTimeout((function(){N.resolve({result:{status:"ERROR",reason:l}})}),1500),new f.oZ({info:l,autoToast:!0})}finally{L(!1)}}})),function(e){return v.apply(this,arguments)}),[H,M,y,k,j,N,_]);return(0,x.jsx)(m.A,{dappApprove:N,children:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(a.Page.Header,{headerShown:!1}),(0,x.jsx)(a.Page.Body,{children:(0,x.jsxs)(p.HJ,{title:b.formatMessage({id:"title__lnurl_withdraw"}),subtitleShown:!1,origin:null!=C?C:"",urlSecurityInfo:W,children:[_?(0,x.jsx)(A.X1,{}):(0,x.jsx)(A.ZY,{readonly:!0}),(0,x.jsx)(g.A,{accountId:j,networkId:k,useFormReturn:H,amount:O===T?O:void 0,amountReadOnly:O===T,minimumAmount:O,maximumAmount:T,descriptionLabelId:"form__withdraw_description",memo:y.defaultDescription})]})}),(0,x.jsx)(a.Page.Footer,{children:(0,x.jsx)(p.OS,{confirmText:"Continue",continueOperate:D,setContinueOperate:function(e){F(!!e)},onConfirm:q,onCancel:function(){_||N.reject()},confirmButtonProps:{loading:M,disabled:!D},showContinueOperateCheckbox:R,riskLevel:$})})]})})}}}]);