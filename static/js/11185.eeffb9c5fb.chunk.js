"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[11185],{278484:(e,n,t)=>{t.d(n,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var o=t(460986),c=t.n(o),r=t(586330),s=t(514041),i=t(17617),u=t(490343),l=t(310955),a=t(325809),d=t(237532),m=t(24284),p=t(911998),g=t(162616),A=t(226952),f=t(584186),h=t(714191),_=t(82506);var x=t(831085);function DAppAccountListInitFromHome({num:e}){var n=(0,g.z$)();return(0,s.useEffect)((function(){(0,r.A)((function*(){yield f.A.wait(600),yield n.current.syncFromScene({from:{sceneName:h.Zs.home,sceneNum:0},num:e})}))()}),[n,e]),null}function DAppAccountListItem({num:e,handleAccountChanged:n,readonly:t,networkReadonly:o,compressionUiMode:c,initFromHome:r,beforeShowTrigger:l}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:n}){var{activeAccount:t}=(0,g.LH)({num:e}),{selectedAccount:o}=(0,g.wz)({num:e}),c=(0,_.d)(t,200),r=(0,_.d)(o,200),i=(0,s.useRef)(t),u=(0,s.useRef)(o);(0,s.useEffect)((function(){i.current=t,u.current=o}),[t,o]),(0,s.useEffect)((function(){n&&(c.isOthersWallet&&c.account?.id===r.othersWalletAccountId||c.indexedAccount?.id===r.indexedAccountId)&&n({activeAccount:i.current,selectedAccount:u.current},e)}),[c,r,n,e])}({num:e,handleAccountChanged:n});var m=r&&!t,p=m?800:500;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(u.XGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:i.A.hairlineWidth,separator:(0,x.jsx)(u.Divider,{vertical:!0}),disabled:t,children:[(0,x.jsx)(u.Group.Item,{children:(0,x.jsx)(a.jY,{num:e,beforeShowTrigger:l,disabled:o||t,loadingDuration:p})}),(0,x.jsx)(u.Group.Item,{children:(0,x.jsx)(d.U,{num:e,compressionUiMode:c,beforeShowTrigger:l,loadingDuration:p})})]}),m?(0,x.jsx)(DAppAccountListInitFromHome,{num:e}):null]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:n,onConnectedAccountInfoChanged:t}){var{serviceDApp:o,serviceNetwork:i}=l.A,{$sourceInfo:d}=(0,m.A)(),{result:g}=(0,p.yk)((0,r.A)((function*(){var e,n;if(!d?.origin||!d.scope)return{accountSelectorNum:null,networkIds:null};var t=(0,A.zg)(d.scope),c=t?(yield i.getNetworkIdsByImpls({impls:t})).networkIds:null,r=yield o.getConnectedAccountsInfo({origin:d.origin,scope:null!=(e=d.scope)?e:"",isWalletConnectRequest:d.isWalletConnectRequest});return Array.isArray(r)&&r.length>0&&"number"==typeof r[0]?.num?{accountSelectorNum:r[0].num,networkIds:c,existConnectedAccount:!0}:{accountSelectorNum:yield o.getAccountSelectorNum({origin:d.origin,scope:null!=(n=d.scope)?n:"",isWalletConnectRequest:d.isWalletConnectRequest}),networkIds:c,existConnectedAccount:!1}})),[d?.origin,d?.scope,d?.isWalletConnectRequest,o,i]);return(0,s.useEffect)((function(){c()(g?.accountSelectorNum)&&t&&t({num:g.accountSelectorNum,existConnectedAccount:g.existConnectedAccount})}),[g?.accountSelectorNum,g?.existConnectedAccount,t]),(0,x.jsxs)(u.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,x.jsx)(u.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),"number"==typeof g?.accountSelectorNum&&Array.isArray(g?.networkIds)?(0,x.jsx)(a.b8,{config:{sceneName:h.Zs.discover,sceneUrl:d?.origin},enabledNum:[g.accountSelectorNum],availableNetworksMap:{[g.accountSelectorNum]:{networkIds:g.networkIds}},children:(0,x.jsx)(DAppAccountListItem,{initFromHome:!g?.existConnectedAccount,num:g?.accountSelectorNum,handleAccountChanged:n,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){return(0,x.jsxs)(u.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,x.jsx)(u.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),(0,x.jsx)(a.b8,{config:{sceneName:h.Zs.home},enabledNum:[0],children:(0,x.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:n,handleAccountChanged:t}){var o=n.map((function(e){return e.accountSelectorNum})),c=n.reduce((function(e,n){var t=n.networkIds.filter(Boolean);return e[n.accountSelectorNum]={networkIds:t,defaultNetworkId:t[0]},e}),{});return(0,x.jsxs)(u.YStack,{space:"$2",children:[(0,x.jsx)(u.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(n)&&n.length?(0,x.jsx)(a.b8,{config:{sceneName:h.Zs.discover,sceneUrl:e},enabledNum:o,availableNetworksMap:c,children:(0,x.jsx)(u.YStack,{space:"$2",children:n.map((function(e){return(0,x.jsx)(u.Stack,{children:(0,x.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:t})},e.accountSelectorNum)}))})}):null]})}},701378:(e,n,t)=>{t.d(n,{_:()=>DAppRequestedPermissionContent,N:()=>DAppSignMessageContent});var o=t(17617),c=t(490343),r=t(831085);function DAppRequestedPermissionContent({requestPermissions:e=["View your balance and activity","Send approval requests"]}){return(0,r.jsxs)(c.YStack,{space:"$2",children:[(0,r.jsx)(c.SizableText,{color:"$text",size:"$headingMd",children:"Requested permissions"}),(0,r.jsx)(c.YStack,{py:"$2.5",px:"$3",space:"$3",minHeight:"$8",bg:"$bg",borderRadius:"$3",borderWidth:o.A.hairlineWidth,borderColor:"$borderSubdued",borderCurve:"continuous",children:e.map((function(e){return(0,r.jsxs)(c.XStack,{space:"$3",children:[(0,r.jsx)(c.Icon,{name:"CheckLargeOutline",color:"$icon",size:"$5"}),(0,r.jsx)(c.SizableText,{color:"$text",size:"$bodyMd",children:e})]},e)}))})]})}function DAppSignMessageContent({content:e}){return(0,r.jsxs)(c.YStack,{justifyContent:"center",children:[(0,r.jsx)(c.SizableText,{color:"$text",size:"$headingMd",mb:"$2",children:"Message"}),(0,r.jsx)(c.TextArea,{value:e,editable:!1,numberOfLines:14})]})}},980342:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(490343),c=t(831085);const r=function DappOpenModalPage({children:e,onClose:n,dappApprove:t}){return(0,c.jsxs)(o.Page,{scrollEnabled:!0,onClose:function(e){e||t.reject(),"function"==typeof n&&n(e)},children:[(0,c.jsx)(o.Page.Header,{headerShown:!1}),e]})}},311185:(e,n,t)=>{t.r(n),t.d(n,{default:()=>S});var o=t(586330),c=t(514041),r=t(728234),s=t(908867),i=t(490343),u=t(310955),l=t(498356),a=t(796895),d=t(24284),m=t(911998),p=t(980342),g=t(507140),A=t(278484),f=t(701378),h=t(748032),_=t(905710),x=t(831085);const S=function LnurlAuthModal(){var e,n,t,S,w=(0,s.A)(),b=(0,l.A)(),k=(0,r.lq)().params,{isSendFlow:j}=k,C=(0,d.A)(),{$sourceInfo:y}=C,{accountId:I,networkId:v,lnurlDetails:$}=j?k:C,M=(0,c.useMemo)((function(){if($?.url)return new URL($.url).origin}),[$?.url]),N=(0,a.A)({id:null!=(e=y?.id)?e:"",closeWindowAfterResolved:!0}),[D,T]=(0,c.useState)(!1),{showContinueOperate:L,continueOperate:R,setContinueOperate:z,riskLevel:q,urlSecurityInfo:H}=(0,_.q)({origin:null!=M?M:""}),{result:W}=(0,m.yk)((0,o.A)((function*(){return"reigster"===$.action?{allowText:w.formatMessage({id:"content__allow_dapp_to_register_with_onekey"}),title:w.formatMessage({id:"title__lnurl_register"}),successText:w.formatMessage({id:"msg__lnurl_register_successful"})}:"link"===$.action?{allowText:w.formatMessage({id:"content__allow_dapp_to_link_with_onekey"}),title:w.formatMessage({id:"title__lnurl_link"}),successText:w.formatMessage({id:"msg__lnurl_link_successful"})}:"auth"===$.action?{allowText:w.formatMessage({id:"content__allow_dapp_to_connect_with_onekey"}),title:w.formatMessage({id:"title__lnurl_authentication"}),successText:w.formatMessage({id:"msg__lnurl_authorization_successful"})}:{allowText:w.formatMessage({id:"content__allow_dapp_to_login_with_onekey"}),title:w.formatMessage({id:"title__lnurl_login"}),successText:w.formatMessage({id:"msg__lnurl_login_successful"})}})),[$?.action,w]),F=(0,c.useCallback)((function(){var e=[w.formatMessage({id:"content__request_lnurl_linkingkey"})];return"auth"===$.action&&(e=[w.formatMessage({id:"content__watch_your_account_balance_and_activity"}),w.formatMessage({id:"content__allow_dapp_to_register_with_onekey"}),w.formatMessage({id:"content__request_invoices_and_send_transaction"})]),(0,x.jsx)(f._,{requestPermissions:e})}),[$?.action,w]),O=(0,c.useCallback)((S=(0,o.A)((function*(e){if($&&!D){T(!0);var{serviceLightning:n}=u.A;try{var t;yield n.lnurlAuth({accountId:I,networkId:v,lnurlDetail:$}),i.Toast.success({title:null!=(t=W?.successText)?t:""}),setTimeout((function(){j?b.popStack():N.resolve({close:e})}),300)}catch(n){var o=n?.message;throw j||setTimeout((function(){N.resolve({close:e,result:{status:"ERROR",reason:o}})}),1500),new g.oZ({info:o,autoToast:!0})}finally{T(!1)}}})),function(e){return S.apply(this,arguments)}),[$,D,I,v,W,j,N,b]);return(0,x.jsx)(p.A,{dappApprove:N,children:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(i.Page.Header,{headerShown:!1}),(0,x.jsx)(i.Page.Body,{children:(0,x.jsxs)(h.HJ,{title:null!=(n=W?.title)?n:"",subtitle:null!=(t=W?.allowText)?t:"",origin:null!=M?M:"",urlSecurityInfo:H,children:[j?(0,x.jsx)(A.X1,{}):(0,x.jsx)(A.ZY,{readonly:!0}),F()]})}),(0,x.jsx)(i.Page.Footer,{children:(0,x.jsx)(h.OS,{continueOperate:R,setContinueOperate:function(e){z(!!e)},onConfirm:O,onCancel:function(){j||N.reject()},confirmButtonProps:{loading:D,disabled:!R},showContinueOperateCheckbox:L,riskLevel:q})})]})})}}}]);