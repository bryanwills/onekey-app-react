"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[74933],{74933:(e,t,n)=>{n.r(t),n.d(t,{default:()=>SignatureRecord});var r=n(514041),i=n(490343),o=n(600435),s=n(885127),a=n(557503),d=n(586330),c=n(17617),l=n(310955),u=n(491180),m=n(567807),h=n(324586),b=n(911998),x=(0,r.createContext)({});function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,h.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var groupBy=function(e){var t=e.reduce((function(e,t){var n=(0,m.Yq)(new Date(t.createdAt),{hideTimeForever:!0});return e[n]||(e[n]=[]),e[n].push(t),e}),{});return Object.entries(t).map((function([e,t]){return{title:e,data:t}}))},useGetSignatureSections=function(e){var t=(0,r.useRef)([]),n=(0,r.useRef)(e),[i,o]=(0,r.useState)({offset:0,limit:10}),{networkId:s,searchContent:a}=(0,r.useContext)(x),{result:{sections:c,ending:l}}=(0,b.yk)((0,d.A)((function*(){var e=yield n.current({networkId:s,address:a,offset:i.offset,limit:i.limit}),r=s||a;return r||t.current.splice(i.offset,i.limit,...e),{sections:groupBy(r?e:t.current),ending:e.length<i.limit}})),[s,i.limit,i.offset,a],{initResult:{sections:[],ending:!1}}),u=(0,r.useCallback)((function(){l||o((function(e){return _objectSpread(_objectSpread({},e),{},{offset:e.offset+e.limit})}))}),[l]);return(0,r.useMemo)((function(){return{sections:c,onEndReached:u}}),[c,u])},p=n(831085),getConnectedSiteTitle=function(e){try{return new URL(e).host}catch{return e}},ConnectedSiteItem=function({item:e}){return(0,p.jsxs)(i.YStack,{borderWidth:c.A.hairlineWidth,mx:"$5",mb:"$3",borderRadius:"$3",borderColor:"$borderSubdued",overflow:"hidden",children:[(0,p.jsx)(i.XStack,{justifyContent:"space-between",pt:"$3",px:"$3",pb:"$1",children:(0,p.jsx)(i.SizableText,{size:"$bodyMd",children:(0,m.fU)(new Date(e.createdAt),{hideSeconds:!0})})}),(0,p.jsxs)(i.XStack,{p:"$3",alignItems:"center",children:[(0,p.jsx)(i.Image,{borderRadius:"$full",overflow:"hidden",width:40,height:40,src:e.logo,mr:"$3"}),(0,p.jsx)(i.SizableText,{size:"$bodyLgMedium",children:getConnectedSiteTitle(e.url)})]}),(0,p.jsx)(i.YStack,{p:"$3",backgroundColor:"$bgSubdued",children:e.networkIds.map((function(t,n){return(0,p.jsxs)(i.XStack,{alignItems:"center",children:[(0,p.jsx)(i.Stack,{mr:"$2",children:(0,p.jsx)(o.um,{size:16,networkId:t})}),(0,p.jsxs)(i.SizableText,{color:"$textSubdued",children:[e.networks[n].name," • ",u.A.shortenAddress({address:e.addresses[n]})]})]},t)}))})]})},ListEmptyComponent=function(){return(0,p.jsx)(i.Empty,{title:"No Connected Sites",description:"All sites connected through OneKey will appear here",icon:"ClockAlertOutline"})},ConnectedSites=function(){var e,{sections:t,onEndReached:n}=useGetSignatureSections((e=(0,d.A)((function*(e){return l.A.serviceSignature.getConnectedSites(e)})),function(t){return e.apply(this,arguments)}));return(0,p.jsx)(i.SectionList,{sections:t,estimatedItemSize:"$36",ItemSeparatorComponent:null,SectionSeparatorComponent:null,renderSectionHeader:function({section:e}){return(0,p.jsx)(i.SectionList.SectionHeader,{title:e.title})},renderItem:function({item:e}){return(0,p.jsx)(ConnectedSiteItem,{item:e})},ListEmptyComponent,onEndReached:n,onEndReachedThreshold:.3})},SignText_ListEmptyComponent=function(){return(0,p.jsx)(i.Empty,{title:"No Signed Text",description:"All text signed through OneKey will appear here",icon:"ClockAlertOutline"})},SignTextItem=function({item:e}){var{copyText:t}=(0,i.useClipboard)(),n=(0,r.useCallback)((function(){return t(e.message)}),[e.message,t]);return(0,p.jsxs)(i.YStack,{borderWidth:c.A.hairlineWidth,mx:"$5",borderRadius:"$3",borderColor:"$borderSubdued",overflow:"hidden",mb:"$3",children:[(0,p.jsxs)(i.XStack,{justifyContent:"space-between",pt:"$3",px:"$3",pb:"$1",children:[(0,p.jsxs)(i.SizableText,{size:"$bodyMd",children:[(0,m.fU)(new Date(e.createdAt),{hideSeconds:!0})," •"," ",e.title]}),(0,p.jsx)(i.IconButton,{variant:"tertiary",icon:"Copy1Outline",size:"small",onPress:n})]}),(0,p.jsx)(i.XStack,{justifyContent:"space-between",p:"$3",children:"json"===e.contentType?(0,p.jsx)(i.TextArea,{maxHeight:"$24",disabled:!0,value:JSON.stringify(JSON.parse(e.message),null,2),backgroundColor:"transparent",width:"100%",borderWidth:0}):(0,p.jsx)(i.SizableText,{maxHeight:"$24",size:"$bodyLgMedium",children:e.message})}),(0,p.jsxs)(i.XStack,{p:"$3",backgroundColor:"$bgSubdued",alignItems:"center",children:[(0,p.jsx)(i.Stack,{mr:"$2",children:(0,p.jsx)(o.um,{size:16,networkId:e.networkId})}),(0,p.jsxs)(i.SizableText,{color:"$textSubdued",children:[e.network.name," • ",u.A.shortenAddress({address:e.address})]})]})]})},SignText=function(){var e,{sections:t,onEndReached:n}=useGetSignatureSections((e=(0,d.A)((function*(e){return l.A.serviceSignature.getSignedMessages(e)})),function(t){return e.apply(this,arguments)}));return(0,p.jsx)(i.SectionList,{sections:t,estimatedItemSize:"$36",ItemSeparatorComponent:null,SectionSeparatorComponent:null,renderSectionHeader:function({section:e}){return(0,p.jsx)(i.SectionList.SectionHeader,{title:e.title})},renderItem:function({item:e}){return(0,p.jsx)(SignTextItem,{item:e})},ListEmptyComponent:SignText_ListEmptyComponent,onEndReached:n,onEndReachedThreshold:.3})},S=n(391944),f=n(971670),j=n(796151),SendTransactionItem=function({data:e}){return(0,p.jsxs)(i.XStack,{justifyContent:"space-between",w:"100%",alignItems:"center",children:[(0,p.jsxs)(i.XStack,{alignItems:"center",children:[(0,p.jsx)(S.o,{size:"lg",tokenImageUri:e.token.logoURI}),(0,p.jsx)(i.SizableText,{ml:"$3",size:"$bodyLgMedium",children:"Send"})]}),(0,p.jsx)(i.NumberSizeableText,{size:"$bodyLgMedium",formatter:"balance",formatterOptions:{tokenSymbol:e.token.symbol.toUpperCase(),showPlusMinusSigns:!0},children:`-${e.amount}`})]})},ApproveTransactionItem=function({data:e}){return(0,p.jsxs)(i.XStack,{justifyContent:"space-between",w:"100%",alignItems:"center",children:[(0,p.jsxs)(i.XStack,{alignItems:"center",children:[(0,p.jsx)(S.o,{size:"lg",tokenImageUri:e.token.logoURI}),(0,p.jsx)(i.SizableText,{ml:"$3",size:"$bodyLgMedium",children:"Approve"})]}),(0,p.jsx)(i.XStack,{children:e.isUnlimited?(0,p.jsx)(i.SizableText,{size:"$bodyLgMedium"}):(0,p.jsx)(i.NumberSizeableText,{size:"$bodyLgMedium",formatter:"balance",formatterOptions:{tokenSymbol:e.token.symbol.toUpperCase(),showPlusMinusSigns:!0},children:`-${e.amount}`})})]})},SwapTransactionItem=function({data:e}){return(0,p.jsxs)(i.XStack,{justifyContent:"space-between",w:"100%",children:[(0,p.jsxs)(i.XStack,{alignItems:"center",children:[(0,p.jsxs)(i.Stack,{w:40,h:40,alignItems:"flex-end",justifyContent:"flex-end",mr:"$3",children:[(0,p.jsx)(i.Stack,{position:"absolute",left:"$0",top:"$0",children:(0,p.jsx)(S.o,{size:"sm",tokenImageUri:e.fromToken.logoURI})}),(0,p.jsx)(i.Stack,{borderWidth:2,borderColor:"$bgApp",borderRadius:"$full",zIndex:1,children:(0,p.jsx)(S.o,{size:"sm",tokenImageUri:e.toToken.logoURI})})]}),(0,p.jsx)(i.SizableText,{size:"$bodyLgMedium",children:"Swap"})]}),(0,p.jsxs)(i.YStack,{alignItems:"flex-end",children:[(0,p.jsx)(i.NumberSizeableText,{size:"$bodyLgMedium",formatter:"balance",formatterOptions:{tokenSymbol:e.toToken.symbol.toUpperCase(),showPlusMinusSigns:!0},children:`+${e.toAmount}`}),(0,p.jsx)(i.NumberSizeableText,{size:"$bodyMd",color:"$textSubdued",formatter:"balance",formatterOptions:{tokenSymbol:e.fromToken.symbol.toUpperCase(),showPlusMinusSigns:!0},children:`-${e.fromAmount}`})]})]})},TransactionData=function({data:e}){return"send"===e.type?(0,p.jsx)(SendTransactionItem,{data:e}):"approve"===e.type?(0,p.jsx)(ApproveTransactionItem,{data:e}):"swap"===e.type?(0,p.jsx)(SwapTransactionItem,{data:e}):null},TransactionItem=function({item:e}){var t=e.network,n=(0,r.useCallback)((function(){(0,f.C)((0,j.BA)({network:t,address:e?.address}))}),[e?.address,t]);return(0,p.jsxs)(i.YStack,{borderWidth:c.A.hairlineWidth,mx:"$5",borderRadius:"$3",borderColor:"$borderSubdued",overflow:"hidden",mb:"$3",children:[(0,p.jsxs)(i.XStack,{justifyContent:"space-between",pt:"$3",px:"$3",pb:"$1",children:[(0,p.jsxs)(i.SizableText,{size:"$bodyMd",children:[(0,m.fU)(new Date(e.createdAt),{hideSeconds:!0})," • ",e.title]}),(0,p.jsx)(i.IconButton,{variant:"tertiary",icon:"OpenOutline",size:"small",onPress:n})]}),(0,p.jsx)(i.XStack,{p:"$3",children:(0,p.jsx)(TransactionData,{data:e.data})}),(0,p.jsxs)(i.XStack,{p:"$3",backgroundColor:"$bgSubdued",alignItems:"center",children:[(0,p.jsx)(i.Stack,{mr:"$2",children:(0,p.jsx)(o.um,{size:16,networkId:e.networkId})}),(0,p.jsxs)(i.SizableText,{color:"$textSubdued",children:[e.network.name," •"," ",u.A.shortenAddress({address:e.address})]})]})]})},Transactions_ListEmptyComponent=function(){return(0,p.jsx)(i.Empty,{title:"No Signed Transactions",description:"All transactions signed through OneKey will appear here",icon:"ClockAlertOutline"})},Transactions=function(){var e,{sections:t,onEndReached:n}=useGetSignatureSections((e=(0,d.A)((function*(e){return l.A.serviceSignature.getSignedTransactions(e)})),function(t){return e.apply(this,arguments)}));return(0,p.jsx)(i.SectionList,{sections:t,estimatedItemSize:"$36",ItemSeparatorComponent:null,SectionSeparatorComponent:null,renderSectionHeader:function({section:e}){return(0,p.jsx)(i.SectionList.SectionHeader,{title:e.title})},renderItem:function({item:e}){return(0,p.jsx)(TransactionItem,{item:e})},ListEmptyComponent:Transactions_ListEmptyComponent,onEndReached:n,onEndReachedThreshold:.3})},ListHeaderComponent=function(){var{searchContent:e,setSearchContent:t}=(0,r.useContext)(x);return(0,p.jsx)(i.Stack,{px:"$4",w:"100%",children:(0,p.jsx)(i.SearchBar,{value:e,onChangeText:t,placeholder:"Enter the address to search"})})};const SignatureRecord=function(){var[e,t]=(0,r.useState)(""),[n,d]=(0,r.useState)(""),c=(0,r.useMemo)((function(){return{networkId:e,searchContent:n,setNetworkId:t,setSearchContent:d}}),[e,n,t,d]),l=(0,s.A)(),u=(0,r.useCallback)((function(){l({defaultNetworkId:e,enableDangerNetwork:!0,onSelect(e){e.id===a.T.id?t(""):t?.(e.id)}})}),[l,e,t]),m=(0,r.useCallback)((function(){return(0,p.jsx)(i.Button,{onPress:u,variant:"tertiary",children:e?(0,p.jsx)(o.um,{size:24,networkId:e}):(0,p.jsx)(o.iD,{size:24})})}),[u,e]),h=(0,r.useMemo)((function(){return[{title:"Transactions",page:Transactions},{title:"Sign Text",page:SignText},{title:"Connected Sites",page:ConnectedSites}]}),[]);return(0,p.jsxs)(i.Page,{children:[(0,p.jsx)(i.Page.Header,{title:"Signature Record",headerRight:m}),(0,p.jsx)(x.Provider,{value:c,children:(0,p.jsx)(i.Page.Body,{children:(0,p.jsx)(i.Tab.Page,{ListHeaderComponent:(0,p.jsx)(ListHeaderComponent,{}),data:h,initialScrollIndex:0})})})]})}}}]);