"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[71214],{536612:(e,t,a)=>{a.d(t,{S:()=>useAppUpdateInfo,x:()=>useAppChangeLog});var n=a(324586),r=a(514041),o=a(734809),s=a(713132),i=a(639451),c=a(730223),l=a(310955),d=a(498356),u=a(911998);function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){(0,n.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var useAppChangeLog=function(e){var t=(0,u.yk)((function(){return e?l.A.serviceAppUpdate.fetchChangeLog():Promise.resolve(null)}),[e]);return(0,r.useMemo)((function(){return t.result}),[t.result])},useAppUpdateInfo=function(e=!1){var[t]=(0,o.useAppUpdatePersistAtom)(),a=(0,d.A)(),n=(0,r.useCallback)((function(){setTimeout((function(){(e?a.pushFullModal:a.pushModal)(c.ry.AppUpdateModal,{screen:c.mk.WhatsNew})}))}),[e,a.pushFullModal,a.pushModal]),u=(0,r.useCallback)((function(e=!1,n){(e?a.pushFullModal:a.pushModal)(c.ry.AppUpdateModal,{screen:c.mk.UpdatePreview,params:_objectSpread({latestVersion:t.latestVersion,isForceUpdate:t.isForceUpdate,autoClose:e},n)})}),[t.isForceUpdate,t.latestVersion,a.pushFullModal,a.pushModal]);(0,r.useEffect)((function(){(0,s.fK)(t)&&n(),t.status===s.ue.downloading&&(0,i.Xo)(t).then((function(){l.A.serviceAppUpdate.readyToInstall()})).catch((function(e){l.A.serviceAppUpdate.notifyFailed(e)})),l.A.serviceAppUpdate.fetchAppUpdateInfo().then((function(e){e?.isForceUpdate&&(0,s._q)(e.latestVersion,e.status)&&u(!0,e)}))}),[]);var p=(0,r.useCallback)((function(){switch(t.status){case s.ue.notify:case s.ue.downloading:u(e);break;case s.ue.ready:(0,i.Ed)(t).catch((function(e){return l.A.serviceAppUpdate.notifyFailed(e)}));break;case s.ue.failed:l.A.serviceAppUpdate.startDownloading(),(0,i.Xo)(t).then((function(){l.A.serviceAppUpdate.readyToInstall()})).catch((function(e){l.A.serviceAppUpdate.notifyFailed(e)}))}}),[t,e,u]);return(0,r.useMemo)((function(){return{isNeedUpdate:(0,s._q)(t.latestVersion,t.status),data:t,onUpdateAction:p,toUpdatePreviewPage:u,onViewReleaseInfo:n}}),[t,p,n,u])}},331250:(e,t,a)=>{a.d(t,{l:()=>ViewUpdateHistory});var n=a(514041),r=a(490343),o=a(117746),s=a(831085);function ViewUpdateHistory(){var e=(0,n.useCallback)((function(){(0,o.Dr)("https://github.com/OneKeyHQ/app-monorepo/releases")}),[]);return(0,s.jsx)(r.XStack,{children:(0,s.jsx)(r.Button,{mt:"$5",iconAfter:"ArrowTopRightOutline",onPress:e,size:"small",children:"Update History"})})}},671214:(e,t,a)=>{a.r(t),a.d(t,{default:()=>A});var n=a(728234),r=a(490343),o=a(663522),s=a(536612),i=a(586330),c=a(514041),l=a(310955),d=a(713132),u=a(639451),p=a(117746),f=a(831085),UpdatePreviewActionButton=function({autoClose:e}){var t=(0,s.S)(),a=(0,c.useCallback)((function(){}),[]),n=(0,c.useCallback)((function(){}),[]),h=(0,u.xf)(a,n),A=(0,c.useCallback)((function(a){t.data&&(t.data.storeUrl?(0,p.Dr)(t.data.storeUrl):t.data.downloadUrl&&(l.A.serviceAppUpdate.startDownloading(),(0,u.Xo)(t.data).then((function(){l.A.serviceAppUpdate.readyToInstall()})).catch((function(e){var{message:t}=e;t&&r.Toast.error({title:t}),l.A.serviceAppUpdate.notifyFailed(e)})),e&&a()))}),[t.data,e]),y=(0,c.useCallback)((0,i.A)((function*(){try{yield(0,u.Ed)(t.data)}catch(t){var{message:e}=t;e&&r.Toast.error({title:e})}})),[t.data]),g=d.ue.downloading===t.data?.status,b=d.ue.ready===t.data?.status,w=(0,c.useCallback)((function(){return g?`${h}% Downloading...`:b?o.Ay.isNativeAndroid?"Install Now":"Restart to Update":"Update Now"}),[g,b,h]);return(0,f.jsx)(r.Page.Footer,{children:(0,f.jsx)(r.YStack,{children:(0,f.jsx)(r.Page.FooterActions,{confirmButtonProps:{disabled:g,loading:g},onConfirmText:w(),onConfirm:b?y:A})})})},h=a(331250);const A=function UpdatePreview({route:e}){var{latestVersion:t,isForceUpdate:a,autoClose:i=!1}=e.params||{};(0,n.Fw)(!!a,(function(){}));var c=(0,s.x)(t);return(0,f.jsxs)(r.Page,{children:[(0,f.jsx)(r.Page.Header,{title:"App Update"}),(0,f.jsxs)(r.Page.Body,{m:"$5",children:[(0,f.jsxs)(r.YStack,{space:"$3",children:[(0,f.jsx)(r.Heading,{size:"$heading2xl",children:"New App Version ðŸŽ‰"}),null,(0,f.jsxs)(r.XStack,{space:"$2.5",alignItems:"center",children:[(0,f.jsx)(r.Badge,{badgeType:"default",badgeSize:"lg",children:o.Ay.version}),(0,f.jsx)(r.Icon,{name:"ArrowRightSolid",size:"$4"}),(0,f.jsx)(r.Badge,{badgeType:"info",badgeSize:"lg",children:t})]})]}),c?(0,f.jsxs)(r.ScrollView,{mt:"$7",contentInsetAdjustmentBehavior:"automatic",contentContainerStyle:{pb:"$5"},children:[(0,f.jsx)(r.Markdown,{children:c}),(0,f.jsx)(h.l,{})]}):null]}),(0,f.jsx)(UpdatePreviewActionButton,{autoClose:i})]})}},639451:(e,t,a)=>{a.d(t,{Ed:()=>i,Xo:()=>s,xf:()=>useDownloadProgress});var n,r,o=a(586330),s=(n=(0,o.A)((function*(){})),function downloadPackage(){return n.apply(this,arguments)}),i=(r=(0,o.A)((function*(){})),function installPackage(){return r.apply(this,arguments)}),useDownloadProgress=function(){return 0}}}]);