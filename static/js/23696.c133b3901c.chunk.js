"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[23696],{278484:(e,n,t)=>{t.d(n,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var o=t(460986),r=t.n(o),c=t(586330),a=t(514041),u=t(17617),i=t(490343),s=t(310955),l=t(325809),d=t(237532),m=t(24284),f=t(911998),p=t(162616),A=t(226952),g=t(584186),h=t(714191),b=t(82506);var x=t(831085);function DAppAccountListInitFromHome({num:e}){var n=(0,p.z$)();return(0,a.useEffect)((function(){(0,c.A)((function*(){yield g.A.wait(600),yield n.current.syncFromScene({from:{sceneName:h.Zs.home,sceneNum:0},num:e})}))()}),[n,e]),null}function DAppAccountListItem({num:e,handleAccountChanged:n,readonly:t,networkReadonly:o,compressionUiMode:r,initFromHome:c,beforeShowTrigger:s}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:n}){var{activeAccount:t}=(0,p.LH)({num:e}),{selectedAccount:o}=(0,p.wz)({num:e}),r=(0,b.d)(t,200),c=(0,b.d)(o,200),u=(0,a.useRef)(t),i=(0,a.useRef)(o);(0,a.useEffect)((function(){u.current=t,i.current=o}),[t,o]),(0,a.useEffect)((function(){n&&(r.isOthersWallet&&r.account?.id===c.othersWalletAccountId||r.indexedAccount?.id===c.indexedAccountId)&&n({activeAccount:u.current,selectedAccount:i.current},e)}),[r,c,n,e])}({num:e,handleAccountChanged:n});var m=c&&!t,f=m?800:500;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(i.XGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:u.A.hairlineWidth,separator:(0,x.jsx)(i.Divider,{vertical:!0}),disabled:t,children:[(0,x.jsx)(i.Group.Item,{children:(0,x.jsx)(l.jY,{num:e,beforeShowTrigger:s,disabled:o||t,loadingDuration:f})}),(0,x.jsx)(i.Group.Item,{children:(0,x.jsx)(d.U,{num:e,compressionUiMode:r,beforeShowTrigger:s,loadingDuration:f})})]}),m?(0,x.jsx)(DAppAccountListInitFromHome,{num:e}):null]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:n,onConnectedAccountInfoChanged:t}){var{serviceDApp:o,serviceNetwork:u}=s.A,{$sourceInfo:d}=(0,m.A)(),{result:p}=(0,f.yk)((0,c.A)((function*(){var e,n;if(!d?.origin||!d.scope)return{accountSelectorNum:null,networkIds:null};var t=(0,A.zg)(d.scope),r=t?(yield u.getNetworkIdsByImpls({impls:t})).networkIds:null,c=yield o.getConnectedAccountsInfo({origin:d.origin,scope:null!=(e=d.scope)?e:"",isWalletConnectRequest:d.isWalletConnectRequest});return Array.isArray(c)&&c.length>0&&"number"==typeof c[0]?.num?{accountSelectorNum:c[0].num,networkIds:r,existConnectedAccount:!0}:{accountSelectorNum:yield o.getAccountSelectorNum({origin:d.origin,scope:null!=(n=d.scope)?n:"",isWalletConnectRequest:d.isWalletConnectRequest}),networkIds:r,existConnectedAccount:!1}})),[d?.origin,d?.scope,d?.isWalletConnectRequest,o,u]);return(0,a.useEffect)((function(){r()(p?.accountSelectorNum)&&t&&t({num:p.accountSelectorNum,existConnectedAccount:p.existConnectedAccount})}),[p?.accountSelectorNum,p?.existConnectedAccount,t]),(0,x.jsxs)(i.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,x.jsx)(i.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),"number"==typeof p?.accountSelectorNum&&Array.isArray(p?.networkIds)?(0,x.jsx)(l.b8,{config:{sceneName:h.Zs.discover,sceneUrl:d?.origin},enabledNum:[p.accountSelectorNum],availableNetworksMap:{[p.accountSelectorNum]:{networkIds:p.networkIds}},children:(0,x.jsx)(DAppAccountListItem,{initFromHome:!p?.existConnectedAccount,num:p?.accountSelectorNum,handleAccountChanged:n,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){return(0,x.jsxs)(i.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,x.jsx)(i.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),(0,x.jsx)(l.b8,{config:{sceneName:h.Zs.home},enabledNum:[0],children:(0,x.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:n,handleAccountChanged:t}){var o=n.map((function(e){return e.accountSelectorNum})),r=n.reduce((function(e,n){var t=n.networkIds.filter(Boolean);return e[n.accountSelectorNum]={networkIds:t,defaultNetworkId:t[0]},e}),{});return(0,x.jsxs)(i.YStack,{space:"$2",children:[(0,x.jsx)(i.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(n)&&n.length?(0,x.jsx)(l.b8,{config:{sceneName:h.Zs.discover,sceneUrl:e},enabledNum:o,availableNetworksMap:r,children:(0,x.jsx)(i.YStack,{space:"$2",children:n.map((function(e){return(0,x.jsx)(i.Stack,{children:(0,x.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:t})},e.accountSelectorNum)}))})}):null]})}},980342:(e,n,t)=>{t.d(n,{A:()=>c});var o=t(490343),r=t(831085);const c=function DappOpenModalPage({children:e,onClose:n,dappApprove:t}){return(0,r.jsxs)(o.Page,{scrollEnabled:!0,onClose:function(e){e||t.reject(),"function"==typeof n&&n(e)},children:[(0,r.jsx)(o.Page.Header,{headerShown:!1}),e]})}},789094:(e,n,t)=>{t.d(n,{A:()=>l});var o=t(514041),r=t(241440),c=t(908867),a=t(490343),u=t(310955),i=t(911998),s=t(831085);const l=function LNSendPaymentForm(e){var{networkId:n,useFormReturn:t,amount:l,minimumAmount:d,maximumAmount:m,descriptionLabelId:f,commentAllowedLength:p,metadata:A,amountReadOnly:g,commentReadOnly:h}=e,b=(0,c.A)(),{result:x}=(0,i.yk)((function(){return u.A.serviceLightning.getInvoiceConfig({networkId:n})}),[n]),y=new r.A(null!=d?d:0).toNumber(),w=new r.A(null!=m?m:0).toNumber(),_=(0,o.useMemo)((function(){var e;return w&&w>0&&w>y&&w<Number(x?.maxSendAmount)&&(e=w),{min:{value:y,message:b.formatMessage({id:"form__field_too_small"},{0:y})},max:e?{value:e,message:b.formatMessage({id:"form__field_too_large"},{0:e})}:void 0,pattern:{value:/^[0-9]*$/,message:b.formatMessage({id:"form__field_only_integer"})},validate:function(e){if(!(y<=0)||e){var n=new r.A(e);return n.isInteger()?x?.maxSendAmount&&n.isGreaterThan(x?.maxSendAmount)?b.formatMessage({id:"msg__the_sending_amount_cannot_exceed_int_sats"},{0:x?.maxSendAmount}):void 0:b.formatMessage({id:"form__field_only_integer"})}}}}),[y,w,b,x?.maxSendAmount]),S=(0,o.useMemo)((function(){if(!(Number(l)>0||y>0&&y===w))return y>0&&w>0?b.formatMessage({id:"form__between_int_and_int_sats"},{min:y,max:w<y?x?.maxSendAmount:Math.min(w,Number(x?.maxSendAmount))}):void 0}),[l,y,w,b,x]),v=(0,o.useMemo)((function(){if(!A||!A.length)return null;try{return JSON.parse(A).map((function([e,n],o){if("text/plain"===e||"text/long-desc"===e){var r=`metadataDescription-${o}`;return t.setValue(r,n),(0,s.jsx)(a.Form.Field,{label:b.formatMessage({id:"form__payment_description"}),name:r,children:(0,s.jsx)(a.TextArea,{editable:!1,disabled:!0,numberOfLines:2})},n)}})).filter(Boolean)}catch(e){console.error(e)}return[]}),[b,A,t]);return(0,s.jsxs)(a.Form,{form:t,children:[v,(0,s.jsx)(a.Form.Field,{label:b.formatMessage({id:"content__amount"}),name:"amount",rules:_,labelAddon:S,children:(0,s.jsx)(a.Input,{readOnly:g,placeholder:b.formatMessage({id:"form__enter_amount"}),flex:1,addOns:[{label:b.formatMessage({id:"form__sats__units"})}]})}),Number(p)>0?(0,s.jsx)(a.Form.Field,{label:b.formatMessage({id:null!=f?f:"form__description__optional"}),name:"comment",rules:{maxLength:{value:Number(p),message:b.formatMessage({id:"msg_description_can_be_up_to_int_characters"},{0:p})}},defaultValue:"",children:(0,s.jsx)(a.TextArea,{editable:!h,disabled:h})}):null]})}},323696:(e,n,t)=>{t.r(n),t.d(n,{default:()=>_});var o=t(324586),r=t(586330),c=t(514041),a=t(728234),u=t(241440),i=t(908867),s=t(490343),l=t(310955),d=t(796895),m=t(24284),f=t(927799),p=t(980342),A=t(333597),g=t(507140),h=t(278484),b=t(748032),x=t(905710),y=t(789094),w=t(831085);function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach((function(n){(0,o.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const _=function LnurlPayRequestModal(){var e,n,t,o=(0,i.A)(),_=(0,a.lq)().params,S=(0,m.A)(),{$sourceInfo:v}=S,{accountId:j,networkId:I,lnurlDetails:C,transfersInfo:N}=_.isSendFlow?_:S,k=(0,d.A)({id:null!=(e=v?.id)?e:"",closeWindowAfterResolved:!0}),O=(0,c.useMemo)((function(){if(C?.url)return new URL(C.url).origin}),[C?.url]),[M,L]=(0,c.useState)(!1),D=(0,f.E)({accountId:j,networkId:I}),{showContinueOperate:F,continueOperate:R,setContinueOperate:P,riskLevel:$,urlSecurityInfo:T}=(0,x.q)({origin:null!=O?O:""}),H=Math.floor(Number(null!=(n=C?.minSendable)?n:0)/1e3),W=Math.floor(Number(null!=(t=C?.maxSendable)?t:0)/1e3),q=(0,s.useForm)({defaultValues:{amount:H>0&&H===W?`${H}`:"",comment:""}}),z=(0,c.useMemo)((function(){return C&&"number"==typeof C.commentAllowed&&C.commentAllowed>0?C.commentAllowed:0}),[C]),E=(0,c.useCallback)((0,r.A)((function*(){if(C&&!M){L(!0);var e,{serviceLightning:n}=l.A,t=q.getValues(),r=new u.A(t.amount).times(1e3).toNumber();try{var c={amount:r,comment:t.comment?t.comment:void 0};e=yield n.fetchLnurlPayRequestResult({callback:C.callback,params:c})}catch(e){return console.log("fetchLnurlPayRequestResult error: ",e),L(!1),void k.reject()}try{var a=e.pr;(yield n.verifyInvoice({paymentInfo:e,metadata:C.metadata,amount:r,networkId:I,accountId:j}))||s.Toast.error({title:o.formatMessage({id:"msg__invalid_lightning_payment_request"})});var i=N[0],d=[_objectSpread(_objectSpread({},i),{},{to:a,lnurlPaymentInfo:e,lightningAddress:(0,A.RT)(i.to)?i.to:void 0})];yield D.normalizeSendConfirm({transfersInfo:d,sameModal:!0})}catch(e){var m;throw console.log("lnurl withdraw error: ",e),k.reject(),new g.oZ({info:null!=(m=e.message)?m:e,autoToast:!0})}finally{L(!1)}}})),[q,M,C,I,j,N,k,o,D]);return(0,w.jsx)(p.A,{dappApprove:k,children:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(s.Page.Header,{headerShown:!1}),(0,w.jsx)(s.Page.Body,{children:(0,w.jsxs)(b.HJ,{title:o.formatMessage({id:"title__lnurl_pay"}),subtitleShown:!1,origin:null!=O?O:"",urlSecurityInfo:T,children:[_.isSendFlow?(0,w.jsx)(h.X1,{}):(0,w.jsx)(h.ZY,{readonly:!0}),(0,w.jsx)(y.A,{accountId:j,networkId:I,useFormReturn:q,amount:H===W?H:void 0,amountReadOnly:H===W,minimumAmount:H,maximumAmount:W,commentAllowedLength:z,metadata:C.metadata})]})}),(0,w.jsx)(s.Page.Footer,{children:(0,w.jsx)(b.OS,{confirmText:"Continue",continueOperate:R,setContinueOperate:function(e){P(!!e)},onConfirm:E,onCancel:function(){_.isSendFlow||k.reject()},confirmButtonProps:{loading:M,disabled:!R},showContinueOperateCheckbox:F,riskLevel:$})})]})})}}}]);