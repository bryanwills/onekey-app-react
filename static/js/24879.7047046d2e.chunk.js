"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[24879],{567967:(e,t,r)=>{r.d(t,{Xp:()=>n.Xp,yZ:()=>useBrowserAction,Gd:()=>useBrowserBookmarkAction,cS:()=>useBrowserHistoryAction,AO:()=>useBrowserTabActions,AS:()=>n.AS,Do:()=>n.Do,pJ:()=>n.pJ,nD:()=>n.nD});var n=r(603614),a=r(586330),o=r(324586),i=r(946343),s=r.n(i),l=r(230414),c=r(929296),u=r(195309),d=r(972715),b=r(514041),f=r(490343),p=r(310955),m=r(262873),y=r(714178),k=r(971670),v=r(660015),g=r(849726),w=(r(663522),r(730223),r(657355)),h=r(482407),D=r(796151),A=function(e){return e.Valid="Valid",e.InvalidUrl="InvalidUrl",e.NotSupportProtocol="NotSupportProtocol",e.ValidDeeplink="ValidDeeplink",e.InvalidPunycode="InvalidPunycode",e}({});function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,o.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var r,n=(0,d.A)(e);if(t){var a=(0,d.A)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.A)(this,r)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}var I={};var B="about:blank",S={id:"home",url:B,title:"OneKey",canGoBack:!1,loading:!1,favicon:""},T=function(e){(0,c.A)(ContextJotaiActionsDiscovery,e);var t=_createSuper(ContextJotaiActionsDiscovery);function ContextJotaiActionsDiscovery(...e){var r,o,i,l,c,u,d,b,y;return(r=t.call(this,...e)).setDisplayHomePage=(0,n.q0)((function(e,t,r){t((0,n.QL)(),r)})),r.buildWebTabs=(0,n.q0)((function(e,t,r){var a=e((0,n.cl)()),{data:o,options:i}=r,l=o;if(!Array.isArray(o))throw new Error("setWebTabsWriteAtom: payload must be an array");l&&l.length||(l=[]);var c=function buildWebTabData(e){var t={},r=[];return e.sort((function(e,t){return e.timestamp&&t.timestamp?e.timestamp-t.timestamp:0})),e.forEach((function(e){r.push(e.id),t[e.id]=e})),{data:e,keys:r,map:t}}(l);s()(c.keys,a.keys)&&!i?.forceUpdate||t((0,n.cl)(),{keys:c.keys,tabs:c.data}),t((0,n.GW)(),(function(){return c.map})),p.A.simpleDb.browserTabs.setRawData({tabs:c.data})})),r.refreshTabs=(0,n.q0)((function(e,t){var{tabs:a}=e((0,n.cl)()),o=[...a];r.buildWebTabs.call(t,{data:o,options:{forceUpdate:!0}})})),r.setCurrentWebTab=(0,n.q0)((function(e,t,a){var o=e((0,n.WL)());if(o!==a){r.pauseDappInteraction.call(t,o);var{tabs:i}=e((0,n.cl)()),s=i.findIndex((function(e){return e.id===a}));i.forEach((function(e){e.isActive=!1})),r.buildWebTabs.call(t,{data:[...i]}),-1!==s?(i[s].isActive=!0,t((0,n.WL)(),a),r.resumeDappInteraction.call(t,a)):t((0,n.WL)(),"")}var l=e((0,n.QL)());a&&l&&r.setDisplayHomePage.call(t,!1),a||l||r.setDisplayHomePage.call(t,!0)})),r.addWebTab=(0,n.q0)((function(e,t,a){var o,i=performance.now(),{tabs:s}=e((0,n.cl)());a.id&&a.id!==S.id||(a.id=(0,h.lk)()),a.timestamp=Date.now(),r.buildWebTabs.call(t,{data:[...s,a]}),r.setCurrentWebTab.call(t,null!=(o=a.id)?o:"");var l=performance.now();console.log(`addBlankWebTab took ${l-i} milliseconds.`)})),r.addBlankWebTab=(0,n.q0)((function(e,t){r.addWebTab.call(t,_objectSpread(_objectSpread({},S),{},{isActive:!0}))})),r.setWebTabData=(0,n.q0)((function(e,t,a){var{tabs:o}=e((0,n.cl)()),i=o,s=i.findIndex((function(e){return e.id===a.id}));if(s>-1){var l=i[s];Object.keys(a).forEach((function(e){var t=e,r=a[t];if(void 0!==r&&r!==l[t]){if("title"===t&&!r)return;l[t]=r,"url"===t&&(l.timestamp=Date.now(),"about:blank"===r&&a.id&&(I[a.id]=l.timestamp))}})),i[s]=l,r.buildWebTabs.call(t,{data:i})}})),r.closeWebTab=(0,n.q0)((function(e,t,a){delete v.O3[a];var{tabs:o}=e((0,n.cl)()),i=e((0,n.WL)()),s=o.findIndex((function(e){return e.id===a}));if(-1!==s){var l=o[s].id===i;if(o.splice(s,1),l){var c=s-1;if(c<0&&o.length>0&&(c=0),c>=0){var u=o[c];u.isActive=!0,r.setCurrentWebTab.call(t,u.id)}}}r.buildWebTabs.call(t,{data:[...o]})})),r.closeAllWebTabs=(0,n.q0)((function(e,t){var{tabs:a}=e((0,n.cl)()),o=e((0,n.WL)()),i=a.filter((function(e){return e.isPinned}));i.every((function(e){return e.id!==o}))&&r.setCurrentWebTab.call(t,null);var _loop=function(e){i.find((function(t){return t.id===e}))||delete v.O3[e]};for(var s of Object.getOwnPropertyNames(v.O3))_loop(s);r.buildWebTabs.call(t,{data:i})})),r.setPinnedTab=(0,n.q0)((function(e,t,n){r.setWebTabData.call(t,{id:n.id,isPinned:n.pinned,timestamp:Date.now()}),r.refreshTabs.call(t)})),r.syncBookmark=(0,n.q0)((function(e,t,a){var o=e((0,n.GW)());o&&Object.entries(o).forEach((function([,e]){e.url===a.url&&r.setWebTabData.call(t,{id:e.id,isBookmark:a.isBookmark})}))})),r.getBookmarkData=(0,n.q0)((0,a.A)((function*(){var e;return null!=(e=(yield p.A.simpleDb.browserBookmarks.getRawData())?.data)?e:[]}))),r.buildBookmarkData=(0,n.q0)((function(e,t,r){if(!Array.isArray(r))throw new Error("buildBookmarkData: payload must be an array");p.A.simpleDb.browserBookmarks.setRawData({data:r})})),r.addBrowserBookmark=(0,n.q0)((o=(0,a.A)((function*(e,t,n){if(n.url&&n.url!==S.url){var a=[...(yield r.getBookmarkData.call(t)).filter((function(e){return e.url!==n.url})),{url:n.url,title:n.title}];r.buildBookmarkData.call(t,a),r.syncBookmark.call(t,{url:n.url,isBookmark:!0}),p.A.serviceCloudBackup.requestAutoBackup()}})),function(e,t,r){return o.apply(this,arguments)})),r.removeBrowserBookmark=(0,n.q0)((i=(0,a.A)((function*(e,t,n){var a=(yield r.getBookmarkData.call(t)).filter((function(e){return e.url!==n}));r.buildBookmarkData.call(t,a),r.syncBookmark.call(t,{url:n,isBookmark:!1})})),function(e,t,r){return i.apply(this,arguments)})),r.modifyBrowserBookmark=(0,n.q0)((l=(0,a.A)((function*(e,t,n){if(n.url&&n.url!==S.url){var a=(yield r.getBookmarkData.call(t)).map((function(e){return e.url===n.url?_objectSpread(_objectSpread({},e),n):e}));r.buildBookmarkData.call(t,a)}})),function(e,t,r){return l.apply(this,arguments)})),r.getHistoryData=(0,n.q0)((0,a.A)((function*(){var e;return null!=(e=(yield p.A.simpleDb.browserHistory.getRawData())?.data)?e:[]}))),r.buildHistoryData=(0,n.q0)((function(e,t,r){if(!Array.isArray(r))throw new Error("buildHistoryData: payload must be an array");p.A.simpleDb.browserHistory.setRawData({data:r})})),r.addBrowserHistory=(0,n.q0)((c=(0,a.A)((function*(e,t,n){if(n.url&&n.url!==S.url){var a=(yield r.getHistoryData.call(t)).filter((function(e){return e.url!==n.url})),o={id:(0,h.lk)(),url:n.url,title:n.title,createdAt:Date.now()};r.buildHistoryData.call(t,[o,...a])}})),function(e,t,r){return c.apply(this,arguments)})),r.removeBrowserHistory=(0,n.q0)((u=(0,a.A)((function*(e,t,n){var a=(yield r.getHistoryData.call(t)).filter((function(e){return e.id!==n}));r.buildHistoryData.call(t,a)})),function(e,t,r){return u.apply(this,arguments)})),r.removeAllBrowserHistory=(0,n.q0)((d=(0,a.A)((function*(e,t){r.buildHistoryData.call(t,[])})),function(e,t){return d.apply(this,arguments)})),r.getWebTabById=(0,n.q0)((function(e,t,r){var a=e((0,n.GW)());return a?.[r||""]})),r.gotoSite=(0,n.q0)((b=(0,a.A)((function*(e,t,{id:n,url:a,title:o,favicon:i,isNewWindow:s,isInPlace:l,userTriggered:c}){var u=r.getWebTabById.call(t,null!=n?n:"");if(a){var d=D.Ay.validateUrl(a);if(!d)return;if(c&&r.addBrowserHistory.call(t,{url:d,title:null!=o?o:""}),"StandardBrowser"===v.n5)return(0,k.C)(d);var b=u?.id,f=!d.startsWith("http")&&"about:blank"!==d,p="boolean"==typeof s?s:(s||!b||"home"===b||f)&&"MultiTabBrowser"===v.n5,m=yield r.getBookmarkData.call(t),y=m?.some((function(e){return e.url.includes(d)}));return p?r.addWebTab.call(t,{title:o,url:d,favicon:i,isBookmark:y}):r.setWebTabData.call(t,{id:b,url:d,title:o,favicon:i,isBookmark:y}),p||l||(0,v.T0)({url:d,tabId:b}),f&&"MultiTabBrowser"===v.n5&&b&&setTimeout((function(){r.closeWebTab.call(t,b)}),1e3),!0}return!1})),function(e,t,r){return b.apply(this,arguments)})),r.openMatchDApp=(0,n.q0)((y=(0,a.A)((function*(e,t,{dApp:n,webSite:a,isNewWindow:o,tabId:i}){return a?r.gotoSite.call(t,{id:i,url:a.url,title:a.title,favicon:yield p.A.serviceDiscovery.buildWebsiteIconUrl(a.url),isNewWindow:o,userTriggered:!0}):n?r.gotoSite.call(t,{id:i,url:n.url,title:n.name,dAppId:n.dappId,favicon:n.logo||n.originLogo,userTriggered:!0,isNewWindow:o}):void 0})),function(e,t,r){return y.apply(this,arguments)})),r.handleOpenWebSite=(0,n.q0)((function(e,t,{useCurrentWindow:a,tabId:o,navigation:i,webSite:s,dApp:l,shouldPopNavigation:c=!0}){var u=!a;if(!a&&e((0,n.$D)()))return void f.Toast.message({title:g.a.intl.formatMessage({id:"msg__tab_has_reached_the_maximum_limit_of_str"},{0:"20"})});r.setDisplayHomePage.call(t,!1),r.openMatchDApp.call(t,{webSite:s,dApp:l,isNewWindow:u,tabId:o}),c&&i.pop()})),r.onNavigation=(0,n.q0)((function(e,t,{url:a,isNewWindow:o,isInPlace:i,title:s,favicon:l,canGoBack:c,canGoForward:u,loading:d,id:b,handlePhishingUrl:f}){var p=Date.now(),y=r.getWebTabById.call(t,null!=b?b:"");if(y){var k="string"==typeof a&&a!==y.url;if(a){var v=e((0,n.RY)()),{action:g}=D.Ay.parseDappRedirect(a,Array.from(v.keys()));if(g===D.Ay.EDAppOpenActionEnum.DENY)return void f?.(a);if(D.Ay.isValidDeepLink(a))return void(0,m.q)({url:a})}if(k){if(y.timestamp&&p-y.timestamp<500)return;if(I[y.id]&&a!==S.url&&p-I[y.id]<1e3)return;r.gotoSite.call(t,{url:a,title:s,favicon:l,isNewWindow:o,isInPlace:i,id:y.id})}r.setWebTabData.call(t,{id:y.id,title:s,favicon:l,canGoBack:c,canGoForward:u,loading:d})}})),r.addUrlToPhishingCache=(0,n.q0)((function(e,t,r){try{var{origin:a}=new URL(r.url),o=e((0,n.RY)());o.set(a,!0),t((0,n.RY)(),o),window.desktopApi?.setAllowedPhishingUrls(Array.from(o.keys()))}catch{}})),r.updateDappActivityInteraction=(0,n.q0)((function(e,t,r){var a=r.id;a||(a=e((0,n.WL)()));var o=a?v.O3[a]:null;if(o){var i="pause"===r.type;i?v.ay:v.F;o.jsBridge&&(o.jsBridge.globalOnMessageEnabled=!i)}})),r.pauseDappInteraction=(0,n.q0)((function(e,t,n){r.updateDappActivityInteraction.call(t,{id:n,type:"pause"})})),r.resumeDappInteraction=(0,n.q0)((function(e,t,n){r.updateDappActivityInteraction.call(t,{id:n,type:"resume"})})),r.validateWebviewSrc=(0,n.q0)((function(e,t,r){if(!r)return A.InvalidUrl;if(r===B)return A.Valid;var a=e((0,n.RY)()),{action:o}=D.Ay.parseDappRedirect(r,Array.from(a.keys()));return o===D.Ay.EDAppOpenActionEnum.DENY?A.NotSupportProtocol:D.Ay.containsPunycode(r)?A.InvalidPunycode:D.Ay.isValidDeepLink(r)?A.ValidDeeplink:A.Valid})),r}return(0,l.A)(ContextJotaiActionsDiscovery)}(y.x),W=(0,w.j)((function(){return console.log("new ContextJotaiActionsDiscovery()",Date.now()),new T}));function useBrowserTabActions(){var e=W(),t=e.addWebTab.use(),r=e.addBlankWebTab.use(),n=e.buildWebTabs.use(),a=e.refreshTabs.use(),o=e.setWebTabData.use(),i=e.getWebTabById.use(),s=e.closeWebTab.use(),l=e.closeAllWebTabs.use(),c=e.setCurrentWebTab.use(),u=e.setPinnedTab.use(),d=e.setDisplayHomePage.use();return(0,b.useRef)({addWebTab:t,addBlankWebTab:r,buildWebTabs:n,refreshTabs:a,setWebTabData:o,getWebTabById:i,closeWebTab:s,closeAllWebTabs:l,setCurrentWebTab:c,setPinnedTab:u,setDisplayHomePage:d})}function useBrowserBookmarkAction(){var e=W(),t=e.buildBookmarkData.use(),r=e.getBookmarkData.use(),n=e.addBrowserBookmark.use(),a=e.removeBrowserBookmark.use(),o=e.modifyBrowserBookmark.use();return(0,b.useRef)({buildBookmarkData:t,getBookmarkData:r,addBrowserBookmark:n,removeBrowserBookmark:a,modifyBrowserBookmark:o})}function useBrowserHistoryAction(){var e=W(),t=e.buildHistoryData.use(),r=e.getHistoryData.use(),n=e.addBrowserHistory.use(),a=e.removeBrowserHistory.use(),o=e.removeAllBrowserHistory.use();return(0,b.useRef)({buildHistoryData:t,getHistoryData:r,addBrowserHistory:n,removeBrowserHistory:a,removeAllBrowserHistory:o})}function useBrowserAction(){var e=W(),t=e.gotoSite.use(),r=e.openMatchDApp.use(),n=e.handleOpenWebSite.use(),a=e.onNavigation.use(),o=e.addUrlToPhishingCache.use(),i=e.pauseDappInteraction.use(),s=e.resumeDappInteraction.use(),l=e.validateWebviewSrc.use();return(0,b.useRef)({gotoSite:t,openMatchDApp:r,handleOpenWebSite:n,onNavigation:a,addUrlToPhishingCache:o,pauseDappInteraction:i,resumeDappInteraction:s,validateWebviewSrc:l})}},574319:(e,t,r)=>{r.d(t,{D$:()=>useWebTabDataById,bI:()=>useDisabledAddedNewTab,cf:()=>useActiveTabId,oM:()=>useWebTabs,y:()=>useDisplayHomePageFlag});var n=r(514041),a=r(567967),useWebTabs=function(){var[e]=(0,a.pJ)();return(0,n.useMemo)((function(){return{tabs:e.tabs}}),[e])},useWebTabDataById=function(e){var[t]=(0,a.nD)();return(0,n.useMemo)((function(){return{tab:t[null!=e?e:""]}}),[t,e])},useActiveTabId=function(){var[e]=(0,a.Xp)();return(0,n.useMemo)((function(){return{activeTabId:e}}),[e])},useDisplayHomePageFlag=function(){var[e]=(0,a.Do)();return{displayHomePage:e}},useDisabledAddedNewTab=function(){var[e]=(0,a.AS)();return(0,n.useMemo)((function(){return{disabledAddedNewTab:e}}),[e])}},224879:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h,tabGridRefs:()=>w});var n=r(324586),a=r(514041),o=r(908867),i=r(17617),s=r(490343),l=r(498356),c=r(567967),u=r(730223),d=r(574319),b=r(831085);const f=function MobileTabListItem({id:e,activeTabId:t,onSelectedItem:r,onCloseItem:n,onLongPress:a}){var{tab:o}=(0,d.D$)(e),l=t===e;return(0,b.jsx)(s.Stack,{width:"100%",onPress:function(){r(e)},onLongPress:function(){a(e)},p:"$1",animation:"quick",pressStyle:{scale:.95},testID:`tab-modal-list-item-${e}`,children:(0,b.jsx)(s.Stack,{borderRadius:"$4",borderWidth:"$1",borderColor:l?"$brand6":"$transparent",p:"$0.5",borderCurve:"continuous",testID:l?`tab-modal-active-item-${e}`:`tab-modal-no-active-item-${e}`,children:(0,b.jsxs)(s.Group,{borderRadius:"$2.5",borderWidth:i.A.hairlineWidth,borderColor:"$borderSubdued",separator:(0,b.jsx)(s.Divider,{}),children:[(0,b.jsx)(s.Group.Item,{children:(0,b.jsxs)(s.XStack,{py:"$2",pl:"$2.5",pr:"$2",alignItems:"center",bg:"$bgSubdued",borderCurve:"continuous",children:[(0,b.jsxs)(s.Image,{size:"$4",borderRadius:"$1",children:[(0,b.jsx)(s.Image.Source,{src:o?.favicon}),(0,b.jsx)(s.Image.Fallback,{children:(0,b.jsx)(s.Icon,{name:"GlobusOutline",size:"$4"})}),(0,b.jsx)(s.Image.Loading,{children:(0,b.jsx)(s.Skeleton,{width:"100%",height:"100%"})})]}),(0,b.jsx)(s.SizableText,{flex:1,size:"$bodySm",textAlign:"left",numberOfLines:1,mx:"$2",children:o?.title||""}),(0,b.jsx)(s.IconButton,{variant:"tertiary",size:"small",icon:"CrossedSmallOutline",onPress:function(){return n(e)},testID:`tab-modal-header-close-${e}`})]})}),(0,b.jsx)(s.Group.Item,{children:(0,b.jsx)(s.Stack,{pb:"100%",children:(0,b.jsx)(s.Stack,{position:"absolute",left:0,top:0,right:0,bottom:0,children:(0,b.jsx)(s.Image,{w:"100%",h:"100%",borderBottomLeftRadius:10,borderBottomRightRadius:10,children:(0,b.jsx)(s.Image.Source,{source:{uri:o?.thumbnail}})})})})})]})})})};const p=function MobileTabListPinnedItem({id:e,activeTabId:t,onSelectedItem:r,onLongPress:n}){var{tab:a}=(0,d.D$)(e),o=t===e;return(0,b.jsx)(s.Stack,{flex:1,p:"$0.5",minWidth:"$28",maxWidth:"$40",borderRadius:"$4",borderWidth:4,borderColor:o?"$brand6":"$transparent",marginHorizontal:2,onPress:function(){r(e)},onLongPress:function(){n(e)},animation:"quick",pressStyle:{scale:.95},children:(0,b.jsxs)(s.XStack,{bg:"$bgStrong",p:"$2",alignItems:"center",borderRadius:"$2.5",testID:`tab-list-stack-pinned-${e}`,children:[(0,b.jsxs)(s.Image,{size:"$4",borderRadius:"$1",children:[(0,b.jsx)(s.Image.Source,{src:a?.favicon}),(0,b.jsx)(s.Image.Fallback,{delayMs:100,children:(0,b.jsx)(s.Icon,{name:"GlobusOutline",size:"$4"})}),(0,b.jsx)(s.Image.Loading,{children:(0,b.jsx)(s.Skeleton,{width:"100%",height:"100%"})})]}),(0,b.jsx)(s.SizableText,{flex:1,size:"$bodySm",numberOfLines:1,ml:"$2",children:a?.title||""})]})})};var m=r(416526),y=(m.A.get("window").width,r(684358)),k=r(663522);const v=function useBrowserOptionsAction(){return{handleShareUrl:(0,a.useCallback)((function(e){if(!e)throw new Error("url is required");setTimeout((function(){y.A.share(k.Ay.isNativeIOS?{url:e}:{message:e})}),300)}),[])}};var g=r(564452);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var w={};function TabToolBar({closeAllDisabled:e,onAddTab:t,onCloseAll:r,onDone:n}){var a=(0,o.A)();return(0,b.jsxs)(s.Stack,{py:"$2",flexDirection:"row",alignItems:"center",borderTopWidth:i.A.hairlineWidth,borderTopColor:"$borderSubdued",children:[(0,b.jsx)(s.Stack,{flex:1,alignItems:"center",justifyContent:"center",children:(0,b.jsx)(s.Button,{variant:"tertiary",size:"medium",onPress:r,disabled:e,testID:"tab-list-modal-close-all",children:a.formatMessage({id:"action__close_all_tabs"})})}),(0,b.jsx)(s.Stack,{flex:1,alignItems:"center",justifyContent:"center",children:(0,b.jsx)(s.IconButton,{variant:"secondary",size:"medium",icon:"PlusLargeOutline",testID:"browser-bar-add",onPress:t})}),(0,b.jsx)(s.Stack,{flex:1,alignItems:"center",justifyContent:"center",children:(0,b.jsx)(s.Button,{variant:"tertiary",size:"medium",onPress:n,testID:"tab-list-modal-done",children:a.formatMessage({id:"action__done"})})})]})}const h=(0,g.k)((function MobileTabListModal(){var e,t=(0,o.A)(),r=(0,l.A)(),{tabs:n}=(0,d.oM)(),i=(0,a.useMemo)((function(){return(null!=n?n:[]).filter((function(e){return!e.isPinned}))}),[n]),m=(0,a.useMemo)((function(){return(null!=n?n:[]).filter((function(e){return e.isPinned}))}),[n]),{disabledAddedNewTab:y}=(0,d.bI)(),{activeTabId:k}=(0,d.cf)(),{addBrowserBookmark:g,removeBrowserBookmark:w}=(0,c.Gd)().current,{closeAllWebTabs:h,setCurrentWebTab:D,closeWebTab:A,setPinnedTab:I,setDisplayHomePage:B}=(0,c.AO)().current,S=(0,a.useRef)(!1);(0,a.useEffect)((function(){S.current&&!n.length&&(B(!0),r.pop()),S.current=!1}),[n,B,r]);var T=(0,a.useRef)(null),{scrollIntoIndex:W,onLayout:j}=(0,s.useSafelyScrollIntoIndex)(T),x=(0,a.useRef)(null),{scrollIntoIndex:P,onLayout:_}=(0,s.useSafelyScrollIntoIndex)(x);(0,a.useEffect)((function(){var e=i.findIndex((function(e){return e.id===k}));if(e>-1)W({index:e,animated:!1});else{var t=m.findIndex((function(e){return e.id===k}));t>-1&&P({index:t,animated:!1})}}),[k,i,m,P,W]);var{handleShareUrl:O}=v(),$=(0,a.useCallback)((function(e,r,n){e?g({url:r,title:n}):w(r),s.Toast.success({title:e?t.formatMessage({id:"msg__bookmark_added"}):t.formatMessage({id:"msg__bookmark_removed"})})}),[g,w,t]),C=(0,a.useCallback)((function(e){O(e)}),[O]),R=(0,a.useCallback)((function(e,r){I({id:e,pinned:r}),s.Toast.success({title:r?t.formatMessage({id:"msg__pinned"}):t.formatMessage({id:"msg__unpinned"})})}),[I,t]),H=(0,a.useCallback)((function(e){S.current=!0,A(e)}),[A]),L=(0,a.useCallback)((function(){y?s.Toast.message({title:t.formatMessage({id:"msg__tab_has_reached_the_maximum_limit_of_str"},{0:"20"})}):(r.pop(),setTimeout((function(){r.pushModal(u.ry.DiscoveryModal,{screen:u.v1.SearchModal})}),0))}),[y,r,t]),M=(0,a.useCallback)((function(e,r){s.ActionList.show({title:"Options",sections:[{items:[{label:t.formatMessage({id:e.isBookmark?"actionn__remove_bookmark":"actionn__bookmark"}),icon:e.isBookmark?"StarSolid":"StarOutline",onPress:function(){var t;return $(!e.isBookmark,e.url,null!=(t=e.title)?t:"")},testID:"action-list-item-"+(e.isBookmark?"remove-bookmark":"bookmark")},{label:t.formatMessage({id:e.isPinned?"action__unpin":"action__pin"}),icon:e.isPinned?"ThumbtackSolid":"ThumbtackOutline",onPress:function(){return R(r,!e.isPinned)},testID:"action-list-item-"+(e.isPinned?"un-pin":"pin")},{label:t.formatMessage({id:"action__share"}),icon:"ShareOutline",onPress:function(){return C(e.url)},testID:"action-list-item-share"}]},{items:[{label:t.formatMessage({id:e.isPinned?"action__close_pin_tab":"form__close_tab"}),icon:"CrossedLargeOutline",onPress:function(){return H(r)},testID:"action-list-item-close-"+(e.isPinned?"close-pin-tab":"close-tab")}]}]})}),[$,R,C,H,t]),q=(0,a.useCallback)((function(e){return e.id}),[]),E=(0,a.useCallback)((function({item:e}){return(0,b.jsx)(f,_objectSpread(_objectSpread({},e),{},{activeTabId:k,onSelectedItem:function(e){D(e),r.pop()},onCloseItem:H,onLongPress:function(t){M(e,t)}}))}),[k,H,D,r,M]),N=(0,a.useCallback)((function({item:e}){return(0,b.jsx)(p,_objectSpread(_objectSpread({},e),{},{activeTabId:k,onSelectedItem:function(e){D(e),r.pop()},onCloseItem:H,onLongPress:function(t){M(e,t)}}))}),[r,D,k,H,M]),U=(0,a.useMemo)((function(){return 0===m.length?null:(0,b.jsx)(s.BlurView,{position:"absolute",left:"$2.5",bottom:"$2.5",right:"$2.5",borderRadius:"$5",bg:"$bgStrong",testID:"tab-pined-container",children:(0,b.jsx)(s.ListView,{contentContainerStyle:{p:"$1"},ref:x,onLayout:_,horizontal:!0,data:m,showsHorizontalScrollIndicator:!1,keyExtractor:function(e){return e.id},estimatedItemSize:"$28",renderItem:N})})}),[_,m,N]);return(0,b.jsxs)(s.Page,{children:[(0,b.jsx)(s.Page.Header,{title:t.formatMessage({id:"title__str_tabs"},{0:`${null!=(e=n.length)?e:0}`})}),(0,b.jsxs)(s.Page.Body,{children:[(0,b.jsx)(s.ListView,{ref:T,onLayout:j,estimatedItemSize:223,data:i,renderItem:E,keyExtractor:q,numColumns:2,showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!1,contentContainerStyle:{paddingHorizontal:10,paddingBottom:62},testID:"tab-container"}),U]}),(0,b.jsx)(s.Page.Footer,{children:(0,b.jsx)(TabToolBar,{closeAllDisabled:i.length<=0,onAddTab:L,onCloseAll:function(){S.current=!0,h()},onDone:function(){r.pop()}})})]})}))},660015:(e,t,r)=>{r.d(t,{F:()=>s,O3:()=>o,T0:()=>crossWebviewLoadUrl,ay:()=>i,n5:()=>a});var n=r(663522),a="StandardBrowser",o={};function getWebviewWrapperRef(e){var t=e?o[e]:null;return null!=t?t:null}function crossWebviewLoadUrl({url:e,tabId:t}){var r=getWebviewWrapperRef(t);console.log("crossWebviewLoadUrl >>>>",e),n.Ay.isRuntimeBrowser?r?.innerRef?.loadURL(e):r?.innerRef?.loadUrl(e)}var i="\n(function(){\n  if (window.WebSocket) {\n    if (!window.$$onekeyWebSocketSend) {\n      window.$$onekeyWebSocketSend = window.WebSocket.prototype.send;\n    }\n    window.WebSocket.prototype.send = () => {};\n  }\n})()\n",s="\n(function(){\n  if (\n    window.WebSocket &&\n    window.$$onekeyWebSocketSend\n  ) {\n    window.WebSocket.prototype.send = window.$$onekeyWebSocketSend;\n  }\n})()\n"}}]);